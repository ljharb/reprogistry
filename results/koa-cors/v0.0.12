[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-21T20:47:08.546Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:11.7.0",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "koa-cors@0.0.12",
			"name": "koa-cors",
			"version": "0.0.12",
			"location": "https://registry.npmjs.org/koa-cors/-/koa-cors-0.0.12.tgz",
			"integrity": "sha512-SWiDGUD8HSW/V6gPF91VEaazPVHbBW8Geq9to1Gy0qrO/mfoyfC4wBIA1+HpkWeIrBvZkeHyMDhusCSX0asBmQ==",
			"publishedAt": "2014-05-23T11:02:55.014Z",
			"publishedWith": {
				"node": null,
				"npm": "1.3.25"
			},
			"dependencies": {}
		},
		"source": {
			"integrity": null,
			"location": "https://github.com/evert0n/koa-cors.git",
			"spec": "github:evert0n/koa-cors#HEAD"
		},
		"comparisonHash": "9ef46a5bd31291e57cbab41e2f17c57bd6da0b5b",
		"diff": {
			"files": {
				".npmignore": {
					"match": false,
					"packageHash": "d11ca7319245e37c399ba3a881caf35ab073d95bf755351df4ec899077173ba3",
					"size": 97,
					"status": "missing-in-source"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -31,35 +31,49 @@\n ## Options\n \n ### origin\n-Configures the **Access-Control-Allow-Origin** CORS header. Expects a string (ex: http://example.com). Set to `true` to reflect the [request origin](http://tools.ietf.org/html/draft-abarth-origin-09), as defined by `req.header('Origin')`. Set to `false` to disable CORS. Can also be set to a function, which takes the request as the first parameter.\n+\n+Configures the **Access-Control-Allow-Origin** CORS header. Expects a string\n+(ex: http://example.com). Set to `true` to reflect the\n+[request origin](http://tools.ietf.org/html/draft-abarth-origin-09), as defined\n+by `req.header('Origin')`. Set to `false` to disable CORS. Can also be set to a\n+function, which takes the request as the first parameter.\n \n ### expose\n-Configures the **Access-Control-Expose-Headers** CORS header. Expects a comma-delimited string (ex: 'WWW-Authenticate,Server-Authorization') or an array (ex: `['WWW-Authenticate', 'Server-Authorization]`). Set this to pass the header, otherwise it is omitted.\n+\n+Configures the **Access-Control-Expose-Headers** CORS header. Expects a\n+comma-delimited string (ex: 'WWW-Authenticate,Server-Authorization') or an array\n+(ex: `['WWW-Authenticate', 'Server-Authorization']`). Set this to pass the\n+header, otherwise it is omitted.\n \n ### maxAge\n-Configures the **Access-Control-Max-Age** CORS header. Set to an integer to pass the header, otherwise it is omitted.\n+\n+Configures the **Access-Control-Max-Age** CORS header. Set to an integer to pass\n+the header, otherwise it is omitted.\n \n ### credentials\n-Configures the **Access-Control-Allow-Credentials** CORS header. Set to `true` to pass the header, otherwise it is omitted.\n+\n+Configures the **Access-Control-Allow-Credentials** CORS header. Set to `true`\n+to pass the header, otherwise it is omitted.\n \n ### methods\n-Configures the **Access-Control-Allow-Methods** CORS header. Expects a comma-delimited string (ex: 'GET,PUT,POST') or an array (ex: `['GET', 'PUT', 'POST']`).\n \n-### headers\n-Configures the **Access-Control-Allow-Headers** CORS header. Expects a comma-delimited string (ex: 'Content-Type,Authorization') or an array (ex: `['Content-Type', 'Authorization]`). If not specified, defaults to reflecting the headers specified in the request's **Access-Control-Request-Headers** header.\n+Configures the **Access-Control-Allow-Methods** CORS header. Expects a\n+comma-delimited string (ex: 'GET,PUT,POST') or an array (ex: `['GET', 'PUT',\n+'POST']`).\n \n+### headers\n+Configures the **Access-Control-Allow-Headers** CORS header. Expects a\n+comma-delimited string (ex: 'Content-Type,Authorization') or an array (ex:\n+`['Content-Type', 'Authorization']`). If not specified, defaults to reflecting\n+the headers specified in the request's **Access-Control-Request-Headers**\n+header.\n \n-For details on the effect of each CORS header, [read this article on HTML5 Rocks](http://www.html5rocks.com/en/tutorials/cors/).\n \n-## Todo\n+For details on the effect of each CORS header,\n+[read this article on HTML5 Rocks](http://www.html5rocks.com/en/tutorials/cors/).\n \n-- Unit tests\n-- Live demo\n \n ## License\n \n [MIT License](http://www.opensource.org/licenses/mit-license.php)\n \n-## Author\n-\n-[Everton Yoshitani](https://github.com/evert0n) ([everton@notreve.com](mailto:everton@notreve.com))\n",
					"match": false,
					"packageHash": "5453ab6a36429ef965285a81106b01efc1c0f73ca521b48725b86016691de99f",
					"size": 2248,
					"sourceHash": "5f3e4652fa506b7952823912417f9c73d146d474466a8b0ef68a29192b5c3906",
					"status": "content"
				},
				"index.js": {
					"diff": "--- published/index.js\n+++ rebuilt/index.js\n@@ -1,59 +1,85 @@\n+'use strict';\n+\n /**\n  * CORS middleware\n  *\n- * @param {Object} [settings]\n- * @return {Function}\n+ * @param {Object} [options]\n+ * @return {GeneratorFunction}\n  * @api public\n  */\n-module.exports = function(settings) {\n+module.exports = function getMiddleware(options) {\n+  \n+  options = options || {};\n \n   var defaults = {\n-    origin: function(req) {\n-      return req.header.origin || '*';\n-    },\n+    origin: true,\n     methods: 'GET,HEAD,PUT,POST,DELETE'\n   };\n \n-  return function* cors(next) {\n+  // Set defaults\n+  for (var key in defaults) {\n+    if (!options.hasOwnProperty(key)) {\n+      options[key] = defaults[key];\n+    }\n+  }\n \n-    /**\n-     * Set options\n-     *\n-     * @type {Object}\n-     */\n-    var options = settings || defaults;\n+  // Set expose\n+  if (Array.isArray(options.expose)) {\n+    options.expose = options.expose.join(',');\n+  }\n \n-    if (typeof options.origin === 'function') {\n-      options.origin = options.origin(this.request);\n-    }\n+  // Set maxAge\n+  if (typeof options.maxAge === 'number') {\n+    options.maxAge = options.maxAge.toString();\n+  } else {\n+    options.maxAge = null;\n+  }\n+\n+  // Set methods\n+  if (Array.isArray(options.methods)) {\n+    options.methods = options.methods.join(',');\n+  }\n+\n+  // Set headers\n+  if (Array.isArray(options.headers)) {\n+    options.headers = options.headers.join(',');\n+  }\n \n+  return function* cors(next) {\n+    \n     /**\n      * Access Control Allow Origin\n      */\n-    if (options.origin === false) {\n-      return;\n-    } else if (typeof options.origin === 'undefined' || options.origin === true) {\n-      options.origin = defaults.origin(this.request);\n+    var origin;\n+\n+    if (typeof options.origin === 'string') {\n+      origin = options.origin;\n+    } else if (options.origin === true) {\n+      origin = this.get('origin') || '*';\n+    } else if (options.origin === false) {\n+      origin = options.origin;\n+    } else if (typeof options.origin === 'function') {\n+      origin = options.origin(this.request);\n+    }\n+\n+    if (origin === false) {\n+       yield next; \n+       return ;\n     }\n-    this.set('Access-Control-Allow-Origin', options.origin);\n+\n+    this.set('Access-Control-Allow-Origin', origin);\n \n     /**\n      * Access Control Expose Headers\n      */\n     if (options.expose) {\n-      if (options.expose.join) {\n",
					"match": false,
					"packageHash": "f3f56ef1b7930ee797ded1df0aa6c4f5bb62ef14140fb836992905c4d3baede3",
					"size": 2321,
					"sourceHash": "4ed222f8877cc03f1370c16e474bf2da41123c4a38fbe90329be8bb20942c06f",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,10 +1,10 @@\n {\n   \"name\": \"koa-cors\",\n-  \"version\": \"0.0.12\",\n+  \"version\": \"0.0.16\",\n   \"description\": \"CORS middleware for Koa\",\n   \"main\": \"index.js\",\n   \"scripts\": {\n-    \"test\": \"npm test\"\n+    \"test\": \"mocha --harmony test\"\n   },\n   \"repository\": {\n     \"type\": \"git\",\n@@ -22,9 +22,9 @@\n   },\n   \"homepage\": \"https://github.com/evert0n/koa-cors\",\n   \"devDependencies\": {\n-    \"koa\": \"^0.6.1\",\n-    \"chai\": \"^1.9.1\",\n-    \"mocha\": \"^1.19.0\",\n-    \"superagent\": \"^0.18.0\"\n+    \"koa\": \"^0.18.0\",\n+    \"chai\": \"^2.0.0\",\n+    \"mocha\": \"^2.1.0\",\n+    \"superagent\": \"^0.21.0\"\n   }\n }\n",
					"match": false,
					"packageHash": "7daf5959d5a21a96d7fb3e3d0d83a4199dfb65bfbae636b655b36d0df6d2e86e",
					"size": 610,
					"sourceHash": "6b5bb6a1ccdddd953171c65dfb915dd878bad0d98a8a7a43ba6f05876a3227e9",
					"status": "content"
				},
				"test/index.js": {
					"diff": "--- published/test/index.js\n+++ rebuilt/test/index.js\n@@ -31,6 +31,21 @@\n       });\n   });\n \n+  it('should update \"Access-Control-Allow-Origin\" for each request', function(done) {\n+    superagent.get('http://localhost:3000')\n+      .end(function(response) {\n+        chai.expect(response.get('Access-Control-Allow-Origin')).to.equal('*');\n+\n+        superagent.get('http://localhost:3000')\n+          .set('Origin', 'localhost')\n+          .end(function(response) {\n+            chai.expect(response.get('Access-Control-Allow-Origin')).to.equal('localhost');\n+\n+            done();\n+          });\n+      });\n+  });\n+\n   it('should not set \"Access-Control-Expose-Headers\"', function(done) {\n     superagent.get('http://localhost:3000')\n       .end(function(response) {\n@@ -87,6 +102,20 @@\n       });\n   });\n \n+  it('should not fix value of \"Access-Control-Allow-Headers\"', function(done) {\n+    superagent.get('http://localhost:3000')\n+      .set('Access-Control-Request-Headers', 'X-Foo')\n+      .end(function() {\n+        superagent.get('http://localhost:3000')\n+          .set('Access-Control-Request-Headers', 'X-Bar')\n+          .end(function(response) {\n+            chai.expect(response.get('Access-Control-Allow-Headers')).to.equal('X-Bar');\n+\n+            done();\n+          });\n+      });\n+  });\n+\n });\n \n describe('cors({ origin: true })', function() {\n@@ -130,6 +159,55 @@\n \n         done();\n       });\n+  });\n+\n+});\n+\n+describe('cors({ origin: [function]})', function() {\n+\n+  beforeEach(function() {\n+    var originWhiteList = [\"localhost\", \"otherhost.com\"];\n+\n+    var originFunction = function(req) {\n+      var origin = req.header.origin;\n+      if (originWhiteList.indexOf(origin) !== -1) {\n+        return origin;\n+      }\n+      return false;\n+    }\n+\n+    setupServer({ origin: originFunction });\n+  });\n+\n+  it('should not set any \"Access-Control-Allow-*\" header', function(done) {\n+    superagent.get('http://localhost:3000')\n+    .set('Origin', 'example.com')\n+      .end(function(response) {\n+        chai.expect(response.get('Access-Control-Allow-Origin')).to.not.exist;\n+        chai.expect(response.get('Access-Control-Allow-Methods')).to.not.exist;\n+        chai.expect(response.statusCode).to.equal(200);\n+        done();\n+      });\n+  });\n+\n+  it('should set \"Access-Control-Allow-Origin\" to \"otherhost.com\"', function(done) {\n+    superagent.get('http://localhost:3000')\n+    .set('Origin', 'otherhost.com')\n+      .end(function(response) {\n+        chai.expect(response.get('Access-Control-Allow-Origin')).to.equal('otherhost.com');\n+\n+        done();\n+      });\n+  });\n+\n+  it('should set \"Access-Control-Allow-Origin\" to \"localhost\"', function(done) {\n+    superagent.get('http://localhost:3000')\n+    .set('Origin', 'localhost')\n+      .end(function(response) {\n+        chai.expect(response.get('Access-Control-Allow-Origin')).to.equal('localhost');\n+\n+        done();\n+      });\n   });\n \n",
					"match": false,
					"packageHash": "cb1709f3c0f1e9a882ae325c69a1115b8415eccfc389269e20c7bae3b4a7ffa9",
					"size": 5322,
					"sourceHash": "213dbd1830c21e91dd35854cb4d96a17324bd146560148f41a8654a3bece204d",
					"status": "content"
				},
				".jshintrc": {
					"match": false,
					"status": "missing-in-package"
				},
				"examples/custom-options.js": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 4,
				"matchingFiles": 4,
				"missingInPackage": 2,
				"missingInSource": 1,
				"score": 0.36363636363636365,
				"totalFiles": 11
			}
		},
		"prodDependencies": []
	}
]
