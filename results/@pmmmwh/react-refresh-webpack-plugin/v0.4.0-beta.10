[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-03T23:55:09.739Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:6.14.5",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "@pmmmwh/react-refresh-webpack-plugin@0.4.0-beta.10",
			"name": "@pmmmwh/react-refresh-webpack-plugin",
			"version": "0.4.0-beta.10",
			"location": "https://registry.npmjs.org/@pmmmwh/react-refresh-webpack-plugin/-/react-refresh-webpack-plugin-0.4.0-beta.10.tgz",
			"integrity": "sha512-yhshasySVdNNPJOLUd0CR+4dCQCIpdGDRNDipJSmD/ioJcEUln5ghSfTTpe1+PvpOuQc5w3bOOObo1hcQaoCkg==",
			"publishedAt": "2020-07-26T18:36:41.167Z",
			"publishedWith": {
				"node": "14.4.0",
				"npm": "6.14.7"
			}
		},
		"source": {
			"integrity": null,
			"location": "git+https://github.com/pmmmwh/react-refresh-webpack-plugin.git",
			"spec": "github:pmmmwh/react-refresh-webpack-plugin#c794e10777c84567371619de2d83320ad90e4873"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				"CHANGELOG.md": {
					"match": false,
					"packageHash": "1c590d382923606ff5e4f26a9d258d8aa3f8378aec39e09afa66448c4d9ffa15",
					"size": 1723,
					"status": "missing-in-source"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -1,16 +1,70 @@\n # React Refresh Webpack Plugin\n \n-[![Latest Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest)\n-[![Next Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next)\n-[![License](https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin)](./LICENSE)\n+[actions]: https://github.com/pmmmwh/react-refresh-webpack-plugin/actions/workflows/ci.yml\n+[actions:badge]: https://img.shields.io/github/actions/workflow/status/pmmmwh/react-refresh-webpack-plugin/ci.yml?branch=main\n+[license:badge]: https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin\n+[npm:latest]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest\n+[npm:latest:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest\n+[npm:next]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next\n+[npm:next:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next\n \n-An **EXPERIMENTAL** Webpack plugin to enable \"Fast Refresh\" (also previously known as _Hot Reloading_) for React components.\n+[![GitHub Actions][actions:badge]][actions]\n+[![License][license:badge]](./LICENSE)\n+[![Latest Version][npm:latest:badge]][npm:latest]\n+[![Next Version][npm:next:badge]][npm:next]\n \n-## Installation\n+A Webpack plugin to enable \"Fast Refresh\" (also known as _Hot Reloading_) for React components.\n \n-First - this plugin is not 100% stable.\n-It works pretty reliably, and we have been testing it for some time, but there are still edge cases yet to be discovered.\n-Please **DO NOT** use it if you cannot afford to face breaking changes in the future.\n+> We're hoping to land a v1 release soon - please help us by reporting any issues you've encountered!\n+\n+## Getting Started\n+\n+### Prerequisites\n+\n+Ensure that you are using at least the minimum supported versions of this plugin's peer dependencies -\n+older versions unfortunately do not contain code to orchestrate \"Fast Refresh\",\n+and thus cannot be made compatible.\n+\n+We recommend using the following versions:\n+\n+| Dependency      | Version                              |\n+| --------------- | ------------------------------------ |\n+| `Node.js`       | `18.12.0`+, `20.x`, `22.x`           |\n+| `react`         | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-dom`     | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-refresh` | `0.10.0`+                            |\n+| `webpack`       | `5.2.0`+                             |\n+\n+<details>\n+<summary>Minimum requirements</summary>\n+<br />\n+\n+| Dependency      | Version   |\n+| --------------- | --------- |\n+| `Node.js`       | `18.12.0` |\n+| `react`         | `16.9.0`  |\n+| `react-dom`     | `16.9.0`  |\n+| `react-refresh` | `0.10.0`  |\n+| `webpack`       | `5.2.0`   |\n+\n+</details>\n+\n+<details>\n+<summary>Using custom renderers (e.g. <code>react-three-fiber</code>, <code>react-pdf</code>, <code>ink</code>)</summary>\n+<br />\n+\n+To ensure full support of \"Fast Refresh\" with components rendered by custom renderers,\n+you should ensure the renderer you're using depends on a recent version of `react-reconciler`.\n+\n+We recommend version `0.25.0` or above, but any versions above `0.22.0` should work.\n+\n+If the renderer is not compatible, please file them an issue instead.\n+\n+</details>\n+\n+### Installation\n+\n+With all prerequisites met, you can install this plugin using your package manager of choice:\n \n ```sh\n # if you prefer npm\n@@ -18,64 +72,114 @@\n \n # if you prefer yarn\n yarn add -D @pmmmwh/react-refresh-webpack-plugin react-refresh\n+\n+# if you prefer pnpm\n+pnpm add -D @pmmmwh/react-refresh-webpack-plugin react-refresh\n+```\n+\n+The `react-refresh` package (from the React team) is a required peer dependency of this plugin.\n+We recommend using version `0.10.0` or above.\n+\n+<details>\n+<summary>Support for TypeScript</summary>\n+<br />\n+\n+TypeScript support is available out-of-the-box for those who use `webpack.config.ts`.\n+\n+Our exported types however depends on `type-fest`, so you'll have to add it as a `devDependency`:\n",
					"match": false,
					"packageHash": "0d52c194dc8642f98cb5b315be965d7d7ea04c1d6bbb7d3448bc064da980d5b4",
					"size": 9016,
					"sourceHash": "e685662008c7264a7a35a431aa151d0cb1e70a70a36cbcabd6c20164e7acb6b6",
					"status": "content"
				},
				"client/ErrorOverlayEntry.js": {
					"diff": "--- published/client/ErrorOverlayEntry.js\n+++ rebuilt/client/ErrorOverlayEntry.js\n@@ -1,86 +1,103 @@\n-/* global __react_refresh_error_overlay__, __react_refresh_init_socket__, __resourceQuery */\n+/* global __react_refresh_error_overlay__, __react_refresh_socket__ */\n \n-const errorEventHandlers = require('./utils/errorEventHandlers');\n-const formatWebpackErrors = require('./utils/formatWebpackErrors');\n+if (process.env.NODE_ENV !== 'production') {\n+  const events = require('./utils/errorEventHandlers.js');\n+  const formatWebpackErrors = require('./utils/formatWebpackErrors.js');\n+  const runWithRetry = require('./utils/retry.js');\n+\n+  // Setup error states\n+  let isHotReload = false;\n+  let hasRuntimeErrors = false;\n+\n+  /**\n+   * Try dismissing the compile error overlay.\n+   * This will also reset runtime error records (if any),\n+   * because we have new source to evaluate.\n+   * @returns {void}\n+   */\n+  const tryDismissErrorOverlay = function () {\n+    __react_refresh_error_overlay__.clearCompileError();\n+    __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n+    hasRuntimeErrors = false;\n+  };\n+\n+  /**\n+   * A function called after a compile success signal is received from Webpack.\n+   * @returns {void}\n+   */\n+  const handleCompileSuccess = function () {\n+    isHotReload = true;\n \n-// Setup error states\n-let isHotReload = false;\n-let hasRuntimeErrors = false;\n-\n-/**\n- * Try dismissing the compile error overlay.\n- * This will also reset runtime error records (if any),\n- * because we have new source to evaluate.\n- * @returns {void}\n- */\n-function tryDismissErrorOverlay() {\n-  __react_refresh_error_overlay__.clearCompileError();\n-  __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n-  hasRuntimeErrors = false;\n-}\n-\n-/**\n- * A function called after a compile success signal is received from Webpack.\n- * @returns {void}\n- */\n-function handleCompileSuccess() {\n-  isHotReload = true;\n-\n-  if (isHotReload) {\n-    tryDismissErrorOverlay();\n-  }\n-}\n-\n-/**\n- * A function called after a compile errored signal is received from Webpack.\n- * @param {string} errors\n- * @returns {void}\n- */\n-function handleCompileErrors(errors) {\n-  isHotReload = true;\n+    if (isHotReload) {\n+      tryDismissErrorOverlay();\n+    }\n+  };\n \n-  const formattedErrors = formatWebpackErrors(errors);\n+  /**\n+   * A function called after a compile errored signal is received from Webpack.\n+   * @param {string[]} errors\n+   * @returns {void}\n+   */\n+  const handleCompileErrors = function (errors) {\n+    isHotReload = true;\n+\n+    const formattedErrors = formatWebpackErrors(errors);\n+\n+    // Only show the first error\n+    __react_refresh_error_overlay__.showCompileError(formattedErrors[0]);\n+  };\n+\n+  /**\n+   * Handles compilation messages from Webpack.\n+   * Integrates with a compile error overlay.\n+   * @param {*} message A Webpack HMR message sent via WebSockets.\n+   * @returns {void}\n+   */\n+  const compileMessageHandler = function (message) {\n+    switch (message.type) {\n+      case 'ok':\n",
					"match": false,
					"packageHash": "6960d46c2faeeec85a73b2da2432b9d43c6bb0441993ab79c6baa342efb53759",
					"size": 2439,
					"sourceHash": "5b57c45de0030d6d220c5882d9de66aa6b4509296c885fdee27157989ec06ff1",
					"status": "content"
				},
				"client/LegacyWDSSocketEntry.js": {
					"match": false,
					"packageHash": "8f17eb150643e9735cdc8641a27e643bcc2383d999a229a078f158ef566077fb",
					"size": 768,
					"status": "missing-in-source"
				},
				"client/ReactRefreshEntry.js": {
					"diff": "--- published/client/ReactRefreshEntry.js\n+++ rebuilt/client/ReactRefreshEntry.js\n@@ -1,13 +1,23 @@\n-const safeThis = require('./utils/safeThis');\n+/* global __react_refresh_library__ */\n \n-if (process.env.NODE_ENV !== 'production' && typeof safeThis !== 'undefined') {\n-  // Only inject the runtime if it hasn't been injected\n-  if (!safeThis.__reactRefreshInjected) {\n-    const RefreshRuntime = require('react-refresh/runtime');\n-    // Inject refresh runtime into global scope\n-    RefreshRuntime.injectIntoGlobalHook(safeThis);\n+if (process.env.NODE_ENV !== 'production') {\n+  const safeThis = require('core-js-pure/features/global-this');\n+  const RefreshRuntime = require('react-refresh/runtime');\n \n-    // Mark the runtime as injected to prevent double-injection\n-    safeThis.__reactRefreshInjected = true;\n+  if (typeof safeThis !== 'undefined') {\n+    var $RefreshInjected$ = '__reactRefreshInjected';\n+    // Namespace the injected flag (if necessary) for monorepo compatibility\n+    if (typeof __react_refresh_library__ !== 'undefined' && __react_refresh_library__) {\n+      $RefreshInjected$ += '_' + __react_refresh_library__;\n+    }\n+\n+    // Only inject the runtime if it hasn't been injected\n+    if (!safeThis[$RefreshInjected$]) {\n+      // Inject refresh runtime into global scope\n+      RefreshRuntime.injectIntoGlobalHook(safeThis);\n+\n+      // Mark the runtime as injected to prevent double-injection\n+      safeThis[$RefreshInjected$] = true;\n+    }\n   }\n }\n",
					"match": false,
					"packageHash": "29c958b9a529b275b801aaf4e3421a6dae9beff6587213256955249b54f1da95",
					"size": 500,
					"sourceHash": "ccbc4d04b16eda9ca493dae2f1e6a39a402921475524758a2b230d2e71a5a513",
					"status": "content"
				},
				"client/utils/errorEventHandlers.js": {
					"diff": "--- published/client/utils/errorEventHandlers.js\n+++ rebuilt/client/utils/errorEventHandlers.js\n@@ -90,7 +90,13 @@\n   return register;\n }\n \n+const handleError = createWindowEventHandler('error', createErrorHandler);\n+const handleUnhandledRejection = createWindowEventHandler(\n+  'unhandledrejection',\n+  createRejectionHandler\n+);\n+\n module.exports = {\n-  error: createWindowEventHandler('error', createErrorHandler),\n-  unhandledRejection: createWindowEventHandler('unhandledrejection', createRejectionHandler),\n+  handleError: handleError,\n+  handleUnhandledRejection: handleUnhandledRejection,\n };\n",
					"match": false,
					"packageHash": "b49f9b5755cd5067b74ab9296e5f2c00d83301e7343fe7f9478f21fb22d70e9f",
					"size": 2979,
					"sourceHash": "8ead621aabe6935b60ed558ba0efe3fdf257daff6f7b3bf13cf58bc5e4b832b4",
					"status": "content"
				},
				"client/utils/formatWebpackErrors.js": {
					"diff": "--- published/client/utils/formatWebpackErrors.js\n+++ rebuilt/client/utils/formatWebpackErrors.js\n@@ -85,6 +85,7 @@\n     // Webpack 4 compilation errors are strings\n     return formatMessage(errorObjOrMessage);\n   });\n+\n   if (formattedErrors.some(isLikelyASyntaxError)) {\n     // If there are any syntax errors, show just them.\n     formattedErrors = formattedErrors.filter(isLikelyASyntaxError);\n",
					"match": false,
					"packageHash": "25d1ed68f90be09d8ec3912c333bfb4efc54430b01b61225ebbc15eb72e8e06f",
					"size": 3424,
					"sourceHash": "77db52026d9039bbae04186437b097a963b10acf10e5f111c8e54106f076eb4e",
					"status": "content"
				},
				"client/utils/safeThis.js": {
					"match": false,
					"packageHash": "149c55322d80514e02a1262aee414c7a961c6ddb31424c79679bffa77d91c363",
					"size": 523,
					"status": "missing-in-source"
				},
				"lib/globals.js": {
					"diff": "--- published/lib/globals.js\n+++ rebuilt/lib/globals.js\n@@ -1,12 +1,8 @@\n-const { version } = require('webpack');\n-\n-// Parse Webpack's major version: x.y.z => x\n-const webpackVersion = parseInt(version || '', 10);\n-\n-let webpackGlobals = {};\n-if (webpackVersion === 5) {\n-  webpackGlobals = require('webpack/lib/RuntimeGlobals');\n-}\n-\n-module.exports.refreshGlobal = `${webpackGlobals.require || '__webpack_require__'}.$Refresh$`;\n-module.exports.webpackVersion = webpackVersion;\n+/**\n+ * Gets current bundle's global scope identifier for React Refresh.\n+ * @param {Record<string, string>} runtimeGlobals The Webpack runtime globals.\n+ * @returns {string} The React Refresh global scope within the Webpack bundle.\n+ */\n+module.exports.getRefreshGlobalScope = (runtimeGlobals) => {\n+  return `${runtimeGlobals.require || '__webpack_require__'}.$Refresh$`;\n+};\n",
					"match": false,
					"packageHash": "a427f548ead9053d81883fa66ba623c6ed59bc828bde9a28657af7efe056cef1",
					"size": 396,
					"sourceHash": "47fc9689ab1a550044fb41caec41a17e88482e61d6d0f97ac9fbceaa9dcba4c5",
					"status": "content"
				},
				"lib/index.js": {
					"diff": "--- published/lib/index.js\n+++ rebuilt/lib/index.js\n@@ -1,47 +1,15 @@\n-const validateOptions = require('schema-utils');\n-const { DefinePlugin, ModuleFilenameHelpers, ProvidePlugin, Template } = require('webpack');\n-const ConstDependency = require('webpack/lib/dependencies/ConstDependency');\n-const { refreshGlobal, webpackVersion } = require('./globals');\n+const { validate: validateOptions } = require('schema-utils');\n+const { getRefreshGlobalScope } = require('./globals');\n const {\n-  createError,\n-  getParserHelpers,\n-  getRefreshGlobal,\n+  getAdditionalEntries,\n+  getIntegrationEntry,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n+  makeRefreshRuntimeModule,\n   normalizeOptions,\n } = require('./utils');\n const schema = require('./options.json');\n \n-// Mapping of react-refresh globals to Webpack runtime globals\n-const REPLACEMENTS = {\n-  $RefreshRuntime$: {\n-    expr: `${refreshGlobal}.runtime`,\n-    req: [`${refreshGlobal}.runtime`],\n-    type: 'object',\n-  },\n-  $RefreshSetup$: {\n-    expr: `${refreshGlobal}.setup`,\n-    req: [`${refreshGlobal}.setup`],\n-    type: 'function',\n-  },\n-  $RefreshCleanup$: {\n-    expr: `${refreshGlobal}.cleanup`,\n-    req: [`${refreshGlobal}.cleanup`],\n-    type: 'function',\n-  },\n-  $RefreshReg$: {\n-    expr: `${refreshGlobal}.register`,\n-    req: [`${refreshGlobal}.register`],\n-    type: 'function',\n-  },\n-  $RefreshSig$: {\n-    expr: `${refreshGlobal}.signature`,\n-    req: [`${refreshGlobal}.signature`],\n-    type: 'function',\n-  },\n-};\n-\n class ReactRefreshPlugin {\n   /**\n    * @param {import('./types').ReactRefreshPluginOptions} [options] Options for react-refresh-plugin.\n@@ -65,12 +33,6 @@\n    * @returns {void}\n    */\n   apply(compiler) {\n-    // Throw if we encounter an unsupported Webpack version,\n-    // since things will most likely not work.\n-    if (webpackVersion !== 4 && webpackVersion !== 5) {\n-      throw createError(`Webpack v${webpackVersion} is not supported!`);\n-    }\n-\n     // Skip processing in non-development mode, but allow manual force-enabling\n     if (\n       // Webpack do not set process.env.NODE_ENV, so we need to check for mode.\n@@ -84,39 +46,140 @@\n       return;\n     }\n \n-    // Inject react-refresh context to all Webpack entry points\n-    compiler.options.entry = injectRefreshEntry(compiler.options.entry, this.options);\n+    const logger = compiler.getInfrastructureLogger(this.constructor.name);\n+\n+    // Get Webpack imports from compiler instance (if available) -\n+    // this allow mono-repos to use different versions of Webpack without conflicts.\n+    const webpack = compiler.webpack || require('webpack');\n+    const {\n+      DefinePlugin,\n+      EntryDependency,\n+      EntryPlugin,\n+      ModuleFilenameHelpers,\n+      NormalModule,\n+      ProvidePlugin,\n+      RuntimeGlobals,\n+      Template,\n+    } = webpack;\n+\n+    // Inject react-refresh context to all Webpack entry points.\n+    const { overlayEntries, prependEntries } = getAdditionalEntries(this.options);\n+    // Prepended entries does not care about injection order,\n+    // so we can utilise EntryPlugin for simpler logic.\n+    for (const entry of prependEntries) {\n+      new EntryPlugin(compiler.context, entry, { name: undefined }).apply(compiler);\n+    }\n+\n+    const integrationEntry = getIntegrationEntry(this.options.overlay.sockIntegration);\n+    const socketEntryData = [];\n",
					"match": false,
					"packageHash": "820cbf7e5acbc09410f28401d1764dd98747fdbccd92e9e67ab62dfcf66a5b53",
					"size": 11805,
					"sourceHash": "903041123290f427ef671589fdbc43d6289441ac77157434b0683572915a2e32",
					"status": "content"
				},
				"lib/options.json": {
					"diff": "--- published/lib/options.json\n+++ rebuilt/lib/options.json\n@@ -2,6 +2,7 @@\n   \"additionalProperties\": false,\n   \"type\": \"object\",\n   \"definitions\": {\n+    \"Path\": { \"type\": \"string\" },\n     \"MatchCondition\": {\n       \"anyOf\": [{ \"instanceof\": \"RegExp\" }, { \"$ref\": \"#/definitions/Path\" }]\n     },\n@@ -10,6 +11,24 @@\n       \"items\": { \"$ref\": \"#/definitions/MatchCondition\" },\n       \"minItems\": 1\n     },\n+    \"ESModuleOptions\": {\n+      \"additionalProperties\": false,\n+      \"type\": \"object\",\n+      \"properties\": {\n+        \"exclude\": {\n+          \"anyOf\": [\n+            { \"$ref\": \"#/definitions/MatchCondition\" },\n+            { \"$ref\": \"#/definitions/MatchConditions\" }\n+          ]\n+        },\n+        \"include\": {\n+          \"anyOf\": [\n+            { \"$ref\": \"#/definitions/MatchCondition\" },\n+            { \"$ref\": \"#/definitions/MatchConditions\" }\n+          ]\n+        }\n+      }\n+    },\n     \"OverlayOptions\": {\n       \"additionalProperties\": false,\n       \"type\": \"object\",\n@@ -26,16 +45,14 @@\n             { \"enum\": [\"wds\", \"whm\", \"wps\"] },\n             { \"$ref\": \"#/definitions/Path\" }\n           ]\n-        },\n-        \"sockHost\": { \"type\": \"string\" },\n-        \"sockPath\": { \"type\": \"string\" },\n-        \"sockPort\": { \"type\": \"number\", \"minimum\": 0 },\n-        \"useLegacyWDSSockets\": { \"type\": \"boolean\" }\n+        }\n       }\n-    },\n-    \"Path\": { \"type\": \"string\", \"absolutePath\": true }\n+    }\n   },\n   \"properties\": {\n+    \"esModule\": {\n+      \"anyOf\": [{ \"type\": \"boolean\" }, { \"$ref\": \"#/definitions/ESModuleOptions\" }]\n+    },\n     \"exclude\": {\n       \"anyOf\": [\n         { \"$ref\": \"#/definitions/MatchCondition\" },\n@@ -49,6 +66,7 @@\n         { \"$ref\": \"#/definitions/MatchConditions\" }\n       ]\n     },\n+    \"library\": { \"type\": \"string\" },\n     \"overlay\": {\n       \"anyOf\": [{ \"type\": \"boolean\" }, { \"$ref\": \"#/definitions/OverlayOptions\" }]\n     }\n",
					"match": false,
					"packageHash": "9de245c4e3e369344f679224a5ed2f852be99b6440a0e18722ae09bae2a1759b",
					"size": 1576,
					"sourceHash": "c363aa80bb10c6d71a4dd66b2a954e0ac30e0064a0ba4aedf4319acb679599a0",
					"status": "content"
				},
				"lib/runtime/RefreshRuntimeModule.js": {
					"match": false,
					"packageHash": "8f9007c2a0820bbeffe3f5d7dc5d260dacdafa0acc58cb95a331c9f2404266b2",
					"size": 1463,
					"status": "missing-in-source"
				},
				"lib/runtime/RefreshUtils.js": {
					"diff": "--- published/lib/runtime/RefreshUtils.js\n+++ rebuilt/lib/runtime/RefreshUtils.js\n@@ -1,5 +1,5 @@\n /* global __webpack_require__ */\n-const Refresh = require('react-refresh/runtime');\n+var Refresh = require('react-refresh/runtime');\n \n /**\n  * Extracts exports from a webpack module object.\n@@ -7,7 +7,30 @@\n  * @returns {*} An exports object from the module.\n  */\n function getModuleExports(moduleId) {\n-  return __webpack_require__.c[moduleId].exports;\n+  if (typeof moduleId === 'undefined') {\n+    // `moduleId` is unavailable, which indicates that this module is not in the cache,\n+    // which means we won't be able to capture any exports,\n+    // and thus they cannot be refreshed safely.\n+    // These are likely runtime or dynamically generated modules.\n+    return {};\n+  }\n+\n+  var maybeModule = __webpack_require__.c[moduleId];\n+  if (typeof maybeModule === 'undefined') {\n+    // `moduleId` is available but the module in cache is unavailable,\n+    // which indicates the module is somehow corrupted (e.g. broken Webpacak `module` globals).\n+    // We will warn the user (as this is likely a mistake) and assume they cannot be refreshed.\n+    console.warn('[React Refresh] Failed to get exports for module: ' + moduleId + '.');\n+    return {};\n+  }\n+\n+  var exportsOrPromise = maybeModule.exports;\n+  if (typeof Promise !== 'undefined' && exportsOrPromise instanceof Promise) {\n+    return exportsOrPromise.then(function (exports) {\n+      return exports;\n+    });\n+  }\n+  return exportsOrPromise;\n }\n \n /**\n@@ -19,7 +42,7 @@\n  * @returns {string[]} A React refresh boundary signature array.\n  */\n function getReactRefreshBoundarySignature(moduleExports) {\n-  const signature = [];\n+  var signature = [];\n   signature.push(Refresh.getFamilyByType(moduleExports));\n \n   if (moduleExports == null || typeof moduleExports !== 'object') {\n@@ -27,7 +50,7 @@\n     return signature;\n   }\n \n-  for (let key in moduleExports) {\n+  for (var key in moduleExports) {\n     if (key === '__esModule') {\n       continue;\n     }\n@@ -40,15 +63,30 @@\n }\n \n /**\n+ * Creates a data object to be retained across refreshes.\n+ * This object should not transtively reference previous exports,\n+ * which can form infinite chain of objects across refreshes, which can pressure RAM.\n+ *\n+ * @param {*} moduleExports A Webpack module exports object.\n+ * @returns {*} A React refresh boundary signature array.\n+ */\n+function getWebpackHotData(moduleExports) {\n+  return {\n+    signature: getReactRefreshBoundarySignature(moduleExports),\n+    isReactRefreshBoundary: isReactRefreshBoundary(moduleExports),\n+  };\n+}\n+\n+/**\n  * Creates a helper that performs a delayed React refresh.\n- * @returns {enqueueUpdate} A debounced React refresh function.\n+ * @returns {function(function(): void): void} A debounced React refresh function.\n  */\n function createDebounceUpdate() {\n   /**\n    * A cached setTimeout handler.\n    * @type {number | undefined}\n    */\n-  let refreshTimeout;\n+  var refreshTimeout;\n \n   /**\n    * Performs react refresh on a delay and clears the error overlay.\n@@ -84,9 +122,9 @@\n     return false;\n   }\n \n-  let hasExports = false;\n-  let areAllExportsComponents = true;\n-  for (let key in moduleExports) {\n+  var hasExports = false;\n",
					"match": false,
					"packageHash": "b02dae19df1c73ab0861bce078f0809146f9ee7230862cbf170ed826f3b7d532",
					"size": 5754,
					"sourceHash": "ce2851930f563eb07cd10528b50ed9812bff95fcf009119ffa4f0a4dac24089c",
					"status": "content"
				},
				"lib/types.js": {
					"diff": "--- published/lib/types.js\n+++ rebuilt/lib/types.js\n@@ -2,11 +2,7 @@\n  * @typedef {Object} ErrorOverlayOptions\n  * @property {string | false} [entry] Path to a JS file that sets up the error overlay integration.\n  * @property {string | false} [module] The error overlay module to use.\n- * @property {string} [sockHost] The socket host to use (WDS only).\n  * @property {import('type-fest').LiteralUnion<'wds' | 'whm' | 'wps' | false, string>} [sockIntegration] Path to a JS file that sets up the Webpack socket integration.\n- * @property {string} [sockPath] The socket path to use (WDS only).\n- * @property {number} [sockPort] The socket port to use (WDS only).\n- * @property {boolean} [useLegacyWDSSockets] Uses a custom SocketJS implementation for older versions of webpack-dev-server.\n  */\n \n /**\n@@ -15,10 +11,11 @@\n \n /**\n  * @typedef {Object} ReactRefreshPluginOptions\n- * @property {boolean} [disableRefreshCheck] Disables detection of react-refresh's Babel plugin (Deprecated since v0.3.0).\n+ * @property {boolean | import('../loader/types').ESModuleOptions} [esModule] Enables strict ES Modules compatible runtime.\n  * @property {string | RegExp | Array<string | RegExp>} [exclude] Files to explicitly exclude from processing.\n  * @property {boolean} [forceEnable] Enables the plugin forcefully.\n  * @property {string | RegExp | Array<string | RegExp>} [include] Files to explicitly include for processing.\n+ * @property {string} [library] Name of the library bundle.\n  * @property {boolean | ErrorOverlayOptions} [overlay] Modifies how the error overlay integration works in the plugin.\n  */\n \n@@ -28,7 +25,7 @@\n  */\n \n /**\n- * @typedef {import('type-fest').Merge<import('type-fest').SetRequired<import('type-fest').Except<ReactRefreshPluginOptions, 'disableRefreshCheck' | 'overlay'>, 'exclude' | 'include'>, OverlayOverrides>} NormalizedPluginOptions\n+ * @typedef {import('type-fest').SetRequired<import('type-fest').Except<ReactRefreshPluginOptions, 'overlay'>, 'exclude' | 'include'> & OverlayOverrides} NormalizedPluginOptions\n  */\n \n module.exports = {};\n",
					"match": false,
					"packageHash": "c18bef345fbedaa9181e509e63e02701b23b1fa72abd17208a14e169475beb80",
					"size": 1882,
					"sourceHash": "5ea26f09e4e5261fcc4e2c5dc98ae038178232802ac9fd127fb5040422a981cc",
					"status": "content"
				},
				"lib/utils/createError.js": {
					"match": false,
					"packageHash": "e5611451aaa8a4d721c052db6c775d90ea03e064afd459a78bfc1070983d11fe",
					"size": 263,
					"status": "missing-in-source"
				},
				"lib/utils/getParserHelpers.js": {
					"match": false,
					"packageHash": "723c81ada745242398c5049cfa762a983d753f87478253ebbb079a548b414bac",
					"size": 1025,
					"status": "missing-in-source"
				},
				"lib/utils/getRefreshGlobal.js": {
					"match": false,
					"packageHash": "475b249a1728338970fd7200bf4d5b3f77a2f4e034ac5830ba35d4d0ae749e54",
					"size": 2572,
					"status": "missing-in-source"
				},
				"lib/utils/index.js": {
					"diff": "--- published/lib/utils/index.js\n+++ rebuilt/lib/utils/index.js\n@@ -1,17 +1,15 @@\n-const createError = require('./createError');\n-const getParserHelpers = require('./getParserHelpers');\n-const getRefreshGlobal = require('./getRefreshGlobal');\n+const getAdditionalEntries = require('./getAdditionalEntries');\n+const getIntegrationEntry = require('./getIntegrationEntry');\n const getSocketIntegration = require('./getSocketIntegration');\n-const injectRefreshEntry = require('./injectRefreshEntry');\n const injectRefreshLoader = require('./injectRefreshLoader');\n+const makeRefreshRuntimeModule = require('./makeRefreshRuntimeModule');\n const normalizeOptions = require('./normalizeOptions');\n \n module.exports = {\n-  createError,\n-  getParserHelpers,\n-  getRefreshGlobal,\n+  getAdditionalEntries,\n+  getIntegrationEntry,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n+  makeRefreshRuntimeModule,\n   normalizeOptions,\n };\n",
					"match": false,
					"packageHash": "f7a8acd23c230ecfad36679f1d85012f10e6e2619c4efdcf94030ac16563cab8",
					"size": 567,
					"sourceHash": "92fb4ccffc1b6eff62f0d0fcda08cb3662cee6a222a35b40a1b25fb229873ec4",
					"status": "content"
				},
				"lib/utils/injectRefreshEntry.js": {
					"match": false,
					"packageHash": "8949ebd744314c282b19fcedf9c9086ef7afd8537667362ddf319253f3d2c5e4",
					"size": 3773,
					"status": "missing-in-source"
				},
				"lib/utils/injectRefreshLoader.js": {
					"diff": "--- published/lib/utils/injectRefreshLoader.js\n+++ rebuilt/lib/utils/injectRefreshLoader.js\n@@ -1,4 +1,4 @@\n-const path = require('path');\n+const path = require('node:path');\n \n /**\n  * @callback MatchObject\n@@ -6,35 +6,53 @@\n  * @returns {boolean}\n  */\n \n+/**\n+ * @typedef {Object} InjectLoaderOptions\n+ * @property {MatchObject} match A function to include/exclude files to be processed.\n+ * @property {import('../../loader/types').ReactRefreshLoaderOptions} [options] Options passed to the loader.\n+ */\n+\n const resolvedLoader = require.resolve('../../loader');\n+const reactRefreshPath = path.dirname(require.resolve('react-refresh'));\n+const refreshUtilsPath = path.join(__dirname, '../runtime/RefreshUtils');\n \n /**\n  * Injects refresh loader to all JavaScript-like and user-specified files.\n- * @param {*} data Module factory creation data.\n- * @param {MatchObject} matchObject A function to include/exclude files to be processed.\n+ * @param {*} moduleData Module factory creation data.\n+ * @param {InjectLoaderOptions} injectOptions Options to alter how the loader is injected.\n  * @returns {*} The injected module factory creation data.\n  */\n-function injectRefreshLoader(data, matchObject) {\n+function injectRefreshLoader(moduleData, injectOptions) {\n+  const { match, options } = injectOptions;\n+\n+  // Include and exclude user-specified files\n+  if (!match(moduleData.matchResource || moduleData.resource)) return moduleData;\n+  // Include and exclude dynamically generated modules from other loaders\n+  if (moduleData.matchResource && !match(moduleData.request)) return moduleData;\n+  // Exclude files referenced as assets\n+  if (moduleData.type.includes('asset')) return moduleData;\n+  // Check to prevent double injection\n+  if (moduleData.loaders.find(({ loader }) => loader === resolvedLoader)) return moduleData;\n+  // Skip react-refresh and the plugin's runtime utils to prevent self-referencing -\n+  // this is useful when using the plugin as a direct dependency,\n+  // or when node_modules are specified to be processed.\n   if (\n-    // Include and exclude user-specified files\n-    matchObject(data.resource) &&\n-    // Skip plugin's runtime utils to prevent self-referencing -\n-    // this is useful when using the plugin as a direct dependency.\n-    !data.resource.includes(path.join(__dirname, '../runtime/RefreshUtils')) &&\n-    // Check to prevent double injection\n-    !data.loaders.find(({ loader }) => loader === resolvedLoader)\n+    moduleData.resource.includes(reactRefreshPath) ||\n+    moduleData.resource.includes(refreshUtilsPath)\n   ) {\n-    // As we inject runtime code for each module,\n-    // it is important to run the injected loader after everything.\n-    // This way we can ensure that all code-processing have been done,\n-    // and we won't risk breaking tools like Flow or ESLint.\n-    data.loaders.unshift({\n-      loader: resolvedLoader,\n-      options: undefined,\n-    });\n+    return moduleData;\n   }\n \n-  return data;\n+  // As we inject runtime code for each module,\n+  // it is important to run the injected loader after everything.\n+  // This way we can ensure that all code-processing have been done,\n+  // and we won't risk breaking tools like Flow or ESLint.\n+  moduleData.loaders.unshift({\n+    loader: resolvedLoader,\n+    options,\n+  });\n+\n+  return moduleData;\n }\n \n module.exports = injectRefreshLoader;\n",
					"match": false,
					"packageHash": "384a6991170a2f422a92b916dfe888d9ebc98afd0ff48bc1c3cad394aeeabe62",
					"size": 1316,
					"sourceHash": "3f5147476d72e21dc95a45d24d5f905d3176d29db6aff67e09852f98b94190ab",
					"status": "content"
				},
				"lib/utils/normalizeOptions.js": {
					"diff": "--- published/lib/utils/normalizeOptions.js\n+++ rebuilt/lib/utils/normalizeOptions.js\n@@ -1,33 +1,4 @@\n-/**\n- * Sets a constant default value for the property when it is undefined.\n- * @template T\n- * @template {keyof T} Property\n- * @param {T} object An object.\n- * @param {Property} property A property of the provided object.\n- * @param {T[Property]} defaultValue The default value to set for the property.\n- * @returns {T[Property]} The defaulted property value.\n- */\n-const d = (object, property, defaultValue) => {\n-  if (typeof object[property] === 'undefined' && typeof defaultValue !== 'undefined') {\n-    object[property] = defaultValue;\n-  }\n-  return object[property];\n-};\n-\n-/**\n- * Resolves the value for a nested object option.\n- * @template T\n- * @template {keyof T} Property\n- * @template Result\n- * @param {T} object An object.\n- * @param {Property} property A property of the provided object.\n- * @param {function(T | undefined): Result} fn The handler to resolve the property's value.\n- * @returns {Result} The resolved option value.\n- */\n-const nestedOption = (object, property, fn) => {\n-  object[property] = fn(object[property]);\n-  return object[property];\n-};\n+const { d, n } = require('../../options');\n \n /**\n  * Normalizes the options for the plugin.\n@@ -35,22 +6,12 @@\n  * @returns {import('../types').NormalizedPluginOptions} Normalized plugin options.\n  */\n const normalizeOptions = (options) => {\n-  // Show deprecation notice for the `disableRefreshCheck` option and remove it\n-  if (typeof options.disableRefreshCheck !== 'undefined') {\n-    delete options.disableRefreshCheck;\n-    console.warn(\n-      [\n-        'The \"disableRefreshCheck\" option has been deprecated and will not have any effect on how the plugin parses files.',\n-        'Please remove it from your configuration.',\n-      ].join(' ')\n-    );\n-  }\n-\n-  d(options, 'exclude', /node_modules/);\n-  d(options, 'include', /\\.([jt]sx?|flow)$/);\n+  d(options, 'exclude', /node_modules/i);\n+  d(options, 'include', /\\.([cm]js|[jt]sx?|flow)$/i);\n   d(options, 'forceEnable');\n+  d(options, 'library');\n \n-  nestedOption(options, 'overlay', (overlay) => {\n+  n(options, 'overlay', (overlay) => {\n     /** @type {import('../types').NormalizedErrorOverlayOptions} */\n     const defaults = {\n       entry: require.resolve('../../client/ErrorOverlayEntry'),\n@@ -68,10 +29,6 @@\n     d(overlay, 'entry', defaults.entry);\n     d(overlay, 'module', defaults.module);\n     d(overlay, 'sockIntegration', defaults.sockIntegration);\n-    d(overlay, 'sockHost');\n-    d(overlay, 'sockPath');\n-    d(overlay, 'sockPort');\n-    d(options, 'useLegacyWDSSockets');\n \n     return overlay;\n   });\n",
					"match": false,
					"packageHash": "6b88b577b7b89b4982fbdb0377fad0485fb9562d967d98b16dde4ccc72058dd0",
					"size": 2645,
					"sourceHash": "d1fda547183f02d1a6fad5eaf0953884ff4d44ce7e821bd730880987025daf1d",
					"status": "content"
				},
				"loader/RefreshModule.runtime.js": {
					"match": false,
					"packageHash": "c51598c80a627bb7c07cb4806e5973d36b47eec5c555788634fa7c45b8213436",
					"size": 3321,
					"status": "missing-in-source"
				},
				"loader/RefreshSetup.runtime.js": {
					"match": false,
					"packageHash": "3dd0a589ee2eefc14bb47b7fa182f082eb72fb61d1c41ee0ed6f79b01b46369d",
					"size": 460,
					"status": "missing-in-source"
				},
				"loader/index.js": {
					"diff": "--- published/loader/index.js\n+++ rebuilt/loader/index.js\n@@ -1,81 +1,89 @@\n-const { SourceMapConsumer, SourceMapGenerator, SourceNode } = require('source-map');\n-const { Template } = require('webpack');\n-\n-/**\n- * Generates an identity source map from a source file.\n- * @param {string} source The content of the source file.\n- * @param {string} resourcePath The name of the source file.\n- * @returns {import('source-map').RawSourceMap} The identity source map.\n- */\n-function getIdentitySourceMap(source, resourcePath) {\n-  const sourceMap = new SourceMapGenerator();\n-  sourceMap.setSourceContent(resourcePath, source);\n-\n-  source.split('\\n').forEach((line, index) => {\n-    sourceMap.addMapping({\n-      source: resourcePath,\n-      original: {\n-        line: index + 1,\n-        column: 0,\n-      },\n-      generated: {\n-        line: index + 1,\n-        column: 0,\n-      },\n-    });\n-  });\n-\n-  return sourceMap.toJSON();\n-}\n-\n-/**\n- * Gets a runtime template from provided function.\n- * @param {function(): void} fn A function containing the runtime template.\n- * @returns {string} The \"sanitized\" runtime template.\n- */\n-function getTemplate(fn) {\n-  return Template.getFunctionContent(fn).trim().replace(/^ {2}/gm, '');\n-}\n-\n-const RefreshSetupRuntime = getTemplate(require('./RefreshSetup.runtime'));\n-const RefreshModuleRuntime = getTemplate(require('./RefreshModule.runtime'));\n+// This is a patch for mozilla/source-map#349 -\n+// internally, it uses the existence of the `fetch` global to toggle browser behaviours.\n+// That check, however, will break when `fetch` polyfills are used for SSR setups.\n+// We \"reset\" the polyfill here to ensure it won't interfere with source-map generation.\n+const originalFetch = global.fetch;\n+delete global.fetch;\n+\n+const { validate: validateOptions } = require('schema-utils');\n+const { SourceMapConsumer, SourceNode } = require('source-map');\n+const {\n+  getIdentitySourceMap,\n+  getModuleSystem,\n+  getRefreshModuleRuntime,\n+  normalizeOptions,\n+} = require('./utils');\n+const schema = require('./options.json');\n+\n+const RefreshRuntimePath = require\n+  .resolve('react-refresh')\n+  .replace(/\\\\/g, '/')\n+  .replace(/'/g, \"\\\\'\");\n \n /**\n  * A simple Webpack loader to inject react-refresh HMR code into modules.\n  *\n  * [Reference for Loader API](https://webpack.js.org/api/loaders/)\n- * @this {import('webpack').loader.LoaderContext}\n+ * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n  * @param {string} source The original module source code.\n  * @param {import('source-map').RawSourceMap} [inputSourceMap] The source map of the module.\n  * @param {*} [meta] The loader metadata passed in.\n  * @returns {void}\n  */\n function ReactRefreshLoader(source, inputSourceMap, meta) {\n+  let options = this.getOptions();\n+  validateOptions(schema, options, {\n+    baseDataPath: 'options',\n+    name: 'React Refresh Loader',\n+  });\n+\n+  options = normalizeOptions(options);\n+\n   const callback = this.async();\n \n+  const { ModuleFilenameHelpers, Template } = this._compiler.webpack || require('webpack');\n+\n+  const RefreshSetupRuntimes = {\n+    cjs: Template.asString(\n+      `__webpack_require__.$Refresh$.runtime = require('${RefreshRuntimePath}');`\n+    ),\n+    esm: Template.asString([\n+      `import * as __react_refresh_runtime__ from '${RefreshRuntimePath}';`,\n+      `__webpack_require__.$Refresh$.runtime = __react_refresh_runtime__;`,\n+    ]),\n+  };\n+\n",
					"match": false,
					"packageHash": "b8461c9cdf83c77da1517721d173ff2670284d9e0801fadb682f3b50397fc9c2",
					"size": 2923,
					"sourceHash": "57b706a720e9f835bc45bd5cd4de1ce89a369b07e83b1ffd10545d87ed725094",
					"status": "content"
				},
				"overlay/components/CompileErrorTrace.js": {
					"diff": "--- published/overlay/components/CompileErrorTrace.js\n+++ rebuilt/overlay/components/CompileErrorTrace.js\n@@ -1,11 +1,6 @@\n-const ansiHTML = require('ansi-html');\n-const HtmlEntities = require('html-entities');\n-const theme = require('../theme');\n-const formatFilename = require('../utils/formatFilename');\n-\n-ansiHTML.setColors(theme);\n-\n-const entities = new HtmlEntities.Html5Entities();\n+const Anser = require('anser');\n+const entities = require('html-entities');\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} CompileErrorTraceProps\n@@ -21,31 +16,56 @@\n  */\n function CompileErrorTrace(document, root, props) {\n   const errorParts = props.errorMessage.split('\\n');\n-  const errorMessage = errorParts\n-    .splice(1, 1)[0]\n-    // Strip filename from the error message\n-    .replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2');\n-  errorParts[0] = formatFilename(errorParts[0]);\n-  errorParts.unshift(errorMessage);\n+  if (errorParts.length) {\n+    if (errorParts[0]) {\n+      errorParts[0] = utils.formatFilename(errorParts[0]);\n+    }\n+\n+    const errorMessage = errorParts.splice(1, 1)[0];\n+    if (errorMessage) {\n+      // Strip filename from the error message\n+      errorParts.unshift(errorMessage.replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2'));\n+    }\n+  }\n \n   const stackContainer = document.createElement('pre');\n-  stackContainer.innerHTML = entities.decode(ansiHTML(entities.encode(errorParts.join('\\n'))));\n   stackContainer.style.fontFamily = [\n-    '\"Operator Mono SSm\"',\n-    '\"Operator Mono\"',\n-    '\"Fira Code Retina\"',\n-    '\"Fira Code\"',\n-    '\"FiraCode-Retina\"',\n-    '\"Andale Mono\"',\n-    '\"Lucida Console\"',\n-    'Menlo',\n+    '\"SFMono-Regular\"',\n     'Consolas',\n-    'Monaco',\n+    'Liberation Mono',\n+    'Menlo',\n+    'Courier',\n     'monospace',\n   ].join(', ');\n   stackContainer.style.margin = '0';\n   stackContainer.style.whiteSpace = 'pre-wrap';\n \n+  const entries = Anser.ansiToJson(\n+    entities.encode(errorParts.join('\\n'), { level: 'html5', mode: 'nonAscii' }),\n+    {\n+      json: true,\n+      remove_empty: true,\n+      use_classes: true,\n+    }\n+  );\n+  for (let i = 0; i < entries.length; i += 1) {\n+    const entry = entries[i];\n+    const elem = document.createElement('span');\n+    elem.innerHTML = entry.content;\n+    elem.style.color = entry.fg ? `var(--color-${entry.fg})` : undefined;\n+    elem.style.wordBreak = 'break-word';\n+    switch (entry.decoration) {\n+      case 'bold':\n+        elem.style.fontWeight = 800;\n+        break;\n+      case 'italic':\n+        elem.style.fontStyle = 'italic';\n+        break;\n+    }\n+\n+    stackContainer.appendChild(elem);\n+  }\n+\n   root.appendChild(stackContainer);\n }\n \n",
					"match": false,
					"packageHash": "5a227c907c166ce6534568f73ecb947a2d8e36a9d32ca8b960f3423dd5397502",
					"size": 1497,
					"sourceHash": "35f68cee2a98fc157b898879dda6adea2ff7b077a34aba5786a9be7f165aa71d",
					"status": "content"
				},
				"overlay/components/PageHeader.js": {
					"diff": "--- published/overlay/components/PageHeader.js\n+++ rebuilt/overlay/components/PageHeader.js\n@@ -1,5 +1,5 @@\n-const theme = require('../theme');\n-const Spacer = require('./Spacer');\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} PageHeaderProps\n@@ -17,18 +17,20 @@\n  */\n function PageHeader(document, root, props) {\n   const pageHeaderContainer = document.createElement('div');\n-  pageHeaderContainer.style.background = '#' + theme.dimgrey;\n+  pageHeaderContainer.style.background = theme['dark-background'];\n   pageHeaderContainer.style.boxShadow = '0 1px 4px rgba(0, 0, 0, 0.3)';\n-  pageHeaderContainer.style.color = '#' + theme.white;\n+  pageHeaderContainer.style.color = theme.white;\n   pageHeaderContainer.style.left = '0';\n+  pageHeaderContainer.style.right = '0';\n   pageHeaderContainer.style.padding = '1rem 1.5rem';\n+  pageHeaderContainer.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n+  pageHeaderContainer.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n   pageHeaderContainer.style.position = 'fixed';\n   pageHeaderContainer.style.top = props.topOffset || '0';\n-  pageHeaderContainer.style.width = 'calc(100vw - 3rem)';\n \n   const title = document.createElement('h3');\n   title.innerText = props.title;\n-  title.style.color = '#' + theme.red;\n+  title.style.color = theme.red;\n   title.style.fontSize = '1.125rem';\n   title.style.lineHeight = '1.3';\n   title.style.margin = '0';\n@@ -39,7 +41,7 @@\n \n     const message = document.createElement('span');\n     message.innerText = props.message;\n-    message.style.color = '#' + theme.white;\n+    message.style.color = theme.white;\n     message.style.wordBreak = 'break-word';\n     pageHeaderContainer.appendChild(message);\n   }\n",
					"match": false,
					"packageHash": "2736bde6528d209a66b8b5a73d6505f759554f87b64cb63d7f5d012a0494f6b0",
					"size": 1735,
					"sourceHash": "3f6789599619d258ea6682cb428770ede8bcb25b97b6446a32ca2e8bad9c9f7f",
					"status": "content"
				},
				"overlay/components/RuntimeErrorFooter.js": {
					"diff": "--- published/overlay/components/RuntimeErrorFooter.js\n+++ rebuilt/overlay/components/RuntimeErrorFooter.js\n@@ -1,5 +1,5 @@\n-const theme = require('../theme');\n-const Spacer = require('./Spacer');\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} RuntimeErrorFooterProps\n@@ -19,15 +19,17 @@\n  */\n function RuntimeErrorFooter(document, root, props) {\n   const footer = document.createElement('div');\n-  footer.style.backgroundColor = '#' + theme.dimgrey;\n+  footer.style.backgroundColor = theme['dark-background'];\n   footer.style.bottom = '0';\n   footer.style.boxShadow = '0 -1px 4px rgba(0, 0, 0, 0.3)';\n   footer.style.height = '2.5rem';\n   footer.style.left = '0';\n+  footer.style.right = '0';\n   footer.style.lineHeight = '2.5rem';\n+  footer.style.paddingBottom = '0';\n+  footer.style.paddingBottom = 'env(safe-area-inset-bottom)';\n   footer.style.position = 'fixed';\n   footer.style.textAlign = 'center';\n-  footer.style.width = '100vw';\n   footer.style.zIndex = '2';\n \n   const BUTTON_CONFIGS = {\n@@ -62,14 +64,14 @@\n     button.id = buttonConfig.id;\n     button.innerHTML = buttonConfig.label;\n     button.tabIndex = 1;\n-    button.style.backgroundColor = '#' + theme.dimgrey;\n+    button.style.backgroundColor = theme['dark-background'];\n     button.style.border = 'none';\n-    button.style.color = '#' + theme.white;\n+    button.style.color = theme.white;\n     button.style.cursor = 'pointer';\n     button.style.fontSize = 'inherit';\n     button.style.height = '100%';\n     button.style.padding = '0.5rem 0.75rem';\n-    button.style.width = (100 / buttons.length).toString(10) + '%';\n+    button.style.width = `${(100 / buttons.length).toString(10)}%`;\n     button.addEventListener('click', buttonConfig.onClick);\n \n     if (buttonConfig.id === props.initialFocus) {\n",
					"match": false,
					"packageHash": "20025515b7afd59440898a1eada5a70bd48a6c474ce32e01820af1a2bb55fb95",
					"size": 2589,
					"sourceHash": "f9547afa949e5c155c0726d916f135e2ea316f77da539373c1a3e61d9296bc77",
					"status": "content"
				},
				"overlay/components/RuntimeErrorHeader.js": {
					"diff": "--- published/overlay/components/RuntimeErrorHeader.js\n+++ rebuilt/overlay/components/RuntimeErrorHeader.js\n@@ -1,5 +1,5 @@\n-const theme = require('../theme');\n-const Spacer = require('./Spacer');\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} RuntimeErrorHeaderProps\n@@ -16,9 +16,9 @@\n  */\n function RuntimeErrorHeader(document, root, props) {\n   const header = document.createElement('div');\n-  header.innerText = 'Error ' + (props.currentErrorIndex + 1) + ' of ' + props.totalErrors;\n-  header.style.backgroundColor = '#' + theme.red;\n-  header.style.color = '#' + theme.white;\n+  header.innerText = `Error ${props.currentErrorIndex + 1} of ${props.totalErrors}`;\n+  header.style.backgroundColor = theme.red;\n+  header.style.color = theme.white;\n   header.style.fontWeight = '500';\n   header.style.height = '2.5rem';\n   header.style.left = '0';\n",
					"match": false,
					"packageHash": "3c02be5ac965a504f80e0c6f21929a79c20c5620d4e029cb87cc886d28eb4b43",
					"size": 1083,
					"sourceHash": "22b1c504587105d823560bf9266e875e83e7595c8ec4abde300871c89f07393d",
					"status": "content"
				},
				"overlay/components/RuntimeErrorStack.js": {
					"diff": "--- published/overlay/components/RuntimeErrorStack.js\n+++ rebuilt/overlay/components/RuntimeErrorStack.js\n@@ -1,6 +1,6 @@\n const ErrorStackParser = require('error-stack-parser');\n-const theme = require('../theme');\n-const formatFilename = require('../utils/formatFilename');\n+const theme = require('../theme.js');\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} RuntimeErrorStackProps\n@@ -17,7 +17,7 @@\n function RuntimeErrorStack(document, root, props) {\n   const stackTitle = document.createElement('h4');\n   stackTitle.innerText = 'Call Stack';\n-  stackTitle.style.color = '#' + theme.white;\n+  stackTitle.style.color = theme.white;\n   stackTitle.style.fontSize = '1.0625rem';\n   stackTitle.style.fontWeight = '500';\n   stackTitle.style.lineHeight = '1.3';\n@@ -40,31 +40,26 @@\n     const currentStack = errorStacks[i];\n \n     const functionName = document.createElement('code');\n-    functionName.innerHTML = '&emsp;' + currentStack.functionName || '(anonymous function)';\n-    functionName.style.color = '#' + theme.yellow;\n+    functionName.innerHTML = `&emsp;${currentStack.functionName || '(anonymous function)'}`;\n+    functionName.style.color = theme.yellow;\n     functionName.style.fontFamily = [\n-      '\"Operator Mono SSm\"',\n-      '\"Operator Mono\"',\n-      '\"Fira Code Retina\"',\n-      '\"Fira Code\"',\n-      '\"FiraCode-Retina\"',\n-      '\"Andale Mono\"',\n-      '\"Lucida Console\"',\n-      'Menlo',\n+      '\"SFMono-Regular\"',\n       'Consolas',\n-      'Monaco',\n+      'Liberation Mono',\n+      'Menlo',\n+      'Courier',\n       'monospace',\n     ].join(', ');\n \n     const fileName = document.createElement('div');\n     fileName.innerHTML =\n       '&emsp;&emsp;' +\n-      formatFilename(currentStack.fileName) +\n+      utils.formatFilename(currentStack.fileName) +\n       ':' +\n       currentStack.lineNumber +\n       ':' +\n       currentStack.columnNumber;\n-    fileName.style.color = '#' + theme.white;\n+    fileName.style.color = theme.white;\n     fileName.style.fontSize = '0.6875rem';\n     fileName.style.marginBottom = '0.25rem';\n \n",
					"match": false,
					"packageHash": "7d51e4947d2f985cfc83c7d2b409636eb1950fecdba39ee2d78a1d9ab6adacc3",
					"size": 2368,
					"sourceHash": "df582e1eba351f892a3523ce1410c6762c21134f5da2e2653de66516869e92d8",
					"status": "content"
				},
				"overlay/containers/CompileErrorContainer.js": {
					"diff": "--- published/overlay/containers/CompileErrorContainer.js\n+++ rebuilt/overlay/containers/CompileErrorContainer.js\n@@ -1,6 +1,6 @@\n-const CompileErrorTrace = require('../components/CompileErrorTrace');\n-const PageHeader = require('../components/PageHeader');\n-const Spacer = require('../components/Spacer');\n+const CompileErrorTrace = require('../components/CompileErrorTrace.js');\n+const PageHeader = require('../components/PageHeader.js');\n+const Spacer = require('../components/Spacer.js');\n \n /**\n  * @typedef {Object} CompileErrorContainerProps\n",
					"match": false,
					"packageHash": "825dba3bb5382fe28756e8c810a1c05fde20ea776b321452dc480ad938efc588",
					"size": 766,
					"sourceHash": "5d504595ba46184a618931f0e59573532e51dbf220594a59b1329774a736cbac",
					"status": "content"
				},
				"overlay/containers/RuntimeErrorContainer.js": {
					"diff": "--- published/overlay/containers/RuntimeErrorContainer.js\n+++ rebuilt/overlay/containers/RuntimeErrorContainer.js\n@@ -1,6 +1,6 @@\n-const PageHeader = require('../components/PageHeader');\n-const RuntimeErrorStack = require('../components/RuntimeErrorStack');\n-const Spacer = require('../components/Spacer');\n+const PageHeader = require('../components/PageHeader.js');\n+const RuntimeErrorStack = require('../components/RuntimeErrorStack.js');\n+const Spacer = require('../components/Spacer.js');\n \n /**\n  * @typedef {Object} RuntimeErrorContainerProps\n",
					"match": false,
					"packageHash": "aeb78ec08d3b31641701a2d07951ae04a484c680dd40489cd03c946c436d813a",
					"size": 821,
					"sourceHash": "1da739245a306e3319b0684b08b133a6293757efab44412231085f88d308868d",
					"status": "content"
				},
				"overlay/index.js": {
					"diff": "--- published/overlay/index.js\n+++ rebuilt/overlay/index.js\n@@ -1,10 +1,9 @@\n-const RuntimeErrorFooter = require('./components/RuntimeErrorFooter');\n-const RuntimeErrorHeader = require('./components/RuntimeErrorHeader');\n-const CompileErrorContainer = require('./containers/CompileErrorContainer');\n-const RuntimeErrorContainer = require('./containers/RuntimeErrorContainer');\n-const theme = require('./theme');\n-const debounce = require('./utils/debounce');\n-const removeAllChildren = require('./utils/removeAllChildren');\n+const RuntimeErrorFooter = require('./components/RuntimeErrorFooter.js');\n+const RuntimeErrorHeader = require('./components/RuntimeErrorHeader.js');\n+const CompileErrorContainer = require('./containers/CompileErrorContainer.js');\n+const RuntimeErrorContainer = require('./containers/RuntimeErrorContainer.js');\n+const theme = require('./theme.js');\n+const utils = require('./utils.js');\n \n /**\n  * @callback RenderFn\n@@ -74,8 +73,10 @@\n   iframe.src = 'about:blank';\n \n   iframe.style.border = 'none';\n-  iframe.style.height = '100vh';\n+  iframe.style.height = '100%';\n   iframe.style.left = '0';\n+  iframe.style.minHeight = '100vh';\n+  iframe.style.minHeight = '-webkit-fill-available';\n   iframe.style.position = 'fixed';\n   iframe.style.top = '0';\n   iframe.style.width = '100vw';\n@@ -101,27 +102,41 @@\n   const div = document.createElement('div');\n   div.id = 'react-refresh-overlay-error';\n \n+  // Apply ANSI theme\n+  div.style.setProperty('--color-ansi-selection', theme.selection);\n+  div.style.setProperty('--color-ansi-bg', theme.background);\n+  div.style.setProperty('--color-ansi-fg', theme.white);\n+  div.style.setProperty('--color-ansi-white', theme.white);\n+  div.style.setProperty('--color-ansi-black', theme.black);\n+  div.style.setProperty('--color-ansi-blue', theme.blue);\n+  div.style.setProperty('--color-ansi-cyan', theme.cyan);\n+  div.style.setProperty('--color-ansi-green', theme.green);\n+  div.style.setProperty('--color-ansi-magenta', theme.magenta);\n+  div.style.setProperty('--color-ansi-red', theme.red);\n+  div.style.setProperty('--color-ansi-yellow', theme.yellow);\n+  div.style.setProperty('--color-ansi-bright-white', theme['bright-white']);\n+  div.style.setProperty('--color-ansi-bright-black', theme['bright-black']);\n+  div.style.setProperty('--color-ansi-bright-blue', theme['bright-blue']);\n+  div.style.setProperty('--color-ansi-bright-cyan', theme['bright-cyan']);\n+  div.style.setProperty('--color-ansi-bright-green', theme['bright-green']);\n+  div.style.setProperty('--color-ansi-bright-magenta', theme['bright-magenta']);\n+  div.style.setProperty('--color-ansi-bright-red', theme['bright-red']);\n+  div.style.setProperty('--color-ansi-bright-yellow', theme['bright-yellow']);\n+\n   // Style the contents container\n-  div.style.backgroundColor = '#' + theme.grey;\n+  div.style.backgroundColor = theme.background;\n   div.style.boxSizing = 'border-box';\n-  div.style.color = '#' + theme.white;\n-  div.style.fontFamily = [\n-    '-apple-system',\n-    'BlinkMacSystemFont',\n-    '\"Segoe UI\"',\n-    '\"Helvetica Neue\"',\n-    'Helvetica',\n-    'Arial',\n-    'sans-serif',\n-    '\"Apple Color Emoji\"',\n-    '\"Segoe UI Emoji\"',\n-    'Segoe UI Symbol',\n-  ].join(', ');\n+  div.style.color = theme.white;\n+  div.style.fontFamily = ['-apple-system', '\"Source Sans Pro\"', 'sans-serif'].join(', ');\n   div.style.fontSize = '0.875rem';\n-  div.style.height = '100vh';\n+  div.style.height = '100%';\n   div.style.lineHeight = '1.3';\n   div.style.overflow = 'auto';\n   div.style.padding = '1rem 1.5rem 0';\n+  div.style.paddingTop = 'max(1rem, env(safe-area-inset-top))';\n+  div.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n+  div.style.paddingBottom = 'env(safe-area-inset-bottom)';\n+  div.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n   div.style.width = '100vw';\n \n   root.appendChild(div);\n@@ -177,7 +192,7 @@\n       currentFocusId = currentFocus.id;\n     }\n \n-    removeAllChildren(root);\n+    utils.removeAllChildren(root);\n \n     if (currentCompileErrorMessage) {\n       currentMode = 'compileError';\n@@ -301,7 +316,7 @@\n  * @param {Error[]} errors\n  * @returns {void}\n",
					"match": false,
					"packageHash": "307bf1fd76c9cc134be1f82a36e4d5bc0bb3717f391197c26f7c18c15d0228ad",
					"size": 9032,
					"sourceHash": "7fa8e14caaef770ae25cd84b2c5ee73d94e05bbb799ab8d752a0943df65d1278",
					"status": "content"
				},
				"overlay/theme.js": {
					"diff": "--- published/overlay/theme.js\n+++ rebuilt/overlay/theme.js\n@@ -1,14 +1,21 @@\n /**\n  * @typedef {Object} Theme\n- * @property {string[]} reset\n  * @property {string} black\n+ * @property {string} bright-black\n  * @property {string} red\n+ * @property {string} bright-red\n  * @property {string} green\n+ * @property {string} bright-green\n  * @property {string} yellow\n+ * @property {string} bright-yellow\n  * @property {string} blue\n+ * @property {string} bright-blue\n  * @property {string} magenta\n+ * @property {string} bright-magenta\n  * @property {string} cyan\n+ * @property {string} bright-cyan\n  * @property {string} white\n+ * @property {string} bright-white\n  * @property {string} lightgrey\n  * @property {string} darkgrey\n  * @property {string} grey\n@@ -21,19 +28,25 @@\n  * Partially adopted from Tomorrow Night Bright.\n  */\n const theme = {\n-  reset: ['transparent', 'transparent'],\n-  black: '000000',\n-  red: 'D34F56',\n-  green: 'B9C954',\n-  yellow: 'E6C452',\n-  blue: '7CA7D8',\n-  magenta: 'C299D6',\n-  cyan: '73BFB1',\n-  white: 'FFFFFF',\n-  lightgrey: 'C7C7C7',\n-  darkgrey: 'A9A9A9',\n-  grey: '474747',\n-  dimgrey: '343434',\n+  black: '#000000',\n+  'bright-black': '#474747',\n+  red: '#D34F56',\n+  'bright-red': '#dd787d',\n+  green: '#B9C954',\n+  'bright-green': '#c9d57b',\n+  yellow: '#E6C452',\n+  'bright-yellow': '#ecd37f',\n+  blue: '#7CA7D8',\n+  'bright-blue': '#a3c1e4',\n+  magenta: '#C299D6',\n+  'bright-magenta': '#d8bde5',\n+  cyan: '#73BFB1',\n+  'bright-cyan': '#96cfc5',\n+  white: '#FFFFFF',\n+  'bright-white': '#FFFFFF',\n+  background: '#474747',\n+  'dark-background': '#343434',\n+  selection: 'rgba(234, 234, 234, 0.5)',\n };\n \n module.exports = theme;\n",
					"match": false,
					"packageHash": "880dfd428e17f82b410b4197816dba596c96519aff3ac19ee9609426a87908f3",
					"size": 862,
					"sourceHash": "41d942efc4a6d3dc88883515dbc16f607269a49125ca29f06b92bbb66655cf46",
					"status": "content"
				},
				"overlay/utils/debounce.js": {
					"match": false,
					"packageHash": "2789135d1466a961fa3700673c816b263ade5ccdf867cb03b88ae34b5800cdeb",
					"size": 698,
					"status": "missing-in-source"
				},
				"overlay/utils/formatFilename.js": {
					"match": false,
					"packageHash": "53f72a54cdae3a25525657b96ebf51fafd277e99191a0e7ab2b1dece32333bc6",
					"size": 725,
					"status": "missing-in-source"
				},
				"overlay/utils/removeAllChildren.js": {
					"match": false,
					"packageHash": "251ae9c3214395dff477a847630affbe4f29fe6e5130c9755db8143481535259",
					"size": 503,
					"status": "missing-in-source"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@pmmmwh/react-refresh-webpack-plugin\",\n-  \"version\": \"0.4.0-beta.10\",\n+  \"version\": \"0.6.2\",\n   \"description\": \"An **EXPERIMENTAL** Webpack plugin to enable \\\"Fast Refresh\\\" (also previously known as _Hot Reloading_) for React components.\",\n   \"keywords\": [\n     \"react\",\n@@ -26,82 +26,99 @@\n   \"license\": \"MIT\",\n   \"author\": \"Michael Mok\",\n   \"main\": \"lib/index.js\",\n-  \"types\": \"types/index.d.ts\",\n+  \"types\": \"types/lib/index.d.ts\",\n   \"files\": [\n     \"client\",\n     \"lib\",\n     \"loader\",\n+    \"options\",\n     \"overlay\",\n     \"sockets\",\n-    \"types\"\n+    \"types\",\n+    \"umd\"\n   ],\n+  \"packageManager\": \"yarn@1.22.22+sha1.ac34549e6aa8e7ead463a7407e1c7390f61a6610\",\n   \"scripts\": {\n-    \"pretest\": \"patch-package && yarn link && yarn link \\\"@pmmmwh/react-refresh-webpack-plugin\\\"\",\n-    \"posttest\": \"yarn unlink \\\"@pmmmwh/react-refresh-webpack-plugin\\\"\",\n-    \"test\": \"node scripts/test.js\",\n-    \"test:webpack-5\": \"WEBPACK_VERSION=5 yarn test\",\n-    \"lint\": \"eslint --report-unused-disable-directives --ext .js .\",\n+    \"test\": \"run-s -c test:pre \\\"test:exec {@}\\\" test:post --\",\n+    \"test:wds-4\": \"cross-env WDS_VERSION=4 yarn test\",\n+    \"test:exec\": \"node --experimental-vm-modules scripts/test.js\",\n+    \"test:pre\": \"run-s -c test:pre:*\",\n+    \"test:pre:0\": \"yarn link\",\n+    \"test:pre:1\": \"yarn link @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post\": \"run-s -c test:post:*\",\n+    \"test:post:0\": \"yarn unlink @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post:1\": \"yarn unlink\",\n+    \"lint\": \"eslint --report-unused-disable-directives --ext .js,.jsx .\",\n     \"lint:fix\": \"yarn lint --fix\",\n     \"format\": \"prettier --write \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n     \"format:check\": \"prettier --check \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n-    \"generate-types\": \"tsc -p tsconfig.json && rimraf \\\"types/{globals.*,runtime,utils}\\\" && yarn format\",\n-    \"prepublishOnly\": \"rimraf types && yarn generate-types\"\n+    \"types:clean\": \"del types\",\n+    \"types:compile\": \"tsc\",\n+    \"types:prune-private\": \"del \\\"types/*/*\\\" \\\"!types/{lib,loader,options}/{index,types}.d.ts\\\"\",\n+    \"generate:client-external\": \"webpack\",\n+    \"generate:types\": \"run-s types:clean types:compile types:prune-private \\\"format --log-level=silent\\\"\",\n+    \"prepublishOnly\": \"run-p generate:*\"\n   },\n   \"dependencies\": {\n-    \"ansi-html\": \"^0.0.7\",\n+    \"anser\": \"^2.1.1\",\n+    \"core-js-pure\": \"^3.23.3\",\n     \"error-stack-parser\": \"^2.0.6\",\n-    \"html-entities\": \"^1.2.1\",\n-    \"native-url\": \"^0.2.6\",\n-    \"schema-utils\": \"^2.6.5\",\n+    \"html-entities\": \"^2.1.0\",\n+    \"schema-utils\": \"^4.2.0\",\n     \"source-map\": \"^0.7.3\"\n   },\n   \"devDependencies\": {\n-    \"@babel/core\": \"^7.10.5\",\n-    \"@types/json-schema\": \"^7.0.5\",\n-    \"@types/node\": \"^14.0.24\",\n-    \"@types/puppeteer\": \"^3.0.1\",\n-    \"@types/webpack\": \"^4.41.21\",\n-    \"@webpack-cli/serve\": \"^1.0.1-alpha.5\",\n-    \"babel-loader\": \"^8.1.0\",\n-    \"cross-spawn\": \"^7.0.3\",\n-    \"eslint\": \"^7.5.0\",\n-    \"eslint-config-prettier\": \"^6.11.0\",\n-    \"eslint-plugin-prettier\": \"^3.1.4\",\n-    \"fs-extra\": \"^9.0.1\",\n-    \"get-port\": \"^5.1.1\",\n-    \"jest\": \"^26.1.0\",\n-    \"jest-circus\": \"^26.1.0\",\n-    \"jest-environment-node\": \"^26.1.0\",\n-    \"jest-junit\": \"^11.0.1\",\n-    \"jest-watch-typeahead\": \"^0.6.0\",\n-    \"memfs\": \"^3.2.0\",\n-    \"nanoid\": \"^3.1.10\",\n-    \"patch-package\": \"^6.2.2\",\n-    \"prettier\": \"^2.0.5\",\n-    \"puppeteer\": \"^5.2.1\",\n-    \"react-refresh\": \"^0.8.3\",\n-    \"rimraf\": \"^3.0.2\",\n+    \"@babel/core\": \"^7.24.6\",\n+    \"@babel/plugin-transform-modules-commonjs\": \"^7.24.6\",\n+    \"@types/cross-spawn\": \"^6.0.6\",\n+    \"@types/fs-extra\": \"^11.0.4\",\n+    \"@types/jest\": \"^29.5.12\",\n+    \"@types/json-schema\": \"^7.0.15\",\n",
					"match": false,
					"packageHash": "0db1e876fab8787210a1c4d2a7d3fc8b7e1126f98465f1bb8338cd0dec051d1f",
					"size": 3686,
					"sourceHash": "2acd42464a99db90ad3e72e7a40e8adbca15365d4473c19d1a6910ab1cfd9b6e",
					"status": "content"
				},
				"sockets/WDSSocket.js": {
					"diff": "--- published/sockets/WDSSocket.js\n+++ rebuilt/sockets/WDSSocket.js\n@@ -1,26 +1,26 @@\n-/* global __webpack_dev_server_client__ */\n-\n-const url = require('native-url');\n-const getSocketUrlParts = require('./utils/getSocketUrlParts');\n-\n /**\n  * Initializes a socket server for HMR for webpack-dev-server.\n  * @param {function(*): void} messageHandler A handler to consume Webpack compilation messages.\n- * @param {string} [resourceQuery] Webpack's `__resourceQuery` string.\n  * @returns {void}\n  */\n-function initWDSSocket(messageHandler, resourceQuery) {\n-  if (typeof __webpack_dev_server_client__ !== 'undefined') {\n-    const SocketClient = __webpack_dev_server_client__;\n+function initWDSSocket(messageHandler) {\n+  const { default: SockJSClient } = require('webpack-dev-server/client/clients/SockJSClient');\n+  const { default: WebSocketClient } = require('webpack-dev-server/client/clients/WebSocketClient');\n+  const { client } = require('webpack-dev-server/client/socket');\n \n-    const urlParts = getSocketUrlParts(resourceQuery);\n-    const connection = new SocketClient(url.format(urlParts));\n-\n-    connection.onMessage(function onSocketMessage(data) {\n-      const message = JSON.parse(data);\n-      messageHandler(message);\n-    });\n+  /** @type {WebSocket} */\n+  let connection;\n+  if (client instanceof SockJSClient) {\n+    connection = client.sock;\n+  } else if (client instanceof WebSocketClient) {\n+    connection = client.client;\n+  } else {\n+    throw new Error('Failed to determine WDS client type');\n   }\n+\n+  connection.addEventListener('message', function onSocketMessage(message) {\n+    messageHandler(JSON.parse(message.data));\n+  });\n }\n \n-module.exports = initWDSSocket;\n+module.exports = { init: initWDSSocket };\n",
					"match": false,
					"packageHash": "a822b12a03a03ee1e331e1ac06a5fead1c7e904ca5c4c30a46e937b7d619afe3",
					"size": 871,
					"sourceHash": "ced8ec207c9ed52a39a6c8c78742cdb4aad5b51fda4d2ac3bd2416ef560cda2e",
					"status": "content"
				},
				"sockets/WHMEventSource.js": {
					"diff": "--- published/sockets/WHMEventSource.js\n+++ rebuilt/sockets/WHMEventSource.js\n@@ -11,21 +11,21 @@\n  * @returns {void}\n  */\n function initWHMEventSource(messageHandler) {\n-  const client = window[singletonKey] || require('webpack-hot-middleware/client');\n+  const client = window[singletonKey];\n \n   client.useCustomOverlay({\n-    showProblems(type, data) {\n+    showProblems: function showProblems(type, data) {\n       const error = {\n-        type,\n-        data,\n+        data: data,\n+        type: type,\n       };\n \n       messageHandler(error);\n     },\n-    clear() {\n+    clear: function clear() {\n       messageHandler({ type: 'ok' });\n     },\n   });\n }\n \n-module.exports = initWHMEventSource;\n+module.exports = { init: initWHMEventSource };\n",
					"match": false,
					"packageHash": "e5b7e8e2375fefa2e2a7b8b36e9b48cbc7d1bd1a98f1dfe0830eea2aa545263d",
					"size": 859,
					"sourceHash": "6f1b23673dc918c81b8c096970f961a7804d65265d9773c7ef83a5808ee843ac",
					"status": "content"
				},
				"sockets/WPSSocket.js": {
					"diff": "--- published/sockets/WPSSocket.js\n+++ rebuilt/sockets/WPSSocket.js\n@@ -1,4 +1,5 @@\n /* global oss */\n+const { ClientSocket } = require('webpack-plugin-serve/lib/client/ClientSocket');\n \n /**\n  * Initializes a socket server for HMR for webpack-plugin-serve.\n@@ -20,12 +21,11 @@\n     return;\n   }\n \n-  const { ClientSocket } = require('webpack-plugin-serve/lib/client/ClientSocket');\n   const { address, client = {}, secure } = options;\n   const protocol = secure ? 'wss' : 'ws';\n-  const socket = new ClientSocket(client, `${protocol}://${client.address || address}/wps`);\n+  const socket = new ClientSocket(client, protocol + '://' + (client.address || address) + '/wps');\n \n-  socket.addEventListener('message', (message) => {\n+  socket.addEventListener('message', function listener(message) {\n     const { action, data } = JSON.parse(message.data);\n \n     switch (action) {\n@@ -48,4 +48,4 @@\n   });\n }\n \n-module.exports = initWPSSocket;\n+module.exports = { init: initWPSSocket };\n",
					"match": false,
					"packageHash": "af285bedfc3499ae549a107548f7f3b94cc3a5f842c4f4e43f2ee0dbb77ada79",
					"size": 1514,
					"sourceHash": "c2f6cee37905a577670ce4828d243770db551cb7383c368b46423362e946d510",
					"status": "content"
				},
				"sockets/utils/getCurrentScriptSource.js": {
					"match": false,
					"packageHash": "a6fab3194a4ceba3cc82da6302411c5c00fd1dee0a51de48abeddc07cb01de6c",
					"size": 744,
					"status": "missing-in-source"
				},
				"sockets/utils/getSocketUrlParts.js": {
					"match": false,
					"packageHash": "bfe2b1fd796a03b7a9c2228f38d771eecc3dd500e147e0df07ab1ea7c0bfb254",
					"size": 3376,
					"status": "missing-in-source"
				},
				"sockets/utils/parseQuery.js": {
					"match": false,
					"packageHash": "ef21f47340f6dc0cdb0866f667d6e5c3651acbdc778c7557270e5a3b7bc67184",
					"size": 819,
					"status": "missing-in-source"
				},
				"types/index.d.ts": {
					"match": false,
					"packageHash": "734cb95a4a8b79fc1e16e669470d78b0b6d062629c1a85320d1efe8ab83c639f",
					"size": 669,
					"status": "missing-in-source"
				},
				"types/types.d.ts": {
					"match": false,
					"packageHash": "6811e16c1bf23dfcf341fd933316160d9a851f70b2bf642bb242367b8513d3ce",
					"size": 2764,
					"status": "missing-in-source"
				},
				"client/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"client/utils/retry.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/utils/getAdditionalEntries.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/utils/getIntegrationEntry.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/utils/makeRefreshRuntimeModule.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/options.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/types.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/utils/getIdentitySourceMap.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/utils/getModuleSystem.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/utils/getRefreshModuleRuntime.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/utils/index.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"loader/utils/normalizeOptions.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"options/index.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"overlay/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"overlay/utils.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"sockets/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"types/lib/index.d.ts": {
					"match": false,
					"status": "missing-in-package"
				},
				"types/lib/types.d.ts": {
					"match": false,
					"status": "missing-in-package"
				},
				"types/loader/index.d.ts": {
					"match": false,
					"status": "missing-in-package"
				},
				"types/loader/types.d.ts": {
					"match": false,
					"status": "missing-in-package"
				},
				"types/options/index.d.ts": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 27,
				"matchingFiles": 3,
				"missingInPackage": 21,
				"missingInSource": 18,
				"score": 0.043478260869565216,
				"totalFiles": 69
			}
		}
	}
]
