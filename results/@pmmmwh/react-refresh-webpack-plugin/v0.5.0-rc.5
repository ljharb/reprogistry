[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-04T00:02:28.803Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:11.7.0",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "@pmmmwh/react-refresh-webpack-plugin@0.5.0-rc.5",
			"name": "@pmmmwh/react-refresh-webpack-plugin",
			"version": "0.5.0-rc.5",
			"location": "https://registry.npmjs.org/@pmmmwh/react-refresh-webpack-plugin/-/react-refresh-webpack-plugin-0.5.0-rc.5.tgz",
			"integrity": "sha512-u9W23sWcG9xUklyI4x+hhrR9YtfSdPTLWx6tVSJV8RjOxpzs73+s38e/aI94ywRAZwRLbLJ8mx6X98xGxRHaZw==",
			"publishedAt": "2021-08-23T09:53:58.127Z",
			"publishedWith": {
				"node": null,
				"npm": null
			}
		},
		"source": {
			"integrity": null,
			"location": "git+https://github.com/pmmmwh/react-refresh-webpack-plugin.git",
			"spec": "github:pmmmwh/react-refresh-webpack-plugin#HEAD"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				"CHANGELOG.md": {
					"match": false,
					"packageHash": "31e2b34a1afb1abdf1eb5cf6d826f02e0a777034b365a4612f180d8d6031f3dd",
					"size": 4518,
					"status": "missing-in-source"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -1,41 +1,70 @@\n # React Refresh Webpack Plugin\n \n-[![Latest Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest)\n-[![Next Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next)\n-[![CircleCI](https://img.shields.io/circleci/project/github/pmmmwh/react-refresh-webpack-plugin/main)](https://app.circleci.com/pipelines/github/pmmmwh/react-refresh-webpack-plugin)\n-[![License](https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin)](./LICENSE)\n+[actions]: https://github.com/pmmmwh/react-refresh-webpack-plugin/actions/workflows/ci.yml\n+[actions:badge]: https://img.shields.io/github/actions/workflow/status/pmmmwh/react-refresh-webpack-plugin/ci.yml?branch=main\n+[license:badge]: https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin\n+[npm:latest]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest\n+[npm:latest:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest\n+[npm:next]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next\n+[npm:next:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next\n \n-An **EXPERIMENTAL** Webpack plugin to enable \"Fast Refresh\" (also previously known as _Hot Reloading_) for React components.\n+[![GitHub Actions][actions:badge]][actions]\n+[![License][license:badge]](./LICENSE)\n+[![Latest Version][npm:latest:badge]][npm:latest]\n+[![Next Version][npm:next:badge]][npm:next]\n \n-## Prerequisites\n+A Webpack plugin to enable \"Fast Refresh\" (also known as _Hot Reloading_) for React components.\n \n-First and foremost, this plugin is not 100% stable.\n-We're working towards a stable v1 release, and we've been testing the plugin quite extensively;\n-but since it is still pretty young, there might still be some unknown edge cases.\n+> We're hoping to land a v1 release soon - please help us by reporting any issues you've encountered!\n \n-There are no breaking changes planned for the v1 release,\n-but they might still happen if we hit some significant road blockers.\n+## Getting Started\n \n-Also, ensure that you are using the minimum supported versions of the plugin's peer dependencies -\n+### Prerequisites\n+\n+Ensure that you are using at least the minimum supported versions of this plugin's peer dependencies -\n older versions unfortunately do not contain code to orchestrate \"Fast Refresh\",\n and thus cannot be made compatible.\n \n-| Dependency         | Minimum                                                      | Best                   |\n-| ------------------ | ------------------------------------------------------------ | ---------------------- |\n-| `react`            | `16.9.0`                                                     | `16.13.0`+             |\n-| `react-dom`        | `16.9.0`                                                     | `16.13.0`+             |\n-| `react-reconciler` | `0.22.0`                                                     | `0.25.0`+              |\n-| `webpack`          | `4.0.0` (for `0.3.x`)<br />`4.43.0` / `5.0.0` (for `0.4.x`+) | `4.43.0`+<br/>`5.2.0`+ |\n-\n-> You only need `react-dom` if you're rendering to the DOM.\n-\n-> You only need to check for `react-reconciler` if you use custom reconcilers like `react-three-fiber`.\n-> You should check their `package.json` to make sure they use a compatible version instead of installing `react-reconciler` yourself.\n-> If the reconcilers are not compatible, please create an issue at their repository.\n+We recommend using the following versions:\n+\n+| Dependency      | Version                              |\n+| --------------- | ------------------------------------ |\n+| `Node.js`       | `18.12.0`+, `20.x`, `22.x`           |\n+| `react`         | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-dom`     | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-refresh` | `0.10.0`+                            |\n+| `webpack`       | `5.2.0`+                             |\n+\n+<details>\n+<summary>Minimum requirements</summary>\n+<br />\n+\n+| Dependency      | Version   |\n+| --------------- | --------- |\n+| `Node.js`       | `18.12.0` |\n+| `react`         | `16.9.0`  |\n+| `react-dom`     | `16.9.0`  |\n+| `react-refresh` | `0.10.0`  |\n+| `webpack`       | `5.2.0`   |\n+\n+</details>\n+\n+<details>\n+<summary>Using custom renderers (e.g. <code>react-three-fiber</code>, <code>react-pdf</code>, <code>ink</code>)</summary>\n+<br />\n+\n+To ensure full support of \"Fast Refresh\" with components rendered by custom renderers,\n+you should ensure the renderer you're using depends on a recent version of `react-reconciler`.\n \n-## Installation\n+We recommend version `0.25.0` or above, but any versions above `0.22.0` should work.\n \n-With all prerequisites met, you can install the plugin with one of the commands below:\n+If the renderer is not compatible, please file them an issue instead.\n+\n+</details>\n+\n+### Installation\n+\n+With all prerequisites met, you can install this plugin using your package manager of choice:\n \n ```sh\n # if you prefer npm\n@@ -48,14 +77,16 @@\n",
					"match": false,
					"packageHash": "039e5cdcf492c011fdd13cbf4d7a19f2d6b198114931df352f31672a890ae153",
					"size": 10398,
					"sourceHash": "e685662008c7264a7a35a431aa151d0cb1e70a70a36cbcabd6c20164e7acb6b6",
					"status": "content"
				},
				"client/ErrorOverlayEntry.js": {
					"diff": "--- published/client/ErrorOverlayEntry.js\n+++ rebuilt/client/ErrorOverlayEntry.js\n@@ -1,100 +1,103 @@\n-/* global __react_refresh_error_overlay__, __react_refresh_socket__, __resourceQuery */\n+/* global __react_refresh_error_overlay__, __react_refresh_socket__ */\n \n-const { handleError, handleUnhandledRejection } = require('./utils/errorEventHandlers.js');\n-const formatWebpackErrors = require('./utils/formatWebpackErrors.js');\n-const runWithPatchedUrl = require('./utils/patchUrl.js');\n-const runWithRetry = require('./utils/retry.js');\n-\n-// Setup error states\n-let isHotReload = false;\n-let hasRuntimeErrors = false;\n-\n-/**\n- * Try dismissing the compile error overlay.\n- * This will also reset runtime error records (if any),\n- * because we have new source to evaluate.\n- * @returns {void}\n- */\n-function tryDismissErrorOverlay() {\n-  __react_refresh_error_overlay__.clearCompileError();\n-  __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n-  hasRuntimeErrors = false;\n-}\n-\n-/**\n- * A function called after a compile success signal is received from Webpack.\n- * @returns {void}\n- */\n-function handleCompileSuccess() {\n-  isHotReload = true;\n-\n-  if (isHotReload) {\n-    tryDismissErrorOverlay();\n-  }\n-}\n-\n-/**\n- * A function called after a compile errored signal is received from Webpack.\n- * @param {string[]} errors\n- * @returns {void}\n- */\n-function handleCompileErrors(errors) {\n-  isHotReload = true;\n-\n-  const formattedErrors = formatWebpackErrors(errors);\n-\n-  // Only show the first error\n-  __react_refresh_error_overlay__.showCompileError(formattedErrors[0]);\n-}\n+if (process.env.NODE_ENV !== 'production') {\n+  const events = require('./utils/errorEventHandlers.js');\n+  const formatWebpackErrors = require('./utils/formatWebpackErrors.js');\n+  const runWithRetry = require('./utils/retry.js');\n+\n+  // Setup error states\n+  let isHotReload = false;\n+  let hasRuntimeErrors = false;\n+\n+  /**\n+   * Try dismissing the compile error overlay.\n+   * This will also reset runtime error records (if any),\n+   * because we have new source to evaluate.\n+   * @returns {void}\n+   */\n+  const tryDismissErrorOverlay = function () {\n+    __react_refresh_error_overlay__.clearCompileError();\n+    __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n+    hasRuntimeErrors = false;\n+  };\n+\n+  /**\n+   * A function called after a compile success signal is received from Webpack.\n+   * @returns {void}\n+   */\n+  const handleCompileSuccess = function () {\n+    isHotReload = true;\n \n-/**\n- * Handles compilation messages from Webpack.\n- * Integrates with a compile error overlay.\n- * @param {*} message A Webpack HMR message sent via WebSockets.\n- * @returns {void}\n- */\n-function compileMessageHandler(message) {\n-  switch (message.type) {\n-    case 'ok':\n-    case 'still-ok':\n-    case 'warnings': {\n-      // TODO: Implement handling for warnings\n-      handleCompileSuccess();\n-      break;\n-    }\n-    case 'errors': {\n-      handleCompileErrors(message.data);\n-      break;\n+    if (isHotReload) {\n+      tryDismissErrorOverlay();\n",
					"match": false,
					"packageHash": "f0fb59eadc22a02511ebace5632f5f567ae4bdf51f6557ba420d7759b03a9779",
					"size": 3035,
					"sourceHash": "5b57c45de0030d6d220c5882d9de66aa6b4509296c885fdee27157989ec06ff1",
					"status": "content"
				},
				"client/LegacyWDSSocketEntry.js": {
					"match": false,
					"packageHash": "825942a445d3f8d4dea9ed5bf07eab8351e9a60366c1027f1f81cd091d25791d",
					"size": 723,
					"status": "missing-in-source"
				},
				"client/ReactRefreshEntry.js": {
					"diff": "--- published/client/ReactRefreshEntry.js\n+++ rebuilt/client/ReactRefreshEntry.js\n@@ -1,9 +1,9 @@\n /* global __react_refresh_library__ */\n \n-const safeThis = require('core-js-pure/features/global-this.js');\n-const RefreshRuntime = require('react-refresh/runtime.js');\n-\n if (process.env.NODE_ENV !== 'production') {\n+  const safeThis = require('core-js-pure/features/global-this');\n+  const RefreshRuntime = require('react-refresh/runtime');\n+\n   if (typeof safeThis !== 'undefined') {\n     var $RefreshInjected$ = '__reactRefreshInjected';\n     // Namespace the injected flag (if necessary) for monorepo compatibility\n",
					"match": false,
					"packageHash": "3f811bae361f96291123be03f3de404e9d4db3d3499ebf142b85ae37324980e8",
					"size": 862,
					"sourceHash": "ccbc4d04b16eda9ca493dae2f1e6a39a402921475524758a2b230d2e71a5a513",
					"status": "content"
				},
				"client/utils/patchUrl.js": {
					"match": false,
					"packageHash": "7dd361694af07dd5eaf3d31a614f63b73ebc3aa4ecaa35e39a343f8b2717a7f3",
					"size": 1197,
					"status": "missing-in-source"
				},
				"client/utils/retry.js": {
					"diff": "--- published/client/utils/retry.js\n+++ rebuilt/client/utils/retry.js\n@@ -1,16 +1,19 @@\n-function runWithRetry(callback, maxRetries) {\n+function runWithRetry(callback, maxRetries, message) {\n   function executeWithRetryAndTimeout(currentCount) {\n     try {\n       if (currentCount > maxRetries - 1) {\n-        console.warn('[React Refresh] Failed set up the socket connection.');\n+        console.warn('[React Refresh]', message);\n         return;\n       }\n \n       callback();\n     } catch (err) {\n-      setTimeout(function () {\n-        executeWithRetryAndTimeout(currentCount + 1);\n-      }, Math.pow(10, currentCount));\n+      setTimeout(\n+        function () {\n+          executeWithRetryAndTimeout(currentCount + 1);\n+        },\n+        Math.pow(10, currentCount)\n+      );\n     }\n   }\n \n",
					"match": false,
					"packageHash": "f9aa638911f01e86ad34af01b345aad9881c3d18f2fa18869961096f3c1ce32d",
					"size": 495,
					"sourceHash": "c7a4b30242351553344be458892a68b7c14364692e419eeea860ed21d8868012",
					"status": "content"
				},
				"lib/globals.js": {
					"diff": "--- published/lib/globals.js\n+++ rebuilt/lib/globals.js\n@@ -6,17 +6,3 @@\n module.exports.getRefreshGlobalScope = (runtimeGlobals) => {\n   return `${runtimeGlobals.require || '__webpack_require__'}.$Refresh$`;\n };\n-\n-/**\n- * Gets current Webpack version according to features on the compiler instance.\n- * @param {import('webpack').Compiler} compiler The current Webpack compiler instance.\n- * @returns {number} The current Webpack version.\n- */\n-module.exports.getWebpackVersion = (compiler) => {\n-  if (!compiler.hooks) {\n-    throw new Error(`[ReactRefreshPlugin] Webpack version is not supported!`);\n-  }\n-\n-  // Webpack v5+ implements compiler caching\n-  return 'cache' in compiler ? 5 : 4;\n-};\n",
					"match": false,
					"packageHash": "d3937e78dfcccd70eae1b823f8ffc9c4fbb2d0ae274ab34b6cefbe720feaed11",
					"size": 843,
					"sourceHash": "47fc9689ab1a550044fb41caec41a17e88482e61d6d0f97ac9fbceaa9dcba4c5",
					"status": "content"
				},
				"lib/index.js": {
					"diff": "--- published/lib/index.js\n+++ rebuilt/lib/index.js\n@@ -1,11 +1,9 @@\n const { validate: validateOptions } = require('schema-utils');\n-const { getRefreshGlobalScope, getWebpackVersion } = require('./globals');\n+const { getRefreshGlobalScope } = require('./globals');\n const {\n   getAdditionalEntries,\n   getIntegrationEntry,\n-  getRefreshGlobal,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n   makeRefreshRuntimeModule,\n   normalizeOptions,\n@@ -48,7 +46,6 @@\n       return;\n     }\n \n-    const webpackVersion = getWebpackVersion(compiler);\n     const logger = compiler.getInfrastructureLogger(this.constructor.name);\n \n     // Get Webpack imports from compiler instance (if available) -\n@@ -66,81 +63,75 @@\n     } = webpack;\n \n     // Inject react-refresh context to all Webpack entry points.\n-    // This should create `EntryDependency` objects when available,\n-    // and fallback to patching the `entry` object for legacy workflows.\n-    const addEntries = getAdditionalEntries({\n-      devServer: compiler.options.devServer,\n-      options: this.options,\n-    });\n-    if (EntryPlugin) {\n-      // Prepended entries does not care about injection order,\n-      // so we can utilise EntryPlugin for simpler logic.\n-      addEntries.prependEntries.forEach((entry) => {\n-        new EntryPlugin(compiler.context, entry, { name: undefined }).apply(compiler);\n-      });\n-\n-      const integrationEntry = getIntegrationEntry(this.options.overlay.sockIntegration);\n-      const socketEntryData = [];\n-      compiler.hooks.make.tap(\n-        { name: this.constructor.name, stage: Number.POSITIVE_INFINITY },\n-        (compilation) => {\n-          // Exhaustively search all entries for `integrationEntry`.\n-          // If found, mark those entries and the index of `integrationEntry`.\n-          for (const [name, entryData] of compilation.entries.entries()) {\n-            const index = entryData.dependencies.findIndex(\n-              (dep) => dep.request && dep.request.includes(integrationEntry)\n-            );\n-            if (index !== -1) {\n-              socketEntryData.push({ name, index });\n-            }\n+    const { overlayEntries, prependEntries } = getAdditionalEntries(this.options);\n+    // Prepended entries does not care about injection order,\n+    // so we can utilise EntryPlugin for simpler logic.\n+    for (const entry of prependEntries) {\n+      new EntryPlugin(compiler.context, entry, { name: undefined }).apply(compiler);\n+    }\n+\n+    const integrationEntry = getIntegrationEntry(this.options.overlay.sockIntegration);\n+    const socketEntryData = [];\n+    compiler.hooks.make.tap(\n+      { name: this.constructor.name, stage: Number.POSITIVE_INFINITY },\n+      (compilation) => {\n+        // Exhaustively search all entries for `integrationEntry`.\n+        // If found, mark those entries and the index of `integrationEntry`.\n+        for (const [name, entryData] of compilation.entries.entries()) {\n+          const index = entryData.dependencies.findIndex(\n+            (dep) => dep.request && dep.request.includes(integrationEntry)\n+          );\n+          if (index !== -1) {\n+            socketEntryData.push({ name, index });\n           }\n         }\n-      );\n+      }\n+    );\n \n-      // Overlay entries need to be injected AFTER integration's entry,\n-      // so we will loop through everything in `finishMake` instead of `make`.\n-      // This ensures we can traverse all entry points and inject stuff with the correct order.\n-      addEntries.overlayEntries.forEach((entry, idx, arr) => {\n-        compiler.hooks.finishMake.tapPromise(\n-          { name: this.constructor.name, stage: Number.MIN_SAFE_INTEGER + (arr.length - idx - 1) },\n-          (compilation) => {\n-            // Only hook into the current compiler\n-            if (compilation.compiler !== compiler) {\n-              return Promise.resolve();\n-            }\n+    // Overlay entries need to be injected AFTER integration's entry,\n+    // so we will loop through everything in `finishMake` instead of `make`.\n+    // This ensures we can traverse all entry points and inject stuff with the correct order.\n+    for (const [idx, entry] of overlayEntries.entries()) {\n+      compiler.hooks.finishMake.tapPromise(\n+        {\n+          name: this.constructor.name,\n+          stage: Number.MIN_SAFE_INTEGER + (overlayEntries.length - idx - 1),\n+        },\n",
					"match": false,
					"packageHash": "473401f7ee50d444d9d1c5ce822eb16b4cd77936f33b9b4fc519c11551aea733",
					"size": 14752,
					"sourceHash": "903041123290f427ef671589fdbc43d6289441ac77157434b0683572915a2e32",
					"status": "content"
				},
				"lib/options.json": {
					"diff": "--- published/lib/options.json\n+++ rebuilt/lib/options.json\n@@ -45,13 +45,7 @@\n             { \"enum\": [\"wds\", \"whm\", \"wps\"] },\n             { \"$ref\": \"#/definitions/Path\" }\n           ]\n-        },\n-        \"sockHost\": { \"type\": \"string\" },\n-        \"sockPath\": { \"type\": \"string\" },\n-        \"sockPort\": { \"type\": \"number\", \"minimum\": 0 },\n-        \"sockProtocol\": { \"enum\": [\"http\", \"https\", \"ws\", \"wss\"] },\n-        \"useLegacyWDSSockets\": { \"type\": \"boolean\" },\n-        \"useURLPolyfill\": { \"type\": \"boolean\" }\n+        }\n       }\n     }\n   },\n",
					"match": false,
					"packageHash": "d7f9ead9e3d03debd947e9e3b0b4f1edbf6ba5b17a1087508077f068ea45554a",
					"size": 2293,
					"sourceHash": "c363aa80bb10c6d71a4dd66b2a954e0ac30e0064a0ba4aedf4319acb679599a0",
					"status": "content"
				},
				"lib/runtime/RefreshUtils.js": {
					"diff": "--- published/lib/runtime/RefreshUtils.js\n+++ rebuilt/lib/runtime/RefreshUtils.js\n@@ -7,7 +7,24 @@\n  * @returns {*} An exports object from the module.\n  */\n function getModuleExports(moduleId) {\n-  var exportsOrPromise = __webpack_require__.c[moduleId].exports;\n+  if (typeof moduleId === 'undefined') {\n+    // `moduleId` is unavailable, which indicates that this module is not in the cache,\n+    // which means we won't be able to capture any exports,\n+    // and thus they cannot be refreshed safely.\n+    // These are likely runtime or dynamically generated modules.\n+    return {};\n+  }\n+\n+  var maybeModule = __webpack_require__.c[moduleId];\n+  if (typeof maybeModule === 'undefined') {\n+    // `moduleId` is available but the module in cache is unavailable,\n+    // which indicates the module is somehow corrupted (e.g. broken Webpacak `module` globals).\n+    // We will warn the user (as this is likely a mistake) and assume they cannot be refreshed.\n+    console.warn('[React Refresh] Failed to get exports for module: ' + moduleId + '.');\n+    return {};\n+  }\n+\n+  var exportsOrPromise = maybeModule.exports;\n   if (typeof Promise !== 'undefined' && exportsOrPromise instanceof Promise) {\n     return exportsOrPromise.then(function (exports) {\n       return exports;\n@@ -46,6 +63,21 @@\n }\n \n /**\n+ * Creates a data object to be retained across refreshes.\n+ * This object should not transtively reference previous exports,\n+ * which can form infinite chain of objects across refreshes, which can pressure RAM.\n+ *\n+ * @param {*} moduleExports A Webpack module exports object.\n+ * @returns {*} A React refresh boundary signature array.\n+ */\n+function getWebpackHotData(moduleExports) {\n+  return {\n+    signature: getReactRefreshBoundarySignature(moduleExports),\n+    isReactRefreshBoundary: isReactRefreshBoundary(moduleExports),\n+  };\n+}\n+\n+/**\n  * Creates a helper that performs a delayed React refresh.\n  * @returns {function(function(): void): void} A debounced React refresh function.\n  */\n@@ -150,14 +182,11 @@\n  * Compares previous and next module objects to check for mutated boundaries.\n  *\n  * This implementation is based on the one in [Metro](https://github.com/facebook/metro/blob/907d6af22ac6ebe58572be418e9253a90665ecbd/packages/metro/src/lib/polyfills/require.js#L776-L792).\n- * @param {*} prevExports The current Webpack module exports object.\n- * @param {*} nextExports The next Webpack module exports object.\n+ * @param {*} prevSignature The signature of the current Webpack module exports object.\n+ * @param {*} nextSignature The signature of the next Webpack module exports object.\n  * @returns {boolean} Whether the React refresh boundary should be invalidated.\n  */\n-function shouldInvalidateReactRefreshBoundary(prevExports, nextExports) {\n-  var prevSignature = getReactRefreshBoundarySignature(prevExports);\n-  var nextSignature = getReactRefreshBoundarySignature(nextExports);\n-\n+function shouldInvalidateReactRefreshBoundary(prevSignature, nextSignature) {\n   if (prevSignature.length !== nextSignature.length) {\n     return true;\n   }\n@@ -177,9 +206,9 @@\n \n   if (webpackHot) {\n     var isHotUpdate = !!webpackHot.data;\n-    var prevExports;\n+    var prevData;\n     if (isHotUpdate) {\n-      prevExports = webpackHot.data.prevExports;\n+      prevData = webpackHot.data.prevData;\n     }\n \n     if (isReactRefreshBoundary(moduleExports)) {\n@@ -192,7 +221,7 @@\n          */\n         function hotDisposeCallback(data) {\n           // We have to mutate the data object to get data registered and cached\n-          data.prevExports = moduleExports;\n+          data.prevData = getWebpackHotData(moduleExports);\n         }\n       );\n       webpackHot.accept(\n@@ -218,8 +247,12 @@\n \n       if (isHotUpdate) {\n         if (\n-          isReactRefreshBoundary(prevExports) &&\n-          shouldInvalidateReactRefreshBoundary(prevExports, moduleExports)\n+          prevData &&\n+          prevData.isReactRefreshBoundary &&\n+          shouldInvalidateReactRefreshBoundary(\n+            prevData.signature,\n+            getReactRefreshBoundarySignature(moduleExports)\n",
					"match": false,
					"packageHash": "36636b1193e939cc85a6f30b6a77df04ff1e2cf815df40706df6f1ecadc0a4c7",
					"size": 8306,
					"sourceHash": "ce2851930f563eb07cd10528b50ed9812bff95fcf009119ffa4f0a4dac24089c",
					"status": "content"
				},
				"lib/types.js": {
					"diff": "--- published/lib/types.js\n+++ rebuilt/lib/types.js\n@@ -2,13 +2,7 @@\n  * @typedef {Object} ErrorOverlayOptions\n  * @property {string | false} [entry] Path to a JS file that sets up the error overlay integration.\n  * @property {string | false} [module] The error overlay module to use.\n- * @property {string} [sockHost] The socket host to use (WDS only).\n  * @property {import('type-fest').LiteralUnion<'wds' | 'whm' | 'wps' | false, string>} [sockIntegration] Path to a JS file that sets up the Webpack socket integration.\n- * @property {string} [sockPath] The socket path to use (WDS only).\n- * @property {number} [sockPort] The socket port to use (WDS only).\n- * @property {'http' | 'https' | 'ws' | 'wss'} [sockProtocol] The socket protocol to use (WDS only).\n- * @property {boolean} [useLegacyWDSSockets] Uses a custom SocketJS implementation for older versions of WDS.\n- * @property {boolean} [useURLPolyfill] Uses a polyfill for the DOM URL API (WDS only).\n  */\n \n /**\n",
					"match": false,
					"packageHash": "db4e60145335789f87727325aa83bc0d06989ca6c461abf1fd09f373d39a52d2",
					"size": 2067,
					"sourceHash": "5ea26f09e4e5261fcc4e2c5dc98ae038178232802ac9fd127fb5040422a981cc",
					"status": "content"
				},
				"lib/utils/getAdditionalEntries.js": {
					"diff": "--- published/lib/utils/getAdditionalEntries.js\n+++ rebuilt/lib/utils/getAdditionalEntries.js\n@@ -1,5 +1,3 @@\n-const querystring = require('querystring');\n-\n /**\n  * @typedef {Object} AdditionalEntries\n  * @property {string[]} prependEntries\n@@ -8,56 +6,18 @@\n \n /**\n  * Creates an object that contains two entry arrays: the prependEntries and overlayEntries\n- * @param {Object} optionsContainer This is the container for the options to this function\n- * @param {import('../types').NormalizedPluginOptions} optionsContainer.options Configuration options for this plugin.\n- * @param {import('webpack').Compiler[\"options\"][\"devServer\"]} [optionsContainer.devServer] The webpack devServer config\n+ * @param {import('../types').NormalizedPluginOptions} options Configuration options for this plugin.\n  * @returns {AdditionalEntries} An object that contains the Webpack entries for prepending and the overlay feature\n  */\n-function getAdditionalEntries({ devServer, options }) {\n-  /** @type {Record<string, string | number>} */\n-  let resourceQuery = {};\n-\n-  if (devServer) {\n-    const { sockHost, sockPath, sockPort, host, path, port, https, http2 } = devServer;\n-\n-    (sockHost || host) && (resourceQuery.sockHost = sockHost ? sockHost : host);\n-    (sockPath || path) && (resourceQuery.sockPath = sockPath ? sockPath : path);\n-    (sockPort || port) && (resourceQuery.sockPort = sockPort ? sockPort : port);\n-    resourceQuery.sockProtocol = https || http2 ? 'https' : 'http';\n-  }\n-\n-  if (options.overlay) {\n-    options.overlay.sockHost && (resourceQuery.sockHost = options.overlay.sockHost);\n-    options.overlay.sockPath && (resourceQuery.sockPath = options.overlay.sockPath);\n-    options.overlay.sockPort && (resourceQuery.sockPort = options.overlay.sockPort);\n-    options.overlay.sockProtocol && (resourceQuery.sockProtocol = options.overlay.sockProtocol);\n-  }\n-\n-  // We don't need to URI encode the resourceQuery as it will be parsed by Webpack\n-  const queryString = querystring.stringify(resourceQuery, undefined, undefined, {\n-    /**\n-     * @param {string} string\n-     * @returns {string}\n-     */\n-    encodeURIComponent(string) {\n-      return string;\n-    },\n-  });\n-\n+function getAdditionalEntries(options) {\n   const prependEntries = [\n     // React-refresh runtime\n     require.resolve('../../client/ReactRefreshEntry'),\n   ];\n \n   const overlayEntries = [\n-    // Legacy WDS SockJS integration\n-    options.overlay &&\n-      options.overlay.useLegacyWDSSockets &&\n-      require.resolve('../../client/LegacyWDSSocketEntry'),\n     // Error overlay runtime\n-    options.overlay &&\n-      options.overlay.entry &&\n-      `${require.resolve(options.overlay.entry)}${queryString ? `?${queryString}` : ''}`,\n+    options.overlay && options.overlay.entry && require.resolve(options.overlay.entry),\n   ].filter(Boolean);\n \n   return { prependEntries, overlayEntries };\n",
					"match": false,
					"packageHash": "a7ebb1029072dbd60a7dc9d9f0854d1ca7354855e7e1d17e0f403d0f8237cbce",
					"size": 2550,
					"sourceHash": "d24a6d262b4f24f148d1a5303321305d152f3a878777d4de0e0bfb965c68d3d9",
					"status": "content"
				},
				"lib/utils/getRefreshGlobal.js": {
					"match": false,
					"packageHash": "2b82c6e4326e8301d9e6061bb2e19f1c7efedbb56866f8e959a99b5d050977cb",
					"size": 4040,
					"status": "missing-in-source"
				},
				"lib/utils/index.js": {
					"diff": "--- published/lib/utils/index.js\n+++ rebuilt/lib/utils/index.js\n@@ -1,8 +1,6 @@\n const getAdditionalEntries = require('./getAdditionalEntries');\n const getIntegrationEntry = require('./getIntegrationEntry');\n-const getRefreshGlobal = require('./getRefreshGlobal');\n const getSocketIntegration = require('./getSocketIntegration');\n-const injectRefreshEntry = require('./injectRefreshEntry');\n const injectRefreshLoader = require('./injectRefreshLoader');\n const makeRefreshRuntimeModule = require('./makeRefreshRuntimeModule');\n const normalizeOptions = require('./normalizeOptions');\n@@ -10,9 +8,7 @@\n module.exports = {\n   getAdditionalEntries,\n   getIntegrationEntry,\n-  getRefreshGlobal,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n   makeRefreshRuntimeModule,\n   normalizeOptions,\n",
					"match": false,
					"packageHash": "c377709d3b68f59e3788a841e67475cd22394ef41f058e5f00c71a2aac36f317",
					"size": 703,
					"sourceHash": "92fb4ccffc1b6eff62f0d0fcda08cb3662cee6a222a35b40a1b25fb229873ec4",
					"status": "content"
				},
				"lib/utils/injectRefreshEntry.js": {
					"match": false,
					"packageHash": "c2ae906faba28f8715cc40a1b6c5afeab6cc7576cff2ef50fe8fa38664a89b3b",
					"size": 3129,
					"status": "missing-in-source"
				},
				"lib/utils/injectRefreshLoader.js": {
					"diff": "--- published/lib/utils/injectRefreshLoader.js\n+++ rebuilt/lib/utils/injectRefreshLoader.js\n@@ -1,4 +1,4 @@\n-const path = require('path');\n+const path = require('node:path');\n \n /**\n  * @callback MatchObject\n@@ -13,6 +13,8 @@\n  */\n \n const resolvedLoader = require.resolve('../../loader');\n+const reactRefreshPath = path.dirname(require.resolve('react-refresh'));\n+const refreshUtilsPath = path.join(__dirname, '../runtime/RefreshUtils');\n \n /**\n  * Injects refresh loader to all JavaScript-like and user-specified files.\n@@ -23,27 +25,33 @@\n function injectRefreshLoader(moduleData, injectOptions) {\n   const { match, options } = injectOptions;\n \n+  // Include and exclude user-specified files\n+  if (!match(moduleData.matchResource || moduleData.resource)) return moduleData;\n+  // Include and exclude dynamically generated modules from other loaders\n+  if (moduleData.matchResource && !match(moduleData.request)) return moduleData;\n+  // Exclude files referenced as assets\n+  if (moduleData.type.includes('asset')) return moduleData;\n+  // Check to prevent double injection\n+  if (moduleData.loaders.find(({ loader }) => loader === resolvedLoader)) return moduleData;\n+  // Skip react-refresh and the plugin's runtime utils to prevent self-referencing -\n+  // this is useful when using the plugin as a direct dependency,\n+  // or when node_modules are specified to be processed.\n   if (\n-    // Include and exclude user-specified files\n-    match(moduleData.resource) &&\n-    // Skip react-refresh and the plugin's runtime utils to prevent self-referencing -\n-    // this is useful when using the plugin as a direct dependency,\n-    // or when node_modules are specified to be processed.\n-    !moduleData.resource.includes(path.dirname(require.resolve('react-refresh'))) &&\n-    !moduleData.resource.includes(path.join(__dirname, '../runtime/RefreshUtils')) &&\n-    // Check to prevent double injection\n-    !moduleData.loaders.find(({ loader }) => loader === resolvedLoader)\n+    moduleData.resource.includes(reactRefreshPath) ||\n+    moduleData.resource.includes(refreshUtilsPath)\n   ) {\n-    // As we inject runtime code for each module,\n-    // it is important to run the injected loader after everything.\n-    // This way we can ensure that all code-processing have been done,\n-    // and we won't risk breaking tools like Flow or ESLint.\n-    moduleData.loaders.unshift({\n-      loader: resolvedLoader,\n-      options,\n-    });\n+    return moduleData;\n   }\n \n+  // As we inject runtime code for each module,\n+  // it is important to run the injected loader after everything.\n+  // This way we can ensure that all code-processing have been done,\n+  // and we won't risk breaking tools like Flow or ESLint.\n+  moduleData.loaders.unshift({\n+    loader: resolvedLoader,\n+    options,\n+  });\n+\n   return moduleData;\n }\n \n",
					"match": false,
					"packageHash": "a93d5feb14295ad952119021d17441898cb2ca52c8e2e7eb9458de837b9f388b",
					"size": 1802,
					"sourceHash": "3f5147476d72e21dc95a45d24d5f905d3176d29db6aff67e09852f98b94190ab",
					"status": "content"
				},
				"lib/utils/makeRefreshRuntimeModule.js": {
					"diff": "--- published/lib/utils/makeRefreshRuntimeModule.js\n+++ rebuilt/lib/utils/makeRefreshRuntimeModule.js\n@@ -1,10 +1,9 @@\n-const { getRefreshGlobalScope } = require('../globals');\n-const getRefreshGlobal = require('./getRefreshGlobal');\n-\n /**\n  * Makes a runtime module to intercept module execution for React Refresh.\n+ * This module creates an isolated `__webpack_require__` function for each module,\n+ * and injects a `$Refresh$` object into it for use by React Refresh.\n  * @param {import('webpack')} webpack The Webpack exports.\n- * @returns {ReactRefreshRuntimeModule} The runtime module class.\n+ * @returns {typeof import('webpack').RuntimeModule} The runtime module class.\n  */\n function makeRefreshRuntimeModule(webpack) {\n   return class ReactRefreshRuntimeModule extends webpack.RuntimeModule {\n@@ -18,53 +17,81 @@\n      * @returns {string} runtime code\n      */\n     generate() {\n+      if (!this.compilation) throw new Error('Webpack compilation missing!');\n+\n       const { runtimeTemplate } = this.compilation;\n-      const refreshGlobal = getRefreshGlobalScope(webpack.RuntimeGlobals);\n+      const constDeclaration = runtimeTemplate.supportsConst() ? 'const' : 'var';\n       return webpack.Template.asString([\n+        `${constDeclaration} setup = ${runtimeTemplate.basicFunction('moduleId', [\n+          `${constDeclaration} refresh = {`,\n+          webpack.Template.indent([\n+            `moduleId: moduleId,`,\n+            `register: ${runtimeTemplate.basicFunction('type, id', [\n+              `${constDeclaration} typeId = moduleId + ' ' + id;`,\n+              'refresh.runtime.register(type, typeId);',\n+            ])},`,\n+            `signature: ${runtimeTemplate.returningFunction(\n+              'refresh.runtime.createSignatureFunctionForTransform()'\n+            )},`,\n+            `runtime: {`,\n+            webpack.Template.indent([\n+              `createSignatureFunctionForTransform: ${runtimeTemplate.returningFunction(\n+                runtimeTemplate.returningFunction('type', 'type')\n+              )},`,\n+              `register: ${runtimeTemplate.emptyFunction()}`,\n+            ]),\n+            `},`,\n+          ]),\n+          `};`,\n+          `return refresh;`,\n+        ])};`,\n+        '',\n         `${webpack.RuntimeGlobals.interceptModuleExecution}.push(${runtimeTemplate.basicFunction(\n           'options',\n           [\n-            `${\n-              runtimeTemplate.supportsConst() ? 'const' : 'var'\n-            } originalFactory = options.factory;`,\n-            `options.factory = ${runtimeTemplate.basicFunction(\n-              'moduleObject, moduleExports, webpackRequire',\n-              [\n-                `${refreshGlobal}.setup(options.id);`,\n-                'try {',\n-                webpack.Template.indent(\n-                  'originalFactory.call(this, moduleObject, moduleExports, webpackRequire);'\n-                ),\n-                '} finally {',\n-                webpack.Template.indent([\n-                  `if (typeof Promise !== 'undefined' && moduleObject.exports instanceof Promise) {`,\n+            `${constDeclaration} originalFactory = options.factory;`,\n+            // Using a function declaration -\n+            // ensures `this` would propagate for modules relying on it\n+            `options.factory = function(moduleObject, moduleExports, webpackRequire) {`,\n+            webpack.Template.indent([\n+              // Our require function delegates to the original require function\n+              `${constDeclaration} hotRequire = ${runtimeTemplate.returningFunction(\n+                'webpackRequire(request)',\n+                'request'\n+              )};`,\n+              // The propery descriptor factory below ensures all properties but `$Refresh$`\n+              // are proxied through to the original require function\n+              `${constDeclaration} createPropertyDescriptor = ${runtimeTemplate.basicFunction(\n+                'name',\n+                [\n+                  `return {`,\n                   webpack.Template.indent([\n-                    // Ponyfill `Promise.finally` as it is only part of the spec after ES2018,\n-                    // and Webpack's top level await implementation only rely on ES2015 Promises.\n-                    'options.module.exports.then(',\n-                    webpack.Template.indent([\n-                      `${runtimeTemplate.basicFunction('result', [\n-                        `${refreshGlobal}.cleanup(options.id);`,\n-                        'return result;',\n-                      ])},`,\n-                      runtimeTemplate.basicFunction('reason', [\n-                        `${refreshGlobal}.cleanup(options.id);`,\n-                        'return Promise.reject(reason);',\n-                      ]),\n-                    ]),\n-                    `);`,\n+                    `configurable: true,`,\n+                    `enumerable: true,`,\n",
					"match": false,
					"packageHash": "258bfe01ab6d7571d6a5326c87be36fd62600e147f5c30e3001fc652a40e62e2",
					"size": 2949,
					"sourceHash": "f693683a81c216a2352ca013ab67bad4a23a26fe63df2a59898e1815fa442053",
					"status": "content"
				},
				"lib/utils/normalizeOptions.js": {
					"diff": "--- published/lib/utils/normalizeOptions.js\n+++ rebuilt/lib/utils/normalizeOptions.js\n@@ -29,12 +29,6 @@\n     d(overlay, 'entry', defaults.entry);\n     d(overlay, 'module', defaults.module);\n     d(overlay, 'sockIntegration', defaults.sockIntegration);\n-    d(overlay, 'sockHost');\n-    d(overlay, 'sockPath');\n-    d(overlay, 'sockPort');\n-    d(overlay, 'sockProtocol');\n-    d(options, 'useLegacyWDSSockets');\n-    d(options, 'useURLPolyfill');\n \n     return overlay;\n   });\n",
					"match": false,
					"packageHash": "be1a0f06fbe5af721cbffec314b0d47fec36296e2ef0835bed21c5e479dcb410",
					"size": 1311,
					"sourceHash": "d1fda547183f02d1a6fad5eaf0953884ff4d44ce7e821bd730880987025daf1d",
					"status": "content"
				},
				"loader/index.js": {
					"diff": "--- published/loader/index.js\n+++ rebuilt/loader/index.js\n@@ -5,7 +5,6 @@\n const originalFetch = global.fetch;\n delete global.fetch;\n \n-const { getOptions } = require('loader-utils');\n const { validate: validateOptions } = require('schema-utils');\n const { SourceMapConsumer, SourceNode } = require('source-map');\n const {\n@@ -17,7 +16,7 @@\n const schema = require('./options.json');\n \n const RefreshRuntimePath = require\n-  .resolve('react-refresh/runtime.js')\n+  .resolve('react-refresh')\n   .replace(/\\\\/g, '/')\n   .replace(/'/g, \"\\\\'\");\n \n@@ -25,14 +24,14 @@\n  * A simple Webpack loader to inject react-refresh HMR code into modules.\n  *\n  * [Reference for Loader API](https://webpack.js.org/api/loaders/)\n- * @this {import('webpack').loader.LoaderContext}\n+ * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n  * @param {string} source The original module source code.\n  * @param {import('source-map').RawSourceMap} [inputSourceMap] The source map of the module.\n  * @param {*} [meta] The loader metadata passed in.\n  * @returns {void}\n  */\n function ReactRefreshLoader(source, inputSourceMap, meta) {\n-  let options = getOptions(this);\n+  let options = this.getOptions();\n   validateOptions(schema, options, {\n     baseDataPath: 'options',\n     name: 'React Refresh Loader',\n@@ -55,12 +54,13 @@\n   };\n \n   /**\n-   * @this {import('webpack').loader.LoaderContext}\n+   * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n    * @param {string} source\n    * @param {import('source-map').RawSourceMap} [inputSourceMap]\n    * @returns {Promise<[string, import('source-map').RawSourceMap]>}\n    */\n   async function _loader(source, inputSourceMap) {\n+    /** @type {'esm' | 'cjs'} */\n     const moduleSystem = await getModuleSystem.call(this, ModuleFilenameHelpers, options);\n \n     const RefreshSetupRuntime = RefreshSetupRuntimes[moduleSystem];\n@@ -75,16 +75,15 @@\n         originalSourceMap = getIdentitySourceMap(source, this.resourcePath);\n       }\n \n-      const node = SourceNode.fromStringWithSourceMap(\n-        source,\n-        await new SourceMapConsumer(originalSourceMap)\n-      );\n+      return SourceMapConsumer.with(originalSourceMap, undefined, (consumer) => {\n+        const node = SourceNode.fromStringWithSourceMap(source, consumer);\n \n-      node.prepend([RefreshSetupRuntime, '\\n\\n']);\n-      node.add(['\\n\\n', RefreshModuleRuntime]);\n+        node.prepend([RefreshSetupRuntime, '\\n\\n']);\n+        node.add(['\\n\\n', RefreshModuleRuntime]);\n \n-      const { code, map } = node.toStringWithSourceMap();\n-      return [code, map.toJSON()];\n+        const { code, map } = node.toStringWithSourceMap();\n+        return [code, map.toJSON()];\n+      });\n     } else {\n       return [[RefreshSetupRuntime, source, RefreshModuleRuntime].join('\\n\\n'), inputSourceMap];\n     }\n",
					"match": false,
					"packageHash": "4f30033af3e149021b03688f066b241c5588dac5b425837d5305a37a598341fb",
					"size": 3506,
					"sourceHash": "57b706a720e9f835bc45bd5cd4de1ce89a369b07e83b1ffd10545d87ed725094",
					"status": "content"
				},
				"loader/utils/getIdentitySourceMap.js": {
					"diff": "--- published/loader/utils/getIdentitySourceMap.js\n+++ rebuilt/loader/utils/getIdentitySourceMap.js\n@@ -10,7 +10,7 @@\n   const sourceMap = new SourceMapGenerator();\n   sourceMap.setSourceContent(resourcePath, source);\n \n-  source.split('\\n').forEach((line, index) => {\n+  source.split('\\n').forEach((_, index) => {\n     sourceMap.addMapping({\n       source: resourcePath,\n       original: {\n",
					"match": false,
					"packageHash": "d632a78a01dfb1a1da5b8b892e4912e09c9aeea61e6e2f0c12b1474e8e765b78",
					"size": 796,
					"sourceHash": "f9fee709ec45ccb5e451678406ccca4d064f9e95d17b34e9531a53954d035763",
					"status": "content"
				},
				"loader/utils/getModuleSystem.js": {
					"diff": "--- published/loader/utils/getModuleSystem.js\n+++ rebuilt/loader/utils/getModuleSystem.js\n@@ -1,8 +1,8 @@\n-const { promises: fsPromises } = require('fs');\n-const path = require('path');\n+const fs = require('node:fs/promises');\n+const path = require('node:path');\n \n-/** @type {string | undefined} */\n-let packageJsonType;\n+/** @type {Map<string, string | undefined>} */\n+let packageJsonTypeMap = new Map();\n \n /**\n  * Infers the current active module system from loader context and options.\n@@ -41,17 +41,83 @@\n   if (/\\.mjs$/.test(this.resourcePath)) return 'esm';\n   if (/\\.cjs$/.test(this.resourcePath)) return 'cjs';\n \n-  // Load users' `package.json` -\n-  // We will cache the results in a global variable so it will only be parsed once.\n-  if (!packageJsonType) {\n+  if (typeof this.addMissingDependency !== 'function') {\n+    // This is Webpack 4 which does not support `import.meta`.\n+    // We assume `.js` files are CommonJS because the output cannot be ESM anyway.\n+    return 'cjs';\n+  }\n+\n+  // We will assume CommonJS if we cannot determine otherwise\n+  let packageJsonType = '';\n+\n+  // We begin our search for relevant `package.json` files,\n+  // at the directory of the resource being loaded.\n+  // These paths should already be resolved,\n+  // but we resolve them again to ensure we are dealing with an aboslute path.\n+  const resourceContext = path.dirname(this.resourcePath);\n+  let searchPath = resourceContext;\n+  let previousSearchPath = '';\n+  // We start our search just above the root context of the webpack compilation\n+  const stopPath = path.dirname(this.rootContext);\n+\n+  // If the module context is a resolved symlink outside the `rootContext` path,\n+  // then we will never find the `stopPath` - so we also halt when we hit the root.\n+  // Note that there is a potential that the wrong `package.json` is found in some pathalogical cases,\n+  // such as a folder that is conceptually a package + does not have an ancestor `package.json`,\n+  // but there exists a `package.json` higher up.\n+  // This might happen if you have a folder of utility JS files that you symlink but did not organize as a package.\n+  // We consider this an unsupported edge case for now.\n+  while (searchPath !== stopPath && searchPath !== previousSearchPath) {\n+    // If we have already determined the `package.json` type for this path we can stop searching.\n+    // We do however still need to cache the found value,\n+    // from the `resourcePath` folder up to the matching `searchPath`,\n+    // to avoid retracing these steps when processing sibling resources.\n+    if (packageJsonTypeMap.has(searchPath)) {\n+      packageJsonType = packageJsonTypeMap.get(searchPath);\n+\n+      let currentPath = resourceContext;\n+      while (currentPath !== searchPath) {\n+        // We set the found type at least level from `resourcePath` folder up to the matching `searchPath`\n+        packageJsonTypeMap.set(currentPath, packageJsonType);\n+        currentPath = path.dirname(currentPath);\n+      }\n+      break;\n+    }\n+\n+    let packageJsonPath = path.join(searchPath, 'package.json');\n     try {\n-      const packageJsonPath = require.resolve(path.join(this.rootContext, 'package.json'));\n-      const buffer = await fsPromises.readFile(packageJsonPath, { encoding: 'utf-8' });\n-      const rawPackageJson = buffer.toString('utf-8');\n-      ({ type: packageJsonType } = JSON.parse(rawPackageJson));\n+      const packageSource = await fs.readFile(packageJsonPath, 'utf-8');\n+      try {\n+        const packageObject = JSON.parse(packageSource);\n+\n+        // Any package.json is sufficient as long as it can be parsed.\n+        // If it does not explicitly have a `type: \"module\"` it will be assumed to be CommonJS.\n+        packageJsonType = typeof packageObject.type === 'string' ? packageObject.type : '';\n+        packageJsonTypeMap.set(searchPath, packageJsonType);\n+\n+        // We set the type in the cache for all paths from the `resourcePath` folder,\n+        // up to the matching `searchPath` to avoid retracing these steps when processing sibling resources.\n+        let currentPath = resourceContext;\n+        while (currentPath !== searchPath) {\n+          packageJsonTypeMap.set(currentPath, packageJsonType);\n+          currentPath = path.dirname(currentPath);\n+        }\n+      } catch (e) {\n+        // `package.json` exists but could not be parsed.\n+        // We track it as a dependency so we can reload if this file changes.\n+      }\n+\n+      this.addDependency(packageJsonPath);\n+      break;\n     } catch (e) {\n-      // Failed to parse `package.json`, do nothing.\n+      // `package.json` does not exist.\n+      // We track it as a missing dependency so we can reload if this file is added.\n+      this.addMissingDependency(packageJsonPath);\n     }\n",
					"match": false,
					"packageHash": "cad42972e175ea285983689ebeff3ed27e30131ad2b3154853c23d54fa45f88e",
					"size": 2098,
					"sourceHash": "78833be1f8c5feb40c643009736638fc2fdcce2b72976b784c6698f3a6cb0c88",
					"status": "content"
				},
				"overlay/components/CompileErrorTrace.js": {
					"diff": "--- published/overlay/components/CompileErrorTrace.js\n+++ rebuilt/overlay/components/CompileErrorTrace.js\n@@ -1,9 +1,6 @@\n-const ansiHTML = require('ansi-html');\n+const Anser = require('anser');\n const entities = require('html-entities');\n-const theme = require('../theme.js');\n-const { formatFilename } = require('../utils.js');\n-\n-ansiHTML.setColors(theme);\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} CompileErrorTraceProps\n@@ -20,39 +17,55 @@\n function CompileErrorTrace(document, root, props) {\n   const errorParts = props.errorMessage.split('\\n');\n   if (errorParts.length) {\n-    const errorMessage = errorParts\n-      .splice(1, 1)[0]\n-      // Strip filename from the error message\n-      .replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2');\n-\n     if (errorParts[0]) {\n-      errorParts[0] = formatFilename(errorParts[0]);\n+      errorParts[0] = utils.formatFilename(errorParts[0]);\n     }\n \n-    errorParts.unshift(errorMessage);\n+    const errorMessage = errorParts.splice(1, 1)[0];\n+    if (errorMessage) {\n+      // Strip filename from the error message\n+      errorParts.unshift(errorMessage.replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2'));\n+    }\n   }\n \n   const stackContainer = document.createElement('pre');\n-  stackContainer.innerHTML = entities.decode(\n-    ansiHTML(entities.encode(errorParts.join('\\n'), { level: 'html5', mode: 'nonAscii' })),\n-    { level: 'html5' }\n-  );\n   stackContainer.style.fontFamily = [\n-    '\"Operator Mono SSm\"',\n-    '\"Operator Mono\"',\n-    '\"Fira Code Retina\"',\n-    '\"Fira Code\"',\n-    '\"FiraCode-Retina\"',\n-    '\"Andale Mono\"',\n-    '\"Lucida Console\"',\n-    'Menlo',\n+    '\"SFMono-Regular\"',\n     'Consolas',\n-    'Monaco',\n+    'Liberation Mono',\n+    'Menlo',\n+    'Courier',\n     'monospace',\n   ].join(', ');\n   stackContainer.style.margin = '0';\n   stackContainer.style.whiteSpace = 'pre-wrap';\n \n+  const entries = Anser.ansiToJson(\n+    entities.encode(errorParts.join('\\n'), { level: 'html5', mode: 'nonAscii' }),\n+    {\n+      json: true,\n+      remove_empty: true,\n+      use_classes: true,\n+    }\n+  );\n+  for (let i = 0; i < entries.length; i += 1) {\n+    const entry = entries[i];\n+    const elem = document.createElement('span');\n+    elem.innerHTML = entry.content;\n+    elem.style.color = entry.fg ? `var(--color-${entry.fg})` : undefined;\n+    elem.style.wordBreak = 'break-word';\n+    switch (entry.decoration) {\n+      case 'bold':\n+        elem.style.fontWeight = 800;\n+        break;\n+      case 'italic':\n+        elem.style.fontStyle = 'italic';\n+        break;\n+    }\n+\n+    stackContainer.appendChild(elem);\n+  }\n+\n   root.appendChild(stackContainer);\n }\n \n",
					"match": false,
					"packageHash": "3521c7660d3345df38027ee094c51c44181a5c12c26c4c5022bf03b55a790dc8",
					"size": 1584,
					"sourceHash": "35f68cee2a98fc157b898879dda6adea2ff7b077a34aba5786a9be7f165aa71d",
					"status": "content"
				},
				"overlay/components/PageHeader.js": {
					"diff": "--- published/overlay/components/PageHeader.js\n+++ rebuilt/overlay/components/PageHeader.js\n@@ -17,18 +17,20 @@\n  */\n function PageHeader(document, root, props) {\n   const pageHeaderContainer = document.createElement('div');\n-  pageHeaderContainer.style.background = '#' + theme.dimgrey;\n+  pageHeaderContainer.style.background = theme['dark-background'];\n   pageHeaderContainer.style.boxShadow = '0 1px 4px rgba(0, 0, 0, 0.3)';\n-  pageHeaderContainer.style.color = '#' + theme.white;\n+  pageHeaderContainer.style.color = theme.white;\n   pageHeaderContainer.style.left = '0';\n+  pageHeaderContainer.style.right = '0';\n   pageHeaderContainer.style.padding = '1rem 1.5rem';\n+  pageHeaderContainer.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n+  pageHeaderContainer.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n   pageHeaderContainer.style.position = 'fixed';\n   pageHeaderContainer.style.top = props.topOffset || '0';\n-  pageHeaderContainer.style.width = 'calc(100vw - 3rem)';\n \n   const title = document.createElement('h3');\n   title.innerText = props.title;\n-  title.style.color = '#' + theme.red;\n+  title.style.color = theme.red;\n   title.style.fontSize = '1.125rem';\n   title.style.lineHeight = '1.3';\n   title.style.margin = '0';\n@@ -39,7 +41,7 @@\n \n     const message = document.createElement('span');\n     message.innerText = props.message;\n-    message.style.color = '#' + theme.white;\n+    message.style.color = theme.white;\n     message.style.wordBreak = 'break-word';\n     pageHeaderContainer.appendChild(message);\n   }\n",
					"match": false,
					"packageHash": "aea03ce1635e760fe897a3318f9e9b058a320b7fac2bb425ecf002626ac1a0c9",
					"size": 1741,
					"sourceHash": "3f6789599619d258ea6682cb428770ede8bcb25b97b6446a32ca2e8bad9c9f7f",
					"status": "content"
				},
				"overlay/components/RuntimeErrorFooter.js": {
					"diff": "--- published/overlay/components/RuntimeErrorFooter.js\n+++ rebuilt/overlay/components/RuntimeErrorFooter.js\n@@ -19,15 +19,17 @@\n  */\n function RuntimeErrorFooter(document, root, props) {\n   const footer = document.createElement('div');\n-  footer.style.backgroundColor = '#' + theme.dimgrey;\n+  footer.style.backgroundColor = theme['dark-background'];\n   footer.style.bottom = '0';\n   footer.style.boxShadow = '0 -1px 4px rgba(0, 0, 0, 0.3)';\n   footer.style.height = '2.5rem';\n   footer.style.left = '0';\n+  footer.style.right = '0';\n   footer.style.lineHeight = '2.5rem';\n+  footer.style.paddingBottom = '0';\n+  footer.style.paddingBottom = 'env(safe-area-inset-bottom)';\n   footer.style.position = 'fixed';\n   footer.style.textAlign = 'center';\n-  footer.style.width = '100vw';\n   footer.style.zIndex = '2';\n \n   const BUTTON_CONFIGS = {\n@@ -62,14 +64,14 @@\n     button.id = buttonConfig.id;\n     button.innerHTML = buttonConfig.label;\n     button.tabIndex = 1;\n-    button.style.backgroundColor = '#' + theme.dimgrey;\n+    button.style.backgroundColor = theme['dark-background'];\n     button.style.border = 'none';\n-    button.style.color = '#' + theme.white;\n+    button.style.color = theme.white;\n     button.style.cursor = 'pointer';\n     button.style.fontSize = 'inherit';\n     button.style.height = '100%';\n     button.style.padding = '0.5rem 0.75rem';\n-    button.style.width = (100 / buttons.length).toString(10) + '%';\n+    button.style.width = `${(100 / buttons.length).toString(10)}%`;\n     button.addEventListener('click', buttonConfig.onClick);\n \n     if (buttonConfig.id === props.initialFocus) {\n",
					"match": false,
					"packageHash": "a3224dfad55817383ae04082ce40ba12bf6aa989a3d12805553384a96aeef39e",
					"size": 2595,
					"sourceHash": "f9547afa949e5c155c0726d916f135e2ea316f77da539373c1a3e61d9296bc77",
					"status": "content"
				},
				"overlay/components/RuntimeErrorHeader.js": {
					"diff": "--- published/overlay/components/RuntimeErrorHeader.js\n+++ rebuilt/overlay/components/RuntimeErrorHeader.js\n@@ -16,9 +16,9 @@\n  */\n function RuntimeErrorHeader(document, root, props) {\n   const header = document.createElement('div');\n-  header.innerText = 'Error ' + (props.currentErrorIndex + 1) + ' of ' + props.totalErrors;\n-  header.style.backgroundColor = '#' + theme.red;\n-  header.style.color = '#' + theme.white;\n+  header.innerText = `Error ${props.currentErrorIndex + 1} of ${props.totalErrors}`;\n+  header.style.backgroundColor = theme.red;\n+  header.style.color = theme.white;\n   header.style.fontWeight = '500';\n   header.style.height = '2.5rem';\n   header.style.left = '0';\n",
					"match": false,
					"packageHash": "e841a8c1f940e929d3d4609544631427f0209772b7abf9ce3c99064a07652d9f",
					"size": 1089,
					"sourceHash": "22b1c504587105d823560bf9266e875e83e7595c8ec4abde300871c89f07393d",
					"status": "content"
				},
				"overlay/components/RuntimeErrorStack.js": {
					"diff": "--- published/overlay/components/RuntimeErrorStack.js\n+++ rebuilt/overlay/components/RuntimeErrorStack.js\n@@ -1,6 +1,6 @@\n const ErrorStackParser = require('error-stack-parser');\n const theme = require('../theme.js');\n-const { formatFilename } = require('../utils.js');\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} RuntimeErrorStackProps\n@@ -17,7 +17,7 @@\n function RuntimeErrorStack(document, root, props) {\n   const stackTitle = document.createElement('h4');\n   stackTitle.innerText = 'Call Stack';\n-  stackTitle.style.color = '#' + theme.white;\n+  stackTitle.style.color = theme.white;\n   stackTitle.style.fontSize = '1.0625rem';\n   stackTitle.style.fontWeight = '500';\n   stackTitle.style.lineHeight = '1.3';\n@@ -40,31 +40,26 @@\n     const currentStack = errorStacks[i];\n \n     const functionName = document.createElement('code');\n-    functionName.innerHTML = '&emsp;' + currentStack.functionName || '(anonymous function)';\n-    functionName.style.color = '#' + theme.yellow;\n+    functionName.innerHTML = `&emsp;${currentStack.functionName || '(anonymous function)'}`;\n+    functionName.style.color = theme.yellow;\n     functionName.style.fontFamily = [\n-      '\"Operator Mono SSm\"',\n-      '\"Operator Mono\"',\n-      '\"Fira Code Retina\"',\n-      '\"Fira Code\"',\n-      '\"FiraCode-Retina\"',\n-      '\"Andale Mono\"',\n-      '\"Lucida Console\"',\n-      'Menlo',\n+      '\"SFMono-Regular\"',\n       'Consolas',\n-      'Monaco',\n+      'Liberation Mono',\n+      'Menlo',\n+      'Courier',\n       'monospace',\n     ].join(', ');\n \n     const fileName = document.createElement('div');\n     fileName.innerHTML =\n       '&emsp;&emsp;' +\n-      formatFilename(currentStack.fileName) +\n+      utils.formatFilename(currentStack.fileName) +\n       ':' +\n       currentStack.lineNumber +\n       ':' +\n       currentStack.columnNumber;\n-    fileName.style.color = '#' + theme.white;\n+    fileName.style.color = theme.white;\n     fileName.style.fontSize = '0.6875rem';\n     fileName.style.marginBottom = '0.25rem';\n \n",
					"match": false,
					"packageHash": "e4c2e0914e4ae188a1d76ec827412c91951232b3a39c77ba2455f670e8f13cc8",
					"size": 2363,
					"sourceHash": "df582e1eba351f892a3523ce1410c6762c21134f5da2e2653de66516869e92d8",
					"status": "content"
				},
				"overlay/index.js": {
					"diff": "--- published/overlay/index.js\n+++ rebuilt/overlay/index.js\n@@ -3,7 +3,7 @@\n const CompileErrorContainer = require('./containers/CompileErrorContainer.js');\n const RuntimeErrorContainer = require('./containers/RuntimeErrorContainer.js');\n const theme = require('./theme.js');\n-const { debounce, removeAllChildren } = require('./utils.js');\n+const utils = require('./utils.js');\n \n /**\n  * @callback RenderFn\n@@ -73,8 +73,10 @@\n   iframe.src = 'about:blank';\n \n   iframe.style.border = 'none';\n-  iframe.style.height = '100vh';\n+  iframe.style.height = '100%';\n   iframe.style.left = '0';\n+  iframe.style.minHeight = '100vh';\n+  iframe.style.minHeight = '-webkit-fill-available';\n   iframe.style.position = 'fixed';\n   iframe.style.top = '0';\n   iframe.style.width = '100vw';\n@@ -100,27 +102,41 @@\n   const div = document.createElement('div');\n   div.id = 'react-refresh-overlay-error';\n \n+  // Apply ANSI theme\n+  div.style.setProperty('--color-ansi-selection', theme.selection);\n+  div.style.setProperty('--color-ansi-bg', theme.background);\n+  div.style.setProperty('--color-ansi-fg', theme.white);\n+  div.style.setProperty('--color-ansi-white', theme.white);\n+  div.style.setProperty('--color-ansi-black', theme.black);\n+  div.style.setProperty('--color-ansi-blue', theme.blue);\n+  div.style.setProperty('--color-ansi-cyan', theme.cyan);\n+  div.style.setProperty('--color-ansi-green', theme.green);\n+  div.style.setProperty('--color-ansi-magenta', theme.magenta);\n+  div.style.setProperty('--color-ansi-red', theme.red);\n+  div.style.setProperty('--color-ansi-yellow', theme.yellow);\n+  div.style.setProperty('--color-ansi-bright-white', theme['bright-white']);\n+  div.style.setProperty('--color-ansi-bright-black', theme['bright-black']);\n+  div.style.setProperty('--color-ansi-bright-blue', theme['bright-blue']);\n+  div.style.setProperty('--color-ansi-bright-cyan', theme['bright-cyan']);\n+  div.style.setProperty('--color-ansi-bright-green', theme['bright-green']);\n+  div.style.setProperty('--color-ansi-bright-magenta', theme['bright-magenta']);\n+  div.style.setProperty('--color-ansi-bright-red', theme['bright-red']);\n+  div.style.setProperty('--color-ansi-bright-yellow', theme['bright-yellow']);\n+\n   // Style the contents container\n-  div.style.backgroundColor = '#' + theme.grey;\n+  div.style.backgroundColor = theme.background;\n   div.style.boxSizing = 'border-box';\n-  div.style.color = '#' + theme.white;\n-  div.style.fontFamily = [\n-    '-apple-system',\n-    'BlinkMacSystemFont',\n-    '\"Segoe UI\"',\n-    '\"Helvetica Neue\"',\n-    'Helvetica',\n-    'Arial',\n-    'sans-serif',\n-    '\"Apple Color Emoji\"',\n-    '\"Segoe UI Emoji\"',\n-    'Segoe UI Symbol',\n-  ].join(', ');\n+  div.style.color = theme.white;\n+  div.style.fontFamily = ['-apple-system', '\"Source Sans Pro\"', 'sans-serif'].join(', ');\n   div.style.fontSize = '0.875rem';\n-  div.style.height = '100vh';\n+  div.style.height = '100%';\n   div.style.lineHeight = '1.3';\n   div.style.overflow = 'auto';\n   div.style.padding = '1rem 1.5rem 0';\n+  div.style.paddingTop = 'max(1rem, env(safe-area-inset-top))';\n+  div.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n+  div.style.paddingBottom = 'env(safe-area-inset-bottom)';\n+  div.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n   div.style.width = '100vw';\n \n   root.appendChild(div);\n@@ -176,7 +192,7 @@\n       currentFocusId = currentFocus.id;\n     }\n \n-    removeAllChildren(root);\n+    utils.removeAllChildren(root);\n \n     if (currentCompileErrorMessage) {\n       currentMode = 'compileError';\n@@ -300,7 +316,7 @@\n  * @param {Error[]} errors\n  * @returns {void}\n  */\n-const debouncedShowRuntimeErrors = debounce(showRuntimeErrors, 30);\n+const debouncedShowRuntimeErrors = utils.debounce(showRuntimeErrors, 30);\n \n /**\n  * Detects if an error is a Webpack compilation error.\n",
					"match": false,
					"packageHash": "5ab24f2c0620e2c0f2f9c2392004883b10f52235e6c409bc59a8db163c44a90e",
					"size": 9000,
					"sourceHash": "7fa8e14caaef770ae25cd84b2c5ee73d94e05bbb799ab8d752a0943df65d1278",
					"status": "content"
				},
				"overlay/theme.js": {
					"diff": "--- published/overlay/theme.js\n+++ rebuilt/overlay/theme.js\n@@ -1,14 +1,21 @@\n /**\n  * @typedef {Object} Theme\n- * @property {string[]} reset\n  * @property {string} black\n+ * @property {string} bright-black\n  * @property {string} red\n+ * @property {string} bright-red\n  * @property {string} green\n+ * @property {string} bright-green\n  * @property {string} yellow\n+ * @property {string} bright-yellow\n  * @property {string} blue\n+ * @property {string} bright-blue\n  * @property {string} magenta\n+ * @property {string} bright-magenta\n  * @property {string} cyan\n+ * @property {string} bright-cyan\n  * @property {string} white\n+ * @property {string} bright-white\n  * @property {string} lightgrey\n  * @property {string} darkgrey\n  * @property {string} grey\n@@ -21,19 +28,25 @@\n  * Partially adopted from Tomorrow Night Bright.\n  */\n const theme = {\n-  reset: ['transparent', 'transparent'],\n-  black: '000000',\n-  red: 'D34F56',\n-  green: 'B9C954',\n-  yellow: 'E6C452',\n-  blue: '7CA7D8',\n-  magenta: 'C299D6',\n-  cyan: '73BFB1',\n-  white: 'FFFFFF',\n-  lightgrey: 'C7C7C7',\n-  darkgrey: 'A9A9A9',\n-  grey: '474747',\n-  dimgrey: '343434',\n+  black: '#000000',\n+  'bright-black': '#474747',\n+  red: '#D34F56',\n+  'bright-red': '#dd787d',\n+  green: '#B9C954',\n+  'bright-green': '#c9d57b',\n+  yellow: '#E6C452',\n+  'bright-yellow': '#ecd37f',\n+  blue: '#7CA7D8',\n+  'bright-blue': '#a3c1e4',\n+  magenta: '#C299D6',\n+  'bright-magenta': '#d8bde5',\n+  cyan: '#73BFB1',\n+  'bright-cyan': '#96cfc5',\n+  white: '#FFFFFF',\n+  'bright-white': '#FFFFFF',\n+  background: '#474747',\n+  'dark-background': '#343434',\n+  selection: 'rgba(234, 234, 234, 0.5)',\n };\n \n module.exports = theme;\n",
					"match": false,
					"packageHash": "880dfd428e17f82b410b4197816dba596c96519aff3ac19ee9609426a87908f3",
					"size": 862,
					"sourceHash": "41d942efc4a6d3dc88883515dbc16f607269a49125ca29f06b92bbb66655cf46",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@pmmmwh/react-refresh-webpack-plugin\",\n-  \"version\": \"0.5.0-rc.5\",\n+  \"version\": \"0.6.2\",\n   \"description\": \"An **EXPERIMENTAL** Webpack plugin to enable \\\"Fast Refresh\\\" (also previously known as _Hot Reloading_) for React components.\",\n   \"keywords\": [\n     \"react\",\n@@ -34,89 +34,91 @@\n     \"options\",\n     \"overlay\",\n     \"sockets\",\n-    \"types\"\n+    \"types\",\n+    \"umd\"\n   ],\n+  \"packageManager\": \"yarn@1.22.22+sha1.ac34549e6aa8e7ead463a7407e1c7390f61a6610\",\n   \"scripts\": {\n     \"test\": \"run-s -c test:pre \\\"test:exec {@}\\\" test:post --\",\n-    \"test:webpack-4\": \"cross-env WEBPACK_VERSION=4 yarn test\",\n-    \"test:pre\": \"run-s yalc:publish yalc:add\",\n-    \"test:exec\": \"node scripts/test.js\",\n-    \"test:post\": \"yalc remove --all\",\n-    \"yalc:add\": \"yalc add --dev @pmmmwh/react-refresh-webpack-plugin\",\n-    \"yalc:publish\": \"yalc publish --no-scripts\",\n+    \"test:wds-4\": \"cross-env WDS_VERSION=4 yarn test\",\n+    \"test:exec\": \"node --experimental-vm-modules scripts/test.js\",\n+    \"test:pre\": \"run-s -c test:pre:*\",\n+    \"test:pre:0\": \"yarn link\",\n+    \"test:pre:1\": \"yarn link @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post\": \"run-s -c test:post:*\",\n+    \"test:post:0\": \"yarn unlink @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post:1\": \"yarn unlink\",\n     \"lint\": \"eslint --report-unused-disable-directives --ext .js,.jsx .\",\n     \"lint:fix\": \"yarn lint --fix\",\n     \"format\": \"prettier --write \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n     \"format:check\": \"prettier --check \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n-    \"types:clean\": \"rimraf types\",\n-    \"types:compile\": \"tsc -p tsconfig.json\",\n+    \"types:clean\": \"del types\",\n+    \"types:compile\": \"tsc\",\n     \"types:prune-private\": \"del \\\"types/*/*\\\" \\\"!types/{lib,loader,options}/{index,types}.d.ts\\\"\",\n-    \"generate-types\": \"run-s types:compile types:prune-private \\\"format --loglevel silent\\\"\",\n-    \"prepublishOnly\": \"run-s types:clean generate-types\"\n+    \"generate:client-external\": \"webpack\",\n+    \"generate:types\": \"run-s types:clean types:compile types:prune-private \\\"format --log-level=silent\\\"\",\n+    \"prepublishOnly\": \"run-p generate:*\"\n   },\n   \"dependencies\": {\n-    \"ansi-html\": \"^0.0.7\",\n-    \"core-js-pure\": \"^3.8.1\",\n+    \"anser\": \"^2.1.1\",\n+    \"core-js-pure\": \"^3.23.3\",\n     \"error-stack-parser\": \"^2.0.6\",\n     \"html-entities\": \"^2.1.0\",\n-    \"loader-utils\": \"^2.0.0\",\n-    \"schema-utils\": \"^3.0.0\",\n+    \"schema-utils\": \"^4.2.0\",\n     \"source-map\": \"^0.7.3\"\n   },\n   \"devDependencies\": {\n-    \"@babel/core\": \"^7.14.2\",\n-    \"@babel/plugin-transform-modules-commonjs\": \"^7.14.0\",\n-    \"@types/cross-spawn\": \"^6.0.2\",\n-    \"@types/fs-extra\": \"^9.0.4\",\n-    \"@types/jest\": \"^26.0.23\",\n-    \"@types/json-schema\": \"^7.0.6\",\n-    \"@types/module-alias\": \"^2.0.0\",\n-    \"@types/node\": \"^16.0.0\",\n-    \"@types/puppeteer\": \"^5.4.0\",\n-    \"@types/webpack\": \"^5.28.0\",\n-    \"babel-jest\": \"^27.0.5\",\n-    \"babel-loader\": \"^8.1.0\",\n+    \"@babel/core\": \"^7.24.6\",\n+    \"@babel/plugin-transform-modules-commonjs\": \"^7.24.6\",\n+    \"@types/cross-spawn\": \"^6.0.6\",\n+    \"@types/fs-extra\": \"^11.0.4\",\n+    \"@types/jest\": \"^29.5.12\",\n+    \"@types/json-schema\": \"^7.0.15\",\n+    \"@types/module-alias\": \"^2.0.4\",\n+    \"@types/node\": \"^24.10.1\",\n+    \"@types/webpack\": \"^5.28.5\",\n+    \"babel-loader\": \"^10.0.0\",\n     \"cross-env\": \"^7.0.3\",\n-    \"cross-spawn\": \"^7.0.3\",\n-    \"del-cli\": \"^3.0.1\",\n-    \"eslint\": \"^7.26.0\",\n-    \"eslint-config-prettier\": \"^8.3.0\",\n-    \"eslint-plugin-prettier\": \"^3.4.0\",\n-    \"fs-extra\": \"^9.0.1\",\n-    \"get-port\": \"^5.1.1\",\n-    \"jest\": \"^27.0.5\",\n-    \"jest-environment-node\": \"^27.0.5\",\n-    \"jest-junit\": \"^12.2.0\",\n-    \"jest-watch-typeahead\": \"^0.6.4\",\n-    \"memfs\": \"^3.2.0\",\n-    \"module-alias\": \"^2.2.2\",\n-    \"nanoid\": \"^3.1.23\",\n",
					"match": false,
					"packageHash": "a320ae9bacf88c926ccde855f9f823c2770d76899c8a87d9c6a623361b3b77c5",
					"size": 4303,
					"sourceHash": "2acd42464a99db90ad3e72e7a40e8adbca15365d4473c19d1a6910ab1cfd9b6e",
					"status": "content"
				},
				"sockets/WDSSocket.js": {
					"diff": "--- published/sockets/WDSSocket.js\n+++ rebuilt/sockets/WDSSocket.js\n@@ -1,32 +1,26 @@\n-/* global __webpack_dev_server_client__ */\n-\n-const getSocketUrlParts = require('./utils/getSocketUrlParts.js');\n-const getUrlFromParts = require('./utils/getUrlFromParts');\n-const getWDSMetadata = require('./utils/getWDSMetadata');\n-\n /**\n  * Initializes a socket server for HMR for webpack-dev-server.\n  * @param {function(*): void} messageHandler A handler to consume Webpack compilation messages.\n- * @param {string} [resourceQuery] Webpack's `__resourceQuery` string.\n  * @returns {void}\n  */\n-function initWDSSocket(messageHandler, resourceQuery) {\n-  if (typeof __webpack_dev_server_client__ !== 'undefined') {\n-    let SocketClient = __webpack_dev_server_client__;\n-    if (typeof __webpack_dev_server_client__.default !== 'undefined') {\n-      SocketClient = __webpack_dev_server_client__.default;\n-    }\n-\n-    const wdsMeta = getWDSMetadata(SocketClient);\n-    const urlParts = getSocketUrlParts(resourceQuery, wdsMeta);\n-\n-    const connection = new SocketClient(getUrlFromParts(urlParts, wdsMeta));\n-\n-    connection.onMessage(function onSocketMessage(data) {\n-      const message = JSON.parse(data);\n-      messageHandler(message);\n-    });\n+function initWDSSocket(messageHandler) {\n+  const { default: SockJSClient } = require('webpack-dev-server/client/clients/SockJSClient');\n+  const { default: WebSocketClient } = require('webpack-dev-server/client/clients/WebSocketClient');\n+  const { client } = require('webpack-dev-server/client/socket');\n+\n+  /** @type {WebSocket} */\n+  let connection;\n+  if (client instanceof SockJSClient) {\n+    connection = client.sock;\n+  } else if (client instanceof WebSocketClient) {\n+    connection = client.client;\n+  } else {\n+    throw new Error('Failed to determine WDS client type');\n   }\n+\n+  connection.addEventListener('message', function onSocketMessage(message) {\n+    messageHandler(JSON.parse(message.data));\n+  });\n }\n \n module.exports = { init: initWDSSocket };\n",
					"match": false,
					"packageHash": "005fdae7ff216733c3f69a2dc72dab4c7e0249a56c6981feaab98a3f9d54326b",
					"size": 1177,
					"sourceHash": "ced8ec207c9ed52a39a6c8c78742cdb4aad5b51fda4d2ac3bd2416ef560cda2e",
					"status": "content"
				},
				"sockets/WPSSocket.js": {
					"diff": "--- published/sockets/WPSSocket.js\n+++ rebuilt/sockets/WPSSocket.js\n@@ -1,5 +1,5 @@\n /* global oss */\n-const { ClientSocket } = require('webpack-plugin-serve/lib/client/ClientSocket.js');\n+const { ClientSocket } = require('webpack-plugin-serve/lib/client/ClientSocket');\n \n /**\n  * Initializes a socket server for HMR for webpack-plugin-serve.\n",
					"match": false,
					"packageHash": "4936c1316c381a638ce2bf2d2d61d80c4bd9552e31d15d334bc3ee80c0ba1b9f",
					"size": 1546,
					"sourceHash": "c2f6cee37905a577670ce4828d243770db551cb7383c368b46423362e946d510",
					"status": "content"
				},
				"sockets/utils/getCurrentScriptSource.js": {
					"match": false,
					"packageHash": "aecd3cfe51f13ad467b830d56d08e1da889383b6dfa0305db51202244546cc73",
					"size": 836,
					"status": "missing-in-source"
				},
				"sockets/utils/getSocketUrlParts.js": {
					"match": false,
					"packageHash": "aa3783e76744f69656a1f56c57afa0301c6e05080c692badc95872e89e390f6e",
					"size": 4313,
					"status": "missing-in-source"
				},
				"sockets/utils/getUrlFromParts.js": {
					"match": false,
					"packageHash": "1c3351cca72ac71b27ad095792a7feb75e3c053f831caa53feb49ae866682f7a",
					"size": 1014,
					"status": "missing-in-source"
				},
				"sockets/utils/getWDSMetadata.js": {
					"match": false,
					"packageHash": "ca103c2479125fdaa093c9c54c281443941476a63cf0aa890a2862afba4a2902",
					"size": 979,
					"status": "missing-in-source"
				},
				"types/lib/types.d.ts": {
					"diff": "--- published/types/lib/types.d.ts\n+++ rebuilt/types/lib/types.d.ts\n@@ -8,35 +8,11 @@\n    */\n   module?: string | false | undefined;\n   /**\n-   * The socket host to use (WDS only).\n-   */\n-  sockHost?: string | undefined;\n-  /**\n    * Path to a JS file that sets up the Webpack socket integration.\n    */\n   sockIntegration?:\n     | import('type-fest').LiteralUnion<false | 'wds' | 'whm' | 'wps', string>\n     | undefined;\n-  /**\n-   * The socket path to use (WDS only).\n-   */\n-  sockPath?: string | undefined;\n-  /**\n-   * The socket port to use (WDS only).\n-   */\n-  sockPort?: number | undefined;\n-  /**\n-   * The socket protocol to use (WDS only).\n-   */\n-  sockProtocol?: 'http' | 'https' | 'ws' | 'wss' | undefined;\n-  /**\n-   * Uses a custom SocketJS implementation for older versions of WDS.\n-   */\n-  useLegacyWDSSockets?: boolean | undefined;\n-  /**\n-   * Uses a polyfill for the DOM URL API (WDS only).\n-   */\n-  useURLPolyfill?: boolean | undefined;\n };\n export type NormalizedErrorOverlayOptions = import('type-fest').SetRequired<\n   ErrorOverlayOptions,\n",
					"match": false,
					"packageHash": "e9b5225e09319d42352c2ed3137e4324b0043175c65dc1a435e5f5a29881ac74",
					"size": 2276,
					"sourceHash": "c84c3bfce9304bea6a821cbc07af14ab757d0250ecd1e15a641db305583102f1",
					"status": "content"
				},
				"types/loader/index.d.ts": {
					"diff": "--- published/types/loader/index.d.ts\n+++ rebuilt/types/loader/index.d.ts\n@@ -3,13 +3,14 @@\n  * A simple Webpack loader to inject react-refresh HMR code into modules.\n  *\n  * [Reference for Loader API](https://webpack.js.org/api/loaders/)\n- * @this {import('webpack').loader.LoaderContext}\n+ * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n  * @param {string} source The original module source code.\n  * @param {import('source-map').RawSourceMap} [inputSourceMap] The source map of the module.\n  * @param {*} [meta] The loader metadata passed in.\n  * @returns {void}\n  */\n declare function ReactRefreshLoader(\n+  this: import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>,\n   source: string,\n   inputSourceMap?: import('source-map').RawSourceMap | undefined,\n   meta?: any\n",
					"match": false,
					"packageHash": "f43744906b876d5a8d88e4ef10c9ce921c78e11302a7a1cb7d7aa25a80451d26",
					"size": 597,
					"sourceHash": "f42721c494b83def355baf6d24287351d733dc3ef87e951a1f49d76fbbb4d72b",
					"status": "content"
				},
				"client/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"overlay/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"sockets/package.json": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 29,
				"matchingFiles": 19,
				"missingInPackage": 3,
				"missingInSource": 9,
				"score": 0.31666666666666665,
				"totalFiles": 60
			}
		}
	}
]
