[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-03T23:58:43.876Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:7.6.3",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "@pmmmwh/react-refresh-webpack-plugin@0.5.0-beta.5",
			"name": "@pmmmwh/react-refresh-webpack-plugin",
			"version": "0.5.0-beta.5",
			"location": "https://registry.npmjs.org/@pmmmwh/react-refresh-webpack-plugin/-/react-refresh-webpack-plugin-0.5.0-beta.5.tgz",
			"integrity": "sha512-sdWrQ77/KqWetQgG3CLB4lkqbl6yRL0amYFRIEMDjZ3pZnlxRfYLvlipiiiEx5IMTw3+qSMF26M2GMfAUe1Wiw==",
			"publishedAt": "2021-05-04T22:05:31.197Z",
			"publishedWith": {
				"node": "15.12.0",
				"npm": "7.11.1"
			}
		},
		"source": {
			"integrity": null,
			"location": "git+https://github.com/pmmmwh/react-refresh-webpack-plugin.git",
			"spec": "github:pmmmwh/react-refresh-webpack-plugin#3327569fc20ffc1b1956eaa55a44508e6303b8cb"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				"CHANGELOG.md": {
					"match": false,
					"packageHash": "31e2b34a1afb1abdf1eb5cf6d826f02e0a777034b365a4612f180d8d6031f3dd",
					"size": 4518,
					"status": "missing-in-source"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -1,41 +1,70 @@\n # React Refresh Webpack Plugin\n \n-[![Latest Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest)\n-[![Next Version](https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next)](https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next)\n-[![CircleCI](https://img.shields.io/circleci/project/github/pmmmwh/react-refresh-webpack-plugin/main)](https://app.circleci.com/pipelines/github/pmmmwh/react-refresh-webpack-plugin)\n-[![License](https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin)](./LICENSE)\n+[actions]: https://github.com/pmmmwh/react-refresh-webpack-plugin/actions/workflows/ci.yml\n+[actions:badge]: https://img.shields.io/github/actions/workflow/status/pmmmwh/react-refresh-webpack-plugin/ci.yml?branch=main\n+[license:badge]: https://img.shields.io/github/license/pmmmwh/react-refresh-webpack-plugin\n+[npm:latest]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest\n+[npm:latest:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/latest\n+[npm:next]: https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/next\n+[npm:next:badge]: https://img.shields.io/npm/v/@pmmmwh/react-refresh-webpack-plugin/next\n \n-An **EXPERIMENTAL** Webpack plugin to enable \"Fast Refresh\" (also previously known as _Hot Reloading_) for React components.\n+[![GitHub Actions][actions:badge]][actions]\n+[![License][license:badge]](./LICENSE)\n+[![Latest Version][npm:latest:badge]][npm:latest]\n+[![Next Version][npm:next:badge]][npm:next]\n \n-## Prerequisites\n+A Webpack plugin to enable \"Fast Refresh\" (also known as _Hot Reloading_) for React components.\n \n-First and foremost, this plugin is not 100% stable.\n-We're working towards a stable v1 release, and we've been testing the plugin quite extensively;\n-but since it is still pretty young, there might still be some unknown edge cases.\n+> We're hoping to land a v1 release soon - please help us by reporting any issues you've encountered!\n \n-There are no breaking changes planned for the v1 release,\n-but they might still happen if we hit some significant road blockers.\n+## Getting Started\n \n-Also, ensure that you are using the minimum supported versions of the plugin's peer dependencies -\n+### Prerequisites\n+\n+Ensure that you are using at least the minimum supported versions of this plugin's peer dependencies -\n older versions unfortunately do not contain code to orchestrate \"Fast Refresh\",\n and thus cannot be made compatible.\n \n-| Dependency         | Minimum                                            | Best       |\n-| ------------------ | -------------------------------------------------- | ---------- |\n-| `react`            | `16.9.0`                                           | `16.13.0`+ |\n-| `react-dom`        | `16.9.0`                                           | `16.13.0`+ |\n-| `react-reconciler` | `0.22.0`                                           | `0.25.0`+  |\n-| `webpack`          | `4.0.0` (for `0.3.x`)<br />`4.43.0` (for `0.4.x`+) | `4.43.0`+  |\n-\n-> You only need `react-dom` if you're rendering to the DOM.\n-\n-> You only need to check for `react-reconciler` if you use custom reconcilers like `react-three-fiber`.\n-> You should check their `package.json` to make sure they use a compatible version instead of installing `react-reconciler` yourself.\n-> If the reconcilers are not compatible, please create an issue at their repository.\n+We recommend using the following versions:\n+\n+| Dependency      | Version                              |\n+| --------------- | ------------------------------------ |\n+| `Node.js`       | `18.12.0`+, `20.x`, `22.x`           |\n+| `react`         | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-dom`     | `16.13.0`+, `17.x`, `18.x` or `19.x` |\n+| `react-refresh` | `0.10.0`+                            |\n+| `webpack`       | `5.2.0`+                             |\n+\n+<details>\n+<summary>Minimum requirements</summary>\n+<br />\n+\n+| Dependency      | Version   |\n+| --------------- | --------- |\n+| `Node.js`       | `18.12.0` |\n+| `react`         | `16.9.0`  |\n+| `react-dom`     | `16.9.0`  |\n+| `react-refresh` | `0.10.0`  |\n+| `webpack`       | `5.2.0`   |\n+\n+</details>\n+\n+<details>\n+<summary>Using custom renderers (e.g. <code>react-three-fiber</code>, <code>react-pdf</code>, <code>ink</code>)</summary>\n+<br />\n+\n+To ensure full support of \"Fast Refresh\" with components rendered by custom renderers,\n+you should ensure the renderer you're using depends on a recent version of `react-reconciler`.\n+\n+We recommend version `0.25.0` or above, but any versions above `0.22.0` should work.\n+\n+If the renderer is not compatible, please file them an issue instead.\n+\n+</details>\n \n-## Installation\n+### Installation\n \n-With all prerequisites met, you can install the plugin with one of the commands below:\n+With all prerequisites met, you can install this plugin using your package manager of choice:\n \n ```sh\n # if you prefer npm\n@@ -48,14 +77,16 @@\n",
					"match": false,
					"packageHash": "991cc1a1f47cc3e7e5e67de7243da4e994e9233aec9dc046b6be4bc5b838680e",
					"size": 8481,
					"sourceHash": "e685662008c7264a7a35a431aa151d0cb1e70a70a36cbcabd6c20164e7acb6b6",
					"status": "content"
				},
				"client/ErrorOverlayEntry.js": {
					"diff": "--- published/client/ErrorOverlayEntry.js\n+++ rebuilt/client/ErrorOverlayEntry.js\n@@ -1,94 +1,103 @@\n-/* global __react_refresh_error_overlay__, __react_refresh_socket__, __resourceQuery */\n+/* global __react_refresh_error_overlay__, __react_refresh_socket__ */\n \n-import { handleError, handleUnhandledRejection } from './utils/errorEventHandlers.js';\n-import formatWebpackErrors from './utils/formatWebpackErrors.js';\n-import runWithPatchedUrl from './utils/patchUrl.js';\n-\n-// Setup error states\n-let isHotReload = false;\n-let hasRuntimeErrors = false;\n-\n-/**\n- * Try dismissing the compile error overlay.\n- * This will also reset runtime error records (if any),\n- * because we have new source to evaluate.\n- * @returns {void}\n- */\n-function tryDismissErrorOverlay() {\n-  __react_refresh_error_overlay__.clearCompileError();\n-  __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n-  hasRuntimeErrors = false;\n-}\n-\n-/**\n- * A function called after a compile success signal is received from Webpack.\n- * @returns {void}\n- */\n-function handleCompileSuccess() {\n-  isHotReload = true;\n-\n-  if (isHotReload) {\n-    tryDismissErrorOverlay();\n-  }\n-}\n-\n-/**\n- * A function called after a compile errored signal is received from Webpack.\n- * @param {string[]} errors\n- * @returns {void}\n- */\n-function handleCompileErrors(errors) {\n-  isHotReload = true;\n+if (process.env.NODE_ENV !== 'production') {\n+  const events = require('./utils/errorEventHandlers.js');\n+  const formatWebpackErrors = require('./utils/formatWebpackErrors.js');\n+  const runWithRetry = require('./utils/retry.js');\n+\n+  // Setup error states\n+  let isHotReload = false;\n+  let hasRuntimeErrors = false;\n+\n+  /**\n+   * Try dismissing the compile error overlay.\n+   * This will also reset runtime error records (if any),\n+   * because we have new source to evaluate.\n+   * @returns {void}\n+   */\n+  const tryDismissErrorOverlay = function () {\n+    __react_refresh_error_overlay__.clearCompileError();\n+    __react_refresh_error_overlay__.clearRuntimeErrors(!hasRuntimeErrors);\n+    hasRuntimeErrors = false;\n+  };\n+\n+  /**\n+   * A function called after a compile success signal is received from Webpack.\n+   * @returns {void}\n+   */\n+  const handleCompileSuccess = function () {\n+    isHotReload = true;\n \n-  const formattedErrors = formatWebpackErrors(errors);\n-\n-  // Only show the first error\n-  __react_refresh_error_overlay__.showCompileError(formattedErrors[0]);\n-}\n-\n-/**\n- * Handles compilation messages from Webpack.\n- * Integrates with a compile error overlay.\n- * @param {*} message A Webpack HMR message sent via WebSockets.\n- * @returns {void}\n- */\n-function compileMessageHandler(message) {\n-  switch (message.type) {\n-    case 'ok':\n-    case 'still-ok':\n-    case 'warnings': {\n-      // TODO: Implement handling for warnings\n-      handleCompileSuccess();\n-      break;\n-    }\n-    case 'errors': {\n-      handleCompileErrors(message.data);\n-      break;\n+    if (isHotReload) {\n+      tryDismissErrorOverlay();\n     }\n",
					"match": false,
					"packageHash": "60420e97a5efe8b76b922640c763ae6b8a1415a004ad9d639e160d08dcb54930",
					"size": 2735,
					"sourceHash": "5b57c45de0030d6d220c5882d9de66aa6b4509296c885fdee27157989ec06ff1",
					"status": "content"
				},
				"client/LegacyWDSSocketEntry.js": {
					"match": false,
					"packageHash": "5de9f714ea0bf2e3ab47af4ff73f367d889eaf196865c50b0482ae10ce9d9e1e",
					"size": 723,
					"status": "missing-in-source"
				},
				"client/ReactRefreshEntry.js": {
					"diff": "--- published/client/ReactRefreshEntry.js\n+++ rebuilt/client/ReactRefreshEntry.js\n@@ -1,21 +1,23 @@\n /* global __react_refresh_library__ */\n \n-import safeThis from 'core-js-pure/features/global-this';\n-import * as RefreshRuntime from 'react-refresh/runtime';\n+if (process.env.NODE_ENV !== 'production') {\n+  const safeThis = require('core-js-pure/features/global-this');\n+  const RefreshRuntime = require('react-refresh/runtime');\n \n-if (process.env.NODE_ENV !== 'production' && typeof safeThis !== 'undefined') {\n-  var $RefreshInjected$ = '__reactRefreshInjected';\n-  // Namespace the injected flag (if necessary) for monorepo compatibility\n-  if (typeof __react_refresh_library__ !== 'undefined' && __react_refresh_library__) {\n-    $RefreshInjected$ += '_' + __react_refresh_library__;\n-  }\n+  if (typeof safeThis !== 'undefined') {\n+    var $RefreshInjected$ = '__reactRefreshInjected';\n+    // Namespace the injected flag (if necessary) for monorepo compatibility\n+    if (typeof __react_refresh_library__ !== 'undefined' && __react_refresh_library__) {\n+      $RefreshInjected$ += '_' + __react_refresh_library__;\n+    }\n \n-  // Only inject the runtime if it hasn't been injected\n-  if (!safeThis[$RefreshInjected$]) {\n-    // Inject refresh runtime into global scope\n-    RefreshRuntime.injectIntoGlobalHook(safeThis);\n+    // Only inject the runtime if it hasn't been injected\n+    if (!safeThis[$RefreshInjected$]) {\n+      // Inject refresh runtime into global scope\n+      RefreshRuntime.injectIntoGlobalHook(safeThis);\n \n-    // Mark the runtime as injected to prevent double-injection\n-    safeThis[$RefreshInjected$] = true;\n+      // Mark the runtime as injected to prevent double-injection\n+      safeThis[$RefreshInjected$] = true;\n+    }\n   }\n }\n",
					"match": false,
					"packageHash": "86834874aab456939492ea7dd48c09e4a31fdc848d0ea74445b18514ea8d2abd",
					"size": 817,
					"sourceHash": "ccbc4d04b16eda9ca493dae2f1e6a39a402921475524758a2b230d2e71a5a513",
					"status": "content"
				},
				"client/utils/errorEventHandlers.js": {
					"diff": "--- published/client/utils/errorEventHandlers.js\n+++ rebuilt/client/utils/errorEventHandlers.js\n@@ -90,8 +90,13 @@\n   return register;\n }\n \n-export const handleError = createWindowEventHandler('error', createErrorHandler);\n-export const handleUnhandledRejection = createWindowEventHandler(\n+const handleError = createWindowEventHandler('error', createErrorHandler);\n+const handleUnhandledRejection = createWindowEventHandler(\n   'unhandledrejection',\n   createRejectionHandler\n );\n+\n+module.exports = {\n+  handleError: handleError,\n+  handleUnhandledRejection: handleUnhandledRejection,\n+};\n",
					"match": false,
					"packageHash": "f6d6e3bf241c5288c4acb6256031279a3b0bdcdcc2a81ea578f7399c720efcbe",
					"size": 2999,
					"sourceHash": "8ead621aabe6935b60ed558ba0efe3fdf257daff6f7b3bf13cf58bc5e4b832b4",
					"status": "content"
				},
				"client/utils/formatWebpackErrors.js": {
					"diff": "--- published/client/utils/formatWebpackErrors.js\n+++ rebuilt/client/utils/formatWebpackErrors.js\n@@ -93,4 +93,4 @@\n   return formattedErrors;\n }\n \n-export default formatWebpackErrors;\n+module.exports = formatWebpackErrors;\n",
					"match": false,
					"packageHash": "b000f7a76a7b9a917bbf7299da8d6305ae2508b16473ead452da0f5e7131c336",
					"size": 3423,
					"sourceHash": "77db52026d9039bbae04186437b097a963b10acf10e5f111c8e54106f076eb4e",
					"status": "content"
				},
				"client/utils/patchUrl.js": {
					"match": false,
					"packageHash": "177781a2e386343b0c299ad976aa0a726f99fc67b0966834284803125139fd58",
					"size": 1263,
					"status": "missing-in-source"
				},
				"lib/RefreshRuntimeModule.js": {
					"match": false,
					"packageHash": "abc72b79ad9f927d1ae0ff85b64124c3fdbbdf2fb170e7a81472fee71074c2a8",
					"size": 1459,
					"status": "missing-in-source"
				},
				"lib/globals.js": {
					"diff": "--- published/lib/globals.js\n+++ rebuilt/lib/globals.js\n@@ -1,13 +1,8 @@\n-const { version } = require('webpack');\n-\n-// Parse the major version of Webpack: x.y.z => x\n-const webpackVersion = parseInt(version || '', 10);\n-\n-let webpackGlobals = {};\n-if (webpackVersion === 5) {\n-  webpackGlobals = require('webpack/lib/RuntimeGlobals');\n-}\n-\n-module.exports.webpackVersion = webpackVersion;\n-module.exports.webpackRequire = webpackGlobals.require || '__webpack_require__';\n-module.exports.refreshGlobal = `${module.exports.webpackRequire}.$Refresh$`;\n+/**\n+ * Gets current bundle's global scope identifier for React Refresh.\n+ * @param {Record<string, string>} runtimeGlobals The Webpack runtime globals.\n+ * @returns {string} The React Refresh global scope within the Webpack bundle.\n+ */\n+module.exports.getRefreshGlobalScope = (runtimeGlobals) => {\n+  return `${runtimeGlobals.require || '__webpack_require__'}.$Refresh$`;\n+};\n",
					"match": false,
					"packageHash": "c943bae10644333cecaca405ab7b2a9d45980bdb92fa184af37e47bebe65b604",
					"size": 464,
					"sourceHash": "47fc9689ab1a550044fb41caec41a17e88482e61d6d0f97ac9fbceaa9dcba4c5",
					"status": "content"
				},
				"lib/index.js": {
					"diff": "--- published/lib/index.js\n+++ rebuilt/lib/index.js\n@@ -1,32 +1,15 @@\n const { validate: validateOptions } = require('schema-utils');\n-const { DefinePlugin, ModuleFilenameHelpers, ProvidePlugin, Template } = require('webpack');\n-const ConstDependency = require('webpack/lib/dependencies/ConstDependency');\n-const { refreshGlobal, webpackRequire, webpackVersion } = require('./globals');\n+const { getRefreshGlobalScope } = require('./globals');\n const {\n-  getParserHelpers,\n-  getRefreshGlobal,\n+  getAdditionalEntries,\n+  getIntegrationEntry,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n+  makeRefreshRuntimeModule,\n   normalizeOptions,\n-  getAdditionalEntries,\n } = require('./utils');\n const schema = require('./options.json');\n \n-// Mapping of react-refresh globals to Webpack runtime globals\n-const REPLACEMENTS = {\n-  $RefreshReg$: {\n-    expr: `${refreshGlobal}.register`,\n-    req: [webpackRequire, `${refreshGlobal}.register`],\n-    type: 'function',\n-  },\n-  $RefreshSig$: {\n-    expr: `${refreshGlobal}.signature`,\n-    req: [webpackRequire, `${refreshGlobal}.signature`],\n-    type: 'function',\n-  },\n-};\n-\n class ReactRefreshPlugin {\n   /**\n    * @param {import('./types').ReactRefreshPluginOptions} [options] Options for react-refresh-plugin.\n@@ -50,12 +33,6 @@\n    * @returns {void}\n    */\n   apply(compiler) {\n-    // Throw if we encounter an unsupported Webpack version,\n-    // since things will most likely not work.\n-    if (webpackVersion !== 4 && webpackVersion !== 5) {\n-      throw new Error(`[ReactRefreshPlugin] Webpack v${webpackVersion} is not supported!`);\n-    }\n-\n     // Skip processing in non-development mode, but allow manual force-enabling\n     if (\n       // Webpack do not set process.env.NODE_ENV, so we need to check for mode.\n@@ -70,17 +47,104 @@\n     }\n \n     const logger = compiler.getInfrastructureLogger(this.constructor.name);\n-    let loggedHotWarning = false;\n \n-    // Inject react-refresh context to all Webpack entry points\n-    compiler.options.entry = injectRefreshEntry(\n-      compiler.options.entry,\n-      getAdditionalEntries({ options: this.options, devServer: compiler.options.devServer })\n+    // Get Webpack imports from compiler instance (if available) -\n+    // this allow mono-repos to use different versions of Webpack without conflicts.\n+    const webpack = compiler.webpack || require('webpack');\n+    const {\n+      DefinePlugin,\n+      EntryDependency,\n+      EntryPlugin,\n+      ModuleFilenameHelpers,\n+      NormalModule,\n+      ProvidePlugin,\n+      RuntimeGlobals,\n+      Template,\n+    } = webpack;\n+\n+    // Inject react-refresh context to all Webpack entry points.\n+    const { overlayEntries, prependEntries } = getAdditionalEntries(this.options);\n+    // Prepended entries does not care about injection order,\n+    // so we can utilise EntryPlugin for simpler logic.\n+    for (const entry of prependEntries) {\n+      new EntryPlugin(compiler.context, entry, { name: undefined }).apply(compiler);\n+    }\n+\n+    const integrationEntry = getIntegrationEntry(this.options.overlay.sockIntegration);\n+    const socketEntryData = [];\n+    compiler.hooks.make.tap(\n+      { name: this.constructor.name, stage: Number.POSITIVE_INFINITY },\n+      (compilation) => {\n+        // Exhaustively search all entries for `integrationEntry`.\n+        // If found, mark those entries and the index of `integrationEntry`.\n+        for (const [name, entryData] of compilation.entries.entries()) {\n+          const index = entryData.dependencies.findIndex(\n+            (dep) => dep.request && dep.request.includes(integrationEntry)\n+          );\n+          if (index !== -1) {\n+            socketEntryData.push({ name, index });\n+          }\n+        }\n+      }\n",
					"match": false,
					"packageHash": "b387c93126fbefbcc33904095528e58f01a0758331e558d053422869b147ee0a",
					"size": 12593,
					"sourceHash": "903041123290f427ef671589fdbc43d6289441ac77157434b0683572915a2e32",
					"status": "content"
				},
				"lib/options.json": {
					"diff": "--- published/lib/options.json\n+++ rebuilt/lib/options.json\n@@ -45,13 +45,7 @@\n             { \"enum\": [\"wds\", \"whm\", \"wps\"] },\n             { \"$ref\": \"#/definitions/Path\" }\n           ]\n-        },\n-        \"sockHost\": { \"type\": \"string\" },\n-        \"sockPath\": { \"type\": \"string\" },\n-        \"sockPort\": { \"type\": \"number\", \"minimum\": 0 },\n-        \"sockProtocol\": { \"enum\": [\"http\", \"https\", \"ws\", \"wss\"] },\n-        \"useLegacyWDSSockets\": { \"type\": \"boolean\" },\n-        \"useURLPolyfill\": { \"type\": \"boolean\" }\n+        }\n       }\n     }\n   },\n",
					"match": false,
					"packageHash": "d7f9ead9e3d03debd947e9e3b0b4f1edbf6ba5b17a1087508077f068ea45554a",
					"size": 2293,
					"sourceHash": "c363aa80bb10c6d71a4dd66b2a954e0ac30e0064a0ba4aedf4319acb679599a0",
					"status": "content"
				},
				"lib/runtime/RefreshUtils.js": {
					"diff": "--- published/lib/runtime/RefreshUtils.js\n+++ rebuilt/lib/runtime/RefreshUtils.js\n@@ -1,5 +1,5 @@\n /* global __webpack_require__ */\n-const Refresh = require('react-refresh/runtime');\n+var Refresh = require('react-refresh/runtime');\n \n /**\n  * Extracts exports from a webpack module object.\n@@ -7,7 +7,30 @@\n  * @returns {*} An exports object from the module.\n  */\n function getModuleExports(moduleId) {\n-  return __webpack_require__.c[moduleId].exports;\n+  if (typeof moduleId === 'undefined') {\n+    // `moduleId` is unavailable, which indicates that this module is not in the cache,\n+    // which means we won't be able to capture any exports,\n+    // and thus they cannot be refreshed safely.\n+    // These are likely runtime or dynamically generated modules.\n+    return {};\n+  }\n+\n+  var maybeModule = __webpack_require__.c[moduleId];\n+  if (typeof maybeModule === 'undefined') {\n+    // `moduleId` is available but the module in cache is unavailable,\n+    // which indicates the module is somehow corrupted (e.g. broken Webpacak `module` globals).\n+    // We will warn the user (as this is likely a mistake) and assume they cannot be refreshed.\n+    console.warn('[React Refresh] Failed to get exports for module: ' + moduleId + '.');\n+    return {};\n+  }\n+\n+  var exportsOrPromise = maybeModule.exports;\n+  if (typeof Promise !== 'undefined' && exportsOrPromise instanceof Promise) {\n+    return exportsOrPromise.then(function (exports) {\n+      return exports;\n+    });\n+  }\n+  return exportsOrPromise;\n }\n \n /**\n@@ -19,7 +42,7 @@\n  * @returns {string[]} A React refresh boundary signature array.\n  */\n function getReactRefreshBoundarySignature(moduleExports) {\n-  const signature = [];\n+  var signature = [];\n   signature.push(Refresh.getFamilyByType(moduleExports));\n \n   if (moduleExports == null || typeof moduleExports !== 'object') {\n@@ -27,7 +50,7 @@\n     return signature;\n   }\n \n-  for (let key in moduleExports) {\n+  for (var key in moduleExports) {\n     if (key === '__esModule') {\n       continue;\n     }\n@@ -40,15 +63,30 @@\n }\n \n /**\n+ * Creates a data object to be retained across refreshes.\n+ * This object should not transtively reference previous exports,\n+ * which can form infinite chain of objects across refreshes, which can pressure RAM.\n+ *\n+ * @param {*} moduleExports A Webpack module exports object.\n+ * @returns {*} A React refresh boundary signature array.\n+ */\n+function getWebpackHotData(moduleExports) {\n+  return {\n+    signature: getReactRefreshBoundarySignature(moduleExports),\n+    isReactRefreshBoundary: isReactRefreshBoundary(moduleExports),\n+  };\n+}\n+\n+/**\n  * Creates a helper that performs a delayed React refresh.\n- * @returns {enqueueUpdate} A debounced React refresh function.\n+ * @returns {function(function(): void): void} A debounced React refresh function.\n  */\n function createDebounceUpdate() {\n   /**\n    * A cached setTimeout handler.\n    * @type {number | undefined}\n    */\n-  let refreshTimeout;\n+  var refreshTimeout;\n \n   /**\n    * Performs react refresh on a delay and clears the error overlay.\n@@ -84,9 +122,9 @@\n     return false;\n   }\n \n-  let hasExports = false;\n-  let areAllExportsComponents = true;\n-  for (let key in moduleExports) {\n+  var hasExports = false;\n",
					"match": false,
					"packageHash": "b02dae19df1c73ab0861bce078f0809146f9ee7230862cbf170ed826f3b7d532",
					"size": 5754,
					"sourceHash": "ce2851930f563eb07cd10528b50ed9812bff95fcf009119ffa4f0a4dac24089c",
					"status": "content"
				},
				"lib/types.js": {
					"diff": "--- published/lib/types.js\n+++ rebuilt/lib/types.js\n@@ -2,13 +2,7 @@\n  * @typedef {Object} ErrorOverlayOptions\n  * @property {string | false} [entry] Path to a JS file that sets up the error overlay integration.\n  * @property {string | false} [module] The error overlay module to use.\n- * @property {string} [sockHost] The socket host to use (WDS only).\n  * @property {import('type-fest').LiteralUnion<'wds' | 'whm' | 'wps' | false, string>} [sockIntegration] Path to a JS file that sets up the Webpack socket integration.\n- * @property {string} [sockPath] The socket path to use (WDS only).\n- * @property {number} [sockPort] The socket port to use (WDS only).\n- * @property {'http' | 'https' | 'ws' | 'wss'} [sockProtocol] The socket protocol to use (WDS only).\n- * @property {boolean} [useLegacyWDSSockets] Uses a custom SocketJS implementation for older versions of WDS.\n- * @property {boolean} [useURLPolyfill] Uses a polyfill for the DOM URL API (WDS only).\n  */\n \n /**\n",
					"match": false,
					"packageHash": "db4e60145335789f87727325aa83bc0d06989ca6c461abf1fd09f373d39a52d2",
					"size": 2067,
					"sourceHash": "5ea26f09e4e5261fcc4e2c5dc98ae038178232802ac9fd127fb5040422a981cc",
					"status": "content"
				},
				"lib/utils/getAdditionalEntries.js": {
					"diff": "--- published/lib/utils/getAdditionalEntries.js\n+++ rebuilt/lib/utils/getAdditionalEntries.js\n@@ -1,63 +1,23 @@\n-const querystring = require('querystring');\n-\n /**\n  * @typedef {Object} AdditionalEntries\n- * @property {import('./injectRefreshEntry').WebpackEntry} prependEntries\n- * @property {import('./injectRefreshEntry').WebpackEntry} overlayEntries\n+ * @property {string[]} prependEntries\n+ * @property {string[]} overlayEntries\n  */\n \n /**\n  * Creates an object that contains two entry arrays: the prependEntries and overlayEntries\n- * @param {Object} optionsContainer This is the container for the options to this function\n- * @param {import('../types').NormalizedPluginOptions} optionsContainer.options Configuration options for this plugin.\n- * @param {import('webpack').Compiler[\"options\"][\"devServer\"]} [optionsContainer.devServer] The webpack devServer config\n+ * @param {import('../types').NormalizedPluginOptions} options Configuration options for this plugin.\n  * @returns {AdditionalEntries} An object that contains the Webpack entries for prepending and the overlay feature\n  */\n-function getAdditionalEntries({ devServer, options }) {\n-  /** @type {Record<string, string | number>} */\n-  let resourceQuery = {};\n-\n-  if (devServer) {\n-    const { sockHost, sockPath, sockPort, host, path, port, https, http2 } = devServer;\n-\n-    (sockHost || host) && (resourceQuery.sockHost = sockHost ? sockHost : host);\n-    (sockPath || path) && (resourceQuery.sockPath = sockPath ? sockPath : path);\n-    (sockPort || port) && (resourceQuery.sockPort = sockPort ? sockPort : port);\n-    resourceQuery.sockProtocol = https || http2 ? 'https' : 'http';\n-  }\n-\n-  if (options.overlay) {\n-    options.overlay.sockHost && (resourceQuery.sockHost = options.overlay.sockHost);\n-    options.overlay.sockPath && (resourceQuery.sockPath = options.overlay.sockPath);\n-    options.overlay.sockPort && (resourceQuery.sockPort = options.overlay.sockPort);\n-    options.overlay.sockProtocol && (resourceQuery.sockProtocol = options.overlay.sockProtocol);\n-  }\n-\n-  // We don't need to URI encode the resourceQuery as it will be parsed by Webpack\n-  const queryString = querystring.stringify(resourceQuery, undefined, undefined, {\n-    /**\n-     * @param {string} string\n-     * @returns {string}\n-     */\n-    encodeURIComponent(string) {\n-      return string;\n-    },\n-  });\n-\n+function getAdditionalEntries(options) {\n   const prependEntries = [\n     // React-refresh runtime\n     require.resolve('../../client/ReactRefreshEntry'),\n   ];\n \n   const overlayEntries = [\n-    // Legacy WDS SockJS integration\n-    options.overlay &&\n-      options.overlay.useLegacyWDSSockets &&\n-      require.resolve('../../client/LegacyWDSSocketEntry'),\n     // Error overlay runtime\n-    options.overlay &&\n-      options.overlay.entry &&\n-      `${options.overlay.entry}${queryString ? `?${queryString}` : ''}`,\n+    options.overlay && options.overlay.entry && require.resolve(options.overlay.entry),\n   ].filter(Boolean);\n \n   return { prependEntries, overlayEntries };\n",
					"match": false,
					"packageHash": "6f4420704c48c176974b16a52c880ce73e0e800e34b8bd6c99e971eaba26bebf",
					"size": 2603,
					"sourceHash": "d24a6d262b4f24f148d1a5303321305d152f3a878777d4de0e0bfb965c68d3d9",
					"status": "content"
				},
				"lib/utils/getParserHelpers.js": {
					"match": false,
					"packageHash": "723c81ada745242398c5049cfa762a983d753f87478253ebbb079a548b414bac",
					"size": 1025,
					"status": "missing-in-source"
				},
				"lib/utils/getRefreshGlobal.js": {
					"match": false,
					"packageHash": "e6be7084b86833cbddb73dd4f05d525bffceec9a7b88c8f7ad0f870076f6c9d3",
					"size": 3724,
					"status": "missing-in-source"
				},
				"lib/utils/index.js": {
					"diff": "--- published/lib/utils/index.js\n+++ rebuilt/lib/utils/index.js\n@@ -1,17 +1,15 @@\n-const getParserHelpers = require('./getParserHelpers');\n-const getRefreshGlobal = require('./getRefreshGlobal');\n+const getAdditionalEntries = require('./getAdditionalEntries');\n+const getIntegrationEntry = require('./getIntegrationEntry');\n const getSocketIntegration = require('./getSocketIntegration');\n-const injectRefreshEntry = require('./injectRefreshEntry');\n const injectRefreshLoader = require('./injectRefreshLoader');\n+const makeRefreshRuntimeModule = require('./makeRefreshRuntimeModule');\n const normalizeOptions = require('./normalizeOptions');\n-const getAdditionalEntries = require('./getAdditionalEntries');\n \n module.exports = {\n-  getParserHelpers,\n-  getRefreshGlobal,\n+  getAdditionalEntries,\n+  getIntegrationEntry,\n   getSocketIntegration,\n-  injectRefreshEntry,\n   injectRefreshLoader,\n+  makeRefreshRuntimeModule,\n   normalizeOptions,\n-  getAdditionalEntries,\n };\n",
					"match": false,
					"packageHash": "288a90129309bb67005b8e473b94b5a8fc73dfdf0f694f95d2bb6d2d5869046f",
					"size": 594,
					"sourceHash": "92fb4ccffc1b6eff62f0d0fcda08cb3662cee6a222a35b40a1b25fb229873ec4",
					"status": "content"
				},
				"lib/utils/injectRefreshEntry.js": {
					"match": false,
					"packageHash": "f4344f15397a54dd34bda53e8efef6c4f974b8620c8313ba7db938685919bb88",
					"size": 3115,
					"status": "missing-in-source"
				},
				"lib/utils/injectRefreshLoader.js": {
					"diff": "--- published/lib/utils/injectRefreshLoader.js\n+++ rebuilt/lib/utils/injectRefreshLoader.js\n@@ -1,4 +1,4 @@\n-const path = require('path');\n+const path = require('node:path');\n \n /**\n  * @callback MatchObject\n@@ -13,6 +13,8 @@\n  */\n \n const resolvedLoader = require.resolve('../../loader');\n+const reactRefreshPath = path.dirname(require.resolve('react-refresh'));\n+const refreshUtilsPath = path.join(__dirname, '../runtime/RefreshUtils');\n \n /**\n  * Injects refresh loader to all JavaScript-like and user-specified files.\n@@ -23,27 +25,33 @@\n function injectRefreshLoader(moduleData, injectOptions) {\n   const { match, options } = injectOptions;\n \n+  // Include and exclude user-specified files\n+  if (!match(moduleData.matchResource || moduleData.resource)) return moduleData;\n+  // Include and exclude dynamically generated modules from other loaders\n+  if (moduleData.matchResource && !match(moduleData.request)) return moduleData;\n+  // Exclude files referenced as assets\n+  if (moduleData.type.includes('asset')) return moduleData;\n+  // Check to prevent double injection\n+  if (moduleData.loaders.find(({ loader }) => loader === resolvedLoader)) return moduleData;\n+  // Skip react-refresh and the plugin's runtime utils to prevent self-referencing -\n+  // this is useful when using the plugin as a direct dependency,\n+  // or when node_modules are specified to be processed.\n   if (\n-    // Include and exclude user-specified files\n-    match(moduleData.resource) &&\n-    // Skip react-refresh and the plugin's runtime utils to prevent self-referencing -\n-    // this is useful when using the plugin as a direct dependency,\n-    // or when node_modules are specified to be processed.\n-    !moduleData.resource.includes('react-refresh') &&\n-    !moduleData.resource.includes(path.join(__dirname, '../runtime/RefreshUtils')) &&\n-    // Check to prevent double injection\n-    !moduleData.loaders.find(({ loader }) => loader === resolvedLoader)\n+    moduleData.resource.includes(reactRefreshPath) ||\n+    moduleData.resource.includes(refreshUtilsPath)\n   ) {\n-    // As we inject runtime code for each module,\n-    // it is important to run the injected loader after everything.\n-    // This way we can ensure that all code-processing have been done,\n-    // and we won't risk breaking tools like Flow or ESLint.\n-    moduleData.loaders.unshift({\n-      loader: resolvedLoader,\n-      options,\n-    });\n+    return moduleData;\n   }\n \n+  // As we inject runtime code for each module,\n+  // it is important to run the injected loader after everything.\n+  // This way we can ensure that all code-processing have been done,\n+  // and we won't risk breaking tools like Flow or ESLint.\n+  moduleData.loaders.unshift({\n+    loader: resolvedLoader,\n+    options,\n+  });\n+\n   return moduleData;\n }\n \n",
					"match": false,
					"packageHash": "d83eb057c41f77fb962e2a9069ac16aa738089c4cb026f99a27ad146f1e9eeab",
					"size": 1771,
					"sourceHash": "3f5147476d72e21dc95a45d24d5f905d3176d29db6aff67e09852f98b94190ab",
					"status": "content"
				},
				"lib/utils/normalizeOptions.js": {
					"diff": "--- published/lib/utils/normalizeOptions.js\n+++ rebuilt/lib/utils/normalizeOptions.js\n@@ -29,12 +29,6 @@\n     d(overlay, 'entry', defaults.entry);\n     d(overlay, 'module', defaults.module);\n     d(overlay, 'sockIntegration', defaults.sockIntegration);\n-    d(overlay, 'sockHost');\n-    d(overlay, 'sockPath');\n-    d(overlay, 'sockPort');\n-    d(overlay, 'sockProtocol');\n-    d(options, 'useLegacyWDSSockets');\n-    d(options, 'useURLPolyfill');\n \n     return overlay;\n   });\n",
					"match": false,
					"packageHash": "be1a0f06fbe5af721cbffec314b0d47fec36296e2ef0835bed21c5e479dcb410",
					"size": 1311,
					"sourceHash": "d1fda547183f02d1a6fad5eaf0953884ff4d44ce7e821bd730880987025daf1d",
					"status": "content"
				},
				"loader/index.js": {
					"diff": "--- published/loader/index.js\n+++ rebuilt/loader/index.js\n@@ -5,11 +5,8 @@\n const originalFetch = global.fetch;\n delete global.fetch;\n \n-const { getOptions } = require('loader-utils');\n const { validate: validateOptions } = require('schema-utils');\n const { SourceMapConsumer, SourceNode } = require('source-map');\n-const { Template } = require('webpack');\n-const { refreshGlobal } = require('../lib/globals');\n const {\n   getIdentitySourceMap,\n   getModuleSystem,\n@@ -19,30 +16,22 @@\n const schema = require('./options.json');\n \n const RefreshRuntimePath = require\n-  .resolve('react-refresh/runtime.js')\n+  .resolve('react-refresh')\n   .replace(/\\\\/g, '/')\n   .replace(/'/g, \"\\\\'\");\n \n-const RefreshSetupRuntimes = {\n-  cjs: Template.asString(`${refreshGlobal}.runtime = require('${RefreshRuntimePath}');`),\n-  esm: Template.asString([\n-    `import * as __react_refresh_runtime__ from '${RefreshRuntimePath}';`,\n-    `${refreshGlobal}.runtime = __react_refresh_runtime__;`,\n-  ]),\n-};\n-\n /**\n  * A simple Webpack loader to inject react-refresh HMR code into modules.\n  *\n  * [Reference for Loader API](https://webpack.js.org/api/loaders/)\n- * @this {import('webpack').loader.LoaderContext}\n+ * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n  * @param {string} source The original module source code.\n  * @param {import('source-map').RawSourceMap} [inputSourceMap] The source map of the module.\n  * @param {*} [meta] The loader metadata passed in.\n  * @returns {void}\n  */\n function ReactRefreshLoader(source, inputSourceMap, meta) {\n-  let options = getOptions(this);\n+  let options = this.getOptions();\n   validateOptions(schema, options, {\n     baseDataPath: 'options',\n     name: 'React Refresh Loader',\n@@ -52,17 +41,33 @@\n \n   const callback = this.async();\n \n+  const { ModuleFilenameHelpers, Template } = this._compiler.webpack || require('webpack');\n+\n+  const RefreshSetupRuntimes = {\n+    cjs: Template.asString(\n+      `__webpack_require__.$Refresh$.runtime = require('${RefreshRuntimePath}');`\n+    ),\n+    esm: Template.asString([\n+      `import * as __react_refresh_runtime__ from '${RefreshRuntimePath}';`,\n+      `__webpack_require__.$Refresh$.runtime = __react_refresh_runtime__;`,\n+    ]),\n+  };\n+\n   /**\n-   * @this {import('webpack').loader.LoaderContext}\n+   * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n    * @param {string} source\n    * @param {import('source-map').RawSourceMap} [inputSourceMap]\n    * @returns {Promise<[string, import('source-map').RawSourceMap]>}\n    */\n   async function _loader(source, inputSourceMap) {\n-    const moduleSystem = await getModuleSystem(this, options);\n+    /** @type {'esm' | 'cjs'} */\n+    const moduleSystem = await getModuleSystem.call(this, ModuleFilenameHelpers, options);\n \n     const RefreshSetupRuntime = RefreshSetupRuntimes[moduleSystem];\n-    const RefreshModuleRuntime = getRefreshModuleRuntime({ const: options.const, moduleSystem });\n+    const RefreshModuleRuntime = getRefreshModuleRuntime(Template, {\n+      const: options.const,\n+      moduleSystem,\n+    });\n \n     if (this.sourceMap) {\n       let originalSourceMap = inputSourceMap;\n@@ -70,16 +75,15 @@\n         originalSourceMap = getIdentitySourceMap(source, this.resourcePath);\n       }\n \n-      const node = SourceNode.fromStringWithSourceMap(\n-        source,\n-        await new SourceMapConsumer(originalSourceMap)\n-      );\n+      return SourceMapConsumer.with(originalSourceMap, undefined, (consumer) => {\n+        const node = SourceNode.fromStringWithSourceMap(source, consumer);\n \n-      node.prepend([RefreshSetupRuntime, '\\n\\n']);\n-      node.add(['\\n\\n', RefreshModuleRuntime]);\n+        node.prepend([RefreshSetupRuntime, '\\n\\n']);\n+        node.add(['\\n\\n', RefreshModuleRuntime]);\n",
					"match": false,
					"packageHash": "1767c2d8f32e291b6d19f642c692bb041a95882563ba316e875d68983834c15b",
					"size": 3400,
					"sourceHash": "57b706a720e9f835bc45bd5cd4de1ce89a369b07e83b1ffd10545d87ed725094",
					"status": "content"
				},
				"loader/utils/getIdentitySourceMap.js": {
					"diff": "--- published/loader/utils/getIdentitySourceMap.js\n+++ rebuilt/loader/utils/getIdentitySourceMap.js\n@@ -10,7 +10,7 @@\n   const sourceMap = new SourceMapGenerator();\n   sourceMap.setSourceContent(resourcePath, source);\n \n-  source.split('\\n').forEach((line, index) => {\n+  source.split('\\n').forEach((_, index) => {\n     sourceMap.addMapping({\n       source: resourcePath,\n       original: {\n",
					"match": false,
					"packageHash": "d632a78a01dfb1a1da5b8b892e4912e09c9aeea61e6e2f0c12b1474e8e765b78",
					"size": 796,
					"sourceHash": "f9fee709ec45ccb5e451678406ccca4d064f9e95d17b34e9531a53954d035763",
					"status": "content"
				},
				"loader/utils/getModuleSystem.js": {
					"diff": "--- published/loader/utils/getModuleSystem.js\n+++ rebuilt/loader/utils/getModuleSystem.js\n@@ -1,17 +1,17 @@\n-const { promises: fsPromises } = require('fs');\n-const path = require('path');\n-const { ModuleFilenameHelpers } = require('webpack');\n+const fs = require('node:fs/promises');\n+const path = require('node:path');\n \n-/** @type {string | undefined} */\n-let packageJsonType;\n+/** @type {Map<string, string | undefined>} */\n+let packageJsonTypeMap = new Map();\n \n /**\n  * Infers the current active module system from loader context and options.\n- * @param {import('webpack').loader.LoaderContext} loaderContext The Webpack loader context.\n+ * @this {import('webpack').loader.LoaderContext}\n+ * @param {import('webpack').ModuleFilenameHelpers} ModuleFilenameHelpers Webpack's module filename helpers.\n  * @param {import('../types').NormalizedLoaderOptions} options The normalized loader options.\n  * @return {Promise<'esm' | 'cjs'>} The inferred module system.\n  */\n-async function getModuleSystem(loaderContext, options) {\n+async function getModuleSystem(ModuleFilenameHelpers, options) {\n   // Check loader options -\n   // if `esModule` is set we don't have to do extra guess work.\n   switch (typeof options.esModule) {\n@@ -21,13 +21,13 @@\n     case 'object': {\n       if (\n         options.esModule.include &&\n-        ModuleFilenameHelpers.matchPart(loaderContext.resourcePath, options.esModule.include)\n+        ModuleFilenameHelpers.matchPart(this.resourcePath, options.esModule.include)\n       ) {\n         return 'esm';\n       }\n       if (\n         options.esModule.exclude &&\n-        ModuleFilenameHelpers.matchPart(loaderContext.resourcePath, options.esModule.exclude)\n+        ModuleFilenameHelpers.matchPart(this.resourcePath, options.esModule.exclude)\n       ) {\n         return 'cjs';\n       }\n@@ -38,20 +38,86 @@\n   }\n \n   // Check current resource's extension\n-  if (/\\.mjs$/.test(loaderContext.resourcePath)) return 'esm';\n-  if (/\\.cjs$/.test(loaderContext.resourcePath)) return 'cjs';\n+  if (/\\.mjs$/.test(this.resourcePath)) return 'esm';\n+  if (/\\.cjs$/.test(this.resourcePath)) return 'cjs';\n \n-  // Load users' `package.json` -\n-  // We will cache the results in a global variable so it will only be parsed once.\n-  if (!packageJsonType) {\n+  if (typeof this.addMissingDependency !== 'function') {\n+    // This is Webpack 4 which does not support `import.meta`.\n+    // We assume `.js` files are CommonJS because the output cannot be ESM anyway.\n+    return 'cjs';\n+  }\n+\n+  // We will assume CommonJS if we cannot determine otherwise\n+  let packageJsonType = '';\n+\n+  // We begin our search for relevant `package.json` files,\n+  // at the directory of the resource being loaded.\n+  // These paths should already be resolved,\n+  // but we resolve them again to ensure we are dealing with an aboslute path.\n+  const resourceContext = path.dirname(this.resourcePath);\n+  let searchPath = resourceContext;\n+  let previousSearchPath = '';\n+  // We start our search just above the root context of the webpack compilation\n+  const stopPath = path.dirname(this.rootContext);\n+\n+  // If the module context is a resolved symlink outside the `rootContext` path,\n+  // then we will never find the `stopPath` - so we also halt when we hit the root.\n+  // Note that there is a potential that the wrong `package.json` is found in some pathalogical cases,\n+  // such as a folder that is conceptually a package + does not have an ancestor `package.json`,\n+  // but there exists a `package.json` higher up.\n+  // This might happen if you have a folder of utility JS files that you symlink but did not organize as a package.\n+  // We consider this an unsupported edge case for now.\n+  while (searchPath !== stopPath && searchPath !== previousSearchPath) {\n+    // If we have already determined the `package.json` type for this path we can stop searching.\n+    // We do however still need to cache the found value,\n+    // from the `resourcePath` folder up to the matching `searchPath`,\n+    // to avoid retracing these steps when processing sibling resources.\n+    if (packageJsonTypeMap.has(searchPath)) {\n+      packageJsonType = packageJsonTypeMap.get(searchPath);\n+\n+      let currentPath = resourceContext;\n+      while (currentPath !== searchPath) {\n+        // We set the found type at least level from `resourcePath` folder up to the matching `searchPath`\n+        packageJsonTypeMap.set(currentPath, packageJsonType);\n+        currentPath = path.dirname(currentPath);\n+      }\n+      break;\n+    }\n+\n+    let packageJsonPath = path.join(searchPath, 'package.json');\n     try {\n",
					"match": false,
					"packageHash": "a1a1d2e8461dafdafa9ba6dcce91e4e8f9beb3d551b69b6097c9ca675cdc2ce1",
					"size": 2123,
					"sourceHash": "78833be1f8c5feb40c643009736638fc2fdcce2b72976b784c6698f3a6cb0c88",
					"status": "content"
				},
				"loader/utils/getRefreshModuleRuntime.js": {
					"diff": "--- published/loader/utils/getRefreshModuleRuntime.js\n+++ rebuilt/loader/utils/getRefreshModuleRuntime.js\n@@ -1,5 +1,3 @@\n-const { Template } = require('webpack');\n-\n /**\n  * @typedef ModuleRuntimeOptions {Object}\n  * @property {boolean} const Use ES6 `const` and `let` in generated runtime code.\n@@ -14,10 +12,11 @@\n  * [Reference for Runtime Injection](https://github.com/webpack/webpack/blob/b07d3b67d2252f08e4bb65d354a11c9b69f8b434/lib/HotModuleReplacementPlugin.js#L419)\n  * [Reference for HMR Error Recovery](https://github.com/webpack/webpack/issues/418#issuecomment-490296365)\n  *\n+ * @param {import('webpack').Template} Webpack's templating helpers.\n  * @param {ModuleRuntimeOptions} options The refresh module runtime options.\n  * @returns {string} The refresh module runtime template.\n  */\n-function getRefreshModuleRuntime(options) {\n+function getRefreshModuleRuntime(Template, options) {\n   const constDeclaration = options.const ? 'const' : 'var';\n   const letDeclaration = options.const ? 'let' : 'var';\n   const webpackHot = options.moduleSystem === 'esm' ? 'import.meta.webpackHot' : 'module.hot';\n@@ -26,123 +25,38 @@\n     `${constDeclaration} $ReactRefreshCurrentExports$ = __react_refresh_utils__.getModuleExports(`,\n     Template.indent('$ReactRefreshModuleId$'),\n     ');',\n-    '__react_refresh_utils__.registerExportsForReactRefresh(',\n-    // prettier-ignore\n-    Template.indent([\n-      '$ReactRefreshCurrentExports$,',\n-      '$ReactRefreshModuleId$',\n-    ]),\n-    ');',\n     '',\n-    `if (${webpackHot}) {`,\n+    'function $ReactRefreshModuleRuntime$(exports) {',\n     Template.indent([\n-      `${constDeclaration} $ReactRefreshHotUpdate$ = !!${webpackHot}.data;`,\n-      `${letDeclaration} $ReactRefreshPrevExports$;`,\n-      'if ($ReactRefreshHotUpdate$) {',\n-      Template.indent(`$ReactRefreshPrevExports$ = ${webpackHot}.data.prevExports;`),\n-      '}',\n-      '',\n-      'if (__react_refresh_utils__.isReactRefreshBoundary($ReactRefreshCurrentExports$)) {',\n+      `if (${webpackHot}) {`,\n       Template.indent([\n-        `${webpackHot}.dispose(`,\n-        Template.indent([\n-          '/**',\n-          ' * A callback to performs a full refresh if React has unrecoverable errors,',\n-          ' * and also caches the to-be-disposed module.',\n-          ' * @param {*} data A hot module data object from Webpack HMR.',\n-          ' * @returns {void}',\n-          ' */',\n-          'function hotDisposeCallback(data) {',\n-          Template.indent([\n-            '// We have to mutate the data object to get data registered and cached',\n-            'data.prevExports = $ReactRefreshCurrentExports$;',\n-          ]),\n-          '}',\n-        ]),\n-        ');',\n-        `${webpackHot}.accept(`,\n+        `${letDeclaration} errorOverlay;`,\n+        \"if (typeof __react_refresh_error_overlay__ !== 'undefined') {\",\n+        Template.indent('errorOverlay = __react_refresh_error_overlay__;'),\n+        '}',\n+        `${letDeclaration} testMode;`,\n+        \"if (typeof __react_refresh_test__ !== 'undefined') {\",\n+        Template.indent('testMode = __react_refresh_test__;'),\n+        '}',\n+        'return __react_refresh_utils__.executeRuntime(',\n         Template.indent([\n-          '/**',\n-          ' * An error handler to allow self-recovering behaviours.',\n-          ' * @param {Error} error An error occurred during evaluation of a module.',\n-          ' * @returns {void}',\n-          ' */',\n-          'function hotErrorHandler(error) {',\n-          Template.indent([\n-            'if (',\n-            Template.indent([\n-              \"typeof __react_refresh_error_overlay__ !== 'undefined' &&\",\n-              '__react_refresh_error_overlay__',\n-            ]),\n-            ') {',\n-            Template.indent('__react_refresh_error_overlay__.handleRuntimeError(error);'),\n-            '}',\n-            '',\n-            \"if (typeof __react_refresh_test__ !== 'undefined' && __react_refresh_test__) {\",\n-            Template.indent([\n-              'if (window.onHotAcceptError) {',\n-              Template.indent('  window.onHotAcceptError(error.message);'),\n-              '}',\n-            ]),\n-            '}',\n-            '',\n-            '__webpack_require__.c[$ReactRefreshModuleId$].hot.accept(hotErrorHandler);',\n-          ]),\n-          '}',\n+          'exports,',\n",
					"match": false,
					"packageHash": "18700728adc4f549b282f3bf9aa1797bd74b91e5cbb1b2ce8ffd5d102d5d50db",
					"size": 5547,
					"sourceHash": "eedcf214b9d9bac6fab570cf040a1f3902c4ff6b9653c7fd42a446003aa9e4ab",
					"status": "content"
				},
				"overlay/components/CompileErrorTrace.js": {
					"diff": "--- published/overlay/components/CompileErrorTrace.js\n+++ rebuilt/overlay/components/CompileErrorTrace.js\n@@ -1,9 +1,6 @@\n-import * as ansiHTML from 'ansi-html';\n-import * as entities from 'html-entities';\n-import theme from '../theme.js';\n-import { formatFilename } from '../utils.js';\n-\n-ansiHTML.setColors(theme);\n+const Anser = require('anser');\n+const entities = require('html-entities');\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} CompileErrorTraceProps\n@@ -19,35 +16,57 @@\n  */\n function CompileErrorTrace(document, root, props) {\n   const errorParts = props.errorMessage.split('\\n');\n-  const errorMessage = errorParts\n-    .splice(1, 1)[0]\n-    // Strip filename from the error message\n-    .replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2');\n-  errorParts[0] = formatFilename(errorParts[0]);\n-  errorParts.unshift(errorMessage);\n+  if (errorParts.length) {\n+    if (errorParts[0]) {\n+      errorParts[0] = utils.formatFilename(errorParts[0]);\n+    }\n+\n+    const errorMessage = errorParts.splice(1, 1)[0];\n+    if (errorMessage) {\n+      // Strip filename from the error message\n+      errorParts.unshift(errorMessage.replace(/^(.*:)\\s.*:(\\s.*)$/, '$1$2'));\n+    }\n+  }\n \n   const stackContainer = document.createElement('pre');\n-  stackContainer.innerHTML = entities.decode(\n-    ansiHTML(entities.encode(errorParts.join('\\n'), { level: 'html5', mode: 'nonAscii' })),\n-    { level: 'html5' }\n-  );\n   stackContainer.style.fontFamily = [\n-    '\"Operator Mono SSm\"',\n-    '\"Operator Mono\"',\n-    '\"Fira Code Retina\"',\n-    '\"Fira Code\"',\n-    '\"FiraCode-Retina\"',\n-    '\"Andale Mono\"',\n-    '\"Lucida Console\"',\n-    'Menlo',\n+    '\"SFMono-Regular\"',\n     'Consolas',\n-    'Monaco',\n+    'Liberation Mono',\n+    'Menlo',\n+    'Courier',\n     'monospace',\n   ].join(', ');\n   stackContainer.style.margin = '0';\n   stackContainer.style.whiteSpace = 'pre-wrap';\n \n+  const entries = Anser.ansiToJson(\n+    entities.encode(errorParts.join('\\n'), { level: 'html5', mode: 'nonAscii' }),\n+    {\n+      json: true,\n+      remove_empty: true,\n+      use_classes: true,\n+    }\n+  );\n+  for (let i = 0; i < entries.length; i += 1) {\n+    const entry = entries[i];\n+    const elem = document.createElement('span');\n+    elem.innerHTML = entry.content;\n+    elem.style.color = entry.fg ? `var(--color-${entry.fg})` : undefined;\n+    elem.style.wordBreak = 'break-word';\n+    switch (entry.decoration) {\n+      case 'bold':\n+        elem.style.fontWeight = 800;\n+        break;\n+      case 'italic':\n+        elem.style.fontStyle = 'italic';\n+        break;\n+    }\n+\n+    stackContainer.appendChild(elem);\n+  }\n+\n   root.appendChild(stackContainer);\n }\n \n-export default CompileErrorTrace;\n+module.exports = CompileErrorTrace;\n",
					"match": false,
					"packageHash": "368ea3ef9a0b207ca0795160f3b72a23e9ddc3231ebe629bf4c0bc0938507214",
					"size": 1494,
					"sourceHash": "35f68cee2a98fc157b898879dda6adea2ff7b077a34aba5786a9be7f165aa71d",
					"status": "content"
				},
				"overlay/components/PageHeader.js": {
					"diff": "--- published/overlay/components/PageHeader.js\n+++ rebuilt/overlay/components/PageHeader.js\n@@ -1,5 +1,5 @@\n-import theme from '../theme.js';\n-import Spacer from './Spacer.js';\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} PageHeaderProps\n@@ -17,18 +17,20 @@\n  */\n function PageHeader(document, root, props) {\n   const pageHeaderContainer = document.createElement('div');\n-  pageHeaderContainer.style.background = '#' + theme.dimgrey;\n+  pageHeaderContainer.style.background = theme['dark-background'];\n   pageHeaderContainer.style.boxShadow = '0 1px 4px rgba(0, 0, 0, 0.3)';\n-  pageHeaderContainer.style.color = '#' + theme.white;\n+  pageHeaderContainer.style.color = theme.white;\n   pageHeaderContainer.style.left = '0';\n+  pageHeaderContainer.style.right = '0';\n   pageHeaderContainer.style.padding = '1rem 1.5rem';\n+  pageHeaderContainer.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n+  pageHeaderContainer.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n   pageHeaderContainer.style.position = 'fixed';\n   pageHeaderContainer.style.top = props.topOffset || '0';\n-  pageHeaderContainer.style.width = 'calc(100vw - 3rem)';\n \n   const title = document.createElement('h3');\n   title.innerText = props.title;\n-  title.style.color = '#' + theme.red;\n+  title.style.color = theme.red;\n   title.style.fontSize = '1.125rem';\n   title.style.lineHeight = '1.3';\n   title.style.margin = '0';\n@@ -39,7 +41,7 @@\n \n     const message = document.createElement('span');\n     message.innerText = props.message;\n-    message.style.color = '#' + theme.white;\n+    message.style.color = theme.white;\n     message.style.wordBreak = 'break-word';\n     pageHeaderContainer.appendChild(message);\n   }\n@@ -53,4 +55,4 @@\n   });\n }\n \n-export default PageHeader;\n+module.exports = PageHeader;\n",
					"match": false,
					"packageHash": "c531cbb02144123259ffff8a6327bfc3f942360d949c648a9453cacbe1c9f418",
					"size": 1729,
					"sourceHash": "3f6789599619d258ea6682cb428770ede8bcb25b97b6446a32ca2e8bad9c9f7f",
					"status": "content"
				},
				"overlay/components/RuntimeErrorFooter.js": {
					"diff": "--- published/overlay/components/RuntimeErrorFooter.js\n+++ rebuilt/overlay/components/RuntimeErrorFooter.js\n@@ -1,5 +1,5 @@\n-import theme from '../theme.js';\n-import Spacer from './Spacer.js';\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} RuntimeErrorFooterProps\n@@ -19,15 +19,17 @@\n  */\n function RuntimeErrorFooter(document, root, props) {\n   const footer = document.createElement('div');\n-  footer.style.backgroundColor = '#' + theme.dimgrey;\n+  footer.style.backgroundColor = theme['dark-background'];\n   footer.style.bottom = '0';\n   footer.style.boxShadow = '0 -1px 4px rgba(0, 0, 0, 0.3)';\n   footer.style.height = '2.5rem';\n   footer.style.left = '0';\n+  footer.style.right = '0';\n   footer.style.lineHeight = '2.5rem';\n+  footer.style.paddingBottom = '0';\n+  footer.style.paddingBottom = 'env(safe-area-inset-bottom)';\n   footer.style.position = 'fixed';\n   footer.style.textAlign = 'center';\n-  footer.style.width = '100vw';\n   footer.style.zIndex = '2';\n \n   const BUTTON_CONFIGS = {\n@@ -62,14 +64,14 @@\n     button.id = buttonConfig.id;\n     button.innerHTML = buttonConfig.label;\n     button.tabIndex = 1;\n-    button.style.backgroundColor = '#' + theme.dimgrey;\n+    button.style.backgroundColor = theme['dark-background'];\n     button.style.border = 'none';\n-    button.style.color = '#' + theme.white;\n+    button.style.color = theme.white;\n     button.style.cursor = 'pointer';\n     button.style.fontSize = 'inherit';\n     button.style.height = '100%';\n     button.style.padding = '0.5rem 0.75rem';\n-    button.style.width = (100 / buttons.length).toString(10) + '%';\n+    button.style.width = `${(100 / buttons.length).toString(10)}%`;\n     button.addEventListener('click', buttonConfig.onClick);\n \n     if (buttonConfig.id === props.initialFocus) {\n@@ -88,4 +90,4 @@\n   }\n }\n \n-export default RuntimeErrorFooter;\n+module.exports = RuntimeErrorFooter;\n",
					"match": false,
					"packageHash": "f1cb2c04d0a1740955d105a315f8b2063a71a73d217661065fadbbf523b2aa57",
					"size": 2583,
					"sourceHash": "f9547afa949e5c155c0726d916f135e2ea316f77da539373c1a3e61d9296bc77",
					"status": "content"
				},
				"overlay/components/RuntimeErrorHeader.js": {
					"diff": "--- published/overlay/components/RuntimeErrorHeader.js\n+++ rebuilt/overlay/components/RuntimeErrorHeader.js\n@@ -1,5 +1,5 @@\n-import theme from '../theme.js';\n-import Spacer from './Spacer.js';\n+const Spacer = require('./Spacer.js');\n+const theme = require('../theme.js');\n \n /**\n  * @typedef {Object} RuntimeErrorHeaderProps\n@@ -16,9 +16,9 @@\n  */\n function RuntimeErrorHeader(document, root, props) {\n   const header = document.createElement('div');\n-  header.innerText = 'Error ' + (props.currentErrorIndex + 1) + ' of ' + props.totalErrors;\n-  header.style.backgroundColor = '#' + theme.red;\n-  header.style.color = '#' + theme.white;\n+  header.innerText = `Error ${props.currentErrorIndex + 1} of ${props.totalErrors}`;\n+  header.style.backgroundColor = theme.red;\n+  header.style.color = theme.white;\n   header.style.fontWeight = '500';\n   header.style.height = '2.5rem';\n   header.style.left = '0';\n@@ -34,4 +34,4 @@\n   Spacer(document, root, { space: '2.5rem' });\n }\n \n-export default RuntimeErrorHeader;\n+module.exports = RuntimeErrorHeader;\n",
					"match": false,
					"packageHash": "16fb3016b97b8514702cfda4b5a41e74282cdd522bd19ea17b2df03cba80535b",
					"size": 1077,
					"sourceHash": "22b1c504587105d823560bf9266e875e83e7595c8ec4abde300871c89f07393d",
					"status": "content"
				},
				"overlay/components/RuntimeErrorStack.js": {
					"diff": "--- published/overlay/components/RuntimeErrorStack.js\n+++ rebuilt/overlay/components/RuntimeErrorStack.js\n@@ -1,6 +1,6 @@\n-import * as ErrorStackParser from 'error-stack-parser';\n-import theme from '../theme.js';\n-import { formatFilename } from '../utils.js';\n+const ErrorStackParser = require('error-stack-parser');\n+const theme = require('../theme.js');\n+const utils = require('../utils.js');\n \n /**\n  * @typedef {Object} RuntimeErrorStackProps\n@@ -17,7 +17,7 @@\n function RuntimeErrorStack(document, root, props) {\n   const stackTitle = document.createElement('h4');\n   stackTitle.innerText = 'Call Stack';\n-  stackTitle.style.color = '#' + theme.white;\n+  stackTitle.style.color = theme.white;\n   stackTitle.style.fontSize = '1.0625rem';\n   stackTitle.style.fontWeight = '500';\n   stackTitle.style.lineHeight = '1.3';\n@@ -40,31 +40,26 @@\n     const currentStack = errorStacks[i];\n \n     const functionName = document.createElement('code');\n-    functionName.innerHTML = '&emsp;' + currentStack.functionName || '(anonymous function)';\n-    functionName.style.color = '#' + theme.yellow;\n+    functionName.innerHTML = `&emsp;${currentStack.functionName || '(anonymous function)'}`;\n+    functionName.style.color = theme.yellow;\n     functionName.style.fontFamily = [\n-      '\"Operator Mono SSm\"',\n-      '\"Operator Mono\"',\n-      '\"Fira Code Retina\"',\n-      '\"Fira Code\"',\n-      '\"FiraCode-Retina\"',\n-      '\"Andale Mono\"',\n-      '\"Lucida Console\"',\n-      'Menlo',\n+      '\"SFMono-Regular\"',\n       'Consolas',\n-      'Monaco',\n+      'Liberation Mono',\n+      'Menlo',\n+      'Courier',\n       'monospace',\n     ].join(', ');\n \n     const fileName = document.createElement('div');\n     fileName.innerHTML =\n       '&emsp;&emsp;' +\n-      formatFilename(currentStack.fileName) +\n+      utils.formatFilename(currentStack.fileName) +\n       ':' +\n       currentStack.lineNumber +\n       ':' +\n       currentStack.columnNumber;\n-    fileName.style.color = '#' + theme.white;\n+    fileName.style.color = theme.white;\n     fileName.style.fontSize = '0.6875rem';\n     fileName.style.marginBottom = '0.25rem';\n \n@@ -76,4 +71,4 @@\n   root.appendChild(stackContainer);\n }\n \n-export default RuntimeErrorStack;\n+module.exports = RuntimeErrorStack;\n",
					"match": false,
					"packageHash": "c494af64fc1105e5721d991a02cdc7a1181381125c40bda0e10ffb50ca7b7fef",
					"size": 2351,
					"sourceHash": "df582e1eba351f892a3523ce1410c6762c21134f5da2e2653de66516869e92d8",
					"status": "content"
				},
				"overlay/components/Spacer.js": {
					"diff": "--- published/overlay/components/Spacer.js\n+++ rebuilt/overlay/components/Spacer.js\n@@ -16,4 +16,4 @@\n   root.appendChild(spacer);\n }\n \n-export default Spacer;\n+module.exports = Spacer;\n",
					"match": false,
					"packageHash": "d8d5bf961723fb94f4f3289a43c340a5e6c01fce525c9c10c3b843a663b3498d",
					"size": 418,
					"sourceHash": "c866e92c15570f85685da97f48e8245da98d4a89a65937fa2fcce9bb174bbcdf",
					"status": "content"
				},
				"overlay/containers/CompileErrorContainer.js": {
					"diff": "--- published/overlay/containers/CompileErrorContainer.js\n+++ rebuilt/overlay/containers/CompileErrorContainer.js\n@@ -1,6 +1,6 @@\n-import CompileErrorTrace from '../components/CompileErrorTrace.js';\n-import PageHeader from '../components/PageHeader.js';\n-import Spacer from '../components/Spacer.js';\n+const CompileErrorTrace = require('../components/CompileErrorTrace.js');\n+const PageHeader = require('../components/PageHeader.js');\n+const Spacer = require('../components/Spacer.js');\n \n /**\n  * @typedef {Object} CompileErrorContainerProps\n@@ -22,4 +22,4 @@\n   Spacer(document, root, { space: '1rem' });\n }\n \n-export default CompileErrorContainer;\n+module.exports = CompileErrorContainer;\n",
					"match": false,
					"packageHash": "def7b6d22047bcce00c9d7fca2f272e1f5d065015bfeb30924c06a10cfe92d73",
					"size": 758,
					"sourceHash": "5d504595ba46184a618931f0e59573532e51dbf220594a59b1329774a736cbac",
					"status": "content"
				},
				"overlay/containers/RuntimeErrorContainer.js": {
					"diff": "--- published/overlay/containers/RuntimeErrorContainer.js\n+++ rebuilt/overlay/containers/RuntimeErrorContainer.js\n@@ -1,6 +1,6 @@\n-import PageHeader from '../components/PageHeader.js';\n-import RuntimeErrorStack from '../components/RuntimeErrorStack.js';\n-import Spacer from '../components/Spacer.js';\n+const PageHeader = require('../components/PageHeader.js');\n+const RuntimeErrorStack = require('../components/RuntimeErrorStack.js');\n+const Spacer = require('../components/Spacer.js');\n \n /**\n  * @typedef {Object} RuntimeErrorContainerProps\n@@ -26,4 +26,4 @@\n   Spacer(document, root, { space: '1rem' });\n }\n \n-export default RuntimeErrorContainer;\n+module.exports = RuntimeErrorContainer;\n",
					"match": false,
					"packageHash": "2b7e9e815a3467a8970da340ee9049f4cbd1174d1df4e26ced5ef22354b65dcc",
					"size": 813,
					"sourceHash": "1da739245a306e3319b0684b08b133a6293757efab44412231085f88d308868d",
					"status": "content"
				},
				"overlay/index.js": {
					"diff": "--- published/overlay/index.js\n+++ rebuilt/overlay/index.js\n@@ -1,9 +1,9 @@\n-import RuntimeErrorFooter from './components/RuntimeErrorFooter.js';\n-import RuntimeErrorHeader from './components/RuntimeErrorHeader.js';\n-import CompileErrorContainer from './containers/CompileErrorContainer.js';\n-import RuntimeErrorContainer from './containers/RuntimeErrorContainer.js';\n-import theme from './theme.js';\n-import { debounce, removeAllChildren } from './utils.js';\n+const RuntimeErrorFooter = require('./components/RuntimeErrorFooter.js');\n+const RuntimeErrorHeader = require('./components/RuntimeErrorHeader.js');\n+const CompileErrorContainer = require('./containers/CompileErrorContainer.js');\n+const RuntimeErrorContainer = require('./containers/RuntimeErrorContainer.js');\n+const theme = require('./theme.js');\n+const utils = require('./utils.js');\n \n /**\n  * @callback RenderFn\n@@ -73,8 +73,10 @@\n   iframe.src = 'about:blank';\n \n   iframe.style.border = 'none';\n-  iframe.style.height = '100vh';\n+  iframe.style.height = '100%';\n   iframe.style.left = '0';\n+  iframe.style.minHeight = '100vh';\n+  iframe.style.minHeight = '-webkit-fill-available';\n   iframe.style.position = 'fixed';\n   iframe.style.top = '0';\n   iframe.style.width = '100vw';\n@@ -100,27 +102,41 @@\n   const div = document.createElement('div');\n   div.id = 'react-refresh-overlay-error';\n \n+  // Apply ANSI theme\n+  div.style.setProperty('--color-ansi-selection', theme.selection);\n+  div.style.setProperty('--color-ansi-bg', theme.background);\n+  div.style.setProperty('--color-ansi-fg', theme.white);\n+  div.style.setProperty('--color-ansi-white', theme.white);\n+  div.style.setProperty('--color-ansi-black', theme.black);\n+  div.style.setProperty('--color-ansi-blue', theme.blue);\n+  div.style.setProperty('--color-ansi-cyan', theme.cyan);\n+  div.style.setProperty('--color-ansi-green', theme.green);\n+  div.style.setProperty('--color-ansi-magenta', theme.magenta);\n+  div.style.setProperty('--color-ansi-red', theme.red);\n+  div.style.setProperty('--color-ansi-yellow', theme.yellow);\n+  div.style.setProperty('--color-ansi-bright-white', theme['bright-white']);\n+  div.style.setProperty('--color-ansi-bright-black', theme['bright-black']);\n+  div.style.setProperty('--color-ansi-bright-blue', theme['bright-blue']);\n+  div.style.setProperty('--color-ansi-bright-cyan', theme['bright-cyan']);\n+  div.style.setProperty('--color-ansi-bright-green', theme['bright-green']);\n+  div.style.setProperty('--color-ansi-bright-magenta', theme['bright-magenta']);\n+  div.style.setProperty('--color-ansi-bright-red', theme['bright-red']);\n+  div.style.setProperty('--color-ansi-bright-yellow', theme['bright-yellow']);\n+\n   // Style the contents container\n-  div.style.backgroundColor = '#' + theme.grey;\n+  div.style.backgroundColor = theme.background;\n   div.style.boxSizing = 'border-box';\n-  div.style.color = '#' + theme.white;\n-  div.style.fontFamily = [\n-    '-apple-system',\n-    'BlinkMacSystemFont',\n-    '\"Segoe UI\"',\n-    '\"Helvetica Neue\"',\n-    'Helvetica',\n-    'Arial',\n-    'sans-serif',\n-    '\"Apple Color Emoji\"',\n-    '\"Segoe UI Emoji\"',\n-    'Segoe UI Symbol',\n-  ].join(', ');\n+  div.style.color = theme.white;\n+  div.style.fontFamily = ['-apple-system', '\"Source Sans Pro\"', 'sans-serif'].join(', ');\n   div.style.fontSize = '0.875rem';\n-  div.style.height = '100vh';\n+  div.style.height = '100%';\n   div.style.lineHeight = '1.3';\n   div.style.overflow = 'auto';\n   div.style.padding = '1rem 1.5rem 0';\n+  div.style.paddingTop = 'max(1rem, env(safe-area-inset-top))';\n+  div.style.paddingRight = 'max(1.5rem, env(safe-area-inset-right))';\n+  div.style.paddingBottom = 'env(safe-area-inset-bottom)';\n+  div.style.paddingLeft = 'max(1.5rem, env(safe-area-inset-left))';\n   div.style.width = '100vw';\n \n   root.appendChild(div);\n@@ -176,7 +192,7 @@\n       currentFocusId = currentFocus.id;\n     }\n \n-    removeAllChildren(root);\n+    utils.removeAllChildren(root);\n \n     if (currentCompileErrorMessage) {\n       currentMode = 'compileError';\n@@ -235,7 +251,7 @@\n  * Clears Webpack compilation errors and dismisses the compile error overlay.\n  * @returns {void}\n  */\n",
					"match": false,
					"packageHash": "105a69cda3c8bac2907c463d930933d8bb155653c7892972d20b00b70fc2957b",
					"size": 8765,
					"sourceHash": "7fa8e14caaef770ae25cd84b2c5ee73d94e05bbb799ab8d752a0943df65d1278",
					"status": "content"
				},
				"overlay/theme.js": {
					"diff": "--- published/overlay/theme.js\n+++ rebuilt/overlay/theme.js\n@@ -1,14 +1,21 @@\n /**\n  * @typedef {Object} Theme\n- * @property {string[]} reset\n  * @property {string} black\n+ * @property {string} bright-black\n  * @property {string} red\n+ * @property {string} bright-red\n  * @property {string} green\n+ * @property {string} bright-green\n  * @property {string} yellow\n+ * @property {string} bright-yellow\n  * @property {string} blue\n+ * @property {string} bright-blue\n  * @property {string} magenta\n+ * @property {string} bright-magenta\n  * @property {string} cyan\n+ * @property {string} bright-cyan\n  * @property {string} white\n+ * @property {string} bright-white\n  * @property {string} lightgrey\n  * @property {string} darkgrey\n  * @property {string} grey\n@@ -21,19 +28,25 @@\n  * Partially adopted from Tomorrow Night Bright.\n  */\n const theme = {\n-  reset: ['transparent', 'transparent'],\n-  black: '000000',\n-  red: 'D34F56',\n-  green: 'B9C954',\n-  yellow: 'E6C452',\n-  blue: '7CA7D8',\n-  magenta: 'C299D6',\n-  cyan: '73BFB1',\n-  white: 'FFFFFF',\n-  lightgrey: 'C7C7C7',\n-  darkgrey: 'A9A9A9',\n-  grey: '474747',\n-  dimgrey: '343434',\n+  black: '#000000',\n+  'bright-black': '#474747',\n+  red: '#D34F56',\n+  'bright-red': '#dd787d',\n+  green: '#B9C954',\n+  'bright-green': '#c9d57b',\n+  yellow: '#E6C452',\n+  'bright-yellow': '#ecd37f',\n+  blue: '#7CA7D8',\n+  'bright-blue': '#a3c1e4',\n+  magenta: '#C299D6',\n+  'bright-magenta': '#d8bde5',\n+  cyan: '#73BFB1',\n+  'bright-cyan': '#96cfc5',\n+  white: '#FFFFFF',\n+  'bright-white': '#FFFFFF',\n+  background: '#474747',\n+  'dark-background': '#343434',\n+  selection: 'rgba(234, 234, 234, 0.5)',\n };\n \n-export default theme;\n+module.exports = theme;\n",
					"match": false,
					"packageHash": "2778e531f4e264cab26605a0aa53d674128e4d41bb3d11477cf751071b870725",
					"size": 860,
					"sourceHash": "41d942efc4a6d3dc88883515dbc16f607269a49125ca29f06b92bbb66655cf46",
					"status": "content"
				},
				"overlay/utils.js": {
					"diff": "--- published/overlay/utils.js\n+++ rebuilt/overlay/utils.js\n@@ -4,7 +4,7 @@\n  * @param {number} wait Milliseconds to wait before invoking again.\n  * @return {function(...*): void} The debounced function.\n  */\n-export function debounce(fn, wait) {\n+function debounce(fn, wait) {\n   /**\n    * A cached setTimeout handler.\n    * @type {number | undefined}\n@@ -32,7 +32,7 @@\n  * @param {string} filename The filename to be formatted.\n  * @returns {string} The formatted filename.\n  */\n-export function formatFilename(filename) {\n+function formatFilename(filename) {\n   // Strip away protocol and domain for compiled files\n   const htmlMatch = /^https?:\\/\\/(.*)\\/(.*)/.exec(filename);\n   if (htmlMatch && htmlMatch[1] && htmlMatch[2]) {\n@@ -55,7 +55,7 @@\n  * @param {number} [skip] Number of elements to skip removing.\n  * @returns {void}\n  */\n-export function removeAllChildren(element, skip) {\n+function removeAllChildren(element, skip) {\n   /** @type {Node[]} */\n   const childList = Array.prototype.slice.call(\n     element.childNodes,\n@@ -66,3 +66,9 @@\n     element.removeChild(childList[i]);\n   }\n }\n+\n+module.exports = {\n+  debounce: debounce,\n+  formatFilename: formatFilename,\n+  removeAllChildren: removeAllChildren,\n+};\n",
					"match": false,
					"packageHash": "ee19bee7b30bf3bbd87f2663223f12aa6922726180c41956f5ab76f7df523a9b",
					"size": 1850,
					"sourceHash": "fded582c13b439df8cc7cdf2389c49f80f284f303c52b1ddf4a019e657257c6a",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"@pmmmwh/react-refresh-webpack-plugin\",\n-  \"version\": \"0.5.0-beta.5\",\n+  \"version\": \"0.6.2\",\n   \"description\": \"An **EXPERIMENTAL** Webpack plugin to enable \\\"Fast Refresh\\\" (also previously known as _Hot Reloading_) for React components.\",\n   \"keywords\": [\n     \"react\",\n@@ -34,83 +34,91 @@\n     \"options\",\n     \"overlay\",\n     \"sockets\",\n-    \"types\"\n+    \"types\",\n+    \"umd\"\n   ],\n+  \"packageManager\": \"yarn@1.22.22+sha1.ac34549e6aa8e7ead463a7407e1c7390f61a6610\",\n   \"scripts\": {\n-    \"pretest\": \"yarn link && yarn link \\\"@pmmmwh/react-refresh-webpack-plugin\\\"\",\n-    \"posttest\": \"yarn unlink \\\"@pmmmwh/react-refresh-webpack-plugin\\\"\",\n-    \"test\": \"node scripts/test.js\",\n-    \"test:webpack-5\": \"WEBPACK_VERSION=5 yarn test\",\n-    \"lint\": \"eslint --report-unused-disable-directives --ext .js .\",\n+    \"test\": \"run-s -c test:pre \\\"test:exec {@}\\\" test:post --\",\n+    \"test:wds-4\": \"cross-env WDS_VERSION=4 yarn test\",\n+    \"test:exec\": \"node --experimental-vm-modules scripts/test.js\",\n+    \"test:pre\": \"run-s -c test:pre:*\",\n+    \"test:pre:0\": \"yarn link\",\n+    \"test:pre:1\": \"yarn link @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post\": \"run-s -c test:post:*\",\n+    \"test:post:0\": \"yarn unlink @pmmmwh/react-refresh-webpack-plugin\",\n+    \"test:post:1\": \"yarn unlink\",\n+    \"lint\": \"eslint --report-unused-disable-directives --ext .js,.jsx .\",\n     \"lint:fix\": \"yarn lint --fix\",\n     \"format\": \"prettier --write \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n     \"format:check\": \"prettier --check \\\"**/*.{js,jsx,ts,tsx,json,md}\\\"\",\n-    \"generate-types\": \"tsc -p tsconfig.json && yarn prune-private-types && yarn format --loglevel silent\",\n-    \"prune-private-types\": \"del \\\"types/*/*\\\" \\\"!types/{lib,loader,options}/{index,types}.d.ts\\\"\",\n-    \"prepublishOnly\": \"rimraf types && yarn generate-types\"\n+    \"types:clean\": \"del types\",\n+    \"types:compile\": \"tsc\",\n+    \"types:prune-private\": \"del \\\"types/*/*\\\" \\\"!types/{lib,loader,options}/{index,types}.d.ts\\\"\",\n+    \"generate:client-external\": \"webpack\",\n+    \"generate:types\": \"run-s types:clean types:compile types:prune-private \\\"format --log-level=silent\\\"\",\n+    \"prepublishOnly\": \"run-p generate:*\"\n   },\n   \"dependencies\": {\n-    \"ansi-html\": \"^0.0.7\",\n-    \"core-js-pure\": \"^3.8.1\",\n+    \"anser\": \"^2.1.1\",\n+    \"core-js-pure\": \"^3.23.3\",\n     \"error-stack-parser\": \"^2.0.6\",\n     \"html-entities\": \"^2.1.0\",\n-    \"loader-utils\": \"^2.0.0\",\n-    \"native-url\": \"^0.3.4\",\n-    \"schema-utils\": \"^3.0.0\",\n+    \"schema-utils\": \"^4.2.0\",\n     \"source-map\": \"^0.7.3\"\n   },\n   \"devDependencies\": {\n-    \"@babel/core\": \"^7.13.14\",\n-    \"@babel/plugin-transform-modules-commonjs\": \"^7.13.8\",\n-    \"@types/cross-spawn\": \"^6.0.2\",\n-    \"@types/fs-extra\": \"^9.0.4\",\n-    \"@types/jest\": \"^26.0.15\",\n-    \"@types/json-schema\": \"^7.0.6\",\n-    \"@types/module-alias\": \"^2.0.0\",\n-    \"@types/node\": \"^14.11.1\",\n-    \"@types/puppeteer\": \"^5.4.0\",\n-    \"@types/webpack\": \"^4.41.22\",\n-    \"babel-jest\": \"^26.6.3\",\n-    \"babel-loader\": \"^8.1.0\",\n-    \"cross-spawn\": \"^7.0.3\",\n-    \"del-cli\": \"^3.0.1\",\n-    \"eslint\": \"^7.9.0\",\n-    \"eslint-config-prettier\": \"^8.1.0\",\n-    \"eslint-plugin-prettier\": \"^3.3.1\",\n-    \"fs-extra\": \"^9.0.1\",\n-    \"get-port\": \"^5.1.1\",\n-    \"jest\": \"^26.4.2\",\n-    \"jest-circus\": \"^26.4.2\",\n-    \"jest-environment-node\": \"^26.3.0\",\n-    \"jest-junit\": \"^12.0.0\",\n-    \"jest-watch-typeahead\": \"^0.6.1\",\n-    \"memfs\": \"^3.2.0\",\n-    \"module-alias\": \"^2.2.2\",\n-    \"nanoid\": \"^3.1.12\",\n-    \"prettier\": \"^2.1.2\",\n-    \"puppeteer\": \"^8.0.0\",\n-    \"react-refresh\": \"^0.10.0\",\n+    \"@babel/core\": \"^7.24.6\",\n+    \"@babel/plugin-transform-modules-commonjs\": \"^7.24.6\",\n+    \"@types/cross-spawn\": \"^6.0.6\",\n+    \"@types/fs-extra\": \"^11.0.4\",\n+    \"@types/jest\": \"^29.5.12\",\n+    \"@types/json-schema\": \"^7.0.15\",\n+    \"@types/module-alias\": \"^2.0.4\",\n+    \"@types/node\": \"^24.10.1\",\n",
					"match": false,
					"packageHash": "49264e0fd3526d7d905d75005703529ef3a130983578b42fdf192251034a379b",
					"size": 4079,
					"sourceHash": "2acd42464a99db90ad3e72e7a40e8adbca15365d4473c19d1a6910ab1cfd9b6e",
					"status": "content"
				},
				"sockets/WDSSocket.js": {
					"diff": "--- published/sockets/WDSSocket.js\n+++ rebuilt/sockets/WDSSocket.js\n@@ -1,26 +1,26 @@\n-/* global __webpack_dev_server_client__ */\n-\n-import * as url from 'native-url';\n-import getSocketUrlParts from './utils/getSocketUrlParts.js';\n-\n /**\n  * Initializes a socket server for HMR for webpack-dev-server.\n  * @param {function(*): void} messageHandler A handler to consume Webpack compilation messages.\n- * @param {string} [resourceQuery] Webpack's `__resourceQuery` string.\n  * @returns {void}\n  */\n-function initWDSSocket(messageHandler, resourceQuery) {\n-  if (typeof __webpack_dev_server_client__ !== 'undefined') {\n-    const SocketClient = __webpack_dev_server_client__;\n+function initWDSSocket(messageHandler) {\n+  const { default: SockJSClient } = require('webpack-dev-server/client/clients/SockJSClient');\n+  const { default: WebSocketClient } = require('webpack-dev-server/client/clients/WebSocketClient');\n+  const { client } = require('webpack-dev-server/client/socket');\n \n-    const urlParts = getSocketUrlParts(resourceQuery);\n-    const connection = new SocketClient(url.format(urlParts));\n-\n-    connection.onMessage(function onSocketMessage(data) {\n-      const message = JSON.parse(data);\n-      messageHandler(message);\n-    });\n+  /** @type {WebSocket} */\n+  let connection;\n+  if (client instanceof SockJSClient) {\n+    connection = client.sock;\n+  } else if (client instanceof WebSocketClient) {\n+    connection = client.client;\n+  } else {\n+    throw new Error('Failed to determine WDS client type');\n   }\n+\n+  connection.addEventListener('message', function onSocketMessage(message) {\n+    messageHandler(JSON.parse(message.data));\n+  });\n }\n \n-export const init = initWDSSocket;\n+module.exports = { init: initWDSSocket };\n",
					"match": false,
					"packageHash": "b92f8b970bf75b938422f037867cab50c30ff81d4af36e2ce60dffdd03377da0",
					"size": 872,
					"sourceHash": "ced8ec207c9ed52a39a6c8c78742cdb4aad5b51fda4d2ac3bd2416ef560cda2e",
					"status": "content"
				},
				"sockets/WHMEventSource.js": {
					"diff": "--- published/sockets/WHMEventSource.js\n+++ rebuilt/sockets/WHMEventSource.js\n@@ -28,4 +28,4 @@\n   });\n }\n \n-export const init = initWHMEventSource;\n+module.exports = { init: initWHMEventSource };\n",
					"match": false,
					"packageHash": "0e611ace51f449f066a0cc95d9dfacdce745499e32b43d0f815469ba9c51acf6",
					"size": 869,
					"sourceHash": "6f1b23673dc918c81b8c096970f961a7804d65265d9773c7ef83a5808ee843ac",
					"status": "content"
				},
				"sockets/WPSSocket.js": {
					"diff": "--- published/sockets/WPSSocket.js\n+++ rebuilt/sockets/WPSSocket.js\n@@ -1,5 +1,5 @@\n /* global oss */\n-import { ClientSocket } from 'webpack-plugin-serve/lib/client/ClientSocket.js';\n+const { ClientSocket } = require('webpack-plugin-serve/lib/client/ClientSocket');\n \n /**\n  * Initializes a socket server for HMR for webpack-plugin-serve.\n@@ -48,4 +48,4 @@\n   });\n }\n \n-export const init = initWPSSocket;\n+module.exports = { init: initWPSSocket };\n",
					"match": false,
					"packageHash": "3dbf6038af05f3c53cc836800988380c534aa539af4b5bfff2db9d73167522e7",
					"size": 1534,
					"sourceHash": "c2f6cee37905a577670ce4828d243770db551cb7383c368b46423362e946d510",
					"status": "content"
				},
				"sockets/utils/getCurrentScriptSource.js": {
					"match": false,
					"packageHash": "e86916ed212ad346bd9d32b798f0d25d7a01ebd3ae55da968c0593b52d4e2931",
					"size": 834,
					"status": "missing-in-source"
				},
				"sockets/utils/getSocketUrlParts.js": {
					"match": false,
					"packageHash": "2dd056dbbfdcf3fe34e65a3b42fcab3371008a71b35d32b9eeca145576ac135f",
					"size": 3850,
					"status": "missing-in-source"
				},
				"sockets/utils/parseQuery.js": {
					"match": false,
					"packageHash": "f0e73a2d262b7544c9118b20a7c11b1664f6124228ac96a81c20995fe476fc67",
					"size": 817,
					"status": "missing-in-source"
				},
				"types/lib/types.d.ts": {
					"diff": "--- published/types/lib/types.d.ts\n+++ rebuilt/types/lib/types.d.ts\n@@ -8,35 +8,11 @@\n    */\n   module?: string | false | undefined;\n   /**\n-   * The socket host to use (WDS only).\n-   */\n-  sockHost?: string | undefined;\n-  /**\n    * Path to a JS file that sets up the Webpack socket integration.\n    */\n   sockIntegration?:\n     | import('type-fest').LiteralUnion<false | 'wds' | 'whm' | 'wps', string>\n     | undefined;\n-  /**\n-   * The socket path to use (WDS only).\n-   */\n-  sockPath?: string | undefined;\n-  /**\n-   * The socket port to use (WDS only).\n-   */\n-  sockPort?: number | undefined;\n-  /**\n-   * The socket protocol to use (WDS only).\n-   */\n-  sockProtocol?: 'http' | 'https' | 'ws' | 'wss' | undefined;\n-  /**\n-   * Uses a custom SocketJS implementation for older versions of WDS.\n-   */\n-  useLegacyWDSSockets?: boolean | undefined;\n-  /**\n-   * Uses a polyfill for the DOM URL API (WDS only).\n-   */\n-  useURLPolyfill?: boolean | undefined;\n };\n export type NormalizedErrorOverlayOptions = import('type-fest').SetRequired<\n   ErrorOverlayOptions,\n",
					"match": false,
					"packageHash": "e9b5225e09319d42352c2ed3137e4324b0043175c65dc1a435e5f5a29881ac74",
					"size": 2276,
					"sourceHash": "c84c3bfce9304bea6a821cbc07af14ab757d0250ecd1e15a641db305583102f1",
					"status": "content"
				},
				"types/loader/index.d.ts": {
					"diff": "--- published/types/loader/index.d.ts\n+++ rebuilt/types/loader/index.d.ts\n@@ -3,13 +3,14 @@\n  * A simple Webpack loader to inject react-refresh HMR code into modules.\n  *\n  * [Reference for Loader API](https://webpack.js.org/api/loaders/)\n- * @this {import('webpack').loader.LoaderContext}\n+ * @this {import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>}\n  * @param {string} source The original module source code.\n  * @param {import('source-map').RawSourceMap} [inputSourceMap] The source map of the module.\n  * @param {*} [meta] The loader metadata passed in.\n  * @returns {void}\n  */\n declare function ReactRefreshLoader(\n+  this: import('webpack').LoaderContext<import('./types').ReactRefreshLoaderOptions>,\n   source: string,\n   inputSourceMap?: import('source-map').RawSourceMap | undefined,\n   meta?: any\n",
					"match": false,
					"packageHash": "f43744906b876d5a8d88e4ef10c9ce921c78e11302a7a1cb7d7aa25a80451d26",
					"size": 597,
					"sourceHash": "f42721c494b83def355baf6d24287351d733dc3ef87e951a1f49d76fbbb4d72b",
					"status": "content"
				},
				"client/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"client/utils/retry.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/utils/getIntegrationEntry.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/utils/makeRefreshRuntimeModule.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"overlay/package.json": {
					"match": false,
					"status": "missing-in-package"
				},
				"sockets/package.json": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 35,
				"matchingFiles": 10,
				"missingInPackage": 6,
				"missingInSource": 10,
				"score": 0.16393442622950818,
				"totalFiles": 61
			}
		}
	}
]
