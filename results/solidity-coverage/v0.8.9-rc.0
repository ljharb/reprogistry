[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-05T13:03:20.515Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:8.11.0",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "solidity-coverage@0.8.9-rc.0",
			"name": "solidity-coverage",
			"version": "0.8.9-rc.0",
			"location": "https://registry.npmjs.org/solidity-coverage/-/solidity-coverage-0.8.9-rc.0.tgz",
			"integrity": "sha512-p/OxSMCPHz1fn7eZ4cTmkpN3xWGG80yratBO7kOJVL4hI8asDR54N+9aBbke0/ES/j5yvLCBadlyYEj8TcsF9A==",
			"publishedAt": "2024-02-25T23:16:47.909Z",
			"publishedWith": {
				"node": "17.9.1",
				"npm": "8.11.0"
			}
		},
		"source": {
			"integrity": null,
			"location": "git+https://github.com/sc-forks/solidity-coverage.git",
			"spec": "github:sc-forks/solidity-coverage#1816f49581a3466be6188118f4d303e7eb1954de"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				"CHANGELOG.md": {
					"diff": "--- published/CHANGELOG.md\n+++ rebuilt/CHANGELOG.md\n@@ -1,5 +1,18 @@\n # Changelog\n \n+0.8.11 / 2024-03-07\n+===================\n+  * Check all SWAP opcodes for inst. hashes when viaIR is true (https://github.com/sc-forks/solidity-coverage/issues/873)\n+\n+0.8.10 / 2024-02-29\n+===================\n+  * Check all PUSH opcodes for instr. hashes when viaIR is true (https://github.com/sc-forks/solidity-coverage/issues/871)\n+\n+0.8.9 / 2024-02-27\n+==================\n+  * Fix duplicate hash logic (https://github.com/sc-forks/solidity-coverage/issues/868)\n+  * Improve organization of edge case code in collector (https://github.com/sc-forks/solidity-coverage/issues/869)\n+\n 0.8.8 / 2024-02-21\n ==================\n   * Coerce sources path to absolute path if necessary (https://github.com/sc-forks/solidity-coverage/issues/866)\n@@ -50,7 +63,7 @@\n   * Update contributor list (https://github.com/sc-forks/solidity-coverage/issues/812)\n   * Add dependabot config (https://github.com/sc-forks/solidity-coverage/issues/759)\n   * Add a package description to package.json (https://github.com/sc-forks/solidity-coverage/issues/775)\n-  * change .solcoverjs occurencies to .solcover.js (https://github.com/sc-forks/solidity-coverage/issues/777)\n+  * change .solcoverjs occurrences to .solcover.js (https://github.com/sc-forks/solidity-coverage/issues/777)\n   * Remove all mentions to buidler (https://github.com/sc-forks/solidity-coverage/issues/778)\n   * Update HH dev dep & fix Zeppelin E2E test (https://github.com/sc-forks/solidity-coverage/issues/811)\n   * Update mocha version to 10.2.0, fix deprecated debug package (https://github.com/sc-forks/solidity-coverage/issues/810)\n@@ -340,7 +353,7 @@\n 0.4.0 / 2017-11-08 (Compatible with testrpc >= 6.0 / pragma 0.4.18 and above)\n ==================\n \n-  * Bug fix to accomodate strict enforcement of constant and view modifiers in pragma 0.4.18\n+  * Bug fix to accommodate strict enforcement of constant and view modifiers in pragma 0.4.18\n \n 0.3.5 / 2017-11-07 (Compatible with testrpc >= 6.0 / pragma 0.4.17 and below)\n ==================\n",
					"match": false,
					"packageHash": "468a28f25a818876e8fdb0d22047648e136fb4f0b17b693c40a3ac708fe05787",
					"size": 20897,
					"sourceHash": "55d966a2a75899ccb33d3a38f1d72bbc0dea476ff812ecda6899bc2311d32918",
					"status": "content"
				},
				"FUNDING.json": {
					"diff": "--- published/FUNDING.json\n+++ rebuilt/FUNDING.json\n@@ -3,5 +3,8 @@\n     \"ethereum\": {\n       \"ownedBy\": \"0xaA4c632684180bf781108c84E7a294B483D12053\"\n     }\n+  },\n+  \"opRetro\": {\n+    \"projectId\": \"0x2bb095e1f297c71da8bd4ee15097abad3b99e299fe14cd6aa704df3f36d0ae22\"\n   }\n }\n",
					"match": false,
					"packageHash": "86e891f29475ef43d9a3e3bf14d22602298820e43e3bc2e8f402da9c909971cf",
					"size": 107,
					"sourceHash": "1217fe0ce8c22914b6d3650646b5bf5bd04fb8c1044796253a7736344bf97179",
					"status": "content"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -56,6 +56,15 @@\n $ TS_NODE_TRANSPILE_ONLY=true npx hardhat coverage\n ```\n \n+**Weird test failures or plugin conflicts?**\n+\n+```sh\n+# Setting the `SOLIDITY_COVERAGE` env variable tells the coverage plugin to configure the provider\n+# early in the hardhat task cycle, minimizing conflicts with other plugins or `extendEnvironment` hooks\n+\n+$ SOLIDITY_COVERAGE=true npx hardhat coverage\n+```\n+\n **Additional Help**\n + [FAQ][1007]\n + [Advanced Topics][1005]\n@@ -86,6 +95,7 @@\n | Option <img width=200/>| Type <img width=200/> | Default <img width=1000/> | Description <img width=1000/> |\n | ------ | ---- | ------- | ----------- |\n | skipFiles | *Array* | `[]` | Array of contracts or folders (with paths expressed relative to the `contracts` directory) that should be skipped when doing instrumentation.(ex: `[ \"Routers\", \"Networks/Polygon.sol\"]`) :warning: **RUN THE HARDHAT CLEAN COMMAND AFTER UPDATING THIS**  |\n+| irMinimum | *Boolean* | `false` | Speeds up test execution times when solc is run in `viaIR` mode. If your project successfully compiles while generating coverage with this option turned on (it may not!) it's worth using |\n | modifierWhitelist | *String[]* | `[]` | List of modifier names (ex: `onlyOwner`) to exclude from branch measurement. (Useful for modifiers which prepare something instead of acting as a gate.)) |\n | mocha | *Object* | `{ }` | [Mocha options][3] to merge into existing mocha config. `grep` and `invert` are useful for skipping certain tests under coverage using tags in the test descriptions. [More...][24]|\n | measureStatementCoverage | *boolean* | `true` | Computes statement (in addition to line) coverage. [More...][34] |\n@@ -104,9 +114,9 @@\n | onCompileComplete[<sup>*</sup>][14] | *Function* |  | Hook run *after* compilation completes, *before* tests are run. Useful if you have secondary compilation steps or need to modify built artifacts. [More...][23]|\n | onTestsComplete[<sup>*</sup>][14] | *Function* |  | Hook run *after* the tests complete, *before* Istanbul reports are generated. [More...][23]|\n | onIstanbulComplete[<sup>*</sup>][14] | *Function* |  | Hook run *after* the Istanbul reports are generated, *before* the coverage task completes. Useful if you need to clean resources up. [More...][23]|\n-| **:warning:    DEPRECATED** |  | |  |\n-| configureYulOptimizer | *Boolean* | false | **(Deprecated since 0.8.7)** Setting to `true` should resolve \"stack too deep\" compiler errors in large projects using ABIEncoderV2 |\n-| solcOptimizerDetails | *Object* | `undefined` |**(Deprecated since 0.8.7))** Must be used in combination with `configureYulOptimizer`. Allows you configure solc's [optimizer details][1001]. Useful if the default remedy for stack-too-deep errors doesn't work in your case (See [FAQ: Running out of stack][1002] ). |\n+| **:warning:    LOW LEVEL** |  | |  |\n+| configureYulOptimizer | *Boolean* | false | Setting to `true` lets you specify optimizer details (see next option). If no details are defined it defaults to turning on the yul optimizer and enabling stack allocation |\n+| solcOptimizerDetails | *Object* | `undefined` |Must be used in combination with `configureYulOptimizer`. Allows you to configure solc's [optimizer details][1001]. (See [FAQ: Running out of stack][1002] ). |\n \n \n [<sup>*</sup> Advanced use][14]\n@@ -134,7 +144,7 @@\n ```\n \n ## Example reports\n-+ [openzeppelin-solidity][10](Codecov)\n++ [openzeppelin-contracts][10] (Codecov)\n \n ## Funding\n \n@@ -161,7 +171,7 @@\n [7]: https://github.com/sc-forks/solidity-coverage/blob/master/docs/faq.md#continuous-integration\n [8]: https://github.com/sc-forks/solidity-coverage/blob/master/docs/faq.md#notes-on-branch-coverage\n [9]: https://sc-forks.github.io/metacoin/\n-[10]: https://coveralls.io/github/OpenZeppelin/openzeppelin-solidity?branch=master\n+[10]: https://app.codecov.io/gh/OpenZeppelin/openzeppelin-contracts\n [11]: https://github.com/sc-forks/solidity-coverage/tree/master/test/units\n [12]: https://github.com/sc-forks/solidity-coverage/issues\n [13]: https://github.com/sc-forks/solidity-coverage/blob/master/docs/faq.md#notes-on-gas-distortion\n",
					"match": false,
					"packageHash": "8ca5e1a52a39b52fe6670f0407debcf93503857da5a23bc95cf1354625249fe7",
					"size": 10868,
					"sourceHash": "b9408630537e9f4369b5b1c2863578f3469b8555e77e866fe22a6eec1c13aa65",
					"status": "content"
				},
				"lib/api.js": {
					"diff": "--- published/lib/api.js\n+++ rebuilt/lib/api.js\n@@ -5,6 +5,7 @@\n const istanbul = require('sc-istanbul');\n const assert = require('assert');\n const _ = require('lodash/lang');\n+const { hardforkGte, HardforkName } = require('hardhat/internal/util/hardforks');\n \n const ConfigValidator = require('./validator');\n const Instrumenter = require('./instrumenter');\n@@ -17,7 +18,7 @@\n  * Coverage Runner\n  */\n class API {\n-  constructor(config={}) {\n+  constructor(config={}, hardfork) {\n     this.validator = new ConfigValidator();\n     this.abiUtils = new AbiUtils();\n     this.config = config || {};\n@@ -47,14 +48,19 @@\n     this.skipFiles = config.skipFiles || [];\n \n     this.log = config.log || console.log;\n-    this.gasLimit = 0xffffffffff                // default \"gas sent\" with transactions\n-    this.gasLimitNumber = 0x1fffffffffffff;     // block gas limit for Hardhat\n+    const isEip7825Enabled = hardfork !== undefined && HardforkName.OSAKA !== undefined\n+      ? hardforkGte(hardfork, HardforkName.OSAKA)\n+      : false;\n+    this.gasLimit = isEip7825Enabled ? 2 ** 24 : 0xffffffffff   // default \"gas sent\" with transactions\n+    this.gasLimitNumber = 0x1fffffffffffff;           // block gas limit for Hardhat\n     this.gasPrice = 0x01;\n \n     this.istanbulFolder = config.istanbulFolder || false;\n     this.istanbulReporter = config.istanbulReporter || ['html', 'lcov', 'text', 'json'];\n \n     this.viaIR = config.viaIR;\n+    this.usingSolcV4 = config.usingSolcV4;\n+    this.irMinimum = config.irMinimum;\n     this.solcOptimizerDetails = config.solcOptimizerDetails;\n \n     this.setLoggingLevel(config.silent);\n@@ -177,7 +183,8 @@\n   // Hardhat\n   async attachToHardhatVM(provider){\n     const self = this;\n-    this.collector = new DataCollector(this.instrumenter.instrumentationData, this.viaIR);\n+    const useExpandedOpcodeDictionary = this.viaIR || this.usingSolcV4;\n+    this.collector = new DataCollector(this.instrumenter.instrumentationData, useExpandedOpcodeDictionary);\n \n     if ('init' in provider) {\n       // Newer versions of Hardhat initialize the provider lazily, so we need to\n",
					"match": false,
					"packageHash": "a34eb1918c2ec4ddec1063ca22661fbfd3788cf3aa433de62ec99bb789116979",
					"size": 9312,
					"sourceHash": "75be6d8f1a02954590a27010957d14342cc9d5cbe9d1084f8d6889b854294e3a",
					"status": "content"
				},
				"lib/collector.js": {
					"diff": "--- published/lib/collector.js\n+++ rebuilt/lib/collector.js\n@@ -6,26 +6,7 @@\n   constructor(instrumentationData={}, viaIR){\n     this.instrumentationData = instrumentationData;\n \n-    this.validOpcodes = {\n-      \"PUSH1\": true,\n-      \"DUP1\": viaIR,\n-      \"DUP2\": viaIR,\n-      \"DUP3\": viaIR,\n-      \"DUP4\": viaIR,\n-      \"DUP5\": viaIR,\n-      \"DUP6\": viaIR,\n-      \"DUP7\": viaIR,\n-      \"DUP8\": viaIR,\n-      \"DUP9\": viaIR,\n-      \"DUP10\": viaIR,\n-      \"DUP11\": viaIR,\n-      \"DUP12\": viaIR,\n-      \"DUP13\": viaIR,\n-      \"DUP14\": viaIR,\n-      \"DUP15\": viaIR,\n-      \"DUP16\": viaIR,\n-    }\n-\n+    this.validOpcodes = this._getOpcodes(viaIR);\n     this.lastHash = null;\n     this.viaIR = viaIR;\n     this.pcZeroCounter = 0;\n@@ -49,18 +30,6 @@\n     } catch (err) { /*Ignore*/ };\n   }\n \n-  // Temporarily disabled because some relevant traces aren't available\n-  /**\n-   * Converts pushData value to string and registers in instrumentation map.\n-   * @param  {HardhatEVMTraceInstruction} instruction\n-   */\n-  /*trackHardhatEVMInstruction(instruction){\n-    if (instruction && instruction.pushData){\n-      let hash = `0x` + instruction.pushData.toString('hex');\n-      this._registerHash(hash)\n-    }\n-  }*/\n-\n   /**\n    * Normalizes has string and marks hit.\n    * @param  {String} hash bytes32 hash\n@@ -78,20 +47,6 @@\n       }\n       return;\n     }\n-\n-    // Detect and recover from viaIR mangled hashes by left-padding single `0`\n-    if(this.viaIR && hash.length === 18) {\n-      hash = hash.slice(2);\n-      hash = '0' + hash;\n-      hash = hash.slice(0,16);\n-      hash = '0x' + hash;\n-      if(this.instrumentationData[hash]){\n-        if (this.lastHash !== hash) {\n-          this.lastHash = hash;\n-          this.instrumentationData[hash].hits++\n-        }\n-      }\n-    }\n   }\n \n   /**\n@@ -107,6 +62,15 @@\n     // but it doesn't preserve leading zeroes when it does this\n     if (this.viaIR && hash.length >= 18) {\n       hash = hash.slice(0,18);\n+\n+      // Detect and recover from viaIR mangled hashes by left-padding single `0`\n+      if(!this.instrumentationData[hash]) {\n+        hash = hash.slice(2);\n+        hash = '0' + hash;\n+        hash = hash.slice(0,16);\n+        hash = '0x' + hash;\n+      }\n+\n     } else if (hash.length < 18 && hash.length > 11){\n       hash = hash.slice(2);\n       while(hash.length < 16) hash = '0' + hash;\n@@ -116,6 +80,36 @@\n   }\n \n   /**\n+   * Generates a list of all the opcodes to inspect for instrumentation hashes\n+   * When viaIR is true, it includes all DUPs and PUSHs, so things are a little slower.\n+   * @param {boolean} viaIR\n+   */\n+  _getOpcodes(viaIR) {\n+    let opcodes = {\n+      \"PUSH1\": true\n+    };\n+\n+    if (!viaIR) return opcodes;\n",
					"match": false,
					"packageHash": "09f802eb0186081c8ac12aa03f9e6969aacd4a527b1f3cfa524f9a17a7564dd3",
					"size": 3668,
					"sourceHash": "765907827852c660b3c7b198e221b96e92c5cb803d7c02c6b6f15caf7c478c02",
					"status": "content"
				},
				"lib/registrar.js": {
					"diff": "--- published/lib/registrar.js\n+++ rebuilt/lib/registrar.js\n@@ -23,6 +23,14 @@\n     this.modifierWhitelist = [];\n   }\n \n+  _seekSemiColon(contract, pos) {\n+    const end = pos + 5;\n+    for(pos; pos <= end; pos++) {\n+      if (contract[pos] === ';') break;\n+    }\n+    return pos;\n+  }\n+\n   /**\n    * Adds injection point to injection points map\n    * @param  {Object} contract instrumentation target\n@@ -441,7 +449,7 @@\n     );\n     this._createInjectionPoint(\n       contract,\n-      expression.range[1] + 2,\n+      this._seekSemiColon(contract.instrumented, expression.range[1] + 1) + 1,\n       {\n         type: 'injectRequirePost',\n         branchId: contract.branchId,\n",
					"match": false,
					"packageHash": "432f4bd53173d74de91fcd7d75b61b1c9eb51f47b5b709864ba65c00ca16857b",
					"size": 14693,
					"sourceHash": "015976e1fa4fdf65eb50154b9364fabbd6fa789498e140b00f43aa9e67eeca2d",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"solidity-coverage\",\n-  \"version\": \"0.8.9-rc.0\",\n+  \"version\": \"0.8.17\",\n   \"description\": \"Code coverage for Solidity testing\",\n   \"main\": \"plugins/nomiclabs.plugin.js\",\n   \"bin\": {\n@@ -13,7 +13,7 @@\n     \"test:unit\": \"./scripts/unit.sh\",\n     \"test:integration\": \"./scripts/integration.sh\",\n     \"test:ci\": \"./scripts/ci.sh\",\n-    \"test:uint:viaIR\": \"VIA_IR=true ./scripts/unit.sh\",\n+    \"test:unit:viaIR\": \"VIA_IR=true ./scripts/unit.sh\",\n     \"test:integration:viaIR\": \"VIA_IR=true ./scripts/integration.sh\",\n     \"test:ci:viaIR\": \"VIA_IR=true ./scripts/ci.sh\"\n   },\n@@ -26,7 +26,7 @@\n   \"license\": \"ISC\",\n   \"dependencies\": {\n     \"@ethersproject/abi\": \"^5.0.9\",\n-    \"@solidity-parser/parser\": \"^0.18.0\",\n+    \"@solidity-parser/parser\": \"^0.20.1\",\n     \"chalk\": \"^2.4.2\",\n     \"death\": \"^1.1.0\",\n     \"difflib\": \"^0.2.4\",\n@@ -35,7 +35,7 @@\n     \"global-modules\": \"^2.0.0\",\n     \"globby\": \"^10.0.1\",\n     \"jsonschema\": \"^1.2.4\",\n-    \"lodash\": \"^4.17.15\",\n+    \"lodash\": \"^4.17.21\",\n     \"mocha\": \"^10.2.0\",\n     \"node-emoji\": \"^1.10.0\",\n     \"pify\": \"^4.0.1\",\n@@ -46,18 +46,22 @@\n     \"web3-utils\": \"^1.3.6\"\n   },\n   \"devDependencies\": {\n+    \"@nomicfoundation/hardhat-network-helpers\": \"^1.0.10\",\n+    \"@nomicfoundation/hardhat-viem\": \"^2.0.0\",\n     \"@nomiclabs/hardhat-ethers\": \"^2.0.4\",\n     \"@nomiclabs/hardhat-truffle5\": \"^2.0.0\",\n     \"@nomiclabs/hardhat-waffle\": \"^2.0.1\",\n     \"@nomiclabs/hardhat-web3\": \"^2.0.0\",\n     \"chai\": \"^4.3.4\",\n+    \"chai-as-promised\": \"^7.1.1\",\n     \"decache\": \"^4.5.1\",\n     \"ethereum-waffle\": \"^3.4.0\",\n     \"ethers\": \"^5.5.3\",\n-    \"hardhat\": \"^2.19.5\",\n+    \"hardhat\": \"^2.22.2\",\n     \"hardhat-gas-reporter\": \"^1.0.1\",\n     \"nyc\": \"^14.1.1\",\n-    \"solc\": \"0.8.24\"\n+    \"solc\": \"0.8.24\",\n+    \"viem\": \"^2.9.9\"\n   },\n   \"peerDependencies\": {\n     \"hardhat\": \"^2.11.0\"\n",
					"match": false,
					"packageHash": "4f990d029cdfa0c9103c6bfdb6536a8210cf3c46e80477d1fc9f96bec05cafac",
					"size": 1807,
					"sourceHash": "7c6818f1b902493e2882bda85d2d436fc46ee86295965f7b065a4cd968642fab",
					"status": "content"
				},
				"plugins/hardhat.plugin.js": {
					"diff": "--- published/plugins/hardhat.plugin.js\n+++ rebuilt/plugins/hardhat.plugin.js\n@@ -1,7 +1,7 @@\n const path = require('path');\n const PluginUI = require('./resources/nomiclabs.ui');\n \n-const { task, types } = require(\"hardhat/config\");\n+const { extendConfig, task, types } = require(\"hardhat/config\");\n const { HardhatPluginError } = require(\"hardhat/plugins\")\n const {HARDHAT_NETWORK_RESET_EVENT} = require(\"hardhat/internal/constants\");\n const {\n@@ -15,12 +15,26 @@\n // Toggled true for `coverage` task only.\n let measureCoverage = false;\n let configureYulOptimizer = false;\n+let irMinimum = false;\n let instrumentedSources;\n let optimizerDetails;\n \n // UI for the task flags...\n const ui = new PluginUI();\n \n+// Workaround for hardhat-viem-plugin and other provider redefinition conflicts\n+extendConfig((config, userConfig) => {\n+  if (Boolean(process.env.SOLIDITY_COVERAGE)) {\n+    const { configureHardhatEVMGas } = require('./resources/nomiclabs.utils');\n+    const API = require('./../lib/api');\n+    const api = new API({}, config.networks.hardhat.hardfork);\n+\n+    const hardhatNetworkForCoverage = {};\n+    configureHardhatEVMGas(hardhatNetworkForCoverage, api);\n+    config.networks.hardhat = Object.assign(config.networks.hardhat, hardhatNetworkForCoverage);\n+  }\n+});\n+\n subtask(TASK_COMPILE_SOLIDITY_GET_COMPILER_INPUT).setAction(async (_, { config }, runSuper) => {\n   const solcInput = await runSuper();\n   if (measureCoverage) {\n@@ -57,12 +71,22 @@\n \n     // Beginning with v0.8.7, we let the optimizer run if viaIR is true and\n     // instrument using `abi.encode(bytes8 covHash)`. Otherwise turn the optimizer off.\n-    if (!settings.viaIR) settings.optimizer.enabled = false;\n+    if (!settings.viaIR || irMinimum) settings.optimizer.enabled = false;\n \n-    // This sometimes fixed a stack-too-deep bug in ABIEncoderV2 for coverage plugin versions up to 0.8.6\n+    // Almost identical to foundry's irMinimum option - may improve performance for projects compiling with viaIR\n+    // Original discussion at: https://github.com/ethereum/solidity/issues/12533#issuecomment-1013073350\n+    if (irMinimum) {\n+      settings.optimizer.details =  {\n+        yul: true,\n+        yulDetails: {\n+          stackAllocation: true,\n+          optimizerSteps: \"\",\n+        },\n+      }\n+    // LEGACY: This sometimes fixed a stack-too-deep bug in ABIEncoderV2 for coverage plugin versions up to 0.8.6\n     // Although issue should be fixed in 0.8.7, am leaving this option in because it may still be necessary\n     // to configure optimizer details in some cases.\n-    if (configureYulOptimizer) {\n+    } else if (configureYulOptimizer) {\n       if (optimizerDetails === undefined) {\n         settings.optimizer.details = {\n           yul: true,\n@@ -126,13 +150,20 @@\n   try {\n     config = nomiclabsUtils.normalizeConfig(env.config, args);\n     ui = new PluginUI(config.logger.log);\n-    api = new API(utils.loadSolcoverJS(config));\n+    api = new API(utils.loadSolcoverJS(config), config.networks.hardhat.hardfork);\n \n     optimizerDetails = api.solcOptimizerDetails;\n+    irMinimum = api.irMinimum;\n \n     // Catch interrupt signals\n     process.on(\"SIGINT\", nomiclabsUtils.finish.bind(null, config, api, true));\n \n+    // Warn about hardhat-viem plugin if present and config hasn't happened\n+    if (env.viem !== undefined && nomiclabsUtils.requiresEVMConfiguration(env.network.config, api)) {\n+      ui.report('hardhat-viem', []);\n+      throw new Error(ui.generate('hardhat-viem'));\n+    }\n+\n     // Version Info\n     ui.report('hardhat-versions', [pkg.version]);\n \n@@ -208,7 +239,13 @@\n     // ==============\n     // Server launch\n     // ==============\n-    let network = await nomiclabsUtils.setupHardhatNetwork(env, api, ui);\n+    let network\n+\n+    if (nomiclabsUtils.requiresEVMConfiguration(env.network.config, api)) {\n+      network = await nomiclabsUtils.setupHardhatNetwork(env, api, ui);\n+    } else {\n+      network = env.network;\n+    }\n \n     accounts = await utils.getAccountsHardhat(network.provider);\n",
					"match": false,
					"packageHash": "f6ded3a263e42b8738c343f2270397bce44065e467bd276c0816a854f76d2f38",
					"size": 8692,
					"sourceHash": "35db0f14d5fee0dbe0f006160be3750cde3efc8e1e120be05f0cd354cb001bff",
					"status": "content"
				},
				"plugins/resources/nomiclabs.ui.js": {
					"diff": "--- published/plugins/resources/nomiclabs.ui.js\n+++ rebuilt/plugins/resources/nomiclabs.ui.js\n@@ -54,6 +54,12 @@\n                          `${ct} ${c.bold('HardhatEVM')}: v${args[0]}\\n` +\n                          `${ct} ${c.bold('network')}:    ${args[1]}\\n`,\n \n+      'hardhat-viem': `\\n${w}${c.red(\"  Coverage requires a special environment variable when used with 'hardhat-viem'  \")}${w}` +\n+                      `\\n${c.red(    \"====================================================================================\")}`   +\n+                      `\\n${c.bold(   \"Please run the coverage command as:\" )}` +\n+                      `\\n${c(        \"SOLIDITY_COVERAGE=true npx hardhat coverage\")}` +\n+                      `\\n${c.red(    \"====================================================================================\")}`\n+                      ,\n     }\n \n     this._write(kinds[kind]);\n@@ -81,12 +87,14 @@\n \n       'tests-fail': `${x} ${c.bold(args[0])} ${c.red('test(s) failed under coverage.')}`,\n \n-\n+      'hardhat-viem': \"'hardhat-viem' requires an environment variable to be set when used with the solidity-coverage plugin\"\n     }\n \n \n     return this._format(kinds[kind])\n   }\n+\n+\n }\n \n-module.exports = PluginUI;\n\\ No newline at end of file\n+module.exports = PluginUI;\n",
					"match": false,
					"packageHash": "55eee070a6de1d75b3b303b48ac1d3e1a4ed1772b2cd7422885dbd6ec9800b20",
					"size": 3011,
					"sourceHash": "a7332b302289c6244836aba830e64eb2ecc0e33bdc3294030fe7862c03c69ca2",
					"status": "content"
				},
				"plugins/resources/nomiclabs.utils.js": {
					"diff": "--- published/plugins/resources/nomiclabs.utils.js\n+++ rebuilt/plugins/resources/nomiclabs.utils.js\n@@ -42,6 +42,7 @@\n \n   if (config.solidity && config.solidity.compilers.length) {\n     config.viaIR = isUsingViaIR(config.solidity);\n+    config.usingSolcV4 = isUsingSolcV4(config.solidity);\n   }\n \n   config.workingDir = config.paths.root;\n@@ -63,8 +64,23 @@\n   return config;\n }\n \n-function isUsingViaIR(solidity) {\n+function isUsingSolcV4(solidity) {\n+  for (compiler of solidity.compilers) {\n+    if (compiler.version && semver.lt(compiler.version, '0.5.0')) {\n+      return true;\n+    }\n+  }\n+  if (solidity.overrides) {\n+    for (key of Object.keys(solidity.overrides)){\n+      if (solidity.overrides[key].version && semver.lt(solidity.overrides[key].version, '0.5.0')) {\n+        return true;\n+      }\n+    }\n+  }\n+  return false;\n+}\n \n+function isUsingViaIR(solidity) {\n   for (compiler of solidity.compilers) {\n     if (compiler.settings && compiler.settings.viaIR) {\n       return true;\n@@ -88,7 +104,7 @@\n   // after 2.15.0, the internal createProvider function has a different signature\n   const newCreateProviderSignature = semver.satisfies(hardhatPackage.version, \"^2.15.0\");\n \n-  let provider, networkName, networkConfig;\n+  let provider, networkConfig;\n \n   // HardhatEVM\n   networkConfig = env.network.config;\n@@ -117,6 +133,16 @@\n   )\n }\n \n+function requiresEVMConfiguration(networkConfig, api) {\n+  return (\n+    networkConfig.allowUnlimitedContractSize !== true ||\n+    networkConfig.blockGasLimit !== api.gasLimitNumber ||\n+    networkConfig.gas !==  api.gasLimit ||\n+    networkConfig.gasPrice !== api.gasPrice ||\n+    networkConfig.initialBaseFeePerGas !== 0\n+  )\n+}\n+\n function configureHardhatEVMGas(networkConfig, api){\n   networkConfig.allowUnlimitedContractSize = true;\n   networkConfig.blockGasLimit = api.gasLimitNumber;\n@@ -233,6 +259,8 @@\n }\n \n module.exports = {\n+  configureHardhatEVMGas,\n+  requiresEVMConfiguration,\n   normalizeConfig,\n   finish,\n   tempCacheDir,\n",
					"match": false,
					"packageHash": "d0fdcc6aafadab0d97f669229cc0d3c5704a8fa1d969d98dd672dfb25f927475",
					"size": 6629,
					"sourceHash": "44a7f9793ed91493bb313feeab1f1a421c9b0fb8f0bd3902bc48c2639b3537aa",
					"status": "content"
				},
				"plugins/resources/plugin.utils.js": {
					"diff": "--- published/plugins/resources/plugin.utils.js\n+++ rebuilt/plugins/resources/plugin.utils.js\n@@ -135,9 +135,9 @@\n   let targetsPath;\n \n   // The targets (contractsDir) could actually be a single named file (OR a folder)\n-  const extName = path.extname(config.contractsDir);\n+  const isDirectory = fs.statSync(config.contractsDir).isDirectory();\n \n-  if (extName.length !== 0) {\n+  if (!isDirectory) {\n     targets = [ path.normalize(config.contractsDir) ];\n   } else {\n     targetsPath = path.join(config.contractsDir, '**', '*.{sol,vy}');\n@@ -222,13 +222,17 @@\n       throw new Error(error)\n     }\n \n-  // Config is optional\n+  // Config is optional, but if passed and not found, error\n+  } else if (config.solcoverjs) {\n+    const message = ui.generate('solcoverjs-fail') + \" --solcoverjs flag was set but no file was found\";\n+    throw new Error(message);\n   } else {\n     coverageConfig = {};\n   }\n \n-  // viaIR is eval'd in `nomiclab.utils.normalizeConfig`\n+  // viaIR and solc versions are eval'd in `nomiclab.utils.normalizeConfig`\n   coverageConfig.viaIR = config.viaIR;\n+  coverageConfig.usingSolcV4 = config.usingSolcV4;\n \n   coverageConfig.log = log;\n   coverageConfig.cwd = config.workingDir;\n",
					"match": false,
					"packageHash": "6eb52ff5021f9b60f4b2a8f559d00bd4960fe0b2e4064e38dba1fb9902694ba2",
					"size": 7798,
					"sourceHash": "8f2edcab4f7820f3a107e91d369ce72f04692875a2ad13d4ade7560be472dcf9",
					"status": "content"
				},
				"scripts/zeppelin.sh": {
					"diff": "--- published/scripts/zeppelin.sh\n+++ rebuilt/scripts/zeppelin.sh\n@@ -3,12 +3,13 @@\n # E2E CI: installs PR candidate on openzeppelin-contracts and runs coverage\n #\n \n-set -o errexit\n+# TODO: uncomment this when zeppelin job gets fixed\n+# set -o errexit\n \n # Get rid of any caches\n sudo rm -rf node_modules\n echo \"NVM CURRENT >>>>>\" && nvm current\n-nvm use 18\n+nvm use 20\n \n # Use PR env variables (for forks) or fallback on local if PR not available\n SED_REGEX=\"s/git@github.com:/https:\\/\\/github.com\\//\"\n@@ -43,3 +44,7 @@\n \n # Track perf\n CI=false npm run coverage\n+\n+# TODO: remove EXIT 0 when zeppelin job is fixed - currently failing for time-related reasons in circleci\n+# TODO: uncomment set command at top of this file\n+exit 0\n\\ No newline at end of file\n",
					"match": false,
					"packageHash": "6c1566ff06a5839dc90ab45832b11c8116f733aa039703e7f861dc844db8eed3",
					"size": 1104,
					"sourceHash": "bd6ae7444e4b95e2be26411b5aafa24403f76e532f35685e77d27fa3658bad85",
					"status": "content"
				}
			},
			"summary": {
				"differentFiles": 12,
				"matchingFiles": 20,
				"missingInPackage": 0,
				"missingInSource": 0,
				"score": 0.625,
				"totalFiles": 32
			}
		}
	}
]
