[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2025-12-31T21:33:30.121Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:6.14.14",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "@oclif/test@2.0.0",
			"name": "@oclif/test",
			"version": "2.0.0",
			"location": "https://registry.npmjs.org/@oclif/test/-/test-2.0.0.tgz",
			"integrity": "sha512-DNMhGCKX1b3k/rCNmmTxftXNw0luiCDDfkvh/bEWsZN8PoyhN9Na/zJvzaB1eWbKXSg5qzkTpWpOc2AjYA6rMQ==",
			"publishedAt": "2021-08-06T16:04:11.229Z",
			"publishedWith": {
				"node": "12.22.4",
				"npm": "6.14.14"
			}
		},
		"source": {
			"integrity": null,
			"location": "git+https://github.com/oclif/test.git",
			"spec": "github:oclif/test#d63af8210afdefb919f8983b754238a23774df85"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				"CHANGELOG.md": {
					"match": false,
					"packageHash": "5093c7a1883aaa2611475fc6f895b8afb1a4fc99ebc3fb7e8504430925bd4851",
					"size": 18541,
					"status": "missing-in-source"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -1,11 +1,45 @@\n-@oclif/test\n-============\n+# @oclif/test\n \n-test helpers for oclif components\n+test helpers for oclif CLIs\n \n [![Version](https://img.shields.io/npm/v/@oclif/test.svg)](https://npmjs.org/package/@oclif/test)\n-[![CircleCI](https://circleci.com/gh/oclif/test/tree/master.svg?style=svg)](https://circleci.com/gh/oclif/test/tree/master)\n-[![Appveyor CI](https://ci.appveyor.com/api/projects/status/github/oclif/test?branch=master&svg=true)](https://ci.appveyor.com/project/heroku/test/branch/master)\n-[![Known Vulnerabilities](https://snyk.io/test/npm/@oclif/test/badge.svg)](https://snyk.io/test/npm/@oclif/test)\n [![Downloads/week](https://img.shields.io/npm/dw/@oclif/test.svg)](https://npmjs.org/package/@oclif/test)\n-[![License](https://img.shields.io/npm/l/@oclif/test.svg)](https://github.com/oclif/test/blob/master/package.json)\n+[![License](https://img.shields.io/npm/l/@oclif/test.svg)](https://github.com/oclif/test/blob/main/package.json)\n+\n+## Migration\n+\n+See the [V4 Migration Guide](./MIGRATION.md) if you are migrating from v3 or older.\n+\n+## Usage\n+\n+`@oclif/test` provides a handful of utilities that make it easy to test your [oclif](https://oclif.io) CLI.\n+\n+> [!NOTE]\n+> In order for these utilities to capture all output to the terminal, you must disable any console output interception/suppression features in your test framework.\n+>\n+> - For Jest users, enable [the `verbose` flag](https://jestjs.io/docs/configuration#verbose-boolean) in your Jest config.\n+> - For Vitest users, enable [the `disableConsoleIntercept` flag](https://vitest.dev/guide/cli.html#disableconsoleintercept) in your Vitest config.\n+\n+### `captureOutput`\n+\n+`captureOutput` allows you to get the stdout, stderr, return value, and error of the callback you provide it. This makes it possible to assert that certain strings were printed to stdout and stderr or that the callback failed with the expected error or succeeded with the expected result.\n+\n+**Options**\n+\n+- `print` - Print everything that goes to stdout and stderr.\n+- `stripAnsi` - Strip ansi codes from everything that goes to stdout and stderr. Defaults to true.\n+- `testNodeEnv` - Sets the `NODE_ENV` value when capturing output. Defaults to `'test'`.\n+\n+See the [tests](./test/capture-output.test.ts) for example usage.\n+\n+### `runCommand`\n+\n+`runCommand` allows you to get the stdout, stderr, return value, and error of a command in your CLI.\n+\n+See the [tests](./test/run-command.test.ts) for example usage.\n+\n+### `runHook`\n+\n+`runHook` allows you to get the stdout, stderr, return value, and error of a hook in your CLI.\n+\n+See the [tests](./test/run-hook.test.ts) for example usage.\n",
					"match": false,
					"packageHash": "0f0e75bdde81cd497a14eadde4f2bea7694f8c6b030c85049f186600185f9137",
					"size": 779,
					"sourceHash": "060b133f851a8c93ab124fdb7a9897924e274cb4f56ecc39205d1b09ed240ec5",
					"status": "content"
				},
				"lib/command.d.ts": {
					"match": false,
					"packageHash": "5f0bbe4244af49673900cf2101d61a96cce89bd8bef933b6b2adbe495a59f0d9",
					"size": 278,
					"status": "missing-in-source"
				},
				"lib/command.js": {
					"match": false,
					"packageHash": "289019a4775618d9ab6558f6d09a3f8557591879bb9d661f836ae5c49d0051df",
					"size": 894,
					"status": "missing-in-source"
				},
				"lib/exit.d.ts": {
					"match": false,
					"packageHash": "229e2b75930ff293af76acec82f97a0a3e688da2e1de1f88a715f6c684c498bd",
					"size": 251,
					"status": "missing-in-source"
				},
				"lib/exit.js": {
					"match": false,
					"packageHash": "655e82a3bbeecec4838ade54964f9ef6fb91a274fdaa70df94ee381b95e8ac15",
					"size": 643,
					"status": "missing-in-source"
				},
				"lib/hook.d.ts": {
					"match": false,
					"packageHash": "edc308d12d46110cc4c5011e0f95bd09a973877f6a782dd2ce6d8b656eecc00d",
					"size": 701,
					"status": "missing-in-source"
				},
				"lib/hook.js": {
					"match": false,
					"packageHash": "a97d17f60662dbbe91f03a6d32a575b278ddb285a735c467366150f418ff6602",
					"size": 1059,
					"status": "missing-in-source"
				},
				"lib/index.d.ts": {
					"diff": "--- published/lib/index.d.ts\n+++ rebuilt/lib/index.d.ts\n@@ -1,114 +1,55 @@\n-import { Config } from '@oclif/core';\n-import { expect, FancyTypes } from 'fancy-test';\n-import { command } from './command';\n-import { loadConfig } from './load-config';\n-export declare const test: FancyTypes.Base<FancyTypes.Context, {\n-    skip: {\n-        output: unknown;\n-        args: [];\n-    };\n-} & {\n-    only: {\n-        output: unknown;\n-        args: [];\n-    };\n-} & {\n-    retries: {\n-        output: unknown;\n-        args: [number];\n-    };\n-} & {\n-    catch: {\n-        output: {\n-            error: Error;\n-        };\n-        args: [string | RegExp | ((err: Error) => any), ({\n-            raiseIfNotThrown?: boolean | undefined;\n-        } | undefined)?];\n-    };\n-} & {\n-    env: {\n-        output: unknown;\n-        args: [{\n-            [k: string]: string | null | undefined;\n-        }, (FancyTypes.EnvOptions | undefined)?];\n-    };\n-} & {\n-    stub: {\n-        output: {\n-            stubs: any[];\n-        };\n-        args: [any, any, () => any];\n-    };\n-} & {\n-    stdin: {\n-        output: unknown;\n-        args: [string, (number | undefined)?];\n-    };\n-} & {\n-    stderr: {\n-        output: {\n-            readonly stderr: string;\n-        };\n-        args: [({\n-            print?: boolean | undefined;\n-            stripColor?: boolean | undefined;\n-        } | undefined)?];\n-    };\n-} & {\n-    stdout: {\n-        output: {\n-            readonly stdout: string;\n-        };\n-        args: [({\n-            print?: boolean | undefined;\n-            stripColor?: boolean | undefined;\n-        } | undefined)?];\n-    };\n-} & {\n-    nock: {\n-        output: {\n-            nock: number;\n-        };\n-        args: [string, FancyTypes.NockOptions | FancyTypes.NockCallback, (FancyTypes.NockCallback | undefined)?];\n-    };\n-} & {\n-    timeout: {\n-        output: {\n-            timeout: number;\n-        };\n-        args: [(number | undefined)?];\n-    };\n-} & {\n-    loadConfig: {\n-        output: {\n-            config: import(\"@oclif/core/lib/interfaces\").Config;\n-        };\n-        args: [(loadConfig.Options | undefined)?];\n-    };\n-} & {\n-    command: {\n-        output: {\n-            config: import(\"@oclif/core/lib/interfaces\").Config;\n-            expectation: string;\n-        };\n-        args: [string | string[], (loadConfig.Options | undefined)?];\n-    };\n-} & {\n",
					"match": false,
					"packageHash": "203f63c31aa7fa3ef3e8a3f1249eb4d10c56e701d0d2f35643d349d32ca691f4",
					"size": 2634,
					"sourceHash": "347b788cd989e5c94751ba5ea1d69b5952aaaaffc17de53834f34951e001b6be",
					"status": "content"
				},
				"lib/index.js": {
					"diff": "--- published/lib/index.js\n+++ rebuilt/lib/index.js\n@@ -1,19 +1,156 @@\n \"use strict\";\n+var __importDefault = (this && this.__importDefault) || function (mod) {\n+    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n+};\n Object.defineProperty(exports, \"__esModule\", { value: true });\n+exports.captureOutput = captureOutput;\n+exports.runCommand = runCommand;\n+exports.runHook = runHook;\n const core_1 = require(\"@oclif/core\");\n-exports.Config = core_1.Config;\n-const fancy_test_1 = require(\"fancy-test\");\n-exports.expect = fancy_test_1.expect;\n-exports.FancyTypes = fancy_test_1.FancyTypes;\n-const command_1 = require(\"./command\");\n-exports.command = command_1.command;\n-const exit_1 = require(\"./exit\");\n-const hook_1 = require(\"./hook\");\n-const load_config_1 = require(\"./load-config\");\n-load_config_1.loadConfig.root = module.parent.filename;\n-exports.test = fancy_test_1.fancy\n-    .register('loadConfig', load_config_1.loadConfig)\n-    .register('command', command_1.command)\n-    .register('exit', exit_1.default)\n-    .register('hook', hook_1.default);\n-exports.default = exports.test;\n+const ansis_1 = __importDefault(require(\"ansis\"));\n+const debug_1 = __importDefault(require(\"debug\"));\n+const node_path_1 = require(\"node:path\");\n+const debug = (0, debug_1.default)('oclif-test');\n+function traverseFilePathUntil(filename, predicate) {\n+    let current = filename;\n+    while (!predicate(current)) {\n+        current = (0, node_path_1.dirname)(current);\n+    }\n+    return current;\n+}\n+function findRoot() {\n+    return (process.env.OCLIF_TEST_ROOT ??\n+        // eslint-disable-next-line unicorn/prefer-module\n+        Object.values(require.cache).find((m) => m?.children?.includes(module))?.filename ??\n+        traverseFilePathUntil(\n+        // eslint-disable-next-line unicorn/prefer-module\n+        require.main?.path ?? module.path, (p) => !(p.includes('node_modules') || p.includes('.pnpm') || p.includes('.yarn'))));\n+}\n+function makeLoadOptions(loadOpts) {\n+    return loadOpts ?? { root: findRoot() };\n+}\n+/**\n+ * Split a string into an array of strings, preserving quoted substrings\n+ *\n+ * @example\n+ * splitString('foo bar --name \"foo\"') // ['foo bar', '--name', 'foo']\n+ * splitString('foo bar --name \"foo bar\"') // ['foo bar', '--name', 'foo bar']\n+ * splitString('foo bar --name=\"foo bar\"') // ['foo bar', '--name=foo bar']\n+ * splitString('foo bar --name=foo bar') // ['foo bar', '--name=foo', 'bar']\n+ *\n+ * @param str input string\n+ * @returns array of strings with quotes removed\n+ */\n+function splitString(str) {\n+    return (str.match(/(?:[^\\s\"]+|\"[^\"]*\")+/g) ?? []).map((s) => s.replaceAll(/^\"|\"$|(?<==)\"/g, ''));\n+}\n+/**\n+ * Capture the stderr and stdout output of a function\n+ * @param fn async function to run\n+ * @param opts options\n+ *  - print: Whether to print the output to the console\n+ *  - stripAnsi: Whether to strip ANSI codes from the output\n+ * @returns {Promise<CaptureResult<T>>} Captured output\n+ *   - error: Error object if the function throws an error\n+ *   - result: Result of the function if it returns a value and succeeds\n+ *   - stderr: Captured stderr output\n+ *   - stdout: Captured stdout output\n+ */\n+async function captureOutput(fn, opts) {\n+    const print = opts?.print ?? false;\n+    const stripAnsi = opts?.stripAnsi ?? true;\n+    const testNodeEnv = opts?.testNodeEnv || 'test';\n+    const originals = {\n+        NODE_ENV: process.env.NODE_ENV,\n+        stderr: process.stderr.write,\n+        stdout: process.stdout.write,\n+    };\n+    const output = {\n+        stderr: [],\n+        stdout: [],\n+    };\n+    const toString = (str) => (stripAnsi ? ansis_1.default.strip(str.toString()) : str.toString());\n+    const getStderr = () => output.stderr.map((b) => toString(b)).join('');\n+    const getStdout = () => output.stdout.map((b) => toString(b)).join('');\n+    const mock = (std) => (str, encoding, cb) => {\n+        output[std].push(str);\n+        if (print) {\n+            if (encoding !== null && typeof encoding === 'function') {\n+                cb = encoding;\n+                encoding = undefined;\n+            }\n",
					"match": false,
					"packageHash": "98281fad73e49cf50c3793f1c6ab7adf478b95bfc9cf2d42f504dd30ac526313",
					"size": 766,
					"sourceHash": "9a57e5e8997cd2633c7cafb59ad39886f7051e6994eb726c5e857e7263f7bc6b",
					"status": "content"
				},
				"lib/load-config.d.ts": {
					"match": false,
					"packageHash": "db41553c9924d4050cbe17bd48823fa310bf0c829be14cf0b86a54f05ab7d883",
					"size": 468,
					"status": "missing-in-source"
				},
				"lib/load-config.js": {
					"match": false,
					"packageHash": "49525cfe413ac4c5c972046220146b67a5c0dd8bebe6c3d2de03f7385d4e7539",
					"size": 575,
					"status": "missing-in-source"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,30 +1,40 @@\n {\n   \"name\": \"@oclif/test\",\n   \"description\": \"test helpers for oclif components\",\n-  \"version\": \"2.0.0\",\n-  \"author\": \"Jeff Dickey @jdxcode\",\n+  \"version\": \"4.1.15\",\n+  \"author\": \"Salesforce\",\n   \"bugs\": \"https://github.com/oclif/test/issues\",\n   \"dependencies\": {\n-    \"fancy-test\": \"^1.4.3\"\n+    \"ansis\": \"^3.17.0\",\n+    \"debug\": \"^4.4.3\"\n+  },\n+  \"peerDependencies\": {\n+    \"@oclif/core\": \">= 3.0.0\"\n   },\n   \"devDependencies\": {\n-    \"@oclif/core\": \"^0.5.27\",\n-    \"@types/chai\": \"^4.1.7\",\n-    \"@types/mocha\": \"^8.0.0\",\n-    \"@types/node\": \"^14.0.14\",\n-    \"chai\": \"^4.2.0\",\n-    \"eslint\": \"^7.3.1\",\n-    \"eslint-config-oclif\": \"^3.1.0\",\n-    \"eslint-config-oclif-typescript\": \"^0.2.0\",\n-    \"globby\": \"^11.0.1\",\n-    \"mocha\": \"^8.2.1\",\n-    \"nock\": \"^13.0.1\",\n-    \"shx\": \"^0.3.3\",\n-    \"ts-node\": \"^9.0.0\",\n-    \"typescript\": \"3.8.3\"\n+    \"@commitlint/config-conventional\": \"^18.6.3\",\n+    \"@eslint/compat\": \"^1.4.1\",\n+    \"@oclif/core\": \"^4.8.0\",\n+    \"@oclif/prettier-config\": \"^0.2.1\",\n+    \"@types/chai\": \"^5.2.2\",\n+    \"@types/debug\": \"^4.1.12\",\n+    \"@types/mocha\": \"^10\",\n+    \"@types/node\": \"^18\",\n+    \"chai\": \"^5.3.3\",\n+    \"commitlint\": \"^18.6.1\",\n+    \"eslint\": \"^9.39.2\",\n+    \"eslint-config-oclif\": \"^6.0.127\",\n+    \"eslint-config-prettier\": \"^10.1.8\",\n+    \"husky\": \"^9.1.7\",\n+    \"lint-staged\": \"^15.5.2\",\n+    \"mocha\": \"^10\",\n+    \"prettier\": \"^3.7.4\",\n+    \"shx\": \"^0.4.0\",\n+    \"tsx\": \"^4.21.0\",\n+    \"typescript\": \"^5.7.3\"\n   },\n   \"engines\": {\n-    \"node\": \">=8.0.0\"\n+    \"node\": \">=18.0.0\"\n   },\n   \"files\": [\n     \"/lib\"\n@@ -38,11 +48,12 @@\n   \"repository\": \"oclif/test\",\n   \"scripts\": {\n     \"build\": \"shx rm -rf lib && tsc\",\n-    \"lint\": \"eslint . --ext .ts --config .eslintrc\",\n+    \"lint\": \"eslint\",\n     \"posttest\": \"yarn lint\",\n+    \"prepare\": \"husky && yarn build\",\n     \"prepublishOnly\": \"yarn run build\",\n-    \"test\": \"mocha --forbid-only \\\"test/**/*.test.ts\\\"\",\n-    \"pretest\": \"yarn build --noEmit && tsc -p test --noEmit\"\n+    \"pretest\": \"yarn build --noEmit && tsc -p test --noEmit\",\n+    \"test\": \"mocha --forbid-only \\\"test/**/*.test.ts\\\"\"\n   },\n   \"types\": \"lib/index.d.ts\"\n }\n",
					"match": false,
					"packageHash": "779f23f6cff7117686ee34cdf74697a9474539bdf59bcfd7c62daebc3b5915c2",
					"size": 1218,
					"sourceHash": "2285183ef2c90b25bef7c8b512ec319c5b78f46a8d9094a71e0c770161b98f9d",
					"status": "content"
				}
			},
			"summary": {
				"differentFiles": 4,
				"matchingFiles": 1,
				"missingInPackage": 0,
				"missingInSource": 9,
				"score": 0.07142857142857142,
				"totalFiles": 14
			}
		}
	}
]
