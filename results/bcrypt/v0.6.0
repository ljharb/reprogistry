[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2026-01-01T06:17:30.376Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:2.15.11",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "bcrypt@0.6.0",
			"name": "bcrypt",
			"version": "0.6.0",
			"location": "https://registry.npmjs.org/bcrypt/-/bcrypt-0.6.0.tgz",
			"integrity": "sha512-rUzai3XhwEvVl8ZagBLo2leY18mYGLsSGYTPoA5pu4GFwEjq6lMaooVSzWnEIwYf9v70teaA1F4zZ5aDmEOttw==",
			"publishedAt": "2012-06-26T17:23:19.824Z",
			"publishedWith": {
				"node": "v0.8.0",
				"npm": "1.1.21"
			}
		},
		"source": {
			"integrity": null,
			"location": "git://github.com/ncb000gt/node.bcrypt.js.git",
			"spec": "github:ncb000gt/node.bcrypt.js#HEAD"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				".npmignore": {
					"match": false,
					"packageHash": "4507d7900187d0c70a6553a7ecb8c5458f3495e7242606793b2413970e4dcfed",
					"size": 43,
					"status": "missing-in-source"
				},
				".travis.yml": {
					"match": false,
					"packageHash": "e04dab5bbd695c1b7c71c86159fe9c373dd40ed3dc70f4fe413bde1bcaebb0cf",
					"size": 97,
					"status": "missing-in-source"
				},
				"CHANGELOG": {
					"match": false,
					"packageHash": "a9ec5f6a2e8c161c693af570995ce2f7245b549ddb0e59cabadf568f304a552c",
					"size": 1297,
					"status": "missing-in-source"
				},
				"Makefile": {
					"diff": "--- published/Makefile\n+++ rebuilt/Makefile\n@@ -2,20 +2,18 @@\n \n all: test\n \n-build: clean configure compile\n+build: clean compile\n \n-configure:\n-\tnode-gyp configure\n-\n-compile: configure\n-\tnode-gyp build\n+compile:\n+\tnpm install .\n+\tnpm run install\n \n test: build\n-\t@./node_modules/nodeunit/bin/nodeunit \\\n+\t@./node_modules/.bin/jest \\\n \t\t$(TESTS)\n \n clean:\n-\tnode-gyp clean\n+\trm -Rf lib/bindings/\n \n \n .PHONY: clean test build\n",
					"match": false,
					"packageHash": "de84766efa1bd88fff33395f045a9d1f54aabad8fa86243c1166a0647a2c6300",
					"size": 245,
					"sourceHash": "db281cfe86cec6bfab7e23c1e22022a45c9f47cdd94b5b01701539e9f3f71959",
					"status": "content"
				},
				"README.md": {
					"diff": "--- published/README.md\n+++ rebuilt/README.md\n@@ -1,152 +1,345 @@\n-node.bcrypt.js\n-=============\n+# node.bcrypt.js\n \n-[![Build Status](https://secure.travis-ci.org/ncb000gt/node.bcrypt.js.png)](http://travis-ci.org/#!/ncb000gt/node.bcrypt.js) \n+[![ci](https://github.com/kelektiv/node.bcrypt.js/actions/workflows/ci.yaml/badge.svg)](https://github.com/kelektiv/node.bcrypt.js/actions/workflows/ci.yaml)\n \n-Lib to help you hash passwords.\n-[bcrypt on wikipedia][bcryptwiki]\n+[![Build Status](https://ci.appveyor.com/api/projects/status/github/kelektiv/node.bcrypt.js)](https://ci.appveyor.com/project/defunctzombie/node-bcrypt-js-pgo26/branch/master)\n \n-Catalyst for this module: [How To Safely Store A Password][codahale]\n+A library to help you hash passwords.\n \n+You can read about [bcrypt in Wikipedia][bcryptwiki] as well as in the following article:\n+[How To Safely Store A Password][codahale]\n \n-Version Compatability\n-=============\n+## If You Are Submitting Bugs or Issues\n \n-<table>\n-<tr>\n-<td>Node Ver</td><td>Bcrypt Version</td>\n-</tr>\n-<tr>\n-<td>&lt;= 0.4.x</td><td>&lt;= 0.4.x</td>\n-</tr>\n-<tr>\n-<td>&gt;= 0.6.x</td><td>&gt;= 0.5.x</td>\n-</tr>\n-</table>\n+Please verify that the NodeJS version you are using is a _stable_ version; Unstable versions are currently not supported and issues created while using an unstable version will be closed.\n \n+If you are on a stable version of NodeJS, please provide a sufficient code snippet or log files for installation issues. The code snippet does not require you to include confidential information. However, it must provide enough information so the problem can be replicable, or it may be closed without an explanation.\n \n-Security Issues/Concerns\n-=============\n \n-As should be the case with any security tool, this library should be scrutinized by anyone using it. If you find or suspect an issue with the code- please bring it to my attention and I'll spend some time trying to make sure that this tool is as secure as possible.\n+## Version Compatibility\n \n-To make it easier for people using this tool to analyze what has been surveyed, here is a list of BCrypt related security issues/concerns as they've come up.\n+_Please upgrade to at least v5.0.0 to avoid security issues mentioned below._\n+\n+| Node Version   |   Bcrypt Version  |\n+| -------------- | ------------------|\n+| 0.4            | <= 0.4            |\n+| 0.6, 0.8, 0.10 | >= 0.5            |\n+| 0.11           | >= 0.8            |\n+| 4              | <= 2.1.0          |\n+| 8              | >= 1.0.3 < 4.0.0  |\n+| 10, 11         | >= 3              |\n+| 12 onwards     | >= 3.0.6          |\n+| 18 onwards     | >= 6.0.0          |\n+\n+`node-gyp` only works with stable/released versions of node. Since the `bcrypt` module uses `node-gyp` to build and install, you'll need a stable version of node to use bcrypt. If you do not, you'll likely see an error that starts with:\n+\n+```\n+gyp ERR! stack Error: \"pre\" versions of node cannot be installed, use the --nodedir flag instead\n+```\n+\n+## Security Issues And Concerns\n+\n+> Per bcrypt implementation, only the first 72 bytes of a string are used. Any extra bytes are ignored when matching passwords. Note that this is not the first 72 *characters*. It is possible for a string to contain less than 72 characters, while taking up more than 72 bytes (e.g. a UTF-8 encoded string containing emojis). If a string is provided, it will be encoded using UTF-8.\n+\n+As should be the case with any security tool, anyone using this library should scrutinise it. If you find or suspect an issue with the code, please bring it to the maintainers' attention. We will spend some time ensuring that this library is as secure as possible.\n+\n+Here is a list of BCrypt-related security issues/concerns that have come up over the years.\n \n * An [issue with passwords][jtr] was found with a version of the Blowfish algorithm developed for John the Ripper. This is not present in the OpenBSD version and is thus not a problem for this module. HT [zooko][zooko].\n+* Versions `< 5.0.0` suffer from bcrypt wrap-around bug and _will truncate passwords >= 255 characters leading to severely weakened passwords_. Please upgrade at  earliest. See [this wiki page][wrap-around-bug] for more details.\n+* Versions `< 5.0.0` _do not handle NUL characters inside passwords properly leading to all subsequent characters being dropped and thus resulting in severely weakened passwords_. Please upgrade at earliest. See [this wiki page][improper-nuls] for more details.\n+\n+## Compatibility Note\n \n-Dependencies\n-=============\n+This library supports `$2a$` and `$2b$` prefix bcrypt hashes. `$2x$` and `$2y$` hashes are specific to bcrypt implementation developed for John the Ripper. In theory, they should be compatible with `$2b$` prefix.\n+\n+Compatibility with hashes generated by other languages is not 100% guaranteed due to difference in character encodings. However, it should not be an issue for most cases.\n+\n+### Migrating from v1.0.x\n+\n+Hashes generated in earlier version of `bcrypt` remain 100% supported in `v2.x.x` and later versions. In most cases, the migration should be a bump in the `package.json`.\n+\n+Hashes generated in `v2.x.x` using the defaults parameters will not work in earlier versions.\n+\n+## Dependencies\n \n * NodeJS\n-* OpenSSL (Development Libraries (header files) for compilation)\n+* `node-gyp`\n+ * Please check the dependencies for this tool at: https://github.com/nodejs/node-gyp\n+  * Windows users will need the options for c# and c++ installed with their visual studio instance.\n+  * Python 2.x/3.x\n+* `OpenSSL` - This is only required to build the `bcrypt` project if you are using versions <= 0.7.7. Otherwise, we're using the builtin node crypto bindings for seed data (which use the same OpenSSL code paths we were, but don't have the external dependency).\n",
					"match": false,
					"packageHash": "ccb21bc8bde9deddc8a11425323542c1168a1867803bc1bc29415b3a456ddf91",
					"size": 7185,
					"sourceHash": "f530fbacd1b2109c672ad1f639c13b02b0c5b4350997dbf46e393ad39fc843d5",
					"status": "content"
				},
				"bcrypt.js": {
					"diff": "--- published/bcrypt.js\n+++ rebuilt/bcrypt.js\n@@ -1,21 +1,14 @@\n-try {\n-  var bindings = require('./build/default/bcrypt_lib');\n-} catch(e) {\n-  //update for v0.5.5+\n-  var bindings = require('./build/Release/bcrypt_lib');\n-}\n+const path = require('path');\n+const bindings = require('node-gyp-build')(path.resolve(__dirname));\n+\n+const crypto = require('crypto');\n+\n+const promises = require('./promises');\n \n /// generate a salt (sync)\n /// @param {Number} [rounds] number of rounds (default 10)\n-/// @param {Number} [seed_length] number of random bytes (default 20)\n /// @return {String} salt\n-module.exports.gen_salt_sync = function(rounds, seed_length) {\n-  console.log(\"DEPRECATION WARNING: `gen_salt_sync` has been deprecated. Please use `genSaltSync` instead.\");\n-\n-  return module.exports.genSaltSync(rounds, seed_length);\n-}\n-\n-module.exports.genSaltSync = function(rounds, seed_length) {\n+function genSaltSync(rounds, minor) {\n     // default 10 rounds\n     if (!rounds) {\n         rounds = 10;\n@@ -23,162 +16,227 @@\n         throw new Error('rounds must be a number');\n     }\n \n-    // default length 20\n-    if (!seed_length) {\n-        seed_length = 20;\n-    } else if (typeof seed_length !== 'number') {\n-        throw new Error('seed_length must be a number');\n+    if (!minor) {\n+        minor = 'b';\n+    } else if (minor !== 'b' && minor !== 'a') {\n+        throw new Error('minor must be either \"a\" or \"b\"');\n     }\n \n-    return bindings.gen_salt_sync(rounds, seed_length);\n-};\n+    return bindings.gen_salt_sync(minor, rounds, crypto.randomBytes(16));\n+}\n \n /// generate a salt\n /// @param {Number} [rounds] number of rounds (default 10)\n-/// @param {Number} [seed_length] number of random bytes (default 20)\n /// @param {Function} cb callback(err, salt)\n-module.exports.gen_salt = function(rounds, seed_length, cb) {\n-  console.log(\"DEPRECATION WARNING: `gen_salt` has been deprecated. Please use `genSalt` instead.\");\n+function genSalt(rounds, minor, cb) {\n+    let error;\n \n-  return module.exports.genSalt(rounds, seed_length, cb);\n-}\n-\n-module.exports.genSalt = function(rounds, seed_length, cb) {\n     // if callback is first argument, then use defaults for others\n     if (typeof arguments[0] === 'function') {\n-        // have to set callback first otherwise arguments are overriden\n+        // have to set callback first otherwise arguments are overridden\n         cb = arguments[0];\n         rounds = 10;\n-        seed_length = 20;\n-    // callback is second argument\n+        minor = 'b';\n+        // callback is second argument\n     } else if (typeof arguments[1] === 'function') {\n-        // have to set callback first otherwise arguments are overriden\n+        // have to set callback first otherwise arguments are overridden\n         cb = arguments[1];\n-        seed_length = 20;\n+        minor = 'b';\n+    }\n+\n+    if (!cb) {\n+        return promises.promise(genSalt, this, [rounds, minor]);\n     }\n \n     // default 10 rounds\n     if (!rounds) {\n         rounds = 10;\n     } else if (typeof rounds !== 'number') {\n-        throw new Error('rounds must be a number');\n-    }\n+        // callback error asynchronously\n+        error = new Error('rounds must be a number');\n+        return process.nextTick(function () {\n+            cb(error);\n+        });\n+    }\n+\n+    if (!minor) {\n",
					"match": false,
					"packageHash": "febd0b8a416554829e4bbc1626501fce5c510a4f6b9813f5d9008c890a3fb32a",
					"size": 6335,
					"sourceHash": "427843f9f572915536dffb47cbeddfdeb8f1c24ddf5db75d76021c1efa522c48",
					"status": "content"
				},
				"binding.gyp": {
					"diff": "--- published/binding.gyp\n+++ rebuilt/binding.gyp\n@@ -1,15 +1,49 @@\n {\n+  \"variables\": {\n+    \"NODE_VERSION%\":\"<!(node -p \\\"process.versions.node.split(\\\\\\\".\\\\\\\")[0]\\\")\"\n+  },\n   'targets': [\n     {\n       'target_name': 'bcrypt_lib',\n-      'include_dirs': [\n-        '<(node_root_dir)/deps/openssl/openssl/include'\n-      ],\n       'sources': [\n         'src/blowfish.cc',\n         'src/bcrypt.cc',\n         'src/bcrypt_node.cc'\n-      ]\n-    }\n+      ],\n+      'defines': [\n+            '_GNU_SOURCE',\n+      ],\n+      'cflags!': [ '-fno-exceptions' ],\n+      'cflags_cc!': [ '-fno-exceptions' ],\n+      'dependencies': [\n+          \"<!(node -p \\\"require('node-addon-api').targets\\\"):node_addon_api_except\",\n+      ],\n+      'conditions': [\n+        ['OS==\"win\"', {\n+          \"msvs_settings\": {\n+            \"VCCLCompilerTool\": {\n+              \"ExceptionHandling\": 1\n+            }\n+          },\n+          'defines': [\n+            'uint=unsigned int',\n+          ]\n+        }],\n+        ['OS==\"mac\"', {\n+          'cflags+': ['-fvisibility=hidden'],\n+          \"xcode_settings\": {\n+            \"CLANG_CXX_LIBRARY\": \"libc++\",\n+            'GCC_ENABLE_CPP_EXCEPTIONS': 'YES',\n+            'GCC_SYMBOLS_PRIVATE_EXTERN': 'YES', # -fvisibility=hidden\n+          }\n+        }],\n+        ['OS==\"zos\" and NODE_VERSION <= 16',{\n+            'cflags': [\n+              '-qascii',\n+            ],\n+            'defines': [\"NAPI_DISABLE_CPP_EXCEPTIONS\"],\n+        }],\n+      ],\n+    },\n   ]\n }\n",
					"match": false,
					"packageHash": "256ddfb48d383b6d0de03b689c6422b69857ba74866bfb096ae5ada573f8b88c",
					"size": 267,
					"sourceHash": "b55c2f501c320237f9a2340994b4645a471d641af3d341b9d9f3eb404b3bda5d",
					"status": "content"
				},
				"examples/async_compare.js": {
					"diff": "--- published/examples/async_compare.js\n+++ rebuilt/examples/async_compare.js\n@@ -1,21 +1,28 @@\n-var bcrypt = require('../bcrypt');\n+const bcrypt = require('../bcrypt');\n \n-var start = Date.now();\n-bcrypt.gen_salt(10, function(err, salt) {\n-  console.log('salt: ' + salt);\n-  console.log('salt cb end: ' + (Date.now() - start) + 'ms');\n-  bcrypt.encrypt('test', salt, function(err, crypted) {\n+(async () => {\n+    const start = Date.now();\n+\n+    // genSalt\n+    const salt = await bcrypt.genSalt(10)\n+    console.log('salt: ' + salt);\n+    console.log('salt cb end: ' + (Date.now() - start) + 'ms');\n+\n+    // hash\n+    const crypted = await bcrypt.hash('test', salt)\n     console.log('crypted: ' + crypted);\n     console.log('crypted cb end: ' + (Date.now() - start) + 'ms');\n-    console.log('rounds used from hash:', bcrypt.get_rounds(crypted));\n-    bcrypt.compare('test', crypted, function(err, res) {\n-      console.log('compared true: ' + res);\n-      console.log('compared true cb end: ' + (Date.now() - start) + 'ms');\n-    });\n-    bcrypt.compare('bacon', crypted, function(err, res) {\n-      console.log('compared false: ' + res);\n-      console.log('compared false cb end: ' + (Date.now() - start) + 'ms');\n-    });\n-  });\n-})\n-console.log('end: ' + (Date.now() - start) + 'ms');\n+    console.log('rounds used from hash:', bcrypt.getRounds(crypted));\n+\n+    // compare\n+    const res = await bcrypt.compare('test', crypted)\n+    console.log('compared true: ' + res);\n+    console.log('compared true cb end: ' + (Date.now() - start) + 'ms');\n+\n+    // compare\n+    const res2 = await bcrypt.compare('bacon', crypted)\n+    console.log('compared false: ' + res2);\n+    console.log('compared false cb end: ' + (Date.now() - start) + 'ms');\n+\n+    console.log('end: ' + (Date.now() - start) + 'ms');\n+})();\n",
					"match": false,
					"packageHash": "563f0e3478bd2a468d85171c0060c9bc9233fcc13539b79e44720ee3cb64d29e",
					"size": 862,
					"sourceHash": "d6ad56d866ed456ac488d1092ee9af6c0082f2b0525e65ef31946a25fd0ab4de",
					"status": "content"
				},
				"examples/forever_gen_salt.js": {
					"diff": "--- published/examples/forever_gen_salt.js\n+++ rebuilt/examples/forever_gen_salt.js\n@@ -1,7 +1,8 @@\n-var bcrypt = require('../bcrypt');\n+const bcrypt = require('../bcrypt');\n \n-while (true) {\n-  bcrypt.gen_salt(10, function(err, salt) {\n+(function printSalt() {\n+  bcrypt.genSalt(10, (err, salt) => {\n     console.log('salt: ' + salt);\n+    printSalt();\n   });\n-}\n+})()\n",
					"match": false,
					"packageHash": "88b7df46ac62d9300bc60c43c5d98a0c47e4e30c448f3f6bf90c370f2ff66f3c",
					"size": 137,
					"sourceHash": "33c061859fb610a143fea68be091f708b40ab9d8649a4f2e83017015570c63fe",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,40 +1,62 @@\n {\n   \"name\": \"bcrypt\",\n   \"description\": \"A bcrypt library for NodeJS.\",\n-  \"keywords\": [\"bcrypt\",\"password\",\"auth\",\"authentication\",\"encryption\",\"crypt\",\"crypto\"],\n+  \"keywords\": [\n+    \"bcrypt\",\n+    \"password\",\n+    \"auth\",\n+    \"authentication\",\n+    \"encryption\",\n+    \"crypt\",\n+    \"crypto\"\n+  ],\n   \"main\": \"./bcrypt\",\n-  \"version\": \"0.6.0\",\n-  \"author\": \"Nick Campbell (http://github.com/ncb000gt)\",\n-  \"engines\": { \"node\": \">= 0.6.0\" },\n+  \"version\": \"6.0.0\",\n+  \"author\": \"Nick Campbell (https://github.com/ncb000gt)\",\n+  \"engines\": {\n+    \"node\": \">= 18\"\n+  },\n   \"repository\": {\n-        \"type\": \"git\",\n-        \"url\": \"http://github.com/ncb000gt/node.bcrypt.js.git\"\n-   },\n-   \"licenses\": [\n-     {\n-        \"type\": \"MIT\"\n-     }\n-   ],\n-   \"bugs\": {\n-     \"url\" : \"http://github.com/ncb000gt/node.bcrypt.js/issues\"\n-   },\n-   \"scripts\": {\n-     \"test\": \"make test\"\n-   },\n-   \"devDependencies\": {\n-     \"nodeunit\": \">=0.6.4\"\n-   },\n-   \"contributors\": [\n-     \"Antonio Salazar Cardozo <savedfastcool@gmail.com> (https://github.com/Shadowfiend)\",\n-     \"Van Nguyen <the.gol.effect@gmail.com> (https://github.com/thegoleffect)\",\n-     \"David Trejo <david@dtrejo.com> (https://github.com/dtrejo)\",\n-     \"Ben Glow <glen.low@pixelglow.com> (https://github.com/pixelglow)\",\n-     \"NewITFarmer.com <> (https://github.com/newitfarmer)\",\n-     \"Alfred Westerveld <alfredwesterveld@gmail.com> (https://github.com/alfredwesterveld)\",\n-     \"Vincent Côté-Roy <vincentcr@gmail.com> (https://github.com/vincentcr)\",\n-     \"Lloyd Hilaiel <lloyd@hilaiel.com> (https://github.com/lloyd)\",\n-     \"Roman Shtylman <shtylman@gmail.com> (https://github.com/shtylman)\",\n-     \"Vadim Graboys <dimva13@gmail.com> (https://github.com/vadimg)\",\n-     \"Ben Noorduis <> (https://github.com/bnoordhuis)\"\n-   ]\n+    \"type\": \"git\",\n+    \"url\": \"https://github.com/kelektiv/node.bcrypt.js.git\"\n+  },\n+  \"license\": \"MIT\",\n+  \"bugs\": {\n+    \"url\": \"https://github.com/kelektiv/node.bcrypt.js/issues\"\n+  },\n+  \"scripts\": {\n+    \"test\": \"jest\",\n+    \"install\": \"node-gyp-build\",\n+    \"build\": \"prebuildify --napi --tag-libc --strip\"\n+  },\n+  \"dependencies\": {\n+    \"node-addon-api\": \"^8.3.0\",\n+    \"node-gyp-build\": \"^4.8.4\"\n+  },\n+  \"devDependencies\": {\n+    \"jest\": \"^29.7.0\",\n+    \"prebuildify\": \"^6.0.1\"\n+  },\n+  \"contributors\": [\n+    \"Antonio Salazar Cardozo <savedfastcool@gmail.com> (https://github.com/Shadowfiend)\",\n+    \"Van Nguyen <the.gol.effect@gmail.com> (https://github.com/thegoleffect)\",\n+    \"David Trejo <david@dtrejo.com> (https://github.com/dtrejo)\",\n+    \"Ben Glow <glen.low@pixelglow.com> (https://github.com/pixelglow)\",\n+    \"NewITFarmer.com <> (https://github.com/newitfarmer)\",\n+    \"Alfred Westerveld <alfredwesterveld@gmail.com> (https://github.com/alfredwesterveld)\",\n+    \"Vincent Côté-Roy <vincentcr@gmail.com> (https://github.com/vincentcr)\",\n+    \"Lloyd Hilaiel <lloyd@hilaiel.com> (https://github.com/lloyd)\",\n+    \"Roman Shtylman <shtylman@gmail.com> (https://github.com/shtylman)\",\n+    \"Vadim Graboys <dimva13@gmail.com> (https://github.com/vadimg)\",\n+    \"Ben Noorduis <> (https://github.com/bnoordhuis)\",\n+    \"Nate Rajlich <nathan@tootallnate.net> (https://github.com/tootallnate)\",\n+    \"Sean McArthur <sean.monstar@gmail.com> (https://github.com/seanmonstar)\",\n+    \"Fanie Oosthuysen <fanie.oosthuysen@gmail.com> (https://github.com/weareu)\",\n+    \"Amitosh Swain Mahapatra <amitosh.swain@gmail.com> (https://github.com/Agathver)\",\n+    \"Corbin Crutchley <crutchcorn@gmail.com> (https://github.com/crutchcorn)\",\n+    \"Nicola Del Gobbo <nicoladelgobbo@gmail.com> (https://github.com/NickNaso)\"\n+  ],\n+  \"binary\": {\n+    \"module_name\": \"bcrypt_lib\"\n+  }\n }\n",
					"match": false,
					"packageHash": "ecc5322e9b153079ca15d58e01d6c27d25f91057bc2f74107003246f8012287d",
					"size": 1497,
					"sourceHash": "33510b2b8859265a413ab101cdf961b1c9b076d93496f52d8ac7eacc007859a4",
					"status": "content"
				},
				"src/bcrypt.cc": {
					"diff": "--- published/src/bcrypt.cc\n+++ rebuilt/src/bcrypt.cc\n@@ -1,46 +1,32 @@\n-/*\t$OpenBSD: bcrypt.c,v 1.24 2008/04/02 19:54:05 millert Exp $\t*/\n+/*\t$OpenBSD: bcrypt.c,v 1.31 2014/03/22 23:02:03 tedu Exp $\t*/\n \n /*\n- * Copyright 1997 Niels Provos <provos@physnet.uni-hamburg.de>\n- * All rights reserved.\n+ * Copyright (c) 1997 Niels Provos <provos@umich.edu>\n  *\n- * Redistribution and use in source and binary forms, with or without\n- * modification, are permitted provided that the following conditions\n- * are met:\n- * 1. Redistributions of source code must retain the above copyright\n- *    notice, this list of conditions and the following disclaimer.\n- * 2. Redistributions in binary form must reproduce the above copyright\n- *    notice, this list of conditions and the following disclaimer in the\n- *    documentation and/or other materials provided with the distribution.\n- * 3. All advertising materials mentioning features or use of this software\n- *    must display the following acknowledgement:\n- *      This product includes software developed by Niels Provos.\n- * 4. The name of the author may not be used to endorse or promote products\n- *    derived from this software without specific prior written permission.\n+ * Permission to use, copy, modify, and distribute this software for any\n+ * purpose with or without fee is hereby granted, provided that the above\n+ * copyright notice and this permission notice appear in all copies.\n  *\n- * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR\n- * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n- * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,\n- * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n- * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n- * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n- * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n- * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n- * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n+ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n+ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n+ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n+ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n+ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n+ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n  */\n \n /* This password hashing algorithm was designed by David Mazieres\n  * <dm@lcs.mit.edu> and works as follows:\n  *\n  * 1. state := InitState ()\n- * 2. state := ExpandKey (state, salt, password) 3.\n- * REPEAT rounds:\n- *\tstate := ExpandKey (state, 0, salt)\n- *      state := ExpandKey(state, 0, password)\n+ * 2. state := ExpandKey (state, salt, password)\n+ * 3. REPEAT rounds:\n+ *    \tstate := ExpandKey (state, 0, password)\n+ *    state := ExpandKey (state, 0, salt)\n  * 4. ctext := \"OrpheanBeholderScryDoubt\"\n  * 5. REPEAT 64:\n- * \tctext := Encrypt_ECB (state, ctext);\n+ *    \tctext := Encrypt_ECB (state, ctext);\n  * 6. RETURN Concatenate (salt, ctext);\n  *\n  */\n@@ -49,9 +35,13 @@\n #include <stdlib.h>\n #include <sys/types.h>\n #include <string.h>\n-#include <pwd.h>\n+\n #include \"node_blf.h\"\n \n+#ifdef _WIN32\n+#define snprintf _snprintf\n+#endif\n+\n //#if !defined(__APPLE__) && !defined(__MACH__)\n //#include \"bsd/stdlib.h\"\n //#endif\n@@ -61,10 +51,6 @@\n  * time to come.\n  */\n \n-/*char *bcrypt(const char *, const char *);\n-void encode_salt(char *, u_int8_t *, u_int16_t, u_int8_t);\n-char * bcrypt_gensalt(u_int8_t log_rounds);*/\n-\n static void encode_base64(u_int8_t *, u_int8_t *, u_int16_t);\n static void decode_base64(u_int8_t *, u_int16_t, u_int8_t *);\n \n@@ -126,14 +112,15 @@\n }\n \n void\n-encode_salt(char *salt, u_int8_t *csalt, u_int16_t clen, u_int8_t logr)\n+encode_salt(char *salt, u_int8_t *csalt, char minor, u_int16_t clen, u_int8_t logr)\n {\n \tsalt[0] = '$';\n",
					"match": false,
					"packageHash": "cfffe76eebbfe77898750b779f4c6c8c46c5e96135107bac975c4e63fbf6f043",
					"size": 8740,
					"sourceHash": "cf1f9a181571653ff8a6089cf54bad4d354e1b3cc68c8d4c319d42338db52f2f",
					"status": "content"
				},
				"src/bcrypt_node.cc": {
					"diff": "--- published/src/bcrypt_node.cc\n+++ rebuilt/src/bcrypt_node.cc\n@@ -1,477 +1,288 @@\n-/*\n- * Copyright (c) 2010, Nicholas Campbell <nicholas.j.campbell@gmail.com>\n- * All rights reserved.\n- *\n- * Redistribution and use in source and binary forms, with or without \n- * modification, are permitted provided that the following conditions \n- * are met:\n- * \n- *  1. Redistributions of source code must retain the above copyright \n- * notice, this list of conditions and the following disclaimer.\n- *  2. Redistributions in binary form must reproduce the above copyright \n- * notice, this list of conditions and the following disclaimer in the \n- * documentation and/or other materials provided with the distribution.\n- *  3. Neither the name of the <ORGANIZATION> nor the names of its \n- * contributors may be used to endorse or promote products derived from \n- * this software without specific prior written permission.\n- * \n- * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \n- * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT \n- * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR \n- * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT \n- * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, \n- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT \n- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, \n- * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY \n- * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT \n- * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE \n- * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n- */\n+#define NAPI_VERSION 3\n \n-#include <node.h>\n-#include <node_version.h>\n+#include <napi.h>\n \n #include <string>\n #include <cstring>\n-#include <memory>\n+#include <vector>\n+#include <stdlib.h> // atoi\n \n-#include <openssl/rand.h>\n-#include <openssl/crypto.h>\n #include \"node_blf.h\"\n \n-//pulled from node commit - 97cada0\n-#ifdef _WIN32\n-# include <windows.h>\n-#else\n-# include <pthread.h>\n-#endif\n-\n #define NODE_LESS_THAN (!(NODE_VERSION_AT_LEAST(0, 5, 4)))\n \n-using namespace v8;\n-using namespace node;\n-\n-#ifdef _WIN32\n-\n-static HANDLE* locks;\n-\n-\n-static void crypto_lock_init(void) {\n-  int i, n;\n-\n-  n = CRYPTO_num_locks();\n-  locks = new HANDLE[n];\n-\n-  for (i = 0; i < n; i++)\n-    if (!(locks[i] = CreateMutex(NULL, FALSE, NULL)))\n-      abort();\n-}\n-\n-static void crypto_lock_cb(int mode, int n, const char* file, int line) {\n-  if (mode & CRYPTO_LOCK)\n-    WaitForSingleObject(locks[type], INFINITE);\n-  else\n-    ReleaseMutex(locks[type]);\n-}\n-\n-static unsigned long crypto_id_cb(void) {\n-  return (unsigned long) GetCurrentThreadId();\n-}\n-\n-#else /* !_WIN32 */\n-\n-static pthread_rwlock_t* locks;\n-\n-static void crypto_lock_init(void) {\n-\n-  const int n = CRYPTO_num_locks();\n-  locks = new pthread_rwlock_t[n];\n-\n-  for (int i = 0; i < n; i++)\n-    if (pthread_rwlock_init(locks + i, NULL))\n-      abort();\n-}\n",
					"match": false,
					"packageHash": "633e6f93d29077e944330e98dba643d6c074b5bec016fef6fbf831c11b4415bb",
					"size": 12603,
					"sourceHash": "816139374a489becd768564177bf57198c9b12eb83f14476272d9cd690053d87",
					"status": "content"
				},
				"src/blowfish.cc": {
					"diff": "--- published/src/blowfish.cc\n+++ rebuilt/src/blowfish.cc\n@@ -39,13 +39,6 @@\n  * Bruce Schneier.\n  */\n \n-#if 0\n-#include <stdio.h>\t\t/* used for debugging */\n-#include <string.h>\n-#endif\n-\n-#include <sys/types.h>\n-\n #include \"node_blf.h\"\n \n #undef inline\n",
					"match": false,
					"packageHash": "8d8c8fd8416666a3805f16d104cebf9b71ce6e7975b4f2ec0e26840ca943be82",
					"size": 23323,
					"sourceHash": "ae054436efc92bb17a69832fa2e04823375765a10aa726dcfd1f0e42a3a76858",
					"status": "content"
				},
				"src/node_blf.h": {
					"diff": "--- published/src/node_blf.h\n+++ rebuilt/src/node_blf.h\n@@ -34,6 +34,8 @@\n #ifndef _NODE_BLF_H_\n #define _NODE_BLF_H_\n \n+#include <sys/types.h>\n+\n /* Solaris compatibility */\n #ifdef __sun\n #define u_int8_t uint8_t\n@@ -42,6 +44,32 @@\n #define u_int64_t uint64_t\n #endif\n \n+#ifdef _WIN32\n+#define u_int8_t unsigned __int8\n+#define u_int16_t unsigned __int16\n+#define u_int32_t unsigned __int32\n+#define u_int64_t unsigned __int64\n+#endif\n+\n+/* Windows ssize_t compatibility */\n+#if defined(_WIN32) || defined(_WIN64)\n+#  if defined(_WIN64)\n+     typedef __int64 LONG_PTR;\n+#  else\n+     typedef long LONG_PTR;\n+#  endif\n+  typedef LONG_PTR SSIZE_T;\n+  typedef SSIZE_T ssize_t;\n+#endif\n+\n+/* z/OS compatibility */\n+#ifdef __MVS__\n+typedef unsigned char u_int8_t;\n+typedef unsigned short u_int16_t;\n+typedef unsigned int u_int32_t;\n+typedef unsigned long long u_int64_t;\n+#endif\n+\n #define BCRYPT_VERSION '2'\n #define BCRYPT_MAXSALT 16\t/* Precomputation is just so nice */\n #define BCRYPT_BLOCKS 6\t\t/* Ciphertext blocks */\n@@ -96,9 +124,9 @@\n u_int32_t Blowfish_stream2word(const u_int8_t *, u_int16_t , u_int16_t *);\n \n /* bcrypt functions*/\n-void bcrypt_gensalt(u_int8_t, u_int8_t*, char *);\n-void bcrypt(const char *, const char *, char *);\n-void encode_salt(char *, u_int8_t *, u_int16_t, u_int8_t);\n+void bcrypt_gensalt(char, u_int8_t, u_int8_t*, char *);\n+void bcrypt(const char *, size_t key_len, const char *, char *);\n+void encode_salt(char *, u_int8_t *, char, u_int16_t, u_int8_t);\n u_int32_t bcrypt_get_rounds(const char *);\n \n #endif\n",
					"match": false,
					"packageHash": "959449435c02a1fea1a5ee64d84f1060b3bc74f7af1b99000639ca740d30c48c",
					"size": 4140,
					"sourceHash": "3ade3327092d38ff15af128831ed262f1c8659a91554700c88a7b51e9741fe2f",
					"status": "content"
				},
				"test/async.js": {
					"match": false,
					"packageHash": "fcca03ba64f1e292976d33088af7ba435b160c0ae1f6102a185d86659cadd560",
					"size": 5014,
					"status": "missing-in-source"
				},
				"test/deprecated.js": {
					"match": false,
					"packageHash": "40bac9f05cc3ad179ec8b9fb3cff72652c99fc99f9ad2af9e0eb0ee352239afb",
					"size": 1341,
					"status": "missing-in-source"
				},
				"test/repetitions.js": {
					"match": false,
					"packageHash": "1a544cca690bf8dc60b701da2f42db6946fefadfb7562a9d3e89799ec52f017e",
					"size": 2954,
					"status": "missing-in-source"
				},
				"test/sync.js": {
					"match": false,
					"packageHash": "98fd08f847654122e46b56e14c70f4ba9df843c493a6b4cf9674f3095111059d",
					"size": 4523,
					"status": "missing-in-source"
				},
				"wscript": {
					"match": false,
					"packageHash": "772624380c240a63c6d20763446035a2dbb1e638e39322c03c79e676d117060d",
					"size": 1623,
					"status": "missing-in-source"
				},
				".dockerignore": {
					"match": false,
					"status": "missing-in-package"
				},
				".editorconfig": {
					"match": false,
					"status": "missing-in-package"
				},
				".github/workflows/build-pack-publish.yml": {
					"match": false,
					"status": "missing-in-package"
				},
				".github/workflows/ci.yaml": {
					"match": false,
					"status": "missing-in-package"
				},
				"CHANGELOG.md": {
					"match": false,
					"status": "missing-in-package"
				},
				"Dockerfile": {
					"match": false,
					"status": "missing-in-package"
				},
				"Dockerfile-alpine": {
					"match": false,
					"status": "missing-in-package"
				},
				"ISSUE_TEMPLATE.md": {
					"match": false,
					"status": "missing-in-package"
				},
				"SECURITY.md": {
					"match": false,
					"status": "missing-in-package"
				},
				"build-all.sh": {
					"match": false,
					"status": "missing-in-package"
				},
				"promises.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"test/async.test.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"test/implementation.test.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"test/promise.test.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"test/repetitions.test.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"test/sync.test.js": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 11,
				"matchingFiles": 1,
				"missingInPackage": 16,
				"missingInSource": 8,
				"score": 0.027777777777777776,
				"totalFiles": 36
			}
		}
	}
]
