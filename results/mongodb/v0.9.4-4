[
	{
		"reproduceVersion": "0.0.0-local",
		"timestamp": "2025-12-31T07:58:36.311Z",
		"os": "linux",
		"arch": "x64",
		"strategy": "npm:11.7.0",
		"reproduced": false,
		"attested": false,
		"package": {
			"spec": "mongodb@0.9.4-4",
			"name": "mongodb",
			"version": "0.9.4-4",
			"location": "https://registry.npmjs.org/mongodb/-/mongodb-0.9.4-4.tgz",
			"integrity": "sha512-8E0m4O1XH17rAip3r0SuVm0cCMm+Logkpi6nS0jY4qVyHi0dMJcdX+WdGZLqS21GukEs8l+LuBqA4Y7XYP6WbQ==",
			"publishedAt": "2011-06-21T15:35:11.643Z",
			"publishedWith": {
				"node": "v0.4.8",
				"npm": "1.0.13"
			}
		},
		"source": {
			"integrity": null,
			"location": "git://github.com/christkv/node-mongodb-native.git",
			"spec": "github:christkv/node-mongodb-native#HEAD"
		},
		"comparisonHash": "8a2a8dcbb729bf3ee9216e490c955701f0ddebe1",
		"diff": {
			"files": {
				".gitignore": {
					"match": false,
					"packageHash": "ab2b279b644bfcbe9754a85e868e0e9873025986870e35ce7d3e297ecc330b0e",
					"size": 66,
					"status": "missing-in-source"
				},
				"HISTORY": {
					"match": false,
					"packageHash": "94154cb67195e163dac9232fcfd2c6154ac043fb34332a0d2049093525e3c478",
					"size": 239,
					"status": "missing-in-source"
				},
				"Makefile": {
					"diff": "--- published/Makefile\n+++ rebuilt/Makefile\n@@ -1,22 +1,45 @@\n-\n NODE = node\n-NODEUNIT = nodeunit\n+NPM = npm\n+NODEUNIT = node_modules/nodeunit/bin/nodeunit\n+DOX = node_modules/dox/bin/dox\n name = all\n \n total: build_native\n \n build_native:\n-\t$(MAKE) -C ./external-libs/bson\n+\t# $(MAKE) -C ./external-libs/bson all\n+\n+build_native_debug:\n+\t$(MAKE) -C ./external-libs/bson all_debug\n+\n+build_native_clang:\n+\t$(MAKE) -C ./external-libs/bson clang\n+\n+build_native_clang_debug:\n+\t$(MAKE) -C ./external-libs/bson clang_debug\n \n clean_native:\n \t$(MAKE) -C ./external-libs/bson clean\n \n-test: build_native test_nodeunit_pure test_nodeunit_native\n+test: build_native\n+\t@echo \"\\n == Run All tests minus replicaset tests==\"\n+\t$(NODE) dev/tools/test_all.js --noreplicaset --boot\n+\n+test_pure: build_native\n+\t@echo \"\\n == Run All tests minus replicaset tests==\"\n+\t$(NODE) dev/tools/test_all.js --noreplicaset --boot --noactive\n+\n+test_junit: build_native\n+\t@echo \"\\n == Run All tests minus replicaset tests==\"\n+\t$(NODE) dev/tools/test_all.js --junit --noreplicaset\n \n test_nodeunit_pure:\n \t@echo \"\\n == Execute Test Suite using Pure JS BSON Parser == \"\n \t@$(NODEUNIT) test/ test/gridstore test/bson\n \n+test_js:\n+\t@$(NODEUNIT) $(TESTS)\n+\n test_nodeunit_replicaset_pure:\n \t@echo \"\\n == Execute Test Suite using Pure JS BSON Parser == \"\n \t@$(NODEUNIT) test/replicaset\n@@ -29,8 +52,20 @@\n \t@echo \"\\n == Execute Test Suite using Native BSON Parser == \"\n \t@TEST_NATIVE=TRUE $(NODEUNIT) test/replicaset\n \n+test_all: build_native\n+\t@echo \"\\n == Run All tests ==\"\n+\t$(NODE) dev/tools/test_all.js --boot\n+\n+test_all_junit: build_native\n+\t@echo \"\\n == Run All tests ==\"\n+\t$(NODE) dev/tools/test_all.js --junit --boot\n+\n clean:\n \trm ./external-libs/bson/bson.node\n \trm -r ./external-libs/bson/build\n \n-.PHONY: total\n\\ No newline at end of file\n+generate_docs:\n+\t$(NODE) dev/tools/build-docs.js\n+\tmake --directory=./docs/sphinx-docs --file=Makefile html\n+\n+.PHONY: total\n",
					"match": false,
					"packageHash": "5367a8df246c053859ef5e97d8779f9609471f9c50f26cf79dbb8c683543584b",
					"size": 867,
					"sourceHash": "9a40c06659b42802352fedb651c7e3ac1993e441b74345c4f4015c7835dbd375",
					"status": "content"
				},
				"Readme.md": {
					"diff": "--- published/Readme.md\n+++ rebuilt/Readme.md\n@@ -1,18 +1,29 @@\n+Main Documentation site\n+=======================\n+\n+[Documentation](http://christkv.github.com/node-mongodb-native/)\n+\n Install\n ========\n \n-Run:\n+To install the most recent release from npm, run:\n+\n+    npm install mongodb\n+    \n+That may give you a warning telling you that bugs['web'] should be bugs['url'], it would be safe to ignore it (this has been fixed in the development version) \n \n-    make\n+To install the latest from the repository, run::\n+\n+    npm install path/to/node-mongodb-native\n \n Community\n ========\n-Check out the google group http://groups.google.com/group/node-mongodb-native for questions/answers from users of the driver.\n+Check out the google group [node-mongodb-native](http://groups.google.com/group/node-mongodb-native) for questions/answers from users of the driver.\n \n Introduction\n ========\n \n-This is a node.js driver for MongoDB. It's a port (or close to a port) of the libary for ruby at http://github.com/mongodb/mongo-ruby-driver/.\n+This is a node.js driver for MongoDB. It's a port (or close to a port) of the library for ruby at http://github.com/mongodb/mongo-ruby-driver/.\n \n A simple example of inserting a document.\n \n@@ -27,7 +38,7 @@\n             // Locate all the entries using find\n             collection.find().toArray(function(err, results) {\n               test.assertEquals(1, results.length);\n-              test.assertTrue(results.a === 2);\n+              test.assertTrue(results[0].a === 2);\n \n               // Let's close the db\n               client.close();\n@@ -39,35 +50,59 @@\n       client.collection('test_insert', test);\n     });\n \n-Important\n+Data types\n ========\n \n-To enable the driver to use the C/C++ bson parser pass it the option native_parser:true like below\n+To store and retrieve the non-JSON MongoDb primitives ([ObjectID](http://www.mongodb.org/display/DOCS/Object+IDs), Long, Binary, [Timestamp](http://www.mongodb.org/display/DOCS/Timestamp+data+type), [DBRef](http://www.mongodb.org/display/DOCS/Database+References#DatabaseReferences-DBRef), Code).\n+\n+In particular, every document has a unique `_id` which can be almost any type, and by default a 12-byte ObjectID is created. ObjectIDs can be represented as 24-digit hexadecimal strings, but you must convert the string back into an ObjectID before you can use it in the database. For example: \n+\n+    // Get the objectID type\n+    var ObjectID = require('mongodb').ObjectID;\n+    \n+    var idString = '4e4e1638c85e808431000003';\n+    collection.findOne({_id: new ObjectID(idString)}, console.log)  // ok\n+    collection.findOne({_id: idString}, console.log)  // wrong! callback gets undefined\n+\n+Here are the constructors the non-Javascript BSON primitive types:\n+\n+    // Fetch the library\n+    var mongo = require('mongodb');\n+    // Create new instances of BSON types\n+    new mongo.Long(numberString)\n+    new mongo.ObjectID(hexString)\n+    new mongo.Timestamp()  // the actual unique number is generated on insert.\n+    new mongo.DBRef(collectionName, id, dbName)\n+    new mongo.Binary(buffer)  // takes a string or Buffer\n+    new mongo.Code(code, [context])\n+    new mongo.Symbol(string)\n+    new mongo.MinKey()\n+    new mongo.MaxKey()\n+    new mongo.Double(number)\t// Force double storage\n \n+The C/C++ bson parser/serializer\n+--------\n+\n+From V0.8.0 to V0.9.6.9, the Javascript bson parser was slower than an optional C/C++ bson parser. As of V0.9.6.9+, due to performance improvements in the Javascript parser, the C/C++ parser is deprecated and is not installed by default anymore.\n+\n+If you are running a version of this library has the C/C++ parser compiled, to enable the driver to use the C/C++ bson parser pass it the option native_parser:true like below\n+\n+    // using Deprecated native_parser:\n     var client = new Db('integration_tests_20',\n                         new Server(\"127.0.0.1\", 27017),\n                         {native_parser:true});\n \n-The version V0.8.0 > contains a C/C++ native BSON parser, this leads to some small changes in the way you need to access the BSON classes as you need to use the right versions of the classes with the right driver.\n-\n-To access the correct version of BSON objects for your instance do the following\n-\n-    client.bson_serializer.Long\n-    client.bson_serializer.ObjectID\n-    client.bson_serializer.Timestamp\n",
					"match": false,
					"packageHash": "b6a1d4a5ffdfb80bd399f975d341a6c6a4ab384a8c0ecdd4f0d51f4c226d1303",
					"size": 13804,
					"sourceHash": "eec96097c0795dae69c2266acd746c7b1ee7a3bec8afe76b1dc19d24418f5075",
					"status": "content"
				},
				"benchmark/grid_fs_write_benchmark.js": {
					"match": false,
					"packageHash": "01afe30f1ee857a37772985c76f81eaaf149cc82f7ac63b03cabc85f0a6f7716",
					"size": 1366,
					"status": "missing-in-source"
				},
				"benchmark/streaming_benchmark.js": {
					"match": false,
					"packageHash": "ac9e5466d3625a661033f82242110dc23e4287877368b180fdec569f45b5c3d0",
					"size": 1658,
					"status": "missing-in-source"
				},
				"deps/nodeunit/.npmignore": {
					"match": false,
					"packageHash": "c22365d4b129983208d56dfa095d9af9e674c734939c8a7c62489c082db31480",
					"size": 36,
					"status": "missing-in-source"
				},
				"deps/nodeunit/CONTRIBUTORS.md": {
					"match": false,
					"packageHash": "dc1a5a144eaa2fdbb9b153779d58af125a5b65f3576d29dba2b5b8e8f3d8f079",
					"size": 1548,
					"status": "missing-in-source"
				},
				"deps/nodeunit/LICENSE": {
					"match": false,
					"packageHash": "b04b9e208e566fa898c7429e4dd5b45ba3ba2f7391e5c009cf63c53d580fa9b4",
					"size": 1058,
					"status": "missing-in-source"
				},
				"deps/nodeunit/Makefile": {
					"match": false,
					"packageHash": "5dbc2ad6b4398c2ecc6f5139795025770f7d29a1875ab3f3998753c42e4f3e81",
					"size": 5154,
					"status": "missing-in-source"
				},
				"deps/nodeunit/README.md": {
					"match": false,
					"packageHash": "751b4e9acf46b4e53769a8504f275b25e671ffd0a412b6d1c90d65955ddfee55",
					"size": 14941,
					"status": "missing-in-source"
				},
				"deps/nodeunit/bin/nodeunit": {
					"match": false,
					"packageHash": "9c73d7f489949be284d1071b6d1cedabd42e6e34d8743f944e94e4864ad8cba7",
					"size": 3568,
					"status": "missing-in-source"
				},
				"deps/nodeunit/bin/nodeunit.json": {
					"match": false,
					"packageHash": "1751ba7b7ad826d3162da359fccef5d1352d1d9a8b710e6753139aa142b1d255",
					"size": 274,
					"status": "missing-in-source"
				},
				"deps/nodeunit/deps/async.js": {
					"match": false,
					"packageHash": "6e67d1380c0ea1c5e876cdeb9b9f39ea8dba07d426d1377f3a1be62d57e0125c",
					"size": 18641,
					"status": "missing-in-source"
				},
				"deps/nodeunit/deps/ejs.js": {
					"match": false,
					"packageHash": "0bf20b8aa0f451bf912d24aa509a9f2469e94d378a8b455da983ad72cb0d3240",
					"size": 2596,
					"status": "missing-in-source"
				},
				"deps/nodeunit/deps/json2.js": {
					"match": false,
					"packageHash": "e6774f41a11016c803c602fa7e03bf03afb8e67217e2b1827cceb2fe5e1ddb52",
					"size": 17415,
					"status": "missing-in-source"
				},
				"deps/nodeunit/doc/nodeunit.md": {
					"match": false,
					"packageHash": "c57518a39297ef6ba91ee72ceeaba7ad5d9807f1cdb02d6449a266904a8305cf",
					"size": 1637,
					"status": "missing-in-source"
				},
				"deps/nodeunit/examples/browser/nodeunit.js": {
					"match": false,
					"packageHash": "4e716bf47c9c35a79dbe0714f1f650d96d0b4def80a6659a1f5fadfdf4fa7c4a",
					"size": 54817,
					"status": "missing-in-source"
				},
				"deps/nodeunit/examples/browser/suite1.js": {
					"match": false,
					"packageHash": "a0cf930d2666256e73299191618d5a58f005cc1bbf7733a7fdeb2aa169bd11d3",
					"size": 319,
					"status": "missing-in-source"
				},
				"deps/nodeunit/examples/browser/suite2.js": {
					"match": false,
					"packageHash": "cca3850beb4e4ea16bffbd6769191e384acf9e88de80a44e49a6266f89bc50ce",
					"size": 396,
					"status": "missing-in-source"
				},
				"deps/nodeunit/examples/browser/test.html": {
					"match": false,
					"packageHash": "921d98372885e8bf4d2918e6ebc1ecf236a3d981eddde4bb820ef46194db9723",
					"size": 311,
					"status": "missing-in-source"
				},
				"deps/nodeunit/img/example_fail.png": {
					"match": false,
					"packageHash": "5205647e4ddd31179fe5e1e4ddba8c496a76c2e821b2629b74772b62287381ab",
					"size": 38642,
					"status": "missing-in-source"
				},
				"deps/nodeunit/img/example_pass.png": {
					"match": false,
					"packageHash": "cd2164286b1c9fcb94cc71856dcdd258d285df39579e1445a1c16dd5d2d3f1c4",
					"size": 14133,
					"status": "missing-in-source"
				},
				"deps/nodeunit/index.js": {
					"match": false,
					"packageHash": "4a2146a5e00131523679c7d60430d41c67ae0a4ddacd52e51b2f0ce0ae517a5c",
					"size": 166,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/assert.js": {
					"match": false,
					"packageHash": "6d4a71e840792d8bb9f55bed413b454c20286936a06216e1e7372b1e6c175656",
					"size": 10207,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/core.js": {
					"match": false,
					"packageHash": "3122e6f06a3a1402e35fd451e137fea641bd8b99769de57494a79ccc3d977bd1",
					"size": 5928,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/nodeunit.js": {
					"match": false,
					"packageHash": "bc65aebee89e3dcbb23afea3f4d96b92171c0a1b1300e34e554b31daa0602554",
					"size": 1836,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/browser.js": {
					"match": false,
					"packageHash": "2f128c6ebaf7346c9c0f18f934bdc7e001ccc07972ee5733dc194e20202ed78c",
					"size": 3891,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/default.js": {
					"match": false,
					"packageHash": "5ae751497ba9f4c5421b6a82bf42422e3860aa79b3e139af6fcf137ac974444b",
					"size": 4194,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/html.js": {
					"match": false,
					"packageHash": "39442b894b5d314e19f45c1a1fb2ec8f7082f40f0344367cda402e10d09ba697",
					"size": 3511,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/index.js": {
					"match": false,
					"packageHash": "156ab9a0ba9aa7cc595e31c0604c6c97a8d8fddcfe984264d61c93804f9c37aa",
					"size": 331,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/junit.js": {
					"match": false,
					"packageHash": "9aba5ae9fb5d849ded37bbcfa265e8ea32e58e86a90db76ca8260cd3dd703dae",
					"size": 5908,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/minimal.js": {
					"match": false,
					"packageHash": "542cfb84da89893ad1d5cd521179e59d5dbbaefeeab30226f438601759c2d77e",
					"size": 3434,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/reporters/skip_passed.js": {
					"match": false,
					"packageHash": "1ffdf5f47d712048de1b56a701c2a57d1525d98f74ab7161e18da5afa3da37b9",
					"size": 3296,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/track.js": {
					"match": false,
					"packageHash": "e02fba7af50d190aaa45678abf04213e3c90b23ffd1633b367233d8abd2cea84",
					"size": 1222,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/types.js": {
					"match": false,
					"packageHash": "3adae1cf4af93b67cbe70604f63822fe0b12e41cacde8765e19f8c22d2f2ca94",
					"size": 5084,
					"status": "missing-in-source"
				},
				"deps/nodeunit/lib/utils.js": {
					"match": false,
					"packageHash": "bc4418a67c3057e5990c8bb2920b60abe45b41a066f19cb2771668b8fdd9f640",
					"size": 6056,
					"status": "missing-in-source"
				},
				"deps/nodeunit/man1/nodeunit.1": {
					"match": false,
					"packageHash": "cd9bac2075ba9fda7b0c26d96f64a1af629eb438a897c40d23f303a43224cf8c",
					"size": 1957,
					"status": "missing-in-source"
				},
				"deps/nodeunit/nodelint.cfg": {
					"match": false,
					"packageHash": "2d97676148773c16d39eb5997004dc88e2746e648dc1023d3080cdbabca5a328",
					"size": 52,
					"status": "missing-in-source"
				},
				"deps/nodeunit/package.json": {
					"match": false,
					"packageHash": "a44a63a8dc5171bfcbebc3da4faff0a78b7cfce0d21064e127638db9e326d8d7",
					"size": 1418,
					"status": "missing-in-source"
				},
				"deps/nodeunit/share/junit.xml.ejs": {
					"match": false,
					"packageHash": "84500bc9c9138c39faa25d81744c17dc9f2f7c081027a025e21fc988d9bef71f",
					"size": 725,
					"status": "missing-in-source"
				},
				"deps/nodeunit/share/license.js": {
					"match": false,
					"packageHash": "c2d81ff8586c4f0e55b222efbdad15072f0960409d49144c39f55d99f96e19c4",
					"size": 235,
					"status": "missing-in-source"
				},
				"deps/nodeunit/share/nodeunit.css": {
					"match": false,
					"packageHash": "e1cff7d7b6903ac5358471ad8a04e400402a20dcf7efd4a9b7a71ca19ebba2fd",
					"size": 1358,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/coffee/mock_coffee_module.coffee": {
					"match": false,
					"packageHash": "a8ba7102b30806f8323e4658688507287363b6972f8a04bd344672b995becdd4",
					"size": 64,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/dir/mock_module3.js": {
					"match": false,
					"packageHash": "59f360a9d2bf7964fa63ce58e013da089e565c87202c35a3492cd9cc330418af",
					"size": 31,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/dir/mock_module4.js": {
					"match": false,
					"packageHash": "8d96c8ee9c1881d9fced4856817ec92a74c5e7f891057d9bae43a97439cede16",
					"size": 31,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/mock_module1.js": {
					"match": false,
					"packageHash": "d0e39b00e441f76ba906a4df1311edcf7ac2063845c34d949b185c073babdb53",
					"size": 31,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/mock_module2.js": {
					"match": false,
					"packageHash": "f79ae9762607ab929a7cef72f47f8f85fd176e0b03479a95a0b64093c5aff5db",
					"size": 31,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/raw_jscode1.js": {
					"match": false,
					"packageHash": "59e98924953900c233df9fd658fa5eb81587bd00ff0a461faf0b5c432ccc89f4",
					"size": 55,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/raw_jscode2.js": {
					"match": false,
					"packageHash": "58f4d19c89bf584aa58f59205156e28b0ec8da8f40e7208169c7140cf2189e79",
					"size": 57,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/fixtures/raw_jscode3.js": {
					"match": false,
					"packageHash": "f2897e8d4ecbea9793fc07bf4e417c2675aa4e96e544ebdc5c80385dc06111c3",
					"size": 15,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-base.js": {
					"match": false,
					"packageHash": "37c7ea3406de4c5a3b965e72f2bb92226f402cafb0b7226eb53f424a2190762d",
					"size": 6250,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-failing-callbacks.js": {
					"match": false,
					"packageHash": "15bd6b031fa69025b97695793801d59448f048a5615ff8b3330f6b173715cc5e",
					"size": 3614,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-httputil.js": {
					"match": false,
					"packageHash": "cd3cc667209dd77721a210e1588fc33ccf754229eb27c3f5ba4c6e1fcbcb9b08",
					"size": 1751,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-runfiles.js": {
					"match": false,
					"packageHash": "6234847db7d5d410ebcf9d1c4dd2c03e1085803f9226d9afb21745651385ccd3",
					"size": 6501,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-runmodule.js": {
					"match": false,
					"packageHash": "c3a0373d1b92fa3fb886be2f79c38dac80632bde6f7053bcba38a4818c6edd86",
					"size": 4107,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-runtest.js": {
					"match": false,
					"packageHash": "7377ea3e92c86979a5b1ee08c1cfa1cbae1b60a9cfbfca55904875e66570d631",
					"size": 1570,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-sandbox.js": {
					"match": false,
					"packageHash": "1d20ecc18dff9c49b1f2554b7705bd15edd6743f8f8d0ab8bd0848d321df1fad",
					"size": 1015,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test-testcase.js": {
					"match": false,
					"packageHash": "3776d1b1636a89c29233276a402b05df3026c70c9c3aefbc64b24f472039bafe",
					"size": 6404,
					"status": "missing-in-source"
				},
				"deps/nodeunit/test/test.html": {
					"match": false,
					"packageHash": "3e8cdfb33c5a73ceeeb9b4ed08829b89924711982be48eed40ed2818166e0007",
					"size": 808,
					"status": "missing-in-source"
				},
				"docs/README.md": {
					"match": false,
					"packageHash": "71b6442574257cb01e1beddb71474dedc2b3fe3f7282df1574bbfe9ed2aa8470",
					"size": 523,
					"status": "missing-in-source"
				},
				"docs/collections.md": {
					"match": false,
					"packageHash": "badffac5e65907dbf0c8a11787d4189a0eab90dd806e0b08c70b9dcdaace5a28",
					"size": 3584,
					"status": "missing-in-source"
				},
				"docs/database.md": {
					"match": false,
					"packageHash": "22326c36a41342c583babf0e748c85e643268b82f478d9e4f1b041d33f21d9ea",
					"size": 3671,
					"status": "missing-in-source"
				},
				"docs/gridfs.md": {
					"match": false,
					"packageHash": "6d84126338b3bbbe78ea8e3597f2ed975ca477c0f874efe5fcb78d0f2a885e94",
					"size": 3508,
					"status": "missing-in-source"
				},
				"docs/indexes.md": {
					"match": false,
					"packageHash": "c1ed053f25e5f25b352d117dba0e5858e6df819db67d78318181ef00d4530378",
					"size": 3122,
					"status": "missing-in-source"
				},
				"docs/insert.md": {
					"match": false,
					"packageHash": "10813c29feef432270e58d6e56a3a7676e19c73d183afa6c970035592fad84f7",
					"size": 5286,
					"status": "missing-in-source"
				},
				"docs/queries.md": {
					"match": false,
					"packageHash": "673c7228d590292e679e55d27486713806177cb4a7968f359131a38228182370",
					"size": 8209,
					"status": "missing-in-source"
				},
				"examples/admin.js": {
					"match": false,
					"packageHash": "45eb57b797d6fe0b0e6d9fea977cf43c239fcdbeb6fb947c90ac88d36c33e263",
					"size": 2377,
					"status": "missing-in-source"
				},
				"examples/blog.js": {
					"match": false,
					"packageHash": "2128cd7d6e6e90684c0c45fded19a69cea2443c0d31aa160f8a2e049ebc5d999",
					"size": 6018,
					"status": "missing-in-source"
				},
				"examples/capped.js": {
					"match": false,
					"packageHash": "b211ffeea1ac82da70eed332f27714b5f7fe9f05f6f3b2f3eb6e453e179e3505",
					"size": 1382,
					"status": "missing-in-source"
				},
				"examples/cursor.js": {
					"match": false,
					"packageHash": "0aa044634a02963db933e80f7f2547f747073d57db9c4c315000d50412c06d55",
					"size": 2721,
					"status": "missing-in-source"
				},
				"examples/gridfs.js": {
					"match": false,
					"packageHash": "d2a1e91cd9fb5a48db54167e38f80c422e2277e1660f9d70144961d5538a4b2c",
					"size": 5966,
					"status": "missing-in-source"
				},
				"examples/index_test.js": {
					"match": false,
					"packageHash": "cdb6045c4c177e356f0ca89ea38c4c426f79b364f375125bb74076f1e4c04ffc",
					"size": 2530,
					"status": "missing-in-source"
				},
				"examples/info.js": {
					"match": false,
					"packageHash": "31ba6b94616e873374fdc91d144ffbf035fe07a50748438c3bcaa07a0a7e3c69",
					"size": 1813,
					"status": "missing-in-source"
				},
				"examples/oplog.js": {
					"match": false,
					"packageHash": "f87622670f2560ee3dcf249c429881a9d64d8da9c49d21a2f7f83a8a510f0cd9",
					"size": 3277,
					"status": "missing-in-source"
				},
				"examples/queries.js": {
					"match": false,
					"packageHash": "e0938c115f4687d150c0e1de0280831355dad08ab0918e59ffba3c670195575b",
					"size": 5369,
					"status": "missing-in-source"
				},
				"examples/replSetServersQueries.js": {
					"match": false,
					"packageHash": "130750b1e553310fdd69f9f59f441d8049c8568c3ac4584a6ad167cfa0861bef",
					"size": 5818,
					"status": "missing-in-source"
				},
				"examples/replSetServersSimple.js": {
					"match": false,
					"packageHash": "82a5dff935ed38f7a4f968222bc429e5324fcb58d9d8e8de96c14e563454e450",
					"size": 2431,
					"status": "missing-in-source"
				},
				"examples/simple.js": {
					"match": false,
					"packageHash": "625ae6468a27edf58f489b91ccfb8e7cd142263e8e3c8b938a49218b1512816a",
					"size": 1822,
					"status": "missing-in-source"
				},
				"examples/strict.js": {
					"match": false,
					"packageHash": "bb563d97813b9414815dd9fb32ae89a3e3da444effa5988bb8a771987b925917",
					"size": 1553,
					"status": "missing-in-source"
				},
				"examples/types.js": {
					"match": false,
					"packageHash": "595034328f2fc876f005844457bd4efaf877e1e377141b39bae41fa6358b9538",
					"size": 1825,
					"status": "missing-in-source"
				},
				"examples/url.js": {
					"match": false,
					"packageHash": "f1a6af085cc620e22e31b76ae6da2d8f13f231c40834e4a0591dcfd331a7253a",
					"size": 413,
					"status": "missing-in-source"
				},
				"examples/v8.log": {
					"match": false,
					"packageHash": "525f38addbdaaaa3e140723c9c2dd1078f1b8d9ab7ee262f3d3676aa3d4620a5",
					"size": 460300,
					"status": "missing-in-source"
				},
				"external-libs/bson/.gitignore": {
					"match": false,
					"packageHash": "9c1cf3205322777097ff8e8d431a18d2cae134686837ee4906f93779ddce2f47",
					"size": 30,
					"status": "missing-in-source"
				},
				"external-libs/bson/Makefile": {
					"diff": "--- published/external-libs/bson/Makefile\n+++ rebuilt/external-libs/bson/Makefile\n@@ -1,4 +1,3 @@\n-\n NODE = node\n name = all\n JOBS = 1\n@@ -6,14 +5,41 @@\n all:\n \trm -rf build .lock-wscript bson.node\n \tnode-waf configure build\n-\t@$(NODE) --expose-gc test_bson.js\n-\t@$(NODE) --expose-gc test_full_bson.js\n+\tcp -R ./build/Release/bson.node . || true\n+\t@$(NODE) --expose-gc test/test_bson.js\n+\t@$(NODE) --expose-gc test/test_full_bson.js\n+\t# @$(NODE) --expose-gc test/test_stackless_bson.js\n+\n+all_debug:\n+\trm -rf build .lock-wscript bson.node\n+\tnode-waf --debug configure build\n+\tcp -R ./build/Release/bson.node . || true\n+\t@$(NODE) --expose-gc test/test_bson.js\n+\t@$(NODE) --expose-gc test/test_full_bson.js\n+\t# @$(NODE) --expose-gc test/test_stackless_bson.js\n \n test:\n-\t@$(NODE) --expose-gc test_bson.js\n-\t@$(NODE) --expose-gc test_full_bson.js\n+\t@$(NODE) --expose-gc test/test_bson.js\n+\t@$(NODE) --expose-gc test/test_full_bson.js\n+\t# @$(NODE) --expose-gc test/test_stackless_bson.js\n+\n+clang:\n+\trm -rf build .lock-wscript bson.node\n+\tCXX=clang node-waf configure build\n+\tcp -R ./build/Release/bson.node . || true\n+\t@$(NODE) --expose-gc test/test_bson.js\n+\t@$(NODE) --expose-gc test/test_full_bson.js\n+\t# @$(NODE) --expose-gc test/test_stackless_bson.js\n+\n+clang_debug:\n+\trm -rf build .lock-wscript bson.node\n+\tCXX=clang node-waf --debug configure build\n+\tcp -R ./build/Release/bson.node . || true\n+\t@$(NODE) --expose-gc test/test_bson.js\n+\t@$(NODE) --expose-gc test/test_full_bson.js\n+\t# @$(NODE) --expose-gc test/test_stackless_bson.js\n \n clean:\n \trm -rf build .lock-wscript bson.node\n-\t\n+\n .PHONY: all\n\\ No newline at end of file\n",
					"match": false,
					"packageHash": "6c08252796f6ce46df424ebbe134cf6638efc69d446f97836a6b7d4f48fd57d9",
					"size": 319,
					"sourceHash": "739cf490555ff92e959059d59f3ab3116a6159879968a0b0b57c5ac838e62163",
					"status": "content"
				},
				"external-libs/bson/binary.cc": {
					"match": false,
					"packageHash": "45d56af34c27556ef4130059facaae2e8758580fd94795f1c6680bab755a230a",
					"size": 11008,
					"status": "missing-in-source"
				},
				"external-libs/bson/binary.h": {
					"match": false,
					"packageHash": "a6998f2b2688c931cda5651e6d330496226df5a0eb02390a0fa0f694ebf25ee0",
					"size": 1932,
					"status": "missing-in-source"
				},
				"external-libs/bson/bson.cc": {
					"diff": "--- published/external-libs/bson/bson.cc\n+++ rebuilt/external-libs/bson/bson.cc\n@@ -1,27 +1,33 @@\n #include <assert.h>\n #include <string.h>\n #include <stdlib.h>\n+\n+#ifdef __clang__\n+#pragma clang diagnostic push\n+#pragma clang diagnostic ignored \"-Wunused-parameter\"\n+#endif\n+\n #include <v8.h>\n+\n+#ifdef __clang__\n+#pragma clang diagnostic pop\n+#endif\n+\n #include <node.h>\n #include <node_version.h>\n-#include <node_events.h>\n #include <node_buffer.h>\n #include <cstring>\n #include <cmath>\n #include <cstdlib>\n #include <iostream>\n #include <limits>\n+#include <vector>\n \n #include \"bson.h\"\n-#include \"long.h\"\n-#include \"timestamp.h\"\n-#include \"objectid.h\"\n-#include \"binary.h\"\n-#include \"code.h\"\n-#include \"dbref.h\"\n \n using namespace v8;\n using namespace node;\n+using namespace std;\n \n // BSON DATA TYPES\n const uint32_t BSON_DATA_NUMBER = 1;\n@@ -34,20 +40,23 @@\n const uint32_t BSON_DATA_DATE = 9;\n const uint32_t BSON_DATA_NULL = 10;\n const uint32_t BSON_DATA_REGEXP = 11;\n+const uint32_t BSON_DATA_CODE = 13;\n+const uint32_t BSON_DATA_SYMBOL = 14;\n const uint32_t BSON_DATA_CODE_W_SCOPE = 15;\n const uint32_t BSON_DATA_INT = 16;\n const uint32_t BSON_DATA_TIMESTAMP = 17;\n const uint32_t BSON_DATA_LONG = 18;\n+const uint32_t BSON_DATA_MIN_KEY = 0xff;\n+const uint32_t BSON_DATA_MAX_KEY = 0x7f;\n \n const int32_t BSON_INT32_MAX = (int32_t)2147483647L;\n const int32_t BSON_INT32_MIN = (int32_t)(-1) * 2147483648L;\n \n-// BSON BINARY DATA SUBTYPES\n-const uint32_t BSON_BINARY_SUBTYPE_FUNCTION = 1;\n-const uint32_t BSON_BINARY_SUBTYPE_BYTE_ARRAY = 2;\n-const uint32_t BSON_BINARY_SUBTYPE_UUID = 3;\n-const uint32_t BSON_BINARY_SUBTYPE_MD5 = 4;\n-const uint32_t BSON_BINARY_SUBTYPE_USER_DEFINED = 128;\n+const int64_t BSON_INT64_MAX = ((int64_t)1 << 63) - 1;\n+const int64_t BSON_INT64_MIN = (int64_t)-1 << 63;\n+\n+const int64_t JS_INT_MAX = (int64_t)1 << 53;\n+const int64_t JS_INT_MIN = (int64_t)-1 << 53;\n \n static Handle<Value> VException(const char *msg) {\n     HandleScope scope;\n@@ -56,38 +65,6 @@\n \n Persistent<FunctionTemplate> BSON::constructor_template;\n \n-class MyExternal : public String::ExternalAsciiStringResource {\n- public:\n-  MyExternal (char *d, size_t length) : ExternalAsciiStringResource() {\n-    data_ = static_cast<char*>(malloc(length));\n-    memcpy(data_, d, length);\n-    // data_ = d;\n-    length_ = length;\n-    \n-    // Adjust of external allocated memory\n-    V8::AdjustAmountOfExternalAllocatedMemory(sizeof(MyExternal));      \n-  }\n-\n-  virtual ~MyExternal () {\n-    // Adjust the memory allocated\n-    V8::AdjustAmountOfExternalAllocatedMemory(-length_);  \n-    // Free the string\n-    free(data_);\n-  }\n-\n-  virtual const char * data () const {\n-    return data_;\n-  }\n-\n",
					"match": false,
					"packageHash": "69a002648a7cd24691cd545b7f795a9384a6a13f921ba5bdd663b89123aba027",
					"size": 63848,
					"sourceHash": "3bbf33024abd0bbd372cf8d602e8323759fdd165640ea5b8822dd862932a142e",
					"status": "content"
				},
				"external-libs/bson/bson.h": {
					"diff": "--- published/external-libs/bson/bson.h\n+++ rebuilt/external-libs/bson/bson.h\n@@ -8,50 +8,98 @@\n using namespace v8;\n using namespace node;\n \n-class BSON : public EventEmitter {\n+class BSON : public ObjectWrap {\n   public:    \n-    BSON() : EventEmitter() {}\n+    BSON() : ObjectWrap() {}\n     ~BSON() {}\n     \n     static void Initialize(Handle<Object> target);\n+    static Handle<Value> BSONDeserializeStream(const Arguments &args);\n+\n+    // JS based objects\n     static Handle<Value> BSONSerialize(const Arguments &args);\n     static Handle<Value> BSONDeserialize(const Arguments &args);\n \n-    // Encode functions\n-    static Handle<Value> EncodeLong(const Arguments &args);\n-    static Handle<Value> ToLong(const Arguments &args);\n-    static Handle<Value> ToInt(const Arguments &args);\n-  \n+    // Calculate size of function\n+    static Handle<Value> CalculateObjectSize(const Arguments &args);\n+    static Handle<Value> SerializeWithBufferAndIndex(const Arguments &args);\n+\n+  \t// Experimental\n+    static Handle<Value> CalculateObjectSize2(const Arguments &args);\n+    static Handle<Value> BSONSerialize2(const Arguments &args);\n+\n     // Constructor used for creating new BSON objects from C++\n     static Persistent<FunctionTemplate> constructor_template;\n \n   private:\n     static Handle<Value> New(const Arguments &args);\n-    static Handle<Value> deserialize(char *data, bool is_array_item);\n-    static uint32_t serialize(char *serialized_object, uint32_t index, Handle<Value> name, Handle<Value> value, bool check_key);\n+    static Handle<Value> deserialize(BSON *bson, char *data, uint32_t dataLength, uint32_t startIndex, bool is_array_item);\n+    static uint32_t serialize(BSON *bson, char *serialized_object, uint32_t index, Handle<Value> name, Handle<Value> value, bool check_key, bool serializeFunctions);\n \n     static char* extract_string(char *data, uint32_t offset);\n     static const char* ToCString(const v8::String::Utf8Value& value);\n-    static uint32_t calculate_object_size(Handle<Value> object);\n+    static uint32_t calculate_object_size(BSON *bson, Handle<Value> object, bool serializeFunctions);\n \n     static void write_int32(char *data, uint32_t value);\n     static void write_int64(char *data, int64_t value);\n     static void write_double(char *data, double value);\n-    static int deserialize_sint8(char *data, uint32_t offset);\n-    static int deserialize_sint16(char *data, uint32_t offset);\n-    static long deserialize_sint32(char *data, uint32_t offset);\n     static uint16_t deserialize_int8(char *data, uint32_t offset);\n     static uint32_t deserialize_int32(char* data, uint32_t offset);\n     static char *check_key(Local<String> key);\n-    static char *decode_utf8(char * string, uint32_t length);\n+     \n+    // BSON type instantiate functions\n+    Persistent<Function> longConstructor;\n+    Persistent<Function> objectIDConstructor;\n+    Persistent<Function> binaryConstructor;\n+    Persistent<Function> codeConstructor;\n+    Persistent<Function> dbrefConstructor;\n+    Persistent<Function> symbolConstructor;\n+    Persistent<Function> doubleConstructor;\n+    Persistent<Function> timestampConstructor;\n+    Persistent<Function> minKeyConstructor;\n+    Persistent<Function> maxKeyConstructor;\n+    \n+    // Equality Objects\n+    Persistent<String> longString;\n+    Persistent<String> objectIDString;\n+    Persistent<String> binaryString;\n+    Persistent<String> codeString;\n+    Persistent<String> dbrefString;\n+    Persistent<String> symbolString;\n+    Persistent<String> doubleString;\n+    Persistent<String> timestampString;\n+    Persistent<String> minKeyString;\n+    Persistent<String> maxKeyString;\n+    \n+    // Equality speed up comparision objects\n+    Persistent<String> _bsontypeString;\n+    Persistent<String> _longLowString;\n+    Persistent<String> _longHighString;\n+    Persistent<String> _objectIDidString;\n+    Persistent<String> _binaryPositionString;\n+    Persistent<String> _binarySubTypeString;\n+    Persistent<String> _binaryBufferString;\n+    Persistent<String> _doubleValueString;\n+    Persistent<String> _symbolValueString;\n+\n+    Persistent<String> _dbRefRefString;\n+    Persistent<String> _dbRefIdRefString;\n+    Persistent<String> _dbRefDbRefString;\n+    Persistent<String> _dbRefNamespaceString;\n+    Persistent<String> _dbRefDbString;\n+    Persistent<String> _dbRefOidString;\n",
					"match": false,
					"packageHash": "d0dd5e0c53567ede4e063edc41a62b7a239b26c0616dedc26fd75e6680d1d7f3",
					"size": 2280,
					"sourceHash": "3ac7c29a803a949feb401a361cff6d5b953f45756933d3d0815dc4833beed2ae",
					"status": "content"
				},
				"external-libs/bson/code.cc": {
					"match": false,
					"packageHash": "2247213aa8d88f7128cc77cc34e61ab737a5d71c02e26085ea168f55a91430ce",
					"size": 5651,
					"status": "missing-in-source"
				},
				"external-libs/bson/code.h": {
					"match": false,
					"packageHash": "56853f4dd68cd1dcc5e8612eb74e827b5b66d17ece160c1a5076a4c0f30a53a3",
					"size": 1402,
					"status": "missing-in-source"
				},
				"external-libs/bson/dbref.cc": {
					"match": false,
					"packageHash": "2735812c0634a029537b92d4ecb869626b1ad68d26107e451da3f04c518688bd",
					"size": 6004,
					"status": "missing-in-source"
				},
				"external-libs/bson/dbref.h": {
					"match": false,
					"packageHash": "9b78991199e9ce741f9b8ea94e900be912c2bd49686464f6d88abd3a57712384",
					"size": 1784,
					"status": "missing-in-source"
				},
				"external-libs/bson/index.js": {
					"diff": "--- published/external-libs/bson/index.js\n+++ rebuilt/external-libs/bson/index.js\n@@ -1,11 +1,15 @@\n var bson = require('./bson');\n exports.BSON = bson.BSON;\n-exports.Long = bson.Long;\n-exports.ObjectID = bson.ObjectID;\n-exports.DBRef = bson.DBRef;\n-exports.Code = bson.Code;\n-exports.Timestamp = bson.Timestamp;\n-exports.Binary = bson.Binary;\n+exports.Long = require('../../lib/mongodb/bson/long').Long;\n+exports.ObjectID = require('../../lib/mongodb/bson/objectid').ObjectID;\n+exports.DBRef = require('../../lib/mongodb/bson/db_ref').DBRef;\n+exports.Code = require('../../lib/mongodb/bson/code').Code;\n+exports.Timestamp = require('../../lib/mongodb/bson/timestamp').Timestamp;\n+exports.Binary = require('../../lib/mongodb/bson/binary').Binary;\n+exports.Double = require('../../lib/mongodb/bson/double').Double;\n+exports.MaxKey = require('../../lib/mongodb/bson/max_key').MaxKey;\n+exports.MinKey = require('../../lib/mongodb/bson/min_key').MinKey;\n+exports.Symbol = require('../../lib/mongodb/bson/symbol').Symbol;\n \n // Just add constants tot he Native BSON parser\n exports.BSON.BSON_BINARY_SUBTYPE_DEFAULT = 0;\n",
					"match": false,
					"packageHash": "def43fd9a41d09483510e72d1591e13cb267a032504ae9ac31909968699659f9",
					"size": 575,
					"sourceHash": "a2d8bb3379e3d4c0c8a825b410e0b924f98b62470fbdfbfb1a13b49e7fff5897",
					"status": "content"
				},
				"external-libs/bson/local.cc": {
					"match": false,
					"packageHash": "05c0c129e97ca07fc2e829ddb2cf416463d533cd4d3ab195c6d6c69afa31eab0",
					"size": 504,
					"status": "missing-in-source"
				},
				"external-libs/bson/local.h": {
					"match": false,
					"packageHash": "8be6e556982f4cd8cc62d9ae0357cd9f3db763fafab4fdc12e9507dbeb986350",
					"size": 276,
					"status": "missing-in-source"
				},
				"external-libs/bson/long.cc": {
					"match": false,
					"packageHash": "dcf9a97b29215b4db880b1acfff995a8532f51e9277d5b0da222b32e02d47c19",
					"size": 18693,
					"status": "missing-in-source"
				},
				"external-libs/bson/long.h": {
					"match": false,
					"packageHash": "94ababd99adc2dd2d4910f56eff09b9c010fd62da2a264ce89bdf15e4a77496b",
					"size": 2647,
					"status": "missing-in-source"
				},
				"external-libs/bson/objectid.cc": {
					"match": false,
					"packageHash": "1d4c30cc75b3e71c47a0e755f52423ecbc1fefe871d1fda32dcdcee523399c16",
					"size": 9095,
					"status": "missing-in-source"
				},
				"external-libs/bson/objectid.h": {
					"match": false,
					"packageHash": "8c439bf9448265a6565d75ec13bd164e093c842c9992a961c34f472ef96f1fd3",
					"size": 1726,
					"status": "missing-in-source"
				},
				"external-libs/bson/test_bson.js": {
					"match": false,
					"packageHash": "73c17d69ce8e9a573a9eb12178240813dc2ba2a5d48f3bf56a96d807ec234e1e",
					"size": 11261,
					"status": "missing-in-source"
				},
				"external-libs/bson/test_full_bson.js": {
					"match": false,
					"packageHash": "6ebe1679c170c0225c050101016a4e32f68f7d94995f2de34e732dd57589bf03",
					"size": 7361,
					"status": "missing-in-source"
				},
				"external-libs/bson/timestamp.cc": {
					"match": false,
					"packageHash": "8ff607799902218c4d42a0445191b36ed0c69ad7830de2a2ee36416156c7cea1",
					"size": 19546,
					"status": "missing-in-source"
				},
				"external-libs/bson/timestamp.h": {
					"match": false,
					"packageHash": "06465df1a98afb3feedbc19d9439530dbd1e55c89e40f72f9c3a6b300753423e",
					"size": 2869,
					"status": "missing-in-source"
				},
				"external-libs/bson/wscript": {
					"diff": "--- published/external-libs/bson/wscript\n+++ rebuilt/external-libs/bson/wscript\n@@ -18,14 +18,15 @@\n def configure(conf):\n   conf.check_tool(\"compiler_cxx\")\n   conf.check_tool(\"node_addon\")\n-  # conf.env.append_value('CXXFLAGS', ['-DDEBUG', '-g', '-O0', '-Wall', '-Wextra'])\n+  conf.env.append_value('CXXFLAGS', ['-O3', '-funroll-loops'])\n \n+  # conf.env.append_value('CXXFLAGS', ['-DDEBUG', '-g', '-O0', '-Wall', '-Wextra'])\n   # conf.check(lib='node', libpath=['/usr/lib', '/usr/local/lib'], uselib_store='NODE')\n \n def build(bld):\n   obj = bld.new_task_gen(\"cxx\", \"shlib\", \"node_addon\")\n   obj.target = \"bson\"\n-  obj.source = [\"bson.cc\", \"long.cc\", \"objectid.cc\", \"binary.cc\", \"code.cc\", \"dbref.cc\", \"timestamp.cc\", \"local.cc\"]\n+  obj.source = [\"bson.cc\"]\n   # obj.uselib = \"NODE\"\n \n def shutdown():\n",
					"match": false,
					"packageHash": "8e03c424744fc9ced4ff9b92060f1e97deaaae24cc544ecf33f0a0294628d233",
					"size": 1205,
					"sourceHash": "561b73e306e26f9f160255232a6fd86da2141e466b1d5ebff8e0cbc6423972ea",
					"status": "content"
				},
				"install.sh": {
					"match": false,
					"packageHash": "9c5932cce21d5a1be3c8f8ca52fcc573dd2269372e3d50082f4c408cf4f0ccd7",
					"size": 270,
					"status": "missing-in-source"
				},
				"lib/mongodb/admin.js": {
					"diff": "--- published/lib/mongodb/admin.js\n+++ rebuilt/lib/mongodb/admin.js\n@@ -1,11 +1,43 @@\n+/*!\n+ * Module dependencies.\n+ */\n var Collection = require('./collection').Collection,\n     Cursor = require('./cursor').Cursor,\n     DbCommand = require('./commands/db_command').DbCommand;\n \n-var Admin = exports.Admin = function(db) {  \n+/**\n+ * Allows the user to access the admin functionality of MongoDB\n+ *\n+ * @class Represents the Admin methods of MongoDB.\n+ * @param {Object} db Current db instance we wish to perform Admin operations on.\n+ * @return {Function} Constructor for Admin type.\n+ */\n+function Admin(db) {  \n+  if(!(this instanceof Admin)) return new Admin(db);\n+  \n   this.db = db;\n };\n \n+/**\n+ * Retrieve the server information for the current\n+ * instance of the db client\n+ * \n+ * @param {Function} callback Callback function of format `function(err, result) {}`.\n+ * @return {null} Returns no result\n+ * @api public\n+ */\n+Admin.prototype.buildInfo = function(callback) {\n+  this.serverInfo(callback);\n+}\n+\n+/**\n+ * Retrieve the server information for the current\n+ * instance of the db client\n+ * \n+ * @param {Function} callback Callback function of format `function(err, result) {}`.\n+ * @return {null} Returns no result\n+ * @api private\n+ */\n Admin.prototype.serverInfo = function(callback) {\n   var self = this;\n   var command = {buildinfo:1};\n@@ -15,13 +47,44 @@\n   });\n }\n \n+/**\n+ * Retrieve this db's server status.\n+ *\n+ * @param {Function} callback returns the server status.\n+ * @return {null}\n+ * @api public\n+ */\n+Admin.prototype.serverStatus = function(callback) {\n+  var self = this;\n+\n+  this.command({serverStatus: 1}, function(err, result) {\n+    if (err == null && result.documents[0].ok == 1) {\n+      callback(null, result.documents[0]);\n+    } else {\n+      if (err) {\n+        callback(err, false);\n+      } else {\n+        callback(self.wrap(result.documents[0]), false);\n+      }\n+    }\n+  });\n+};\n+\n+/**\n+ * Retrieve the current profiling Level for MongoDB\n+ * \n+ * @param {Function} callback Callback function of format `function(err, result) {}`.\n+ * @return {null} Returns no result\n+ * @api public\n+ */\n Admin.prototype.profilingLevel = function(callback) {\n   var self = this;\n   var command = {profile:-1};\n \n   this.command(command, function(err, doc) {\n     doc = doc.documents[0];\n-    if(err == null && (doc.ok == 1 || doc.was.constructor == Numeric)) {\n+    \n+    if(err == null && (doc.ok == 1 || typeof doc.was === 'number')) {\n       var was = doc.was;\n       if(was == 0) {\n         callback(null, \"off\");\n@@ -38,6 +101,131 @@\n   });\n };\n \n+/**\n+ * Ping the MongoDB server and retrieve results\n+ *\n",
					"match": false,
					"packageHash": "efde4057cdc889e25d7a45d5270091f2d375bd96c877f3a146bee80f1ed900b6",
					"size": 3179,
					"sourceHash": "a037f0b049bc29d04bfc3ee04e7483bbe7b8750c68b95e6c0b45b94b67897af1",
					"status": "content"
				},
				"lib/mongodb/bson/binary.js": {
					"match": false,
					"packageHash": "bb27c9df9e6813615e74dd3dce445de6d7fd73641b5e3e07931777a4ba38a750",
					"size": 2621,
					"status": "missing-in-source"
				},
				"lib/mongodb/bson/binary_parser.js": {
					"match": false,
					"packageHash": "f5d7a26bbf7668fd7486019d4327159b6944e75ff23713de524e2291c3fa7df0",
					"size": 12219,
					"status": "missing-in-source"
				},
				"lib/mongodb/bson/bson.js": {
					"match": false,
					"packageHash": "e3f06f8e8ec6ae3e353e1c073fab42d96833ee42b09ac3189452b4858c7aa40e",
					"size": 27023,
					"status": "missing-in-source"
				},
				"lib/mongodb/bson/objectid.js": {
					"match": false,
					"packageHash": "6ce180259b3d38ec56e9b6d72ee03b17bc06f5bcc29a56e898194a000f5fc7d4",
					"size": 3404,
					"status": "missing-in-source"
				},
				"lib/mongodb/collection.js": {
					"diff": "--- published/lib/mongodb/collection.js\n+++ rebuilt/lib/mongodb/collection.js\n@@ -1,124 +1,100 @@\n /**\n  * Module dependencies.\n+ * @ignore\n  */\n var InsertCommand = require('./commands/insert_command').InsertCommand\n   , QueryCommand = require('./commands/query_command').QueryCommand\n   , DeleteCommand = require('./commands/delete_command').DeleteCommand\n   , UpdateCommand = require('./commands/update_command').UpdateCommand\n   , DbCommand = require('./commands/db_command').DbCommand\n-  , BinaryParser = require('./bson/binary_parser').BinaryParser\n+  , ObjectID = require('bson').ObjectID\n+  , Code = require('bson').Code\n   , Cursor = require('./cursor').Cursor\n-  , debug = require('util').debug\n-  , inspect = require('util').inspect;\n+  , utils = require('./utils');\n \n /**\n- * Sort functions, Normalize and prepare sort parameters\n- */\n-\n-function formatSortValue (sortDirection) {\n-  var value = (\"\" + sortDirection).toLowerCase();\n-\n-  switch (value) {\n-    case 'ascending':\n-    case 'asc':\n-    case '1':\n-      return 1;\n-    case 'descending':\n-    case 'desc':\n-    case '-1':\n-      return -1;\n-    default:\n-      throw new Error(\"Illegal sort clause, must be of the form \"\n-                    + \"[['field1', '(ascending|descending)'], \"\n-                    + \"['field2', '(ascending|descending)']]\");\n-  }\n-};\n-\n-function formattedOrderClause (sortValue) {\n-  var orderBy = {};\n-\n-  if (Array.isArray(sortValue)) {\n-    sortValue.forEach(function (sortElement) {\n-      if (sortElement.constructor == String) {\n-        orderBy[sortElement] = 1;\n-      } else {\n-        orderBy[sortElement[0]] = formatSortValue(sortElement[1]);\n-      }\n-    });\n-  } else if (sortValue.constructor == String) {\n-    orderBy[sortValue] = 1;\n-  } else {\n-    throw new Error(\"Illegal sort clause, must be of the form \" +\n-      \"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]\");\n-  }\n-\n-  return orderBy;\n-};\n+ * Precompiled regexes\n+ * @ignore\n+**/\n+const eErrorMessages = /No matching object found/;\n \n /**\n  * toString helper.\n+ * @ignore\n  */\n-\n var toString = Object.prototype.toString;\n \n /**\n- * Collection constructor.\n+ * Create a new Collection instance\n  *\n- * @param {Database} db\n- * @param {String} collectionName\n- * @param {Function} pkFactory\n+ * Options\n+ *  - **slaveOk** {Boolean, default:false}, Allow reads from secondaries.\n+ *  - **serializeFunctions** {Boolean, default:false}, serialize functions on the document.\n+ *  - **raw** {Boolean, default:false}, perform all operations using raw bson objects.\n+ *  - **pkFactory** {Object}, object overriding the basic ObjectID primary key generation.\n+ *\n+ * @class Represents a Collection\n+ * @param {Object} db db instance.\n+ * @param {String} collectionName collection name.\n+ * @param {Object} [pkFactory] alternative primary key factory.\n+ * @param {Object} [options] additional options for the collection.\n+ * @return {Object} a collection instance.\n  */\n-\n function Collection (db, collectionName, pkFactory, options) {\n-  this.checkCollectionName(collectionName);\n+  if(!(this instanceof Collection)) return new Collection(db, collectionName, pkFactory, options);\n+  \n",
					"match": false,
					"packageHash": "1f5f3207be72c216b4d5b45df8ef2a77649f7fd6fe4cacd4acaa312a797cd1b3",
					"size": 24390,
					"sourceHash": "a3563efa6644f7f9f404b47e0386f1ca647574fd634b04b427ee5ef9c05c8b56",
					"status": "content"
				},
				"lib/mongodb/commands/base_command.js": {
					"diff": "--- published/lib/mongodb/commands/base_command.js\n+++ rebuilt/lib/mongodb/commands/base_command.js\n@@ -1,28 +1,20 @@\n-var BinaryParser = require('../bson/binary_parser').BinaryParser;\n-\n /**\n   Base object used for common functionality\n **/\n var BaseCommand = exports.BaseCommand = function() {\n };\n \n-BaseCommand.prototype.toBinary = function() {\n-  // Get the command op code\n-  var op_code = this.getOpCode();\n-  // Get the command data structure\n-  var command = this.getCommand();\n-  // Total Size of command\n-  var totalSize = 4*4 + command.length;\n-  // Create the command with the standard header file\n-  return BinaryParser.fromInt(totalSize) + BinaryParser.fromInt(this.requestId) + BinaryParser.fromInt(0) + BinaryParser.fromInt(op_code) + command;\n-};\n-\n var id = 1;\n BaseCommand.prototype.getRequestId = function() {\n   if (!this.requestId) this.requestId = id++;\n   return this.requestId;\n };\n \n+BaseCommand.prototype.updateRequestId = function() {\n+  this.requestId = id++;\n+  return this.requestId;\n+};\n+\n // OpCodes\n BaseCommand.OP_REPLY = 1;\n BaseCommand.OP_MSG = 1000;\n@@ -32,4 +24,4 @@\n BaseCommand.OP_QUERY = 2004;\n BaseCommand.OP_GET_MORE = 2005;\n BaseCommand.OP_DELETE =\t2006;\n-BaseCommand.OP_KILL_CURSORS =\t2007;\n+BaseCommand.OP_KILL_CURSORS =\t2007;\n\\ No newline at end of file\n",
					"match": false,
					"packageHash": "4d899faab07d1f313aad22479001f9c819ae5bc298c64261b1609d6854d4b497",
					"size": 1052,
					"sourceHash": "3b9d5bf8d0033df72262cdd5c60feb91a4052597696bb1123bae0beeda3f9aa9",
					"status": "content"
				},
				"lib/mongodb/commands/db_command.js": {
					"diff": "--- published/lib/mongodb/commands/db_command.js\n+++ rebuilt/lib/mongodb/commands/db_command.js\n@@ -1,23 +1,27 @@\n var QueryCommand = require('./query_command').QueryCommand,\n   InsertCommand = require('./insert_command').InsertCommand,\n-  MD5 = require('../crypto/md5').MD5,\n   inherits = require('util').inherits,\n-  debug = require('util').debug,\n-  inspect = require('util').inspect;\n+  crypto = require('crypto');\n \n /**\n   Db Command\n **/\n-var DbCommand = exports.DbCommand = function(db, collectionName, queryOptions, numberToSkip, numberToReturn, query, returnFieldSelector) {\n-  QueryCommand.call(db, this);\n-\n+var DbCommand = exports.DbCommand = function(dbInstance, collectionName, queryOptions, numberToSkip, numberToReturn, query, returnFieldSelector, options) {\n+  QueryCommand.call(this);\n   this.collectionName = collectionName;\n   this.queryOptions = queryOptions;\n   this.numberToSkip = numberToSkip;\n   this.numberToReturn = numberToReturn;\n   this.query = query;\n   this.returnFieldSelector = returnFieldSelector;\n-  this.db = db;\n+  this.db = dbInstance;\n+\n+  // Make sure we don't get a null exception\n+  options = options == null ? {} : options;\n+  // Let us defined on a command basis if we want functions to be serialized or not\n+  if(options['serializeFunctions'] != null && options['serializeFunctions']) {\n+    this.serializeFunctions = true;\n+  }\n };\n \n inherits(DbCommand, QueryCommand);\n@@ -29,6 +33,11 @@\n DbCommand.SYSTEM_USER_COLLECTION = \"system.users\";\n DbCommand.SYSTEM_COMMAND_COLLECTION = \"$cmd\";\n \n+// New commands\n+DbCommand.NcreateIsMasterCommand = function(db, databaseName) {\n+  return new DbCommand(db, databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NO_CURSOR_TIMEOUT, 0, -1, {'ismaster':1}, null);\n+};\n+\n // Provide constructors for different db commands\n DbCommand.createIsMasterCommand = function(db) {\n   return new DbCommand(db, db.databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NO_CURSOR_TIMEOUT, 0, -1, {'ismaster':1}, null);\n@@ -43,12 +52,19 @@\n };\n \n DbCommand.createAuthenticationCommand = function(db, username, password, nonce) {\n+  // Use node md5 generator\n+  var md5 = crypto.createHash('md5');\n   // Generate keys used for authentication\n-  var hash_password = MD5.hex_md5(username + \":mongo:\" + password);\n-  var key = MD5.hex_md5(nonce + username + hash_password);\n+  md5.update(username + \":mongo:\" + password);\n+  var hash_password = md5.digest('hex');\n+  // Final key\n+  md5 = crypto.createHash('md5');\n+  md5.update(nonce + username + hash_password);\n+  var key = md5.digest('hex');  \n+  // Creat selector\n   var selector = {'authenticate':1, 'user':username, 'nonce':nonce, 'key':key};\n   // Create db command\n-  return new DbCommand(db, db.databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NO_CURSOR_TIMEOUT, 0, -1, selector, null);\n+  return new DbCommand(db, db.databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NONE, 0, -1, selector, null);\n };\n \n DbCommand.createLogoutCommand = function(db) {\n@@ -76,9 +92,11 @@\n };\n \n DbCommand.createGetLastErrorCommand = function(options, db) {\n-  var args = Array.prototype.slice.call(arguments, 0);\n-  db = args.pop();\n-  options = args.length ? args.shift() : {};\n+\n+  if (typeof db === 'undefined') {\n+    db =  options;\n+    options = {};\n+  }\n   // Final command \n   var command = {'getlasterror':1};\n   // If we have an options Object let's merge in the fields (fsync/wtimeout/w)\n@@ -88,16 +106,11 @@\n     }\n   }\n   \n-  // debug(\"createGetLastErrorCommand :: \" + inspect(command))\n-  \n   // Execute command\n   return new DbCommand(db, db.databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NO_CURSOR_TIMEOUT, 0, -1, command, null);\n };\n \n DbCommand.createGetLastStatusCommand = DbCommand.createGetLastErrorCommand;\n-// function(db) {\n-//   return new DbCommand(db, db.databaseName + \".\" + DbCommand.SYSTEM_COMMAND_COLLECTION, QueryCommand.OPTS_NO_CURSOR_TIMEOUT, 0, -1, {'getlasterror':1}, null);\n",
					"match": false,
					"packageHash": "596df0ac41e918ac28184f0848aaa5c9c9c929637326f59b0177c0eb296f9e9d",
					"size": 7938,
					"sourceHash": "6f41be547a863b0b0169eba3b2ecc8d56a3ca07357817dae0fd22c2063b2d8ed",
					"status": "content"
				},
				"lib/mongodb/commands/delete_command.js": {
					"diff": "--- published/lib/mongodb/commands/delete_command.js\n+++ rebuilt/lib/mongodb/commands/delete_command.js\n@@ -1,5 +1,4 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n   inherits = require('util').inherits;\n \n /**\n@@ -8,6 +7,17 @@\n var DeleteCommand = exports.DeleteCommand = function(db, collectionName, selector) {\n   BaseCommand.call(this);\n \n+  // Validate correctness off the selector\n+  var object = selector;\n+  if(Buffer.isBuffer(object)) {\n+    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;        \n+    if(object_size != object.length)  {\n+      var error = new Error(\"delete raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n+  \n   this.collectionName = collectionName;\n   this.selector = selector;\n   this.db = db;\n@@ -15,9 +25,7 @@\n \n inherits(DeleteCommand, BaseCommand);\n \n-DeleteCommand.prototype.getOpCode = function() {\n-  return BaseCommand.OP_DELETE;\n-};\n+DeleteCommand.OP_DELETE =\t2006;\n \n /*\n struct {\n@@ -28,7 +36,76 @@\n     mongo.BSON      selector;               // query object.  See below for details.\n }\n */\n-DeleteCommand.prototype.getCommand = function() {\n-  // Generate the command string\n-  return BinaryParser.fromInt(0) + BinaryParser.encode_cstring(this.collectionName) + BinaryParser.fromInt(0) + this.db.bson_serializer.BSON.serialize(this.selector);\n+DeleteCommand.prototype.toBinary = function() {\n+  // Calculate total length of the document\n+  var totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + this.db.bson.calculateObjectSize(this.selector, false, true) + (4 * 4);\n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n+  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n+  _command[_index] = totalLengthOfCommand & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write the request ID\n+  _command[_index + 3] = (this.requestId >> 24) & 0xff;     \n+  _command[_index + 2] = (this.requestId >> 16) & 0xff;\n+  _command[_index + 1] = (this.requestId >> 8) & 0xff;\n+  _command[_index] = this.requestId & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  // Write the op_code for the command\n+  _command[_index + 3] = (DeleteCommand.OP_DELETE >> 24) & 0xff;     \n+  _command[_index + 2] = (DeleteCommand.OP_DELETE >> 16) & 0xff;\n+  _command[_index + 1] = (DeleteCommand.OP_DELETE >> 8) & 0xff;\n+  _command[_index] = DeleteCommand.OP_DELETE & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+\n+  // Write the collection name to the command\n+  _index = _index + _command.write(this.collectionName, _index, 'utf8') + 1;\n+  _command[_index - 1] = 0;    \n+\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+\n+  // Document binary length\n+  var documentLength = 0\n+\n+  // Serialize the selector\n+  // If we are passing a raw buffer, do minimal validation\n+  if(Buffer.isBuffer(this.selector)) {\n+    documentLength = this.selector.length;\n",
					"match": false,
					"packageHash": "ecff7e8e1dadfbfcf56abc733f765abc80255e7c099266587c5a1dc37ce368e8",
					"size": 1141,
					"sourceHash": "4e4d0f12685765c7a6eb62947f5f73432a07453a99925a1a0e1a63d53d4d218a",
					"status": "content"
				},
				"lib/mongodb/commands/get_more_command.js": {
					"diff": "--- published/lib/mongodb/commands/get_more_command.js\n+++ rebuilt/lib/mongodb/commands/get_more_command.js\n@@ -1,6 +1,6 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  inherits = require('util').inherits;\n+  inherits = require('util').inherits,\n+  binaryutils = require('../utils');\n \n /**\n   Get More Document Command\n@@ -16,11 +16,68 @@\n \n inherits(GetMoreCommand, BaseCommand);\n \n-GetMoreCommand.prototype.getOpCode = function() {\n-  return BaseCommand.OP_GET_MORE;\n-};\n+GetMoreCommand.OP_GET_MORE = 2005;\n+\n+GetMoreCommand.prototype.toBinary = function() {\n+  // Calculate total length of the document\n+  var totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + 8 + (4 * 4);\n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index++] = totalLengthOfCommand & 0xff;\n+  _command[_index++] = (totalLengthOfCommand >> 8) & 0xff;\n+  _command[_index++] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index++] = (totalLengthOfCommand >> 24) & 0xff;     \n+\n+  // Write the request ID\n+  _command[_index++] = this.requestId & 0xff;\n+  _command[_index++] = (this.requestId >> 8) & 0xff;\n+  _command[_index++] = (this.requestId >> 16) & 0xff;\n+  _command[_index++] = (this.requestId >> 24) & 0xff;     \n+\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+\n+  // Write the op_code for the command\n+  _command[_index++] = GetMoreCommand.OP_GET_MORE & 0xff;\n+  _command[_index++] = (GetMoreCommand.OP_GET_MORE >> 8) & 0xff;\n+  _command[_index++] = (GetMoreCommand.OP_GET_MORE >> 16) & 0xff;\n+  _command[_index++] = (GetMoreCommand.OP_GET_MORE >> 24) & 0xff;     \n+\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+\n+  // Write the collection name to the command\n+  _index = _index + _command.write(this.collectionName, _index, 'utf8') + 1;\n+  _command[_index - 1] = 0;    \n \n-GetMoreCommand.prototype.getCommand = function() {\n-  // Generate the command string\n-  return BinaryParser.fromInt(0) + BinaryParser.encode_cstring(this.collectionName) + BinaryParser.fromInt(this.numberToReturn) + this.db.bson_serializer.BSON.encodeLong(this.cursorId);\n+  // Number of documents to return\n+  _command[_index++] = this.numberToReturn & 0xff;\n+  _command[_index++] = (this.numberToReturn >> 8) & 0xff;\n+  _command[_index++] = (this.numberToReturn >> 16) & 0xff;\n+  _command[_index++] = (this.numberToReturn >> 24) & 0xff;     \n+  \n+  // Encode the cursor id\n+  var low_bits = this.cursorId.getLowBits();\n+  // Encode low bits\n+  _command[_index++] = low_bits & 0xff;\n+  _command[_index++] = (low_bits >> 8) & 0xff;\n+  _command[_index++] = (low_bits >> 16) & 0xff;\n+  _command[_index++] = (low_bits >> 24) & 0xff;     \n+  \n+  var high_bits = this.cursorId.getHighBits();\n+  // Encode high bits\n+  _command[_index++] = high_bits & 0xff;\n+  _command[_index++] = (high_bits >> 8) & 0xff;\n+  _command[_index++] = (high_bits >> 16) & 0xff;\n+  _command[_index++] = (high_bits >> 24) & 0xff;     \n+  // Return command\n+  return _command;\n };\n\\ No newline at end of file\n",
					"match": false,
					"packageHash": "e26000691099bff9a75fe135b8fae67a5851e6c074bc0f7fd34a7011d64bd2e8",
					"size": 855,
					"sourceHash": "9c9ec06d4ad6306c6823afb357aa2f5a41fffc9ac401894f0ba240e13b72a592",
					"status": "content"
				},
				"lib/mongodb/commands/insert_command.js": {
					"diff": "--- published/lib/mongodb/commands/insert_command.js\n+++ rebuilt/lib/mongodb/commands/insert_command.js\n@@ -1,33 +1,53 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  inherits = require('util').inherits,\n-  debug = require('util').debug,\n-  inspect = require('util').inspect;\n+  inherits = require('util').inherits;\n \n /**\n   Insert Document Command\n **/\n-var InsertCommand = exports.InsertCommand = function(db, collectionName, checkKeys) {\n+var InsertCommand = exports.InsertCommand = function(db, collectionName, checkKeys, options) {\n   BaseCommand.call(this);\n \n   this.collectionName = collectionName;\n   this.documents = [];\n   this.checkKeys = checkKeys == null ? true : checkKeys;\n   this.db = db;\n+  this.flags = 0;\n+  this.serializeFunctions = false;\n+  \n+  // Ensure valid options hash\n+  options = options == null ? {} : options;\n+\n+  // Check if we have keepGoing set -> set flag if it's the case\n+  if(options['keepGoing'] != null && options['keepGoing']) {\n+    // This will finish inserting all non-index violating documents even if it returns an error\n+    this.flags = 1;\n+  }\n+  \n+  // Let us defined on a command basis if we want functions to be serialized or not\n+  if(options['serializeFunctions'] != null && options['serializeFunctions']) {\n+    this.serializeFunctions = true;\n+  }\n };\n \n inherits(InsertCommand, BaseCommand);\n \n+// OpCodes\n+InsertCommand.OP_INSERT =\t2002;\n+\n InsertCommand.prototype.add = function(document) {\n+  if(Buffer.isBuffer(document)) {\n+    var object_size = document[0] | document[1] << 8 | document[2] << 16 | document[3] << 24;    \n+    if(object_size != document.length)  {\n+      var error = new Error(\"insert raw message size does not match message header size [\" + document.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n+  \n   this.documents.push(document);\n   return this;\n };\n \n-InsertCommand.prototype.getOpCode = function() {\n-  \n-  return BaseCommand.OP_INSERT;\n-};\n-\n /*\n struct {\n     MsgHeader header;             // standard message header\n@@ -36,11 +56,86 @@\n     BSON[]    documents;          // one or more documents to insert into the collection\n }\n */\n-InsertCommand.prototype.getCommand = function() {\n-  var command_string = '';\n-  for(var i = 0; i < this.documents.length; i++) {    \n-    command_string = command_string + this.db.bson_serializer.BSON.serialize(this.documents[i], this.checkKeys);\n+InsertCommand.prototype.toBinary = function() {\n+  // Calculate total length of the document\n+  var totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + (4 * 4);\n+  // var docLength = 0\n+  for(var i = 0; i < this.documents.length; i++) {\n+    if(Buffer.isBuffer(this.documents[i])) {\n+      totalLengthOfCommand += this.documents[i].length;\n+    } else {\n+      // Calculate size of document\n+      totalLengthOfCommand += this.db.bson.calculateObjectSize(this.documents[i], this.serializeFunctions, true);\n+    }\n   }\n-  // Build the command string\n-  return BinaryParser.fromInt(0) + BinaryParser.encode_cstring(this.collectionName) + command_string;\n-};\n\\ No newline at end of file\n+  \n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n+  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n+  _command[_index] = totalLengthOfCommand & 0xff;\n+  // Adjust index\n",
					"match": false,
					"packageHash": "6c71c5fab1c9637e1a2d26d9e26cbe3736fe131fdb2e9fdf5f02ae7e27945b1d",
					"size": 1424,
					"sourceHash": "90970dad921cc155b641d84092b4cee8d1b9f7486e4199685a856dc4fb4ed19d",
					"status": "content"
				},
				"lib/mongodb/commands/kill_cursor_command.js": {
					"diff": "--- published/lib/mongodb/commands/kill_cursor_command.js\n+++ rebuilt/lib/mongodb/commands/kill_cursor_command.js\n@@ -1,6 +1,6 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  inherits = require('util').inherits;\n+  inherits = require('util').inherits,\n+  binaryutils = require('../utils');\n \n /**\n   Insert Document Command\n@@ -14,9 +14,7 @@\n \n inherits(KillCursorCommand, BaseCommand);\n \n-KillCursorCommand.prototype.getOpCode = function() {\n-  return BaseCommand.OP_KILL_CURSORS;\n-};\n+KillCursorCommand.OP_KILL_CURSORS = 2007;\n \n /*\n struct {\n@@ -26,12 +24,75 @@\n     int64[]   cursorIDs;                // array of cursorIDs to close\n }\n */\n-KillCursorCommand.prototype.getCommand = function() {\n-  var self = this;\n-  // Generate the command string\n-  var command_string = BinaryParser.fromInt(0) + BinaryParser.fromInt(this.cursorIds.length);\n-  this.cursorIds.forEach(function(cursorId) {\n-    command_string = command_string + self.db.bson_serializer.BSON.encodeLong(cursorId);\n-  });\n-  return command_string;\n+KillCursorCommand.prototype.toBinary = function() {\n+  // Calculate total length of the document\n+  var totalLengthOfCommand = 4 + 4 + (4 * 4) + (this.cursorIds.length * 8);\n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n+  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n+  _command[_index] = totalLengthOfCommand & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write the request ID\n+  _command[_index + 3] = (this.requestId >> 24) & 0xff;     \n+  _command[_index + 2] = (this.requestId >> 16) & 0xff;\n+  _command[_index + 1] = (this.requestId >> 8) & 0xff;\n+  _command[_index] = this.requestId & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  // Write the op_code for the command\n+  _command[_index + 3] = (KillCursorCommand.OP_KILL_CURSORS >> 24) & 0xff;     \n+  _command[_index + 2] = (KillCursorCommand.OP_KILL_CURSORS >> 16) & 0xff;\n+  _command[_index + 1] = (KillCursorCommand.OP_KILL_CURSORS >> 8) & 0xff;\n+  _command[_index] = KillCursorCommand.OP_KILL_CURSORS & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+\n+  // Number of cursors to kill\n+  var numberOfCursors = this.cursorIds.length;\n+  _command[_index + 3] = (numberOfCursors >> 24) & 0xff;     \n+  _command[_index + 2] = (numberOfCursors >> 16) & 0xff;\n+  _command[_index + 1] = (numberOfCursors >> 8) & 0xff;\n+  _command[_index] = numberOfCursors & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+\n+  // Encode all the cursors\n+  for(var i = 0; i < this.cursorIds.length; i++) {\n+    // Encode the cursor id\n+    var low_bits = this.cursorIds[i].getLowBits();\n+    // Encode low bits\n+    _command[_index + 3] = (low_bits >> 24) & 0xff;     \n+    _command[_index + 2] = (low_bits >> 16) & 0xff;\n+    _command[_index + 1] = (low_bits >> 8) & 0xff;\n+    _command[_index] = low_bits & 0xff;\n+    // Adjust index\n+    _index = _index + 4;\n+      \n+    var high_bits = this.cursorIds[i].getHighBits();\n+    // Encode high bits\n+    _command[_index + 3] = (high_bits >> 24) & 0xff;     \n+    _command[_index + 2] = (high_bits >> 16) & 0xff;\n+    _command[_index + 1] = (high_bits >> 8) & 0xff;\n+    _command[_index] = high_bits & 0xff;\n",
					"match": false,
					"packageHash": "b06cebcf9da616adec60de875ba18d4beccb0f26a6642c2cda06a5336b5fcbfc",
					"size": 1150,
					"sourceHash": "d01af72568b490f4e88bb07da854ed5b050494e55e90b60b8b3d11561f8ffa5e",
					"status": "content"
				},
				"lib/mongodb/commands/query_command.js": {
					"diff": "--- published/lib/mongodb/commands/query_command.js\n+++ rebuilt/lib/mongodb/commands/query_command.js\n@@ -1,13 +1,37 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n   inherits = require('util').inherits;\n \n /**\n   Insert Document Command\n **/\n-var QueryCommand = exports.QueryCommand = function(db, collectionName, queryOptions, numberToSkip, numberToReturn, query, returnFieldSelector) {\n+var QueryCommand = exports.QueryCommand = function(db, collectionName, queryOptions, numberToSkip, numberToReturn, query, returnFieldSelector, options) {\n   BaseCommand.call(this);\n+\n+  // Validate correctness off the selector\n+  var object = query,\n+    object_size;\n+  if(Buffer.isBuffer(object)) {\n+    object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;\n+    if(object_size != object.length) {\n+      var error = new Error(\"query selector raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n+\n+  object = returnFieldSelector;\n+  if(Buffer.isBuffer(object)) {\n+    object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;\n+    if(object_size != object.length) {\n+      var error = new Error(\"query fields raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n   \n+  // Make sure we don't get a null exception\n+  options = options == null ? {} : options;\n+  // Set up options\n   this.collectionName = collectionName;\n   this.queryOptions = queryOptions;\n   this.numberToSkip = numberToSkip;\n@@ -15,13 +39,16 @@\n   this.query = query;\n   this.returnFieldSelector = returnFieldSelector;\n   this.db = db;\n+  \n+  // Let us defined on a command basis if we want functions to be serialized or not\n+  if(options['serializeFunctions'] != null && options['serializeFunctions']) {\n+    this.serializeFunctions = true;\n+  }\n };\n \n inherits(QueryCommand, BaseCommand);\n \n-QueryCommand.prototype.getOpCode = function() {\n-  return BaseCommand.OP_QUERY;\n-};\n+QueryCommand.OP_QUERY = 2004;\n \n /*\n struct {\n@@ -34,16 +61,143 @@\n   [ BSON      returnFieldSelector; ]  // OPTIONAL : selector indicating the fields to return.  See below for details.\n }\n */\n-QueryCommand.prototype.getCommand = function() {\n-  // Generate the command string\n-  var command_string = BinaryParser.fromInt(this.queryOptions) + BinaryParser.encode_cstring(this.collectionName);\n-  command_string = command_string + BinaryParser.fromInt(this.numberToSkip) + BinaryParser.fromInt(this.numberToReturn);\n-  command_string = command_string + this.db.bson_serializer.BSON.serialize(this.query);\n-  if(this.returnFieldSelector != null)  {\n-    var count = 0; for(var name in this.returnFieldSelector) { count += 1; }\n-    if(count > 0) command_string = command_string + this.db.bson_serializer.BSON.serialize(this.returnFieldSelector);\n+QueryCommand.prototype.toBinary = function() {\n+  var totalLengthOfCommand = 0;\n+  // Calculate total length of the document\n+  if(Buffer.isBuffer(this.query)) {\n+    totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + 4 + this.query.length + (4 * 4);    \n+  } else {\n+    totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + 4 + this.db.bson.calculateObjectSize(this.query, this.serializeFunctions, true) + (4 * 4);    \n+  }\n+  \n+  // Calculate extra fields size\n+  if(this.returnFieldSelector != null && !(Buffer.isBuffer(this.returnFieldSelector)))  {\n+    if(Object.keys(this.returnFieldSelector).length > 0) {\n+      totalLengthOfCommand += this.db.bson.calculateObjectSize(this.returnFieldSelector, this.serializeFunctions, true);\n+    }\n+  } else if(Buffer.isBuffer(this.returnFieldSelector)) {\n+    totalLengthOfCommand += this.returnFieldSelector.length;\n   }\n-  return command_string;\n+\n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n+  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n",
					"match": false,
					"packageHash": "a8dc239236e96274ddf7ee8c9c1a7afa3b56d7f6d3c904b0c94f09c35b4b8ac8",
					"size": 2271,
					"sourceHash": "42e8d9b5c0118fe3e93e96f00a9998faafbc79b058168904ec3341353c71240b",
					"status": "content"
				},
				"lib/mongodb/commands/update_command.js": {
					"diff": "--- published/lib/mongodb/commands/update_command.js\n+++ rebuilt/lib/mongodb/commands/update_command.js\n@@ -1,17 +1,37 @@\n var BaseCommand = require('./base_command').BaseCommand,\n-  BinaryParser = require('../bson/binary_parser').BinaryParser,\n   inherits = require('util').inherits;\n \n /**\n   Update Document Command\n **/\n var UpdateCommand = exports.UpdateCommand = function(db, collectionName, spec, document, options) {\n-  BaseCommand.apply(this);\n+  BaseCommand.call(this);\n+\n+  var object = spec;\n+  if(Buffer.isBuffer(object)) {\n+    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;    \n+    if(object_size != object.length)  {\n+      var error = new Error(\"update spec raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n+\n+  var object = document;\n+  if(Buffer.isBuffer(object)) {\n+    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;    \n+    if(object_size != object.length)  {\n+      var error = new Error(\"update document raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n+      error.name = 'MongoError';\n+      throw error;\n+    }\n+  }\n \n   this.collectionName = collectionName;\n   this.spec = spec;\n   this.document = document;\n   this.db = db;\n+  this.serializeFunctions = false;\n \n   // Generate correct flags\n   var db_upsert = 0;\n@@ -21,14 +41,15 @@\n \n   // Flags\n   this.flags = parseInt(db_multi_update.toString() + db_upsert.toString(), 2);\n+  // Let us defined on a command basis if we want functions to be serialized or not\n+  if(options['serializeFunctions'] != null && options['serializeFunctions']) {\n+    this.serializeFunctions = true;\n+  }\n };\n \n inherits(UpdateCommand, BaseCommand);\n \n-\n-UpdateCommand.prototype.getOpCode = function() {\n-  return BaseCommand.OP_UPDATE;\n-};\n+UpdateCommand.OP_UPDATE = 2001;\n \n /*\n struct {\n@@ -40,10 +61,112 @@\n     BSON      document;           // the document data to update with or insert\n }\n */\n-UpdateCommand.prototype.getCommand = function() {\n-  // Generate the command string\n-  var command_string = BinaryParser.fromInt(0) + BinaryParser.encode_cstring(this.collectionName);\n-  return command_string + BinaryParser.fromInt(this.flags) + this.db.bson_serializer.BSON.serialize(this.spec) + this.db.bson_serializer.BSON.serialize(this.document, false);\n+UpdateCommand.prototype.toBinary = function() {\n+  // Calculate total length of the document\n+  var totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + this.db.bson.calculateObjectSize(this.spec, false, true) +\n+      this.db.bson.calculateObjectSize(this.document, this.serializeFunctions, true) + (4 * 4);\n+\n+  // Let's build the single pass buffer command\n+  var _index = 0;\n+  var _command = new Buffer(totalLengthOfCommand);\n+  // Write the header information to the buffer\n+  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n+  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n+  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n+  _command[_index] = totalLengthOfCommand & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write the request ID\n+  _command[_index + 3] = (this.requestId >> 24) & 0xff;     \n+  _command[_index + 2] = (this.requestId >> 16) & 0xff;\n+  _command[_index + 1] = (this.requestId >> 8) & 0xff;\n+  _command[_index] = this.requestId & 0xff;\n+  // Adjust index\n+  _index = _index + 4;\n+  // Write zero\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  _command[_index++] = 0;\n+  // Write the op_code for the command\n+  _command[_index + 3] = (UpdateCommand.OP_UPDATE >> 24) & 0xff;     \n+  _command[_index + 2] = (UpdateCommand.OP_UPDATE >> 16) & 0xff;\n",
					"match": false,
					"packageHash": "e63d7f1015f47b0c539c241c7b4366d2305fcc4a821a8ede6cecd8fd7440ff31",
					"size": 1804,
					"sourceHash": "1e9efcade1290911d79395a36a74e0f4bdfc7608c739482547738ac544d537d3",
					"status": "content"
				},
				"lib/mongodb/connection.js": {
					"match": false,
					"packageHash": "40fd26704fe9ca08dbf2d3e361f2d5b4c5fa971da420adf167473b87e18cdd57",
					"size": 6923,
					"status": "missing-in-source"
				},
				"lib/mongodb/connections/repl_set_servers.js": {
					"match": false,
					"packageHash": "b8fe061a0cef703819e0adacc52f95e9df82ad0700d9f98b0cd5c08d8cea3bbb",
					"size": 15342,
					"status": "missing-in-source"
				},
				"lib/mongodb/connections/server.js": {
					"match": false,
					"packageHash": "34d9c1c60804a1ac058c9c346104c283ef1f97e4a9eedfac612a01186d40d4db",
					"size": 4243,
					"status": "missing-in-source"
				},
				"lib/mongodb/connections/server_cluster.js": {
					"match": false,
					"packageHash": "b09fbc67dc027a20cd1fd8c11184b81ccd38c2ad03edc1e1de0b400d6efe8b32",
					"size": 4593,
					"status": "missing-in-source"
				},
				"lib/mongodb/connections/server_pair.js": {
					"match": false,
					"packageHash": "20c1bc1219adc570c52c9bc4ed9e786edd85b1ca07dda37ee5d1651ec1bc5440",
					"size": 4544,
					"status": "missing-in-source"
				},
				"lib/mongodb/crypto/md5.js": {
					"match": false,
					"packageHash": "f1077dc944ce6ea4d93259b41eb52df6cff776a1ba4ce1fc590f3e5fb3b485ee",
					"size": 12334,
					"status": "missing-in-source"
				},
				"lib/mongodb/cursor.js": {
					"diff": "--- published/lib/mongodb/cursor.js\n+++ rebuilt/lib/mongodb/cursor.js\n@@ -1,46 +1,41 @@\n var QueryCommand = require('./commands/query_command').QueryCommand,\n   GetMoreCommand = require('./commands/get_more_command').GetMoreCommand,\n   KillCursorCommand = require('./commands/kill_cursor_command').KillCursorCommand,\n-  Long = require('./goog/math/long').Long,\n-  debug = require('util').debug,\n-  inspect = require('util').inspect;\n+  Long = require('bson').Long,\n+  CursorStream = require('./cursorstream'),\n+  utils = require('./utils');\n \n /**\n  * Constructor for a cursor object that handles all the operations on query result\n- * using find. This cursor object is unidirectional and cannot traverse backwards.\n- * As an alternative, {@link Cursor#toArray} can be used to obtain all the results.\n- * Clients should not be creating a cursor directly, but use {@link Collection#find}\n- * to acquire a cursor.\n- *\n- * @constructor\n- *\n- * @param db {Db} The database object to work with\n- * @param collection {Colleciton} The collection to query\n- * @param selector\n- * @param fields\n- * @param skip {number}\n- * @param limit {number} The number of results to return. -1 has a special meaning and\n- *     is used by {@link Db#eval}. A value of 1 will also be treated as if it were -1.\n- * @param sort {string|Array<Array<string|object> >} Please refer to {@link Cursor#sort}\n- * @param hint\n- * @param explain\n- * @param snapshot\n- * @param timeout\n- * @param tailable {?boolean}\n- * @param batchSize {?number} The number of the subset of results to request the database\n- *     to return for every request. This should initially be greater than 1 otherwise\n- *     the database will automatically close the cursor. The batch size can be set to 1\n- *     with {@link Cursor#batchSize} after performing the initial query to the database.\n- *\n- * @see Cursor#toArray\n- * @see Cursor#skip\n- * @see Cursor#sort\n- * @see Cursor#limit\n- * @see Cursor#batchSize\n- * @see Collection#find\n- * @see Db#eval\n- */\n-var Cursor = exports.Cursor = function(db, collection, selector, fields, skip, limit, sort, hint, explain, snapshot, timeout, tailable, batchSize, slaveOk) {\n+ * using find. This cursor object is unidirectional and cannot traverse backwards. Clients should not be creating a cursor directly, \n+ * but use find to acquire a cursor.\n+ *\n+ * @class Represents a Cursor.\n+ * @param {Db} db the database object to work with.\n+ * @param {Collection} collection the collection to query.\n+ * @param {Object} selector the query selector.\n+ * @param {Object} fields an object containing what fields to include or exclude from objects returned.\n+ * @param {Number} skip number of documents to skip.\n+ * @param {Number} limit the number of results to return. -1 has a special meaning and is used by Db.eval. A value of 1 will also be treated as if it were -1.\n+ * @param {String|Array|Object} sort the required sorting for the query.\n+ * @param {Object} hint force the query to use a specific index.\n+ * @param {Boolean} explain return the explaination of the query.\n+ * @param {Boolean} snapshot Snapshot mode assures no duplicates are returned.\n+ * @param {Boolean} timeout allow the query to timeout.\n+ * @param {Boolean} tailable allow the cursor to be tailable.\n+ * @param {Number} batchSize the number of the subset of results to request the database to return for every request. This should initially be greater than 1 otherwise the database will automatically close the cursor. The batch size can be set to 1 with cursorInstance.batchSize after performing the initial query to the database.\n+ * @param {Boolean} raw return all query documents as raw buffers (default false).\n+ * @param {Boolean} read specify override of read from source (primary/secondary).\n+ * @param {Boolean} returnKey only return the index key.\n+ * @param {Number} maxScan limit the number of items to scan.\n+ * @param {Number} min set index bounds.\n+ * @param {Number} max set index bounds.\n+ * @param {Boolean} showDiskLoc show disk location of results.\n+ * @param {String} comment you can put a $comment field on a query to make looking in the profiler logs simpler.\n+ */\n+function Cursor(db, collection, selector, fields, skip, limit\n+\t, sort, hint, explain, snapshot, timeout, tailable, batchSize, slaveOk, raw, read\n+\t, returnKey, maxScan, min, max, showDiskLoc, comment) {\n   this.db = db;\n   this.collection = collection;\n   this.selector = selector;\n@@ -54,11 +49,19 @@\n   this.timeout = timeout == null ? true : timeout;\n   this.tailable = tailable;\n   this.batchSizeValue = batchSize == null ? 0 : batchSize;\n-  this.slaveOk = slaveOk == null ? false : slaveOk;\n-\n+  this.slaveOk = slaveOk == null ? collection.slaveOk : slaveOk;\n+  this.raw = raw == null ? false : raw;\n+  this.read = read == null ? true : read;\n+  this.returnKey = returnKey;\n+  this.maxScan = maxScan;\n+  this.min = min;\n+  this.max = max;\n+  this.showDiskLoc = showDiskLoc;\n+  this.comment = comment;\n+  \n   this.totalNumberOfRecords = 0;\n   this.items = [];\n-  this.cursorId = this.db.bson_serializer.Long.fromInt(0);\n",
					"match": false,
					"packageHash": "fa4a362180b1cad506c4b1963ae07a0e8862171c9bf797f5300a2f0176f84b65",
					"size": 22851,
					"sourceHash": "c4a6fb5b596bb88a2e03a3d00859e3cb8ae2ac573e12fa196743abfbf01737ea",
					"status": "content"
				},
				"lib/mongodb/db.js": {
					"diff": "--- published/lib/mongodb/db.js\n+++ rebuilt/lib/mongodb/db.js\n@@ -1,102 +1,391 @@\n+/**\n+ * Module dependencies.\n+ * @ignore\n+ */\n var QueryCommand = require('./commands/query_command').QueryCommand,\n   DbCommand = require('./commands/db_command').DbCommand,\n-  BinaryParser = require('./bson/binary_parser').BinaryParser,\n   MongoReply = require('./responses/mongo_reply').MongoReply,\n   Admin = require('./admin').Admin,\n-  Connection = require('./connection').Connection,\n   Collection = require('./collection').Collection,\n-  Server = require('./connections/server').Server,\n-  ServerPair = require('./connections/server_pair').ServerPair,\n-  ServerCluster = require('./connections/server_cluster').ServerCluster,\n-  ReplSetServers = require('./connections/repl_set_servers').ReplSetServers,\n+  Server = require('./connection/server').Server,\n+  ReplSet = require('./connection/repl_set').ReplSet,\n   Cursor = require('./cursor').Cursor,\n-  MD5 = require('./crypto/md5').MD5,\n   EventEmitter = require('events').EventEmitter,\n   inherits = require('util').inherits,\n-  debug = require('util').debug,\n-  inspect = require('util').inspect;\n+  crypto = require('crypto');\n+\n+/**\n+ * Internal class for callback storage \n+ * @ignore\n+ */\n+var CallbackStore = function() {\n+  // Make class an event emitter\n+  EventEmitter.call(this);\n+  // Add a info about call variable\n+  this._notReplied = {};\n+}\n+\n+/**\n+ * @ignore\n+ */\n+inherits(CallbackStore, EventEmitter);\n+\n+/**\n+ * Create a new Db instance.\n+ *\n+ * Options\n+ *  - **strict** {true | {w:n, wtimeout:n} | {fsync:true}, default:false}, execute insert with a getLastError command returning the result of the insert command.\n+ *  - **native_parser** {Boolean, default:false}, use c++ bson parser.\n+ *  - **forceServerObjectId** {Boolean, default:false}, force server to create _id fields instead of client.\n+ *  - **pkFactory** {Object}, object overriding the basic ObjectID primary key generation.\n+ *  - **slaveOk** {Boolean, default:false}, allow reads from secondaries.\n+ *  - **serializeFunctions** {Boolean, default:false}, serialize functions.\n+ *  - **raw** {Boolean, default:false}, peform operations using raw bson buffers.\n+ *  - **recordQueryStats** {Boolean, default:false}, record query statistics during execution.\n+ *  - **reaper** {Boolean, default:false}, enables the reaper, timing out calls that never return.\n+ *  - **reaperInterval** {Number, default:10000}, number of miliseconds between reaper wakups.\n+ *  - **reaperTimeout** {Number, default:30000}, the amount of time before a callback times out.\n+ *  - **retryMiliSeconds** {Number, default:5000}, number of miliseconds between retries.\n+ *  - **numberOfRetries** {Number, default:5}, number of retries off connection.\n+ *\n+ * @class Represents a Collection\n+ * @param {String} databaseName name of the database.\n+ * @param {Object} serverConfig server config object.\n+ * @param {Object} [options] additional options for the collection.\n+ */\n+function Db(databaseName, serverConfig, options) {\n \n-var Db = exports.Db = function(databaseName, serverConfig, options) {\n+  if(!(this instanceof Db)) return new Db(databaseName, serverConfig, options);\n+  \n   EventEmitter.call(this);\n   this.databaseName = databaseName;\n-  this.serverConfig = serverConfig;\n-  this.options = options == null ? {} : options;\n+  this.serverConfig = serverConfig;  \n+  this.options = options == null ? {} : options;  \n+  // State to check against if the user force closed db\n+  this._applicationClosed = false;\n+  // Fetch the override flag if any\n+  var overrideUsedFlag = this.options['override_used_flag'] == null ? false : this.options['override_used_flag'];  \n+  // Verify that nobody is using this config\n+  if(!overrideUsedFlag && typeof this.serverConfig == 'object' && this.serverConfig._isUsed()) {\n+    throw new Error(\"A Server or ReplSet instance cannot be shared across multiple Db instances\");\n+  } else if(!overrideUsedFlag && typeof this.serverConfig == 'object'){\n+    // Set being used\n+    this.serverConfig._used = true;    \n+  }\n+  \n+  // Ensure we have a valid db name\n+  validateDatabaseName(databaseName);\n   \n   // Contains all the connections for the db\n   try {\n-    var serializer = this.options.native_parser ? require('../../external-libs/bson') : require('./bson/bson');\n-    this.bson_serializer = serializer;\n-    this.bson_deserializer = serializer;\n+    this.native_parser = this.options.native_parser;\n+    // The bson lib\n",
					"match": false,
					"packageHash": "2e49560f74176ac677f02081fb9d1c82cda5e701e02b4c866848496f83b082b1",
					"size": 24576,
					"sourceHash": "8975ea6eee925ca6f0b33ba4cb074d8de4c712ad9540ccd346aeb97e626a7e93",
					"status": "content"
				},
				"lib/mongodb/goog/math/long.js": {
					"match": false,
					"packageHash": "fb03f43098c1f6f90e7e614f3e282071e2ab27f6f40e087fa2cb6aab8a805301",
					"size": 23354,
					"status": "missing-in-source"
				},
				"lib/mongodb/gridfs/chunk.js": {
					"diff": "--- published/lib/mongodb/gridfs/chunk.js\n+++ rebuilt/lib/mongodb/gridfs/chunk.js\n@@ -1,10 +1,8 @@\n-var BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  sys = require('util'),\n-  debug = require('util').debug,\n-  inspect = require('util').inspect;\n+var Binary = require('bson').Binary,\n+  ObjectID = require('bson').ObjectID;\n \n /**\n- * Class for representing a signle chunk in GridFS.\n+ * Class for representing a single chunk in GridFS.\n  *\n  * @class\n  *\n@@ -19,36 +17,48 @@\n  * @see Chunk#buildMongoObject\n  */\n var Chunk = exports.Chunk = function(file, mongoObject) {\n+  if(!(this instanceof Chunk)) return new Chunk(file, mongoObject);\n+  \n   this.file = file;\n+  var self = this;\n   var mongoObjectFinal = mongoObject == null ? {} : mongoObject;\n-  this.objectId = mongoObjectFinal._id == null ? new file.db.bson_serializer.ObjectID() : mongoObjectFinal._id;\n+\n+  this.objectId = mongoObjectFinal._id == null ? new ObjectID() : mongoObjectFinal._id;\n   this.chunkNumber = mongoObjectFinal.n == null ? 0 : mongoObjectFinal.n;\n-  this.data = new file.db.bson_serializer.Binary();\n+  this.data = new Binary();\n \n   if(mongoObjectFinal.data == null) {\n-  } else if(mongoObjectFinal.data.constructor == String) {\n+  } else if(typeof mongoObjectFinal.data == \"string\") {\n     var buffer = new Buffer(mongoObjectFinal.data.length);\n     buffer.write(mongoObjectFinal.data, 'binary', 0);\n-    this.data = new file.db.bson_serializer.Binary(buffer);\n-  } else if(mongoObjectFinal.data.constructor == Array) {\n+    this.data = new Binary(buffer);\n+  } else if(Array.isArray(mongoObjectFinal.data)) {\n     var buffer = new Buffer(mongoObjectFinal.data.length);\n     buffer.write(mongoObjectFinal.data.join(''), 'binary', 0);\n-    this.data = new file.db.bson_serializer.Binary(buffer);\n-  } else if(mongoObjectFinal.data instanceof file.db.bson_serializer.Binary || Object.prototype.toString.call(mongoObjectFinal.data) == \"[object Binary]\") {    \n+    this.data = new Binary(buffer);\n+  } else if(mongoObjectFinal.data instanceof Binary || Object.prototype.toString.call(mongoObjectFinal.data) == \"[object Binary]\") {    \n     this.data = mongoObjectFinal.data;\n+  } else if(Buffer.isBuffer(mongoObjectFinal.data)) {\n   } else {\n     throw Error(\"Illegal chunk format\");\n   }\n   // Update position\n   this.internalPosition = 0;\n-\t/**\n-\t * The position of the read/write head\n-\t * @name position\n-\t * @lends Chunk#\n-\t * @field\n-\t */\n-  this.__defineGetter__(\"position\", function() { return this.internalPosition; });\n-  this.__defineSetter__(\"position\", function(value) { this.internalPosition = value; });\n+\n+  /**\n+   * The position of the read/write head\n+   * @name position\n+   * @lends Chunk#\n+   * @field\n+   */\n+  Object.defineProperty(this, \"position\", { enumerable: true\n+    , get: function () {\n+        return this.internalPosition;\n+      }\n+    , set: function(value) {\n+        this.internalPosition = value;\n+      }\n+  });  \n };\n \n /**\n@@ -60,10 +70,10 @@\n  *     will contain a reference to this object.\n  */\n Chunk.prototype.write = function(data, callback) {\n-  // this.data.write(data.toString('binary'), this.internalPosition);\n   this.data.write(data, this.internalPosition);\n   this.internalPosition = this.data.length();\n-  callback(null, this);\n+  if(callback != null) return callback(null, this);\n+  return this;\n };\n \n /**\n@@ -75,6 +85,9 @@\n  *     the chunk. Returns an empty String otherwise.\n  */\n Chunk.prototype.read = function(length) {  \n+  // Default to full read if no index defined\n+  length = length == null || length == 0 ? this.length() : length;\n+  \n",
					"match": false,
					"packageHash": "a9b2fbcab2e62e70288b6966b847dfb2d879060a51c9ae5df9df898a1e0b07fa",
					"size": 6664,
					"sourceHash": "ebb1d349b3e79a84bc1a2f0a2d8bb5679a6f63325d9d48d0665c1296119ff3a5",
					"status": "content"
				},
				"lib/mongodb/gridfs/gridstore.js": {
					"diff": "--- published/lib/mongodb/gridfs/gridstore.js\n+++ rebuilt/lib/mongodb/gridfs/gridstore.js\n@@ -6,126 +6,165 @@\n  * chunks of split files behind the scenes. More information about GridFS can be\n  * found <a href=\"http://www.mongodb.org/display/DOCS/GridFS\">here</a>.\n  */\n-\n-var BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  Chunk = require('./chunk').Chunk,\n+var Chunk = require('./chunk').Chunk,\n   DbCommand = require('../commands/db_command').DbCommand,\n+  ObjectID = require('bson').ObjectID,\n   Buffer = require('buffer').Buffer,\n   fs = require('fs'),\n   util = require('util'),\n-  debug = require('util').debug,\n-  inspect = require('util').inspect,\n-  Stream = require('stream').Stream;\n+  ReadStream = require('./readstream').ReadStream;\n+\n+var REFERENCE_BY_FILENAME = 0,\n+  REFERENCE_BY_ID = 1;\n \n /**\n  * A class representation of a file stored in GridFS.\n  *\n- * @class\n- *\n- * @param db {Db} A database instance to interact with.\n- * @param filename {string} The name for the file.\n- * @param mode {?string} Set the mode for this file. Available modes:\n- *     <ul>\n- *       <li>\"r\" - read only. This is the default mode.</li>\n- *       <li>\"w\" - write in truncate mode. Existing data will be overwriten</li>\n- *       <li>\"w+\" - write in edit mode.</li>\n- *     </ul>\n-\n- * @param options {?object} Optional properties to specify. Recognized keys:\n- *\n- *     <pre><code>\n- *     {\n- *       'root' : , // {string} root collection to use. Defaults to GridStore#DEFAULT_ROOT_COLLECTION\n- *       'chunk_type' : , // {string} mime type of the file. Defaults to GridStore#DEFAULT_CONTENT_TYPE\n- *       'chunk_size' : , // {number} size for the chunk. Defaults to Chunk#DEFAULT_CHUNK_SIZE.\n- *       'metadata' : , // {object} arbitrary data the user wants to store\n- *     }\n- *     </code></pre>\n- *\n- * @see <a href=\"http://www.mongodb.org/display/DOCS/GridFS+Specification\">MongoDB GridFS Specification</a>\n- */\n-var GridStore = exports.GridStore = function(db, filename, mode, options) {\n-  this.db = db;\n-  this.filename = filename;\n+ * Modes\n+ *  - **\"r\"** - read only. This is the default mode.\n+ *  - **\"w\"** - write in truncate mode. Existing data will be overwriten.\n+ *  - **w+\"** - write in edit mode.\n+ *\n+ * Options\n+ *  - **root** {String}, root collection to use. Defaults to **{GridStore.DEFAULT_ROOT_COLLECTION}**.\n+ *  - **chunk_type** {String}, mime type of the file. Defaults to **{GridStore.DEFAULT_CONTENT_TYPE}**.\n+ *  - **chunk_size** {Number}, size for the chunk. Defaults to **{Chunk.DEFAULT_CHUNK_SIZE}**.\n+ *  - **metadata** {Object}, arbitrary data the user wants to store.\n+ *\n+ * @class Represents the GridStore.\n+ * @param {Db} db A database instance to interact with.\n+ * @param {ObjectID} id an unique ObjectID for this file\n+ * @param {String} [filename] optional a filename for this file, no unique constrain on the field\n+ * @param {String} mode set the mode for this file.\n+ * @param {Object} options optional properties to specify. Recognized keys:\n+ * @return {GridStore}\n+ */\n+function GridStore(db, id, filename, mode, options) {\n+  if(!(this instanceof GridStore)) return new GridStore(db, id, filename, mode, options);\n+\n+  var self = this;\n+  this.db = db;  \n+  var _filename = filename;\n+\n+  if(typeof filename == 'string' && typeof mode == 'string') {\n+    _filename = filename;  \n+  } else if(typeof filename == 'string' && typeof mode == 'object' && mode != null) {\n+    var _mode = mode;\n+    mode = filename;\n+    options = _mode;    \n+    _filename = id;\n+  } else if(typeof filename == 'string' && mode == null) {\n+    mode = filename;\n+    _filename = id;\n+  }\n+  \n+  // set grid referencetype\n+  this.referenceBy = typeof id == 'string' ? 0 : 1;\n+  this.filename = _filename;\n+  this.fileId = typeof id == 'string' ? new ObjectID() : id;\n+  \n+  // Set up the rest\n   this.mode = mode == null ? \"r\" : mode;\n   this.options = options == null ? {} : options;\n   this.root = this.options['root'] == null ? exports.GridStore.DEFAULT_ROOT_COLLECTION : this.options['root'];\n",
					"match": false,
					"packageHash": "90d86c1a3a690b781acd63ab262557e446e8af5ad93f5cb88e9eb59b97466287",
					"size": 41325,
					"sourceHash": "3431d98442b60a3a8125b38249d63dfe6a81338d3bf41d9b86b2e8e71c0c3aac",
					"status": "content"
				},
				"lib/mongodb/index.js": {
					"diff": "--- published/lib/mongodb/index.js\n+++ rebuilt/lib/mongodb/index.js\n@@ -1,47 +1,11 @@\n-\n try {\n-  exports.BSONPure = require('./bson/bson');\n-  exports.BSONNative = require('../../external-libs/bson/bson');\n+  exports.BSONPure = require('bson').BSONPure;\n+  exports.BSONNative = require('bson').BSONNative;\n } catch(err) {\n   // do nothing\n }\n \n-[ 'bson/binary_parser'\n-, 'commands/base_command'\n-, 'commands/db_command'\n-, 'commands/delete_command'\n-, 'commands/get_more_command'\n-, 'commands/insert_command'\n-, 'commands/kill_cursor_command'\n-, 'commands/query_command'\n-, 'commands/update_command'\n-, 'responses/mongo_reply'\n-, 'admin'\n-, 'collection'\n-, 'connections/server'\n-, 'connections/server_pair'\n-, 'connections/server_cluster'\n-, 'connections/repl_set_servers'\n-, 'connection'\n-, 'cursor'\n-, 'db'\n-, 'goog/math/long'\n-, 'crypto/md5'\n-,\t'gridfs/chunk'\n-, 'gridfs/gridstore'].forEach(function (path) {\n-\tvar module = require('./' + path);\n-\tfor (var i in module) {\n-\t\texports[i] = module[i];\n-  }\n-});\n-\n-// Exports all the classes for the NATIVE JS BSON Parser\n-exports.native = function() {\n-  var classes = {};\n-  // Map all the classes\n-  [ 'bson/binary_parser'\n-  , '../../external-libs/bson/bson'\n-  , 'commands/base_command'\n+[ 'commands/base_command'\n   , 'commands/db_command'\n   , 'commands/delete_command'\n   , 'commands/get_more_command'\n@@ -52,57 +16,136 @@\n   , 'responses/mongo_reply'\n   , 'admin'\n   , 'collection'\n-  , 'connections/server'\n-  , 'connections/server_pair'\n-  , 'connections/server_cluster'\n-  , 'connections/repl_set_servers'\n-  , 'connection'\n+  , 'connection/connection'\n+  , 'connection/server'\n+  , 'connection/repl_set'\n   , 'cursor'\n   , 'db'\n-  , 'crypto/md5'\n+  , 'gridfs/grid'\n   ,\t'gridfs/chunk'\n   , 'gridfs/gridstore'].forEach(function (path) {\n   \tvar module = require('./' + path);\n   \tfor (var i in module) {\n-  \t\tclasses[i] = module[i];\n+  \t\texports[i] = module[i];\n     }\n+\n+    // backwards compat\n+    exports.ReplSetServers = exports.ReplSet;\n+    \n+    // Add BSON Classes\n+    exports.Binary = require('bson').Binary;\n+    exports.Code = require('bson').Code;\n+    exports.DBRef = require('bson').DBRef;\n+    exports.Double = require('bson').Double;\n+    exports.Long = require('bson').Long;\n+    exports.MinKey = require('bson').MinKey;\n+    exports.MaxKey = require('bson').MaxKey;\n+    exports.ObjectID = require('bson').ObjectID;\n+    exports.Symbol = require('bson').Symbol;\n+    exports.Timestamp = require('bson').Timestamp;  \n+    \n+    // Add BSON Parser\n+    exports.BSON = require('bson').BSONPure.BSON;\n+});\n+\n+// Exports all the classes for the PURE JS BSON Parser\n+exports.pure = function() {\n+  var classes = {};\n+  // Map all the classes\n",
					"match": false,
					"packageHash": "6bcf904f0838d78c4673a2e042229ba207091cbffa48fff3c30b7b053411dfbd",
					"size": 2547,
					"sourceHash": "f177a8277bbee6a3ec1c3e002bda2026d47cad3da7c164edb7f615a0b9c7b360",
					"status": "content"
				},
				"lib/mongodb/responses/mongo_reply.js": {
					"diff": "--- published/lib/mongodb/responses/mongo_reply.js\n+++ rebuilt/lib/mongodb/responses/mongo_reply.js\n@@ -1,48 +1,123 @@\n-var BinaryParser = require('../bson/binary_parser').BinaryParser,\n-  Long = require('../goog/math/long').Long;\n+var Long = require('bson').Long;\n \n /**\n   Reply message from mongo db\n **/\n-var MongoReply = exports.MongoReply = function(db, binary_reply) {\n+var MongoReply = exports.MongoReply = function() {\n   this.documents = [];\n-  var index = 0;\n+  this.index = 0;\n+};\n+\n+MongoReply.prototype.parseHeader = function(binary_reply, bson) {\n   // Unpack the standard header first\n-  var messageLength = BinaryParser.toInt(binary_reply.substr(index, 4));\n-  index = index + 4;\n+  this.messageLength = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n   // Fetch the request id for this reply\n-  this.requestId = BinaryParser.toInt(binary_reply.substr(index, 4));\n-  index = index + 4;\n+  this.requestId = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n   // Fetch the id of the request that triggered the response\n-  this.responseTo = BinaryParser.toInt(binary_reply.substr(index, 4));\n+  this.responseTo = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n   // Skip op-code field\n-  index = index + 4 + 4;\n+  this.index = this.index + 4 + 4;\n   // Unpack the reply message\n-  this.responseFlag = BinaryParser.toInt(binary_reply.substr(index, 4));\n-  index = index + 4;  \n+  this.responseFlag = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n   // Unpack the cursor id (a 64 bit long integer)\n-  this.cursorId = new db.bson_serializer.BSON.toLong(BinaryParser.toInt(binary_reply.substr(index, 4)), BinaryParser.toInt(binary_reply.substr(index + 4, 4)));\n-  index = index + 8;\n+  var low_bits = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n+  var high_bits = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n+  this.cursorId = new Long(low_bits, high_bits);\n   // Unpack the starting from\n-  this.startingFrom = BinaryParser.toInt(binary_reply.substr(index, 4));\n-  index = index + 4;\n+  this.startingFrom = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;\n   // Unpack the number of objects returned\n-  this.numberReturned = BinaryParser.toInt(binary_reply.substr(index, 4));\n-  index = index + 4;\n-  // Let's unpack all the bson document, deserialize them and store them\n-  for(var object_index = 0; object_index < this.numberReturned; object_index++) {\n-    // Read the size of the bson object\n-    var bsonObjectSize = BinaryParser.toInt(binary_reply.substr(index, 4));\n-    \n-    // sys.debug(\"--------------------------------------------------- incoming\")\n-    // BinaryParser.hprint(binary_reply.substr(index, bsonObjectSize))\n+  this.numberReturned = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n+  this.index = this.index + 4;  \n+}\n+\n+MongoReply.prototype.parseBody = function(binary_reply, bson, raw, callback) {\n+  raw = raw == null ? false : raw;\n+  // Just set a doc limit for deserializing\n+  var docLimitSize = 1024*20;  \n+  \n+  // If our message length is very long, let's switch to process.nextTick for messages\n+  if(this.messageLength > docLimitSize) {\n+    var batchSize = this.numberReturned;\n+    this.documents = new Array(this.numberReturned);\n     \n-    // Read the entire object and deserialize it\n-    this.documents.push(db.bson_deserializer.BSON.deserialize(binary_reply.substr(index, bsonObjectSize)));\n-    // Adjust for next object\n-    index = index + bsonObjectSize;\n-  }\n-};\n+    // Just walk down until we get a positive number >= 1\n+    for(var i = 50; i > 0; i--) {\n+      if((this.numberReturned/i) >= 1) {\n+        batchSize = i;\n+        break;\n+      }      \n+    }  \n+\n+    // Actual main creator of the processFunction setting internal state to control the flow\n+    var parseFunction = function(_self, _binary_reply, _batchSize, _numberReturned) {\n+      var object_index = 0;      \n+      // Internal loop process that will use nextTick to ensure we yield some time\n+      var processFunction = function() {\n+        // Adjust batchSize if we have less results left than batchsize\n+        if((_numberReturned - object_index) < _batchSize) {\n+          _batchSize = _numberReturned - object_index;\n+        }\n+        \n",
					"match": false,
					"packageHash": "d1747a49a1e8632075ef4477b5e29a51329647615c7fba77c65076f4527c2ee2",
					"size": 2291,
					"sourceHash": "2a7cc4f286e5792d1ac34e4e92fc1586b483f6f974fb93afbf63d6d80d64e842",
					"status": "content"
				},
				"package.json": {
					"diff": "--- published/package.json\n+++ rebuilt/package.json\n@@ -1,26 +1,80 @@\n { \"name\" :            \"mongodb\"\n , \"description\" :     \"A node.js driver for MongoDB\"\n-, \"version\" :         \"0.9.4-4\"\n+, \"keywords\" :        [\"mongodb\", \"mongo\", \"driver\", \"db\"]\n+, \"version\" :         \"0.9.9-8\"\n , \"author\" :          \"Christian Amor Kvalheim <christkv@gmail.com>\"\n-, \"contributors\" :  [ \"Nathan White <nw@nwhite.net>\",\n-                      \"Adam Wiggins <adam@heroku.com>\",\n-                      \"Ian Millington <idmillington@googlemail.com>\",\n-                      \"Aaron Heckmann <aaron.heckmann+github@gmail.com>\",\n-                      \"Ciaran Jessup <ciaranj@gmail.com>\",\n+, \"contributors\" :  [ \"Aaron Heckmann\",\n                       \"Christoph Pojer\",\n+                      \"Pau Ramon Revilla\",\n+                      \"Nathan White\",\n+                      \"Emmerman\",\n+                      \"Seth LaForge\",\n+                      \"Boris Filipov\",\n+                      \"Stefan Schrmeli\",\n+                      \"Tedde Lundgren\",\n+                      \"renctan\",\n+                      \"Sergey Ukustov\",\n+                      \"Ciaran Jessup\",\n+                      \"kuno\",\n+                      \"srimonti\",\n                       \"Erik Abele\",\n-                      \"Henrik Johansson <dahankzter@gmail.com>\" ]\n+                      \"Pratik Daga\",\n+                      \"Slobodan Utvic\",\n+                      \"Kristina Chodorow\",\n+                      \"Yonathan Randolph\",\n+                      \"Brian Noguchi\",\n+                      \"Sam Epstein\",\n+                      \"James Harrison Fisher\",\n+                      \"Vladimir Dronnikov\",\n+                      \"Ben Hockey\",\n+                      \"Henrik Johansson\",\n+                      \"Simon Weare\",\n+                      \"Alex Gorbatchev\",\n+                      \"Shimon Doodkin\",\n+                      \"Kyle Mueller\",\n+                      \"Eran Hammer-Lahav\",\n+                      \"Marcin Ciszak\",\n+                      \"Franois de Metz\",\n+                      \"Vinay Pulim\",\n+                      \"nstielau\",\n+                      \"Adam Wiggins\",\n+                      \"entrinzikyl\",\n+                      \"Jeremy Selier\",\n+                      \"Ian Millington\",\n+                      \"Public Keating\",\n+                      \"andrewjstone\",\n+                      \"Christopher Stott\",\n+                      \"Corey Jewett\",\n+                      \"brettkiefer\",\n+                      \"Rob Holland\",\n+                      \"Senmiao Liu\",\n+                      \"heroic\",\n+                      \"gitfy\",\n+                      \"Andrew Stone\",\n+\t\t\t\t\t\t\t\t\t\t\t\"John Le Drew\"]\n+\n , \"repository\" :    { \"type\" :  \"git\"\n                     , \"url\" :   \"http://github.com/christkv/node-mongodb-native.git\" }\n , \"bugs\" :          { \"mail\" :  \"node-mongodb-native@googlegroups.com\"\n-                    , \"web\" :   \"http://github.com/christkv/node-mongodb-native/issues\" }\n-, \"os\" :            [ \"linux\"\n-                    , \"darwin\"\n-                    , \"freebsd\" ]\n+                    , \"url\" :   \"http://github.com/christkv/node-mongodb-native/issues\" }\n+, \"dependencies\" : {\n+  \"bson\": \"0.0.4\"\n+}                    \n+, \"devDependencies\": {\n+      \"dox\": \"0.2.0\"\n+    , \"uglify-js\": \"1.2.5\"\n+    , \"ejs\": \"0.6.1\"\n+    , \"nodeunit\": \"0.7.3\"\n+    , \"github3\": \">=0.3.0\"\n+\t  , \"markdown\": \"0.3.1\"\n+\t  , \"gleak\": \"0.2.3\"\n+\t  , \"step\": \"0.0.5\"\n+  }\n+, \"config\":         { \"native\" : false }                    \n , \"main\":             \"./lib/mongodb/index\"\n , \"directories\" :   { \"lib\" : \"./lib/mongodb\" }\n , \"engines\" :       { \"node\" : \">=0.4.0\" }\n-, \"scripts\": { \"install\" : \"bash ./install.sh\" }\n+, \"scripts\": { \"test\" : \"make test_pure\" }\n , \"licenses\" :    [ { \"type\" :  \"Apache License, Version 2.0\"\n                     , \"url\" :   \"http://www.apache.org/licenses/LICENSE-2.0\" } ]\n }\n",
					"match": false,
					"packageHash": "8cc7b331a23dd20dd0847df6d1e91aa136bca0f6f4c922747bdf1d83462c5488",
					"size": 1352,
					"sourceHash": "3e819dd4d5c4f71977047355855ffb75eb246f9cfed7b07d12c2abb32fdb8bc5",
					"status": "content"
				},
				"server.js": {
					"match": false,
					"packageHash": "8902e0fbd87ec48ff53615424eb684d9c9cb687b0e26e98b1c5b3938888816ba",
					"size": 3226,
					"status": "missing-in-source"
				},
				"test/admin_test.js": {
					"match": false,
					"packageHash": "2302df85af97bd6bb491b906d6f7171feeef3016a1d7f090b22179d7eb25904e",
					"size": 15634,
					"status": "missing-in-source"
				},
				"test/authentication_test.js": {
					"match": false,
					"packageHash": "f1174892db84e33505bef507a83a6fd00c04b44d06d1b3750268872c62801683",
					"size": 3286,
					"status": "missing-in-source"
				},
				"test/bson/bson_test.js": {
					"match": false,
					"packageHash": "bcec12073194c2df13adfb741155c5050279fb2b06f776039dc6904575347743",
					"size": 12320,
					"status": "missing-in-source"
				},
				"test/bson/commands_test.js": {
					"match": false,
					"packageHash": "052d490fef48dc29be49ece1ff5fef47427892957dff60307c96f76ac025e55e",
					"size": 5207,
					"status": "missing-in-source"
				},
				"test/collection_test.js": {
					"match": false,
					"packageHash": "49520c4b6d0231f4d1cc17c362ee4a44142a6d00c3d2f4f9109a4012a6b68314",
					"size": 22075,
					"status": "missing-in-source"
				},
				"test/cursor_test.js": {
					"match": false,
					"packageHash": "6f19cf2ee8e9b4e147e29e8ef21e2900d1f7465100cf1dc9118c5721810c518f",
					"size": 27882,
					"status": "missing-in-source"
				},
				"test/custom_pk_test.js": {
					"match": false,
					"packageHash": "4fd09ce36f65a434e14e599e33c35f7eb3452236ea17babfed40f2a480df626b",
					"size": 2723,
					"status": "missing-in-source"
				},
				"test/db_test.js": {
					"match": false,
					"packageHash": "bef8e671dc2b48371d027cca2f9bf0599075caac5fbb64cf20f60710b6147c79",
					"size": 11491,
					"status": "missing-in-source"
				},
				"test/error_test.js": {
					"match": false,
					"packageHash": "56fe9af6c14f3f20734636fe76e6c03889ff8edfb580fce404e051630beb5106",
					"size": 8370,
					"status": "missing-in-source"
				},
				"test/find_test.js": {
					"match": false,
					"packageHash": "7398b16fb9a12da520295af933d7f979c3a42181dd8c1ac8a8d1141a6711f516",
					"size": 24482,
					"status": "missing-in-source"
				},
				"test/gridstore/grid_store_file_test.js": {
					"match": false,
					"packageHash": "c32a47fb5626d466f4accd263c48d5ff3d551fd302ed8a4f8113a56e3b2c5364",
					"size": 25889,
					"status": "missing-in-source"
				},
				"test/gridstore/grid_store_stream_test.js": {
					"match": false,
					"packageHash": "0d1a8cbb062847f8e53b315e8d273c24bafb7c098157fc5337bd81c57f518673",
					"size": 2501,
					"status": "missing-in-source"
				},
				"test/gridstore/grid_store_test.js": {
					"match": false,
					"packageHash": "b593db35390a9919dff66fdaffb8631f4a17301308fa60abb616c9df1f33981f",
					"size": 16370,
					"status": "missing-in-source"
				},
				"test/gridstore/test_gs_weird_bug.png": {
					"match": false,
					"packageHash": "357ae8923961baeaf8eb1d434f5a3f8d9ac51ae0dbb2ed412e2687615f757ebc",
					"size": 52184,
					"status": "missing-in-source"
				},
				"test/gridstore/test_gs_working_field_read.pdf": {
					"match": false,
					"packageHash": "c866f44c43c7554e4b25394fa52901ee8c8c176649d4cd7f4dd4e92e8d4bd4f8",
					"size": 130253,
					"status": "missing-in-source"
				},
				"test/index_test.js": {
					"match": false,
					"packageHash": "e091cbc6c521856fd33c3fe36e8a89ed40cbc9330c7be612b3c6de4c80e5eb02",
					"size": 9889,
					"status": "missing-in-source"
				},
				"test/insert_test.js": {
					"match": false,
					"packageHash": "4dc0852d0b2a84e45f6b53cc78a79020b1ba245c259aa845b37a03f08995440f",
					"size": 17370,
					"status": "missing-in-source"
				},
				"test/map_reduce_test.js": {
					"match": false,
					"packageHash": "77b1cb4c25aeb0a3530785529abb19fe8f95939ca1183688b587cbe06d6941db",
					"size": 10430,
					"status": "missing-in-source"
				},
				"test/objectid_test.js": {
					"match": false,
					"packageHash": "0600c4c69bbcc14eab1835e95367b4ad51b555efa0d75f5a5c33a59a745e4d7c",
					"size": 4748,
					"status": "missing-in-source"
				},
				"test/regexp_test.js": {
					"match": false,
					"packageHash": "0bf213da7f8dcf6cc4a2ce70f862979a6f1c72d5f11a745382fa24d9b19945b0",
					"size": 3525,
					"status": "missing-in-source"
				},
				"test/remove_test.js": {
					"match": false,
					"packageHash": "3805f15d2b533d82e9dabb09288dab289050195677be06ab17b374339d52f5c1",
					"size": 2395,
					"status": "missing-in-source"
				},
				"test/replicaset/connect_test.js": {
					"match": false,
					"packageHash": "577258b6631ff57139c2bc399c4918668c1632b0a663672e0f39c71826854fdc",
					"size": 8413,
					"status": "missing-in-source"
				},
				"test/replicaset/count_test.js": {
					"match": false,
					"packageHash": "a500677390dfe25c975067be5a2be6d4e1623a4ee9b991950920bf6558ff1490",
					"size": 4265,
					"status": "missing-in-source"
				},
				"test/replicaset/insert_test.js": {
					"match": false,
					"packageHash": "1d9e5b409ac5f5c55e1fba5aebe9880e2f036e150afabcc02aedd8417368b693",
					"size": 7370,
					"status": "missing-in-source"
				},
				"test/replicaset/query_secondaries_test.js": {
					"match": false,
					"packageHash": "21d392b3f9fec69933d917f179547598073262dea6b91a368f4cf2b0d3d83ff6",
					"size": 6993,
					"status": "missing-in-source"
				},
				"test/streaming_test.js": {
					"match": false,
					"packageHash": "bd9369ff4b6b22fef8382b4922f67ea20758ad15ad8954e7e9beb443b8eea178",
					"size": 4022,
					"status": "missing-in-source"
				},
				"test/tools/replica_set_manager.js": {
					"match": false,
					"packageHash": "fccdd2befcfd4033884104754c6da5b22289928a15f839331038e8026e52fa80",
					"size": 15202,
					"status": "missing-in-source"
				},
				"test/tools/server_manager.js": {
					"match": false,
					"packageHash": "1f43a2c0e5883d8211b1e8dc91c8054606e7bb6cc83332748860e420737c52f5",
					"size": 3372,
					"status": "missing-in-source"
				},
				"test/unicode_test.js": {
					"match": false,
					"packageHash": "138880462d93b43d45efcfef144013c566d3418cbc1d78a458801f79848e87cb",
					"size": 5600,
					"status": "missing-in-source"
				},
				"tools/test_all.js": {
					"match": false,
					"packageHash": "32e57ec1c7b407f97c762bb43478013d667892c14879f2632b5ea82b3993c007",
					"size": 4022,
					"status": "missing-in-source"
				},
				".travis.yml": {
					"match": false,
					"status": "missing-in-package"
				},
				"install.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/connection.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/connection_pool.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/connection_utils.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/repl_set.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/server.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/strategies/ping_strategy.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/connection/strategies/statistics_strategy.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/cursorstream.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/gridfs/grid.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/gridfs/readstream.js": {
					"match": false,
					"status": "missing-in-package"
				},
				"lib/mongodb/utils.js": {
					"match": false,
					"status": "missing-in-package"
				}
			},
			"summary": {
				"differentFiles": 24,
				"matchingFiles": 1,
				"missingInPackage": 13,
				"missingInSource": 141,
				"score": 0.00558659217877095,
				"totalFiles": 179
			}
		}
	}
]
